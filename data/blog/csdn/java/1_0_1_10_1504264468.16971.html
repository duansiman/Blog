
        <div class="markdown_views"><ul>
<li>XmlHttp是什么？</li>
</ul>



<pre class="prettyprint"><code class=" hljs livecodeserver">最通用的定义为：XmlHttp是一套可以在Javascript、VbScript、Jscript等脚本语言中通过<span class="hljs-keyword">http</span>协议传送或从接收XML及其他数据的一套API。XmlHttp最大的用处是可以更新网页的部分内容而不需要刷新整个页面。
来自MSDN的解释：XmlHttp提供客户端同<span class="hljs-keyword">http</span>服务器通讯的协议。客户端可以通过XmlHttp对象(MSXML2.XMLHTTP<span class="hljs-number">.3</span><span class="hljs-number">.0</span>)向<span class="hljs-keyword">http</span>服务器发送请求并使用微软XML文档对象模型Microsoft® XML Document Object Model (DOM)处理回应。 

现在的绝对多数浏览器都增加了对XmlHttp的支持，IE中使用ActiveXObject方式创建XmlHttp对象，其他浏览器如：Firefox、Opera等通过window.XMLHttpRequest来创建xmlhttp对象。 
</code></pre>

<ul>
<li>AJAX即“Asynchronous Javascript And   XML”（异步JavaScript和XML），是指一种创建交互式网页应用的网页开发技术。</li>
<li>AJAX 是一种用于创建快速动态网页的技术。</li>
<li>作用：通过在后台与服务器进行少量数据交换，AJAX 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。</li>
<li>ajax对象参考： <br />
属性：</li>
</ul>



<pre class="prettyprint"><code class=" hljs livecodeserver">    onreadystatechange* 指定当readyState属性改变时的事件处理句柄。只写 
    readyState  返回当前请求的状态，只读. 
    responseBody  将回应信息正文以unsigned <span class="hljs-keyword">byte</span>数组形式返回.只读 
    responseStream 以Ado Stream对象的形式返回响应信息。只读 
    responseText 将响应信息作为字符串返回.只读 
    responseXML 将响应信息格式化为Xml Document对象并返回，只读 
    status 返回当前请求的<span class="hljs-keyword">http</span>状态码.只读 
    statusText  返回当前请求的响应行状态，只读 
</code></pre>

<p>方法：</p>



<pre class="prettyprint"><code class=" hljs livecodeserver">    abort 取消当前请求 
    getAllResponseHeaders 获取响应的所有<span class="hljs-keyword">http</span>头 
    getResponseHeader 从响应信息中获取指定的<span class="hljs-keyword">http</span>头 
    <span class="hljs-built_in">open</span> 创建一个新的<span class="hljs-keyword">http</span>请求，并指定此请求的方法、<span class="hljs-built_in">URL</span>以及验证信息(用户名/密码) 
    <span class="hljs-built_in">send</span> 发送请求到<span class="hljs-keyword">http</span>服务器并接收回应 
    setRequestHeader 单独指定请求的某个<span class="hljs-keyword">http</span>头 </code></pre>

<ul>
<li>两个重要类状态信息： <br />
readyState</li>
</ul>



<pre class="prettyprint"><code class=" hljs livecodeserver">变量，此属性只读，状态用长度为<span class="hljs-number">4</span>的整型表示.定义如下：

<span class="hljs-number">0</span> (未初始化) 对象已建立，但是尚未初始化（尚未调用<span class="hljs-built_in">open</span>方法） 
<span class="hljs-number">1</span> (初始化) 对象已建立，尚未调用<span class="hljs-built_in">send</span>方法 
<span class="hljs-number">2</span> (发送数据) <span class="hljs-built_in">send</span>方法已调用，但是当前的状态及<span class="hljs-keyword">http</span>头未知 
<span class="hljs-number">3</span> (数据传送中) 已接收部分数据，因为响应及<span class="hljs-keyword">http</span>头不全，这时通过responseBody和responseText获取部分数据会出现错误， 
<span class="hljs-number">4</span> (完成) 数据接收完毕,此时可以通过通过responseBody和responseText获取完整的回应数据 
</code></pre>

<p>status</p>



<pre class="prettyprint"><code class=" hljs mathematica">长整形标准http状态码，定义如下： <span class="hljs-keyword">Number</span>  Description  
<span class="hljs-number">100</span> <span class="hljs-keyword">Continue</span>
<span class="hljs-number">101</span> Switching protocols 
<span class="hljs-number">200</span>  OK 
<span class="hljs-number">201</span> Created 
<span class="hljs-number">202</span> Accepted 
<span class="hljs-number">203</span> Non-Authoritative <span class="hljs-keyword">Information</span> 
<span class="hljs-number">204</span> No Content 
<span class="hljs-number">205</span> Reset Content 
<span class="hljs-number">206</span> Partial Content 
<span class="hljs-number">300</span> Multiple Choices 
<span class="hljs-number">301</span> Moved Permanently 
<span class="hljs-number">302</span> Found
<span class="hljs-number">303</span> See Other 
<span class="hljs-number">304</span> <span class="hljs-keyword">Not</span> Modified 
<span class="hljs-number">305</span> Use Proxy
<span class="hljs-number">307</span> <span class="hljs-keyword">Temporary</span> Redirect
<span class="hljs-number">400</span> Bad Request
<span class="hljs-number">401</span> Unauthorized 
<span class="hljs-number">402</span> Payment Required
<span class="hljs-number">403</span> Forbidden 
<span class="hljs-number">404</span> <span class="hljs-keyword">Not</span> Found 
<span class="hljs-number">405</span> <span class="hljs-keyword">Method</span> <span class="hljs-keyword">Not</span> Allowed 
<span class="hljs-number">406</span> <span class="hljs-keyword">Not</span> Acceptable
<span class="hljs-number">407</span> Proxy Authentication Required 
<span class="hljs-number">408</span> Request Timeout 
<span class="hljs-number">409</span> Conflic 
<span class="hljs-number">410</span> Gone 
<span class="hljs-number">411</span> <span class="hljs-keyword">Length</span> Required 
<span class="hljs-number">412</span> Precondition Failed 
<span class="hljs-number">413</span> Request Entity Too <span class="hljs-keyword">Large</span> 
<span class="hljs-number">414</span> Request-URI Too Long 
<span class="hljs-number">415</span> Unsupported Media Type 
<span class="hljs-number">416</span> Requested <span class="hljs-keyword">Range</span> <span class="hljs-keyword">Not</span> Suitable 
<span class="hljs-number">417</span> <span class="hljs-keyword">Expectation</span> Failed 
<span class="hljs-number">500</span> Internal Server Error 
<span class="hljs-number">501</span> <span class="hljs-keyword">Not</span> Implemented 
<span class="hljs-number">502</span> Bad Gateway 
<span class="hljs-number">503</span> Service Unavailable 
<span class="hljs-number">504</span> Gateway Timeout 
<span class="hljs-number">505</span> HTTP <span class="hljs-keyword">Version</span> <span class="hljs-keyword">Not</span> Supported
</code></pre>

<ul>
<li>使用步骤：</li>
</ul>



<pre class="prettyprint"><code class=" hljs livecodeserver">    <span class="hljs-number">1</span>创建一个ajax对象(XMLHttpResquest)
    <span class="hljs-number">2</span>设置通讯方式和地址(<span class="hljs-built_in">open</span>)
    <span class="hljs-number">3</span>设置访问成功后的 js对象(回调函数)(onreadystatechange)
    <span class="hljs-number">4</span>发送（<span class="hljs-built_in">post</span>.<span class="hljs-built_in">get</span>）(<span class="hljs-built_in">send</span>)</code></pre>

<hr />

<p>下面是详细代码演示： <br />
index.jsp</p>



<pre class="prettyprint"><code class=" hljs xml"><span class="vbscript">&lt;%@ page language=<span class="hljs-string">"java"</span> import=<span class="hljs-string">"java.util.*"</span> pageEncoding=<span class="hljs-string">"UTF-8"</span>%&gt;</span>
<span class="vbscript">&lt;%@taglib uri=<span class="hljs-string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="hljs-string">"c"</span>%&gt;</span>

<span class="hljs-doctype">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>演示Ajax技术<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="javascript">
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check1</span><span class="hljs-params">(obj)</span>{</span>
            <span class="hljs-comment">//先进行数据格式检验--这里省了</span>
            <span class="hljs-keyword">var</span> name=obj.value;
             <span class="hljs-comment">//1创建一个ajax对象//xmlHttp.</span>
             <span class="hljs-comment">//IE中使用ActiveXObject方式创建XmlHttp对象，其他浏览器如：Firefox、Opera等通过window.XMLHttpRequest来创建xmlhttp对象。</span>
            <span class="hljs-keyword">var</span> xhr=<span class="hljs-literal">null</span>;
            <span class="hljs-keyword">if</span>(window.XMLHttpRequest){<span class="hljs-comment">//ie7 Firefox、Opera等通过window.XMLHttpRequest来创建xmlhttp对象。</span>
                xhr=<span class="hljs-keyword">new</span> XMLHttpRequest();
            }<span class="hljs-keyword">else</span>{<span class="hljs-comment">//老版本</span>
                xhr=<span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Microsoft.XMLHttp"</span>);
            }

             <span class="hljs-keyword">var</span> url=<span class="hljs-string">"&lt;c:url value='/OneServlet?name="</span>+name+<span class="hljs-string">"'/&gt;"</span>;
              <span class="hljs-comment">//2 设置通讯方式和地址</span>
             xhr.open(<span class="hljs-string">"GET"</span>, url, <span class="hljs-literal">true</span>);<span class="hljs-comment">//false异步--多线程</span>
             <span class="hljs-comment">//xhr.open("GET", url, false);//false同步--单线程</span>
              <span class="hljs-comment">//3 设置访问成功后的 js对象(回调函数)</span>
              xhr.onreadystatechange=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
                <span class="hljs-keyword">if</span>(xhr.readyState==<span class="hljs-number">4</span>){
                    <span class="hljs-keyword">if</span>(xhr.status==<span class="hljs-number">200</span>){
                        <span class="hljs-keyword">var</span> text=xhr.responseText;
                        alert(<span class="hljs-string">"服务器返回"</span>+text);
                        succ1(text);
                    }<span class="hljs-keyword">else</span>{
                         alert(<span class="hljs-string">"服务器响应出错信息,错误代码:"</span>+xhr.status);
                    }
                }   
              };
              <span class="hljs-comment">//4发送---Get方式，没有参数(请求体) ---数据在请求地址中</span>
              xhr.send(<span class="hljs-literal">null</span>);
              alert(<span class="hljs-string">"OKOK"</span>);<span class="hljs-comment">//同步时，必须等到ajax回来之后才会执行。异步时不用等</span>
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">succ1</span><span class="hljs-params">(obj)</span>{</span>
            div1.innerHTML=obj;
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check2</span><span class="hljs-params">(obj)</span>{</span>
            <span class="hljs-keyword">var</span> name=obj.value;

             <span class="hljs-comment">//1创建一个ajax对象//xmlHttp.</span>
             <span class="hljs-keyword">var</span> xhr=<span class="hljs-literal">null</span>;
             <span class="hljs-keyword">if</span>(window.XMLHttpRequest){<span class="hljs-comment">//ie7 Firefox、Opera等通过window.XMLHttpRequest来创建xmlhttp对象。</span>
                xhr=<span class="hljs-keyword">new</span> XMLHttpRequest();
            }<span class="hljs-keyword">else</span>{<span class="hljs-comment">//老版本</span>
                xhr=<span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Microsoft.XMLHttp"</span>);
            }

            <span class="hljs-comment">//2 设置通讯方式和地址</span>
             <span class="hljs-keyword">var</span> url=<span class="hljs-string">"&lt;c:url value='/OneServlet' /&gt;"</span>;

             xhr.open(<span class="hljs-string">"POST"</span>, url, <span class="hljs-literal">true</span>);

             xhr.onreadystatechange=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
                <span class="hljs-keyword">if</span>(xhr.readyState==<span class="hljs-number">4</span>){
                    <span class="hljs-keyword">if</span>(xhr.status==<span class="hljs-number">200</span>){
                        <span class="hljs-keyword">var</span> text=xhr.responseText;
                        alert(<span class="hljs-string">"服务器返回"</span>+text);
                        succ2(text);
                    }<span class="hljs-keyword">else</span>{
                         alert(<span class="hljs-string">"服务器响应出错信息,错误代码:"</span>+xhr.status);
                    }

                }
             };
            xhr.setRequestHeader(<span class="hljs-string">"Content-Type"</span>,<span class="hljs-string">"application/x-www-form-urlencoded"</span>);<span class="hljs-comment">//POST要设置响应头,而且要放在响应之后</span>

             <span class="hljs-comment">//4发送---Post方式，有参数(请求体) &lt;---数据 ※</span>
             xhr.send(<span class="hljs-string">"name="</span>+name);
             alert(<span class="hljs-string">"OKOK"</span>);<span class="hljs-comment">//同步时，必须等到ajax回来之后才会执行。异步时不用等</span>
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">succ2</span><span class="hljs-params">(obj)</span>{</span>
             div2.innerHTML=obj;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span>演示Ajax技术<span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">pre</span>&gt;</span>
     Ajax技术介绍:
          全称: Asynchronized(异步) Javascript And Xml
          技术组成: Javascript、DOM、CSS 和 XMLHttpRequest (ActiveXObject)
  readyState
    0 (未初始化) 对象已建立，但是尚未初始化（尚未调用open方法） 
    1 (初始化) 对象已建立，尚未调用send方法 
    2 (发送数据) send方法已调用，但是当前的状态及http头未知 
    3 (数据传送中) 已接收部分数据，因为响应及http头不全，这时通过responseBody和responseText获取部分数据会出现错误， 
    4 (完成) 数据接收完毕,此时可以通过通过responseBody和responseText获取完整的回应数据 
        <span class="hljs-tag">&lt;/<span class="hljs-title">pre</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">action</span>=<span class="hljs-value">""</span>&gt;</span>
        GET姓名1:<span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"name"</span> <span class="hljs-attribute">onblur</span>=<span class="hljs-value">"check1(this)"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"div1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>/&gt;</span>
        POST姓名2:<span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"name"</span> <span class="hljs-attribute">onblur</span>=<span class="hljs-value">"check2(this)"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"div2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>

<p>OneServlet.java</p>



<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> cn.hncu.servlet;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.PrintWriter;
<span class="hljs-keyword">import</span> java.text.SimpleDateFormat;
<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-keyword">import</span> javax.servlet.ServletException;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OneServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> {</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span>(HttpServletRequest request, HttpServletResponse response)
            <span class="hljs-keyword">throws</span> ServletException, IOException {

        response.setContentType(<span class="hljs-string">"text/html;charset=utf-8"</span>);
        PrintWriter out = response.getWriter();
        String name=request.getParameter(<span class="hljs-string">"name"</span>);
        SimpleDateFormat sdf=<span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
        out.println(name+<span class="hljs-string">"你好，来访时间是:"</span>+sdf.format(<span class="hljs-keyword">new</span> Date()) );
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">3000</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
<span class="hljs-comment">//      out.close();</span>

    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span>(HttpServletRequest request, HttpServletResponse response)
            <span class="hljs-keyword">throws</span> ServletException, IOException {
        response.setContentType(<span class="hljs-string">"text/html;charset=utf-8"</span>);
        PrintWriter out = response.getWriter();
        String name=request.getParameter(<span class="hljs-string">"name"</span>);
        <span class="hljs-keyword">int</span> i=<span class="hljs-number">100</span>/<span class="hljs-number">0</span>;<span class="hljs-comment">//故意让后台响应500的错误信息</span>
        SimpleDateFormat sdf=<span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
        out.println(name+<span class="hljs-string">"你好，来访时间是:"</span>+sdf.format(<span class="hljs-keyword">new</span> Date()) );
    }

}
</code></pre>

<hr />

<p>封装的ajax工具</p>



<pre class="prettyprint"><code class=" hljs actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Ajax</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-keyword">this</span>.<span class="hljs-keyword">get</span>=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url,succ1,failure)</span>{</span>
        <span class="hljs-keyword">var</span> http=<span class="hljs-keyword">this</span>.getHttp();
        http.open(<span class="hljs-string">"GET"</span>,url,<span class="hljs-literal">true</span>);
        http.onreadystatechange=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
            <span class="hljs-keyword">if</span>(http.readyState==<span class="hljs-number">4</span>){
                <span class="hljs-keyword">if</span>(http.status==<span class="hljs-number">200</span>){
                    <span class="hljs-keyword">var</span> text=http.responseText;
                    alert(text);
                    succ1(text);
                }<span class="hljs-keyword">else</span>{
                    <span class="hljs-keyword">if</span>(failure){
                        failure(http.status);
                    }
                }
            }   
          };
          http.send(<span class="hljs-literal">null</span>);
    };
    <span class="hljs-keyword">this</span>.post=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url,param,succ2,failure)</span>{</span>
        <span class="hljs-keyword">var</span> http=<span class="hljs-keyword">this</span>.getHttp();
        http.open(<span class="hljs-string">"post"</span>,url,<span class="hljs-literal">true</span>);
        http.setRequestHeader(<span class="hljs-string">"Content-Type"</span>,<span class="hljs-string">"application/x-www-form-urlencoded"</span>);
        http.onreadystatechange=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
            <span class="hljs-keyword">if</span>(http.readyState==<span class="hljs-number">4</span>){
                <span class="hljs-keyword">if</span>(http.status==<span class="hljs-number">200</span>){
                    <span class="hljs-keyword">var</span> text=http.responseText;
                    alert(text);
                    succ1(text);
                }<span class="hljs-keyword">else</span>{
                    <span class="hljs-keyword">if</span>(failure){
                        failure(http.status);
                    }
                }
            }   
          };
          http.send(param);
    };

    <span class="hljs-keyword">this</span>.getHttp=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-comment">//生成ajax对象</span>
        <span class="hljs-keyword">if</span>(window.XMLHttpRequest){
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> XMLHttpRequest();
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Microsoft.XMLHttp"</span>);
        }
    };
};


</code></pre></div>&#13;
        <script type="text/javascript">&#13;
            $(function () {&#13;
                $('pre.prettyprint code').each(function () {&#13;
                    var lines = $(this).text().split('\n').length;&#13;
                    var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;
                    $(this).addClass('has-numbering').parent().append($numbering);&#13;
                    for (i = 1; i &lt;= lines; i++) {&#13;
                        $numbering.append($('&lt;li/&gt;').text(i));&#13;
                    };&#13;
                    $numbering.fadeIn(1700);&#13;
                });&#13;
            });&#13;
        </script>&#13;
   &#13;
