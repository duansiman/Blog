
<p><span style="font-size:14px;">今天开始研究JNI技术，首先还是老套路，输出一个HelloWorld:具体流程如下:在Java中定义一个方法，在C++中实现这个方法，在方法内部输出“Hello World"，然后再回到Java中进行调用。分为以下步骤:</span></p><p><strong><span style="font-size:14px;">第一步:在Eclipse中建立一个类:JNIDemo</span></strong></p><p><span style="font-size:14px;"></span></p><pre name="code" class="java">package com.jni.demo;
public class JNIDemo {
	//定义一个本地方法
	public native void sayHello();
	public static void main(String[] args){
		//调用动态链接库
		System.loadLibrary("JNIDemo");
		JNIDemo jniDemo = new JNIDemo();
		jniDemo.sayHello();
	}
}</pre><span style="font-size:14px;">其中sayHello就是要在C++中实现的方法。</span><p><span style="font-size:14px;"><br /></span></p><p><strong><span style="font-size:14px;">第二步：使用javah命令将JNIDemo生成.h的头文件:</span></strong></p><p><span style="font-size:14px;">命令如下:</span></p><p><span style="font-size:14px;"><strong>E:\workspace\JNIDemo\bin&gt;javah com.jni.demo.JNIDemo</strong><br /></span></p><p><span style="color: rgb(255, 0, 0);"><strong><span style="font-size:14px;">注意:</span></strong></span></p><p><span style="font-size:14px;">1. 首先要确保配置了Java的环境变量的配置，不然javah命令不能用，具体怎么配置见:<a target="_blank" href="http://blog.csdn.net/jiangwei0910410003/article/details/17463173">http://blog.csdn.net/jiangwei0910410003/article/details/17463173</a></span></p><p><span style="font-size:14px;">2. 我的Java项目是放在E:\workspace中的，所以首先进入到工程的bin目录中，然后使用javah命令生成头文件</span></p><p><span style="font-size:14px;">3. javah后面的类文件的格式:是类的全名（包名+class文件名），同时不能有.class后缀</span></p><p><span style="font-size:14px;">命令执行成功后会在bin目录中生成头文件:com_jni_demo_JNIDemo.h</span></p><p><span style="font-size:14px;"><img src="http://img.blog.csdn.net/20160509154754808?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></span></p><p><span style="font-size:14px;"><strong>但是我们还需要注意一个问题，就是如果我们的包含native方法的类，如果引用其他地方的类，那么这时候进入bin\classes\目录下会出现问题提示找不到指定的类，这时候我们需要切换到源码目录src下运行即可。</strong></span></p><p><span style="font-size:14px;"><br /></span></p><p><strong><span style="font-size:14px;">第三步：使用VC6.0生成.dll文件:</span></strong></p><p><span style="font-size:14px;">首先创建一个dll工程:</span></p><p><span style="font-size:14px;"><img src="http://img.blog.csdn.net/20131221130638718?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhbmd3ZWkwOTEwNDEwMDAz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></span></p><p><span style="font-size:14px;"><img src="http://img.blog.csdn.net/20131221130706765?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhbmd3ZWkwOTEwNDEwMDAz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></span></p><p><span style="font-size:14px;"><img src="http://img.blog.csdn.net/20131221130716562?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhbmd3ZWkwOTEwNDEwMDAz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></span></p><p><span style="font-size:14px;">在.cpp文件中输入如下代码:</span></p><p></p><pre code_snippet_id="125036" snippet_file_name="blog_20131223_2_6541975" name="code" class="cpp"><span style="font-size:14px;">#include&lt;iostream.h&gt;
#include "com_jni_demo_JNIDemo.h"

JNIEXPORT void JNICALL Java_com_jni_demo_JNIDemo_sayHello (JNIEnv * env, jobject obj)
{
cout&lt;&lt;"Hello World"&lt;&lt;endl;
}</span></pre><span style="font-size:14px;"><br /></span><p></p><p><span style="color: rgb(255, 0, 0);"><strong><span style="font-size:14px;">说明:</span></strong></span></p><p><span style="font-size:14px;">1. JNIEXPORT void JNICALL Java_com_jni_demo_JNIDemo_sayHello (JNIEnv * env, jobject obj)<br />{<br /><span style="white-space:pre"></span><span style="white-space:pre">	</span>cout&lt;&lt;"Hello World"&lt;&lt;endl;<br />}</span></p><p><span style="font-size:14px;">这个方法的声明可以在上面生成的com_jni_demo_JNIDemo.h头文件中找到，这个就是Java工程中的sayHello方法的实现</span></p><p><span style="font-size:14px;">2. 这里编译会出现几个问题:</span></p><p><span style="font-size:14px;">(1):会提示你找不到相应的头文件：</span></p><p><span style="font-size:14px;"><img src="http://img.blog.csdn.net/20131221131124656?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhbmd3ZWkwOTEwNDEwMDAz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></span></p><p><span style="font-size:14px;">这时候需要将jni.h,jni_md.h文件考到工程目录中，这两个文件的具体位置在:</span></p><p><span style="font-size:14px;"><img src="http://img.blog.csdn.net/20131221131338234?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhbmd3ZWkwOTEwNDEwMDAz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></span></p><p><span style="font-size:14px;">java的安装目录中的include文件夹下，jni_md.h这个文件在win32文件夹中，找到这两个文件后，将其拷贝到C++的工程目录中；</span></p><p><span style="font-size:14px;">(2) 当拷贝到这两个文件之后，编译还是提示找不到这两个文件:主要原因就是#include&lt;jni.h&gt;这个是从系统目录中查找jni.h头文件的，而我们只把jni.h拷贝到工程目录中，所以需要在com_jni_demo_JNIDemo.h头文件中将#include&lt;jni.h&gt;改成#include "jni.h"，同理在jni.h文件中将#include&lt;jni_md.h&gt;改成#include "jni_md.h"</span></p><p><span style="font-size:14px;">(3) 同时还有一个错误就是，提示：e:\c++\jnidemo\jnidemo.cpp(9) : fatal error C1010: unexpected end of file while looking for precompiled header directive，这个是预编译头文件读写错误，这时候还要在VC中进行设置:项目-》设置-》C/C++;在分类中选择预编译头文件，选择不使用预补偿页眉:</span></p><p><span style="font-size:14px;"><img src="http://img.blog.csdn.net/20131221132211156?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhbmd3ZWkwOTEwNDEwMDAz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></span></p><p><span style="font-size:14px;">这样，编译成功，生成JNIDemo.dll文件在C++工程中的Debug目录中</span></p><p><span style="font-size:14px;"><br /></span></p><p><strong><span style="font-size:14px;">第四步:将JNIDemo.dll文件添加到path环境变量中:</span></strong></p><p><span style="font-size:14px;"><img src="http://img.blog.csdn.net/20131221132548343?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhbmd3ZWkwOTEwNDEwMDAz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></span></p><p><span style="color: rgb(255, 0, 0);"><strong><span style="font-size:14px;">注意:在用户变量中的path设置，用分号隔开: ” ;E:\C++\Debug“,这样就将.dll文件添加到环境变量中了</span></strong></span></p><p><span style="font-size:14px;"><br /></span></p><p><strong><span style="font-size:14px;">第五步:在Eclipse中调用sayHello方法输出"Hello World":代码如下:</span></strong></p><p></p><pre name="code" class="java">public static void main(String[] args){
	//调用动态链接库
	System.loadLibrary("JNIDemo");
	JNIDemo jniDemo = new JNIDemo();
	jniDemo.sayHello();
}</pre><p><span style="font-size:14px;">System.loadLibrary方法就是加载JNIDemo.dll文件的，一定要注意不要有.dll后缀名，只需要文件名即可；</span></p><p><span style="font-size:14px;">注意：运行的时候会报错:</span></p><p><span style="font-size:14px;"><img src="http://img.blog.csdn.net/20131221132933000?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhbmd3ZWkwOTEwNDEwMDAz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></span></p><p><span style="color: rgb(255, 0, 0);"><strong><span style="font-size:14px;">这个提示就是没有找到JNIDemo.dll文件，这时候我们需要关闭Eclipse，然后在打开，运行就没有错了，原因是Eclipse每次打开的时候都会去读取环境变量的配置，我们刚才配置的path，没有立即生效，所以要关闭Eclipse，然后从新打开一次即可。</span></strong></span></p><p><span style="font-size:14px;">至此，一个简单的JNI例子到此演示完毕，后续还有更高级的应用，要及时关注呀！</span></p>   &#13;
