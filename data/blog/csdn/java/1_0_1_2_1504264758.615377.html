

<h1>基本概念</h1>&#13;
<p>观察者模式：定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。这种模式最常用在我们熟悉的事件驱动模型里面，像VC、Android界面里面的事件响应，就是基于观察者模式来实现。</p>&#13;
<h1><strong>观察者模式含义</strong></h1>&#13;
<p>下面讲解一下个人对观察者模式的理解，其实这个模式在我们平时工作中是很常用的模式，可能你已经使用过，缺没有意识到。</p>&#13;
<p>　　观察者模式主要是针对一对多的数据更新。简单来说就是，系统里面某个元素更新了数据，然后有好几个元素是使用了这个元素的数据。此时更新了数据的对象，就要通知其他使用了它数据的对象，让他们都进行更新。</p>&#13;
<p>　　标准的观察者对象是一对多的关系，不过我们都知道设计模式里面是很灵活，在我们使用的时候，经常需要进行变形。对现有的标准模式进行适当的修改来适应设计需求。</p>&#13;
<p>　　在我们实际应用中，还会遇到一对一、或者多对一的情况。一对一就是，一个目标对应一个观察者。多对一是指多个目标对应一个观察者。</p>&#13;
<p> </p>&#13;
<p>类图：</p>&#13;
<p></p>&#13;
<h1>实例一</h1>&#13;
<p>该例子是这样的情景：例如：老师有电话号码，学生需要知道老师的电话号码以便于在合适的时候拨打，在这样的组合中，老师就是一个被观察者（Subject），学生就是需要知道信息的观察者，当老师的电话号码发生改变时，学生得到通知，并更新相应的电话记录。</p>&#13;
<p> </p>&#13;
<p align="left">Observer.java</p>&#13;
<p align="left"><span style="color:#3F5FBF">/**</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * Observer(</span><span style="color:#3F5FBF">观察者，</span><span style="color:#3F5FBF">Observer)</span><span style="color:#3F5FBF">：</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * </span><span style="color:#3F5FBF">为那些在目标发生改变时需要获得通知的对象定义一个更新接口。</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * </span><strong><span style="color:#7F9FBF">@author</span></strong><span style="color:#3F5FBF"> Andy.Chen</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> *</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> */</span></p>&#13;
<p align="left"><strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
interface</span></strong> <span style="background:lightgrey">Observer</span>{</p>&#13;
<p align="left"> </p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> update();</p>&#13;
<p>}</p>&#13;
<p> </p>&#13;
<p> </p>&#13;
<p align="left"> </p>&#13;
<p align="left">Subject.java</p>&#13;
<p align="left"><span style="color:#3F5FBF">/**</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * Subject(</span><span style="color:#3F5FBF">目标，</span><span style="color:#3F5FBF">Subject)</span><span style="color:#3F5FBF">：</span><span style="color:#3F5FBF"> &#13;
</span><span style="color:#3F5FBF">是我们定义目标对象，或者说被观察对象。</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * </span><span style="color:#3F5FBF">目标知道它的观察者。可以有任意多个观察者观察同一个目标。</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * </span><span style="color:#3F5FBF">提供注册和删除观察者对象的接口。</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * </span><strong><span style="color:#7F9FBF">@author</span></strong><span style="color:#3F5FBF"> Andy.Chen</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> *</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> */</span></p>&#13;
<p align="left"><strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
interface</span></strong> Subject {</p>&#13;
<p align="left"> </p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> attach(Observer mObserver);</p>&#13;
<p align="left">    </p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> detach(Observer mObserver);</p>&#13;
<p align="left">    </p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> notice();</p>&#13;
<p>}</p>&#13;
<p> </p>&#13;
<p> </p>&#13;
<p align="left"> </p>&#13;
<p align="left">Teacher.java</p>&#13;
<p align="left"><strong><span style="color:#7F0055">import</span></strong> java.util.Vector;</p>&#13;
<p align="left"> </p>&#13;
<p align="left"><span style="color:#3F5FBF">/**</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * ConcreteSubject(</span><span style="color:#3F5FBF">具体目标，</span><span style="color:#3F5FBF">Teacher)</span><span style="color:#3F5FBF">是实际的被观察对象</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * </span><span style="color:#3F5FBF">将有关状态存入各</span><span style="color:#3F5FBF">ConcreteObserve</span><span style="color:#3F5FBF">对象。</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * </span><span style="color:#3F5FBF">当他的状态发生改变时，向他的各个观察者发出通知。</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * </span><strong><span style="color:#7F9FBF">@author</span></strong><span style="color:#3F5FBF"> Andy.Chen</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> *</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> */</span></p>&#13;
<p align="left"><strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
class</span></strong> Teacher <strong><span style="color:#7F0055">implements</span></strong> Subject{</p>&#13;
<p align="left">    </p>&#13;
<p align="left">    <strong><span style="color:#7F0055">private</span></strong> String&#13;
<span style="color:#0000C0">phone</span>;</p>&#13;
<p align="left">    <strong><span style="color:#7F0055">private</span></strong> <u>&#13;
Vector</u> <span style="color:#0000C0">students</span>;</p>&#13;
<p align="left">    </p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span></strong> Teacher(){</p>&#13;
<p align="left">       <span style="color:#0000C0">phone</span> = <span style="color:#2A00FF">&#13;
""</span>;</p>&#13;
<p align="left">       <span style="color:#0000C0">students</span> = <strong><span style="color:#7F0055">new</span></strong>&#13;
<u>Vector</u>();</p>&#13;
<p align="left">    }</p>&#13;
<p align="left"> </p>&#13;
<p align="left">    <span style="color:#646464">@Override</span></p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> attach(Observer mObserver) {</p>&#13;
<p align="left">       <u><span style="color:#0000C0">students</span>.add(mObserver)</u>;</p>&#13;
<p align="left">    }</p>&#13;
<p align="left"> </p>&#13;
<p align="left">    <span style="color:#646464">@Override</span></p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> detach(Observer mObserver) {</p>&#13;
<p align="left">       <span style="color:#0000C0">students</span>.remove(mObserver);</p>&#13;
<p align="left">    }</p>&#13;
<p align="left"> </p>&#13;
<p align="left">    <span style="color:#646464">@Override</span></p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> notice() {</p>&#13;
<p align="left">       <strong><span style="color:#7F0055">for</span></strong>(<strong><span style="color:#7F0055">int</span></strong> i=0;i&lt;<span style="color:#0000C0">students</span>.size();i++){</p>&#13;
<p align="left">           ((Observer)<span style="color:#0000C0">students</span>.get(i)).update();</p>&#13;
<p align="left">       }</p>&#13;
<p align="left">    }</p>&#13;
<p align="left"> </p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span></strong> String&#13;
<span style="background:lightgrey">getPhone</span>() {</p>&#13;
<p align="left">       <strong><span style="color:#7F0055">return</span></strong>&#13;
<span style="color:#0000C0">phone</span>;</p>&#13;
<p align="left">    }</p>&#13;
<p align="left"> </p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> setPhone(String phone) {</p>&#13;
<p align="left">       <strong><span style="color:#7F0055">this</span></strong>.<span style="color:#0000C0">phone</span> = phone;</p>&#13;
<p align="left">       notice();</p>&#13;
<p align="left">    }</p>&#13;
<p align="left"> </p>&#13;
<p>}</p>&#13;
<p> </p>&#13;
<p>观察者对象</p>&#13;
<p align="left">Student.java</p>&#13;
<p align="left"><span style="color:#3F5FBF">/**</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * ConcreteObserver(</span><span style="color:#3F5FBF">具体观察者</span><span style="color:#3F5FBF">, Student)</span><span style="color:#3F5FBF">：是实际的观察者对象。</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * </span><span style="color:#3F5FBF">维护一个指向</span><span style="color:#3F5FBF">ConcreteSubject</span><span style="color:#3F5FBF">对象的引用。</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * </span><span style="color:#3F5FBF">存储有关状态，这些状态应与目标的状态保持一致。</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * </span><span style="color:#3F5FBF">实现</span><span style="color:#3F5FBF">Observer</span><span style="color:#3F5FBF">的更新接口以使自身状态与目标的状态保持一致。</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> * </span><strong><span style="color:#7F9FBF">@author</span></strong><span style="color:#3F5FBF"> Andy.Chen</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> *</span></p>&#13;
<p align="left"><span style="color:#3F5FBF"> */</span></p>&#13;
<p align="left"><strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
class</span></strong> Student <strong><span style="color:#7F0055">implements</span></strong> Observer{</p>&#13;
<p align="left"> </p>&#13;
<p align="left">    <strong><span style="color:#7F0055">private</span></strong> String&#13;
<span style="color:#0000C0">name</span>;</p>&#13;
<p align="left">    <strong><span style="color:#7F0055">private</span></strong> String&#13;
<span style="color:#0000C0">phone</span>;</p>&#13;
<p align="left">    <strong><span style="color:#7F0055">private</span></strong> Teacher&#13;
<span style="color:#0000C0">mTeacher</span>;</p>&#13;
<p align="left">    </p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span></strong> Student(String name,Teachert){</p>&#13;
<p align="left">       <strong><span style="color:#7F0055">this</span></strong>.<span style="color:#0000C0">name</span> = name;</p>&#13;
<p align="left">       <span style="color:#0000C0">mTeacher</span> = t;</p>&#13;
<p align="left">    }</p>&#13;
<p align="left">    </p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> show(){</p>&#13;
<p align="left">       System.<em><span style="color:#0000C0">out</span></em>.println(<span style="color:#2A00FF">"Name:"</span>+<span style="color:#0000C0">name</span>+<span style="color:#2A00FF">"\nTeacher'sphone:"</span> +&#13;
<span style="color:#0000C0">phone</span>);</p>&#13;
<p align="left">    }</p>&#13;
<p align="left">    </p>&#13;
<p align="left">    <span style="color:#646464">@Override</span></p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> update() {</p>&#13;
<p align="left">       <span style="color:#0000C0">phone</span> = <span style="color:#0000C0">&#13;
mTeacher</span>.getPhone();</p>&#13;
<p align="left">    }</p>&#13;
<p align="left"> </p>&#13;
<p>}</p>&#13;
<p> </p>&#13;
<p align="left"> </p>&#13;
<p align="left">测试类</p>&#13;
<p align="left">Test.java</p>&#13;
<p align="left"><strong><span style="color:#7F0055">import</span></strong> java.util.Vector;</p>&#13;
<p align="left"><strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
class</span></strong> Test {</p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
static</span> <span style="color:#7F0055">void</span></strong> main(String[] args) { </p>&#13;
<p align="left">           <u>Vector</u>students = <strong><span style="color:#7F0055">new</span></strong>&#13;
<u>Vector</u>();  </p>&#13;
<p align="left">           Teacher t = <strong><span style="color:#7F0055">new</span></strong> Teacher(); &#13;
</p>&#13;
<p align="left">           <strong><span style="color:#7F0055">for</span></strong>(<strong><span style="color:#7F0055">int</span></strong> i= 0;i&lt;10;i++){ &#13;
</p>&#13;
<p align="left">               Student st = <strong><span style="color:#7F0055">new</span></strong> Student(<span style="color:#2A00FF">"Andy.Chen"</span>+i,t); &#13;
</p>&#13;
<p align="left">               <u>students.add(st)</u>;  </p>&#13;
<p align="left">              t.attach(st);  </p>&#13;
<p align="left">           }  </p>&#13;
<p align="left">             </p>&#13;
<p align="left">            System.<em><span style="color:#0000C0">out</span></em>.println(<span style="color:#2A00FF">"Welcome to Andy.Chen Blog!"</span> +<span style="color:#2A00FF">"\n"</span>  &#13;
</p>&#13;
<p align="left">                       +<span style="color:#2A00FF">"Observer Patterns."</span> +<span style="color:#2A00FF">"\n"</span> &#13;
</p>&#13;
<p align="left">                       +<span style="color:#2A00FF">"-------------------------------"</span>); &#13;
</p>&#13;
<p align="left">             </p>&#13;
<p align="left">           t.setPhone(<span style="color:#2A00FF">"12345678"</span>); &#13;
</p>&#13;
<p align="left">           <strong><span style="color:#7F0055">for</span></strong>(<strong><span style="color:#7F0055">int</span></strong>i=0;i&lt;3;i++) &#13;
</p>&#13;
<p align="left">              ((Student)students.get(i)).show(); </p>&#13;
<p align="left">             </p>&#13;
<p align="left">           t.setPhone(<span style="color:#2A00FF">"87654321"</span>); &#13;
</p>&#13;
<p align="left">           <strong><span style="color:#7F0055">for</span></strong>(<strong><span style="color:#7F0055">int</span></strong>i=0;i&lt;3;i++) &#13;
</p>&#13;
<p align="left">              ((Student)students.get(i)).show(); </p>&#13;
<p align="left">        } </p>&#13;
<p align="left">}</p>&#13;
<p> </p>&#13;
<p> </p>&#13;
<h1>实例二</h1>&#13;
<p>Android中View的点击事件</p>&#13;
<p align="left">OnClickListener.java</p>&#13;
<p align="left"><strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
interface</span></strong> OnClickListener {</p>&#13;
<p align="left">       <strong><span style="color:#7F0055">void</span></strong> onClick(<span style="background:lightgrey">TextView</span> v);</p>&#13;
<p align="left">}</p>&#13;
<p> </p>&#13;
<p> </p>&#13;
<p> </p>&#13;
<p align="left"> </p>&#13;
<p align="left"><span style="background:rgb(211,211,211)">TextView</span>.java</p>&#13;
<p align="left"><strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
class</span></strong> <span style="background:lightgrey">TextView</span>{</p>&#13;
<p align="left"> </p>&#13;
<p align="left">    OnClickListener <span style="color:#0000C0">l</span>;</p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span></strong> TextView(){</p>&#13;
<p align="left">       </p>&#13;
<p align="left">    }</p>&#13;
<p align="left">    </p>&#13;
<p align="left">    <span style="color:#3F7F5F">//</span><span style="color:#3F7F5F">模拟点击</span></p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> click(){</p>&#13;
<p align="left">       <span style="color:#0000C0">l</span>.onClick(<strong><span style="color:#7F0055">this</span></strong>);</p>&#13;
<p align="left">    }</p>&#13;
<p align="left">    </p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> setOnClickListener(<u>OnClickListener</u> l){</p>&#13;
<p align="left">       <strong><span style="color:#7F0055">this</span></strong>.<span style="color:#0000C0">l</span> = l;</p>&#13;
<p align="left">    }</p>&#13;
<p>}</p>&#13;
<p> </p>&#13;
<p> </p>&#13;
<p align="left">Test.java</p>&#13;
<p align="left"><strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
class</span></strong> Test {</p>&#13;
<p align="left">    <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
static</span> <span style="color:#7F0055">void</span></strong> main(String[] args) {</p>&#13;
<p align="left">       TextView tv = <strong><span style="color:#7F0055">new</span></strong> TextView();</p>&#13;
<p align="left">       tv.setOnClickListener(<strong><span style="color:#7F0055">new</span></strong> OnClickListener() {</p>&#13;
<p align="left">           </p>&#13;
<p align="left">           <span style="color:#646464">@Override</span></p>&#13;
<p align="left">           <strong><span style="color:#7F0055">public</span> <span style="color:#7F0055">&#13;
void</span></strong> onClick(TextView v) {</p>&#13;
<p align="left">              System.<em><span style="color:#0000C0">out</span></em>.println(v.getClass().getName()+<span style="color:#2A00FF">"</span><span style="color:#2A00FF">点击了</span><span style="color:#2A00FF">"</span>);</p>&#13;
<p align="left">           }</p>&#13;
<p align="left">       });</p>&#13;
<p align="left">       tv.click();</p>&#13;
<p align="left">    }</p>&#13;
<p align="left">}</p>&#13;
<p> </p>&#13;
<p> </p>&#13;
<p align="left">总结：观察者模式何时适用？</p>&#13;
<p align="left">1.当一个抽象模型有两个方面，其中一个方面依赖于另一方面。将这二者封装在独立的对象中可以使他们各自独立地改变和复用。</p>&#13;
<p align="left">2.当对一个对象的改变需要同时改变其它对象，而不知道具体由多少对象有待改变。</p>&#13;
<p align="left">3.当一个对象必须通知其他对象，而它又不能假定其他对象是谁，换言之，你不希望这些对象是紧密耦合的。让耦合的双方都依赖于抽象，而不是依赖于具体。</p>&#13;
<p> </p>&#13;
   &#13;
