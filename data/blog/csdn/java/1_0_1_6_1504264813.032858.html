
<p>一，集成 Spring 与 Hibernate<br /> 1，配置SessionFactory<br />  1，配置<br />   ---------------------- applicationContext.xml ------------------------<br />   &lt;!-- 配置SessionFactory（整合Hibernate） --&gt;<br />   &lt;context:property-placeholder location="classpath:jdbc.properties" /&gt;<br />   &lt;bean id="sessionFactory"<br />    class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;<br />    &lt;property name="dataSource"&gt;<br />     &lt;bean class="com.mchange.v2.c3p0.ComboPooledDataSource"&gt;<br />      &lt;!-- 数据库连接信息 --&gt;<br />      &lt;property name="jdbcUrl" value="${jdbcUrl}"&gt;&lt;/property&gt;<br />      &lt;property name="driverClass" value="${driverClass}"&gt;&lt;/property&gt;<br />      &lt;property name="user" value="${username}"&gt;&lt;/property&gt;<br />      &lt;property name="password" value="${password}"&gt;&lt;/property&gt;<br />      &lt;!-- 其他配置 --&gt;<br />      &lt;property name="initialPoolSize" value="3"&gt;&lt;/property&gt;<br />      &lt;property name="maxPoolSize" value="5"&gt;&lt;/property&gt;<br />      &lt;property name="minPoolSize" value="3"&gt;&lt;/property&gt;<br />      &lt;property name="acquireIncrement" value="2"&gt;&lt;/property&gt;<br />      &lt;property name="maxStatements" value="8"&gt;&lt;/property&gt;<br />      &lt;property name="maxStatementsPerConnection" value="5"&gt;&lt;/property&gt;<br />      &lt;property name="maxIdleTime" value="20"&gt;&lt;/property&gt;<br />     &lt;/bean&gt;<br />    &lt;/property&gt;<br />    &lt;!-- 指定hibernate的配置文件的位置 --&gt;<br />    &lt;property name="configLocation" value="classpath:hibernate.cfg.xml"&gt;&lt;/property&gt;<br />   &lt;/bean&gt;<br />   ---------------------- jdbc.properties ------------------------<br />   jdbcUrl = jdbc:mysql:///itcastoa<br />   driverClass = com.mysql.jdbc.Driver<br />   username = root<br />   password = 1234<br />  2，测试代码<br />   @Test// 测试 SessionFactory 的配置<br />   public void testSessionFactory(){<br />    SessionFactory sessionFactory = (SessionFactory) ac.getBean("sessionFactory");<br />    Assert.assertNotNull(sessionFactory.openSession());<br />   }<br /> 2，配置声明式事务（使用基于注解的方式）<br />  1，配置<br />   &lt;!-- 配置事务管理器 --&gt;<br />   &lt;bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager"&gt;<br />    &lt;property name="sessionFactory" ref="sessionFactory"&gt;&lt;/property&gt;<br />   &lt;/bean&gt;<br />   &lt;!-- 配置基于注解的事务支持--&gt;<br />   &lt;tx:annotation-driven transaction-manager="transactionManager"/&gt;<br />  2，测试代码<br />   1，Service类<br />    @Service<br />    public class InsertUserService {<br />     @Resource<br />     private SessionFactory sessionFactory;<br />     @Transactional<br />     public void addUsers() {<br />      sessionFactory.getCurrentSession().save(new User());<br />      // int a = 1 / 0; // 这行会抛异常<br />      sessionFactory.getCurrentSession().save(new User());<br />     }<br />    }<br />   2，单元测试<br />    @Test // 测试声明式事务<br />    public void testTransaction() {<br />     InsertUserService service = (InsertUserService) ac.getBean("insertUserService");<br />     service.addUsers();<br />    }<br /> 3，在web.xml中配置 spring 的 OpenSessionInView 过滤器（解决抛LazyInitializationException的问题）<br />  1，配置<br />   &lt;!-- 配置 spring 的 OpenSessionInView 过滤器 --&gt;<br />   &lt;filter&gt;<br />    &lt;filter-name&gt;OpenSessionInView&lt;/filter-name&gt;<br />    &lt;filter-class&gt;org.springframework.orm.hibernate3.support.OpenSessionInViewFilter&lt;/filter-class&gt;<br />   &lt;/filter&gt;<br />   &lt;filter-mapping&gt;<br />    &lt;filter-name&gt;OpenSessionInView&lt;/filter-name&gt;<br />    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;<br />   &lt;/filter-mapping&gt;<br />  2，LazyInitializationException异常说明<br />   1，对于集合属性，默认是lazy="true"的，在第一次使用时才加载。<br />   2，但在加载时，如果Session已经关掉了就会抛LazyInitializationException异常</p><p>二，集成 Spring 与 Struts2.1.8.1<br /> 1，在web.xml配置监听器（Spring Reference 15.2 Common configuration）<br />  &lt;!-- 集成Spring --&gt;<br />  &lt;listener&gt;<br />   &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;<br />  &lt;/listener&gt;<br />  &lt;context-param&gt;<br />   &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;<br />   &lt;param-value&gt;/WEB-INF/classes/applicationContext*.xml&lt;/param-value&gt;<br />  &lt;/context-param&gt;<br /> 2，在struts-config.xml中配置controller（Spring Reference 15.4.1.1. DelegatingRequestProcessor）<br />  &lt;!-- 集成Spring --&gt;<br />  &lt;controller&gt;<br />   &lt;set-property property="processorClass" value="org.springframework.web.struts.DelegatingRequestProcessor" /&gt;<br />  &lt;/controller&gt;<br /> 3，测试<br />  1，写Action类与Service类<br />   @Controller("testAction")<br />   @Scope("prototype")<br />   public class TestAction extends ActionSupport {<br />    @Resource<br />    private TestService testService;<br />    @Override<br />    public String execute(){<br />     testService.saveTwoUser();<br />     return SUCCESS;<br />    }<br />   }<br />   @Service<br />   public class TestService {<br />    @Resource<br />    private SessionFactory sessionFactory;<br />    @Transactional<br />    public void saveTwoUser() {<br />     sessionFactory.getCurrentSession().save(new User());<br />     // int a = 1 / 0; // 这行会抛异常<br />     sessionFactory.getCurrentSession().save(new User());<br />    }<br />   }<br />  2，在struts.xml中配置Action<br />   &lt;!-- 测试 --&gt;<br />   &lt;action name="test" class="testAction"&gt;<br />    &lt;result&gt;/test.jsp&lt;/result&gt;<br />   &lt;/action&gt;<br />  3，部署到Tomcat中并访问测试。</p><p> 4，说明：<br />  1，在写Action时要指定 @Controller 与 @Scope("prototype")<br />  2，在struts.xml中配置action时，在class属性中写bean的名称<br />  <br />三，整合Spring与Jbpm4（jBPM4.4 Developers Guide, Chapter 17. Spring Integration） <br /> 1，在jbpm.cfg.xml中<br />  1，删除配置：<br />   &lt;import resource="jbpm.tx.hibernate.cfg.xml" /&gt;<br />  2，增加配置：<br />   &lt;!-- 整合Spring --&gt;<br />   &lt;import resource="jbpm.tx.spring.cfg.xml" /&gt;<br /> 2，在applicationContext.xml中配置<br />  &lt;!-- 配置ProcessEngine（整合jBPM4） --&gt;<br />  &lt;bean id="springHelper" class="org.jbpm.pvm.internal.processengine.SpringHelper"&gt;<br />   &lt;!-- jbpmCfg是相对于classpath的相对路径，默认值为jbpm.cfg.xml --&gt;<br />   &lt;property name="jbpmCfg" value="jbpm.cfg.xml"&gt;&lt;/property&gt;<br />  &lt;/bean&gt;<br />  &lt;bean id="processEngine" factory-bean="springHelper" factory-method="createProcessEngine" /&gt;<br /> 3，测试<br />  @Test // 测试ProcessEngine<br />  public void testProcessEngine() {<br />   ProcessEngine processEngine = (ProcessEngine) ac.getBean("processEngine");<br />   Assert.assertNotNull(processEngine);<br />  }</p><p> </p>   &#13;
