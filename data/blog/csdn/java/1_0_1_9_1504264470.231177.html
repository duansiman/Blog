

<p><strong>1、Log4j简介</strong></p>&#13;
<blockquote>&#13;
<p>  作用：</p>&#13;
<p>1、 跟踪代码的运行轨迹。</p>&#13;
<p>2、 输出调试信息</p>&#13;
</blockquote>&#13;
<p>三大组成：</p>&#13;
<blockquote>&#13;
<p>1、 <span style="color:blue">Logger</span><span style="color:blue">类</span>-生成日志。</p>&#13;
<p>2、 <span style="color:blue">Appender</span><span style="color:blue">类</span>-定义日志输出的目的地。</p>&#13;
<p>3、 <span style="color:blue">Layout</span><span style="color:blue">类</span>-指定日志输出的格式。</p>&#13;
</blockquote>&#13;
<p><strong>2、Logger组件</strong></p>&#13;
<p><strong></strong></p>&#13;
<p>                  日志共分为5种级别(ON开,OFF关这两个不计算在内)，从高到底（从严重到轻微）排序为:</p>&#13;
<p>                   FATAL—严重的错误,可能会导致程序不能正常运行. 类似System.exit()，整个项目都不能运行</p>&#13;
<p>                  ERROR– 错误，影响程序的正常运行。           类似当前线程挂了，但其它线程或组件还在跑</p>&#13;
<p>                   WARN– 警告，不会影响程序的运行。最好将此问题修正。</p>&#13;
<p>                    <span style="color:red">INFO – </span><span style="color:red">一般信息。不影响程序的运行。可能是用户的调试信息。可有可无。等同于</span><span style="color:red">syserr</span></p>&#13;
<p><span style="color:red">                    </span>DEBUG – <span style="color:red">&#13;
一般的信息。等同于</span><span style="color:red">sysout</span></p>&#13;
<p><span style="color:red"></span></p>&#13;
<p>                 上面五种级别分别对应以下几个方法</p>&#13;
<p>                       fatal(Object)</p>&#13;
<p>                       error(Object)</p>&#13;
<p>                       warn(Object)</p>&#13;
<p>                        <span style="color:red">info(Object)</span></p>&#13;
<p><span style="color:red">                        </span>debug(Object)</p>&#13;
<p><span style="color:red">              当信息大于或是等于配置的级别时才会输出日志</span>。</p>&#13;
<p><br />&#13;
</p>&#13;
<p></p>&#13;
<p><span style="color:#330033"><strong>3、Appender组件</strong></span></p>&#13;
<p><span style="color:#330033">  (仅要求记住两个)</span></p>&#13;
<p>  <span style="color:red">Console – </span><span style="color:red">控制台。</span><span style="color:red">org.apache.log4j.ConsoleAppender</span></p>&#13;
<p><span style="color:red">  </span>File   - <span style="color:red">文件。</span><span style="color:red"> &#13;
</span>org.apache.log4j.FileAppender, org.apache.log4j.RollingFileAppender</p>&#13;
<p><br />&#13;
</p>&#13;
<p></p>&#13;
<p><span style="color:#330033"><strong>4、Layout组件</strong></span></p>&#13;
<p><span style="color:#330033">  功能是定义日志的输出格式</span></p>&#13;
<p><span style="color:#330033">  org.apache.log4j.HTMLLayout</span></p>&#13;
<p><span style="color:#330033">  org.apache.log4j.PatternLayout (自定义)</span></p>&#13;
<p><span style="color:#330033">  org.apache.log4j.SimpleLayout</span></p>&#13;
<p><span style="color:#330033">  </span></p>&#13;
<p><span style="color:#330033">  对于自定义格式，see page 256 chart 17-1。</span></p>&#13;
<p><span style="color:#330033">  %d%p %c %m%n是我经常用的格式，要求记住.</span></p>&#13;
<p><span style="color:#330033">  %d –具体的时间.</span></p>&#13;
<p><span style="color:#330033">  %p –优先级</span></p>&#13;
<p><span style="color:#330033">  %c –信息的输出类</span></p>&#13;
<p><span style="color:#330033">  %L—行号</span></p>&#13;
<p><span style="color:#330033">  %m –信息文本</span></p>&#13;
<p><span style="color:#330033">  %n —换行符</span></p>&#13;
<br />&#13;
<p><span style="color:#330033"><strong>5、Log4j的基本使用方法</strong></span></p>&#13;
<p>    步1、将log4j.jar文件，Copy到WEB-INF/lib)目录下。</p>&#13;
<p>    （此时发布程序，启动程序，会发出警告信息。信息要求配置log4j.properties文件）</p>&#13;
<p>  步2、在src目录下（即WEB-INF/classes）建立一个log4j.properties文件</p>&#13;
<p>    在WEB-INF/classes目录下，为log4j的默认目录。Log4j.properties也是log4j的默认文件名。</p>&#13;
<p>  步3、书写log4j.properties文件如下：</p>&#13;
<p align="left">   <span style="color:#3F7F5F">#####</span><span style="color:#3F7F5F">配置根元素</span></p>&#13;
<p align="left"><span style="color:black">log4j.rootLogger=</span><span style="color:#2A00FF">INFO,file,console</span></p>&#13;
<p align="left"><span style="color:#3F7F5F">#file</span><span style="color:#3F7F5F">的输入地址为文件</span></p>&#13;
<p align="left"><span style="color:black">log4j.appender.file=</span><span style="color:#2A00FF">org.apache.log4j.RollingFileAppender</span></p>&#13;
<p align="left"><span style="color:#3F7F5F">#</span><span style="color:#3F7F5F">以下是具体的目录</span></p>&#13;
<p align="left"><span style="color:black">log4j.appender.file.File=</span><span style="color:#2A00FF">d</span><span style="color:black">:</span><span style="color:#2A00FF">/a.log</span></p>&#13;
<p align="left"><span style="color:#3F7F5F">#</span><span style="color:#3F7F5F">每个文件的最大大小</span></p>&#13;
<p align="left"><span style="color:black">log4j.appender.file.MaxFileSize=</span><span style="color:#2A00FF">512KB</span></p>&#13;
<p align="left"><span style="color:#3F7F5F">#</span><span style="color:#3F7F5F">最多可以是多少个文件</span></p>&#13;
<p align="left"><span style="color:black">log4j.appender.file.MaxBackupIndex=</span><span style="color:#2A00FF">3</span></p>&#13;
<p align="left"><span style="color:#3F7F5F">#</span><span style="color:#3F7F5F">信息的布局格式</span><span style="color:#3F7F5F">-</span><span style="color:#3F7F5F">按指定的格式打出</span></p>&#13;
<p align="left"><span style="color:black">log4j.appender.file.layout=</span><span style="color:#2A00FF">org.apache.log4j.PatternLayout</span></p>&#13;
<p align="left"><span style="color:#3F7F5F">#</span><span style="color:#3F7F5F">具体的布局格式</span><span style="color:#3F7F5F"> - %d</span><span style="color:#3F7F5F">为时间</span></p>&#13;
<p align="left"><u><span style="color:blue">log4j.appender.file.layout.ConversionPattern</span></u><span style="color:black">=</span><span style="color:#2A00FF">%d</span><span style="color:#2A00FF">%p</span><span style="color:#2A00FF">[%c]</span><span style="color:#2A00FF">%m%n</span></p>&#13;
<p align="left"> </p>&#13;
<p align="left"><span style="color:#3F7F5F">#</span><span style="color:#3F7F5F">以下配置输出到控制台</span></p>&#13;
<p align="left"><span style="color:black">log4j.appender.console=</span><span style="color:#2A00FF">org.apache.log4j.ConsoleAppender</span></p>&#13;
<p align="left"><span style="color:black">log4j.appender.console.layout=</span><span style="color:#2A00FF">org.apache.log4j.PatternLayout</span></p>&#13;
<p align="left"><span style="color:black">log4j.appender.console.layout.ConversionPattern=</span><span style="color:#2A00FF">%d</span><span style="color:#2A00FF">%p</span><span style="color:#2A00FF">[%c]</span><span style="color:#2A00FF">%m%n</span></p>&#13;
<p align="left"> </p>&#13;
<p align="left"><span style="color:red">####</span><span style="color:red">以下配置自己的类输出日志的信息</span><span style="color:red">,</span><span style="color:red">即将</span><span style="color:red">com.three</span><span style="color:red">包下的日志输出到的目录</span></p>&#13;
<p align="left"><span style="color:#3F7F5F">###</span><span style="color:#3F7F5F">同时也会打出到控制台。尽管是没有配置打出到控制台。但依据</span><span style="color:#3F7F5F">log4j</span><span style="color:#3F7F5F">的继承性，它仍然具体打出的控制台的功能。</span></p>&#13;
<p align="left"><span style="color:black">log4j.</span><span style="color:red">category</span><span style="color:black">.com.three=</span><span style="color:#2A00FF">INFO,myFile</span></p>&#13;
<p align="left"><span style="color:black">log4j.appender.myFile=</span><span style="color:#2A00FF">org.apache.log4j.RollingFileAppender</span></p>&#13;
<p align="left"><span style="color:black">log4j.appender.myFile.File=</span><span style="color:#2A00FF">d</span><span style="color:black">:</span><span style="color:#2A00FF">/b.txt</span></p>&#13;
<p align="left"><span style="color:black">log4j.appender.myFile.layout=</span><span style="color:#2A00FF">org.apache.log4j.PatternLayout</span></p>&#13;
<p align="left"><span style="color:black">log4j.appender.myFile.layout.ConversionPattern=</span><span style="color:#2A00FF">%d</span><span style="color:#2A00FF">%p</span><span style="color:#2A00FF">[%c]</span><span style="color:#2A00FF">%m%n</span></p>&#13;
<p><span style="color:#330033">具体的说明，请参考上面以#号注释的部分。</span></p>&#13;
<p><span style="color:#330033">注意上面红体字下面的部分，是书上没有讲的。此部分只配置对com.three包下的类指出日志信息。掌握具体配置的方法。</span></p>&#13;
<p><span style="color:#330033">使用<br />&#13;
</span></p>&#13;
<p></p><pre code_snippet_id="1845546" snippet_file_name="blog_20160822_1_7096905" name="code" class="html">&lt;span style="color:#330033;"&gt;package cn.hncu.reg.sendMail;

import java.util.Properties;

import javax.mail.Authenticator;
import javax.mail.Message.RecipientType;
import javax.mail.MessagingException;
import javax.mail.PasswordAuthentication;
import javax.mail.Session;
import javax.mail.Transport;
import javax.mail.internet.AddressException;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;

import org.apache.log4j.Logger;

public class SendEMailThread extends Thread {
	private String acode;
	private Logger log=Logger.getLogger(SendEMailThread.class);
	public SendEMailThread(String acode) {
		this.acode = acode;
	}

	@Override
	public void run() {
		Properties p=new Properties();
		p.setProperty("mail.host", "smtp.sina.com");
		p.setProperty("mail.smtp.auth", "true");
		Session session=Session.getDefaultInstance(p, new Authenticator() {

			@Override
			protected PasswordAuthentication getPasswordAuthentication() {
				PasswordAuthentication pa=new PasswordAuthentication("hncujava", "1234567");
				return pa;
			}
		});
		session.setDebug(true);
		MimeMessage msg=new MimeMessage(session);

		try {
			msg.setFrom( new InternetAddress("hncujava@sina.com") );
			msg.setRecipient(RecipientType.TO,  new InternetAddress("747205398@qq.com"));
			msg.setSubject("激活hncu账号");
			StringBuilder sb=new StringBuilder();
			sb.append("请激活邮箱:&lt;a href='http://127.0.0.1:8080/mailWeb/ActiveServlet");
			sb.append("?acode="+acode+" '&gt;点击激活&lt;/a&gt;");
			sb.append("&lt;br/&gt;如果激活未成功,请复制下面地址到浏览器地址栏进行手动激活:");
			sb.append("http://www.hncu.cn/mailWeb/ActiveServlet?acode="+acode);
			msg.setContent(sb.toString(),"text/html;charset=utf-8");
			Transport.send(msg);
			log.info("邮件发送成功");
		} catch (AddressException e) {
			log.error("邮箱地址错误，邮件发送失败");
			e.printStackTrace();
		} catch (MessagingException e) {
			e.printStackTrace();
			log.error("邮箱信息格式错误，邮件发送失败");
		}
	}

}&lt;/span&gt;
</pre><br />&#13;
<br />&#13;
&#13;
<br />&#13;
<br />&#13;
   &#13;
