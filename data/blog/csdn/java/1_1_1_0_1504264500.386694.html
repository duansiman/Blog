

<p>问题描述：（<strong>jsp自定义标签代码片段中出现出来多个相同类型的标签&lt;JB:ToobarCellComponent。那么jsp引擎是否实例化多个标签对象呢</strong>）那么大家可能就奇怪了，研究这个问题到底对我们项目研发有何好处呢？其实这个问题可以延伸出很多关于java自定义标签的一些高级应用以及自定义标签的解析原理，比如自定义标签按钮级别的权限控制【页面控件权值记录，初始化等】等。研究这些设计框架大有所益处，以下内容但愿对你有所帮助。也欢迎大家进入群【<span style="color:rgb(255,0,0); font-family:Arial; font-size:14px; line-height:26px; background-color:rgb(249,249,249)">376447127</span>】与我交流RAD快速开发平台相关技术。</p>&#13;
<pre code_snippet_id="537823" snippet_file_name="blog_20141201_1_8405788" name="code" class="html">&lt;JB:ToolBarCellComponent id="skinSetting_Toolbar" cellType="button" btnSelectName="新增" imgDisabled="plus.gif" imgEnabled="plus.gif" itemId="0"  optionItems=""&gt;&lt;/JB:ToolBarCellComponent&gt;
		    &lt;JB:ToolBarCellComponent id="skinSetting_Toolbar" cellType="separator" imgDisabled="" imgEnabled=""  itemId="1" optionItems=""&gt;&lt;/JB:ToolBarCellComponent&gt;
		    &lt;JB:ToolBarCellComponent id="skinSetting_Toolbar" cellType="button" btnSelectName="保存" imgDisabled="save.gif" imgEnabled="save.gif" itemId="2"  optionItems=""&gt;&lt;/JB:ToolBarCellComponent&gt;
		    &lt;JB:ToolBarCellComponent id="skinSetting_Toolbar" cellType="separator" imgDisabled="" imgEnabled=""  itemId="3" optionItems=""&gt;&lt;/JB:ToolBarCellComponent&gt;
		    &lt;JB:ToolBarCellComponent id="skinSetting_Toolbar" cellType="button" btnSelectName="删除" imgDisabled="delete.gif" imgEnabled="delete.gif" itemId="4"  optionItems=""&gt;&lt;/JB:ToolBarCellComponent&gt;
		    &lt;JB:ToolBarCellComponent id="skinSetting_Toolbar" cellType="separator" imgDisabled="" imgEnabled=""  itemId="5" optionItems=""&gt;&lt;/JB:ToolBarCellComponent&gt;
		    &lt;JB:ToolBarCellComponent id="skinSetting_Toolbar" cellType="button" btnSelectName="隐藏/关闭" imgDisabled="sysset.gif" imgEnabled="sysset.gif" itemId="6"  optionItems=""&gt;&lt;/JB:ToolBarCellComponent&gt;
		    &lt;JB:ToolBarCellComponent id="skinSetting_Toolbar" cellType="separator" imgDisabled="" imgEnabled=""  itemId="7" optionItems=""&gt;&lt;/JB:ToolBarCellComponent&gt;
		    &lt;JB:ToolBarCellComponent id="skinSetting_Toolbar" cellType="button" btnSelectName="刷新" imgDisabled="refresh.gif" imgEnabled="refresh.gif" itemId="8"  optionItems=""&gt;&lt;/JB:ToolBarCellComponent&gt;
		    &lt;JB:ToolBarCellComponent id="skinSetting_Toolbar" cellType="separator" imgDisabled="" imgEnabled=""  itemId="9" optionItems=""&gt;&lt;/JB:ToolBarCellComponent&gt;</pre>像以上这段<strong>jsp自定义标签代码片段中出现出来多个相同类型的标签&lt;JB:ToobarCellComponent。那么jsp引擎是否实例化多个标签对象呢？</strong>这个问题是接下里需要考究的！&#13;
<p></p>&#13;
<p>对于以上其中一个标签对应执行的相关操作我们可以通过查看jsp引擎编译整合jsp页面生成servlet类中一个方法，代码如下：</p>&#13;
<pre code_snippet_id="537823" snippet_file_name="blog_20141201_2_6543375" name="code" class="html">  private boolean _jspx_meth_JB_005fToolBarCellComponent_005f6(javax.servlet.jsp.tagext.JspTag _jspx_th_JB_005fToolBarComponent_005f0, PageContext _jspx_page_context)
          throws Throwable {
    PageContext pageContext = _jspx_page_context;
    JspWriter out = _jspx_page_context.getOut();
    //  JB:ToolBarCellComponent
    org.jplogic.system.core.soa.component.taglib.ToolBarCellControl _jspx_th_JB_005fToolBarCellComponent_005f6 = (org.jplogic.system.core.soa.component.taglib.ToolBarCellControl) _005fjspx_005ftagPool_005fJB_005fToolBarCellComponent_0026_005foptionItems_005fitemId_005fimgEnabled_005fimgDisabled_005fid_005fcellType_005fbtnSelectName_005fnobody.get(org.jplogic.system.core.soa.component.taglib.ToolBarCellControl.class);
   _jspx_th_JB_005fToolBarCellComponent_005f6.setPageContext(_jspx_page_context);
    _jspx_th_JB_005fToolBarCellComponent_005f6.setParent((javax.servlet.jsp.tagext.Tag)_jspx_th_JB_005fToolBarComponent_005f0);
    // /jsp/JpSystem/SystemParamConfigMngForm.jsp(342,6) name = id type = null reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_JB_005fToolBarCellComponent_005f6.setId("skinSetting_Toolbar");
    // /jsp/JpSystem/SystemParamConfigMngForm.jsp(342,6) name = cellType type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_JB_005fToolBarCellComponent_005f6.setCellType("button");
    // /jsp/JpSystem/SystemParamConfigMngForm.jsp(342,6) name = btnSelectName type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_JB_005fToolBarCellComponent_005f6.setBtnSelectName("隐藏/关闭");
    // /jsp/JpSystem/SystemParamConfigMngForm.jsp(342,6) name = imgDisabled type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_JB_005fToolBarCellComponent_005f6.setImgDisabled("sysset.gif");
    // /jsp/JpSystem/SystemParamConfigMngForm.jsp(342,6) name = imgEnabled type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_JB_005fToolBarCellComponent_005f6.setImgEnabled("sysset.gif");
    // /jsp/JpSystem/SystemParamConfigMngForm.jsp(342,6) name = itemId type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
  _jspx_th_JB_005fToolBarCellComponent_005f6.setItemId("6");
    // /jsp/JpSystem/SystemParamConfigMngForm.jsp(342,6) name = optionItems type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_JB_005fToolBarCellComponent_005f6.setOptionItems("");
    int _jspx_eval_JB_005fToolBarCellComponent_005f6 = _jspx_th_JB_005fToolBarCellComponent_005f6.doStartTag();
    if (_jspx_th_JB_005fToolBarCellComponent_005f6.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fJB_005fToolBarCellComponent_0026_005foptionItems_005fitemId_005fimgEnabled_005fimgDisabled_005fid_005fcellType_005fbtnSelectName_005fnobody.reuse(_jspx_th_JB_005fToolBarCellComponent_005f6);
      return true;
    }
    _005fjspx_005ftagPool_005fJB_005fToolBarCellComponent_0026_005foptionItems_005fitemId_005fimgEnabled_005fimgDisabled_005fid_005fcellType_005fbtnSelectName_005fnobody.reuse(_jspx_th_JB_005fToolBarCellComponent_005f6);
    return false;
  }</pre>&#13;
<p>通过以上代码你可以了解到在在jsp1.2规范中：（大家有兴趣可以去查看一下，可以很方便的让你了解到自定义标签技术的相关执行过程）</p>&#13;
<p><strong>1：</strong>当容器创建一个新的标签实例后，通过setPageContext设置标签的页面上下文。 </p>&#13;
<p><strong>2：</strong>使用setParent方法设置这个标签的上一级标签。如果没有上一级嵌套，设置为空。 </p>&#13;
<p><strong>3：</strong>设置标签的属性。这个属性在标签库描述文件中定义。如果没有定义属性就不调用此类方法。</p>&#13;
<p><strong>4：</strong>调用 doStartTag方法，这个方法可以返回EVAL_BODY_INCLUDE和SKIP_BODY。当返回EVAL_BODY_INCLUDE时，就计算标签的BODY，如果返回SKIP_BODY，就         不计算标签的BODY。 <br />&#13;
<strong>5：</strong>调用doEndTag方法，这个方法可以返回EVAL_PAGE或者SKIP_PAGE。当返回EVAL_PAGE时，容器将在标签结束时继续计算JSP页面的其他部分;如果返回SKIP_PAGE，容器将在标签结束时停止计算JSP页面的其他部分。</p>&#13;
<p><strong>6：</strong>调用release方法释放标签程序占用的任何资源。</p>&#13;
<p><strong>jsp引擎编译后的servlet类中看到标签对象引用：</strong></p>&#13;
<p><span style="background-color:rgb(240,240,240)"><strong><span style="color:#ff0000">private org.apache.jasper.runtime.TagHandlerPool</span></strong> _005fjspx_005ftagPool_005fJB_005fToolBarCellComponent_0026_005foptionItems_005fitemId_005fimgEnabled_005fimgDisabled_005fid_005fcellType_005fbtnSelectName_005fnobody;</span></p>&#13;
<p>当我们阅读这个有jsp引擎编译后的servlet的源代码可以看出，我们标签对象实例是通过标签处理对象池来获取，调用标签处理对象池TagHandlerPool类的get方法来获取相应的标签处理对象。入参为相应标签处理对象的class.。下面我们来看看这个jsp引擎编译后的servlet是如何通过TagHandlerPool来获取具体的标签处理对象的。</p>&#13;
<p>类TagHandlerPool内部代码如下：</p>&#13;
<pre code_snippet_id="537823" snippet_file_name="blog_20141201_3_4723607" name="code" class="html">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 * 
 *      http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
 
package org.apache.jasper.runtime;
 
import javax.servlet.ServletConfig;
import javax.servlet.jsp.JspException;
import javax.servlet.jsp.tagext.Tag;
 
import org.apache.jasper.Constants;
import org.apache.tomcat.InstanceManager;
import org.jboss.logging.Logger;
 
/**
 * Pool of tag handlers that can be reused.
 *
 * @author Jan Luehe
 */
public class TagHandlerPool {
 
    private Tag[] handlers;
 
    public static final String OPTION_TAGPOOL="tagpoolClassName";
    public static final String OPTION_MAXSIZE="tagpoolMaxSize";
 
    // index of next available tag handler
    private int current;
    protected InstanceManager instanceManager = null;
 
    public static TagHandlerPool getTagHandlerPool( ServletConfig config) {
        TagHandlerPool result=null;
 
        String tpClassName=getOption( config, OPTION_TAGPOOL, null);
        if( tpClassName != null ) {
            try {
                Class c=Class.forName( tpClassName );
                result=(TagHandlerPool)c.newInstance();
            } catch (Exception e) {
                result = null;
            }
        }
        &lt;strong&gt;&lt;span style="color:#ff0000;"&gt;if( result==null ) result=new PerThreadTagHandlerPool();&lt;/span&gt;
       &lt;span style="color:#ff0000;"&gt; result.init(config);&lt;/span&gt;&lt;/strong&gt;
 
        return result;
    }
 
    protected void init( ServletConfig config ) {
        int maxSize=-1;
        String maxSizeS=getOption(config, OPTION_MAXSIZE, null);
        if( maxSizeS != null ) {
            try {
                maxSize=Integer.parseInt(maxSizeS);
            } catch( Exception ex) {
                maxSize=-1;
            }
        }
        if( maxSize &lt;0  ) {
            maxSize=Constants.MAX_POOL_SIZE;
        }
        this.handlers = new Tag[maxSize];
        this.current = -1;
        instanceManager = InstanceManagerFactory.getInstanceManager(config);
    }
 
    /**
     * Constructs a tag handler pool with the default capacity.
     */
    public TagHandlerPool() {
    // Nothing - jasper generated servlets call the other constructor,
        // this should be used in future + init .
    }
 
    /**
     * Constructs a tag handler pool with the given capacity.
     *
     * @param capacity Tag handler pool capacity
     * @deprecated Use static getTagHandlerPool
     */
    public TagHandlerPool(int capacity) {
    this.handlers = new Tag[capacity];
    this.current = -1;
    }
 
    /**
     * Gets the next available tag handler from this tag handler pool,
     * instantiating one if this tag handler pool is empty.
     *
     * @param handlerClass Tag handler class
     *
     * @return Reused or newly instantiated tag handler
     *
     * @throws JspException if a tag handler cannot be instantiated
     */
    public Tag get(Class handlerClass) throws JspException {
        Tag handler;
        synchronized( this ) {
            if (current &gt;= 0) {
                handler = handlers[current--];
                return handler;
            }
        }
 
        // Out of sync block - there is no need for other threads to
        // wait for us to construct a tag for this thread.
        try {
            if (Constants.USE_INSTANCE_MANAGER_FOR_TAGS) {
                return (Tag) instanceManager.newInstance(handlerClass);
            } else {
                Tag instance = (Tag) handlerClass.newInstance();
                if (Constants.INJECT_TAGS) {
                    instanceManager.newInstance(instance);
                }
                return instance;
            }
        } catch (Exception e) {
            throw new JspException(e.getMessage(), e);
        }
    }
 
    /**
     * Adds the given tag handler to this tag handler pool, unless this tag
     * handler pool has already reached its capacity, in which case the tag
     * handler's release() method is called.
     *
     * @param handler Tag handler to add to this tag handler pool
     */
    public void reuse(Tag handler) {
        synchronized( this ) {
            if (current &lt; (handlers.length - 1)) {
                handlers[++current] = handler;
                return;
            }
        }
        // There is no need for other threads to wait for us to release
        handler.release();
        if (Constants.INJECT_TAGS || Constants.USE_INSTANCE_MANAGER_FOR_TAGS) {
            try {
                instanceManager.destroyInstance(handler);
            } catch (Exception e) {
                // Ignore
            }
        }
    }
 
    /**
     * Calls the release() method of all available tag handlers in this tag
     * handler pool.
     */
    public synchronized void release() {
        for (int i = current; i &gt;= 0; i--) {
            handlers[i].release();
            if (Constants.INJECT_TAGS || Constants.USE_INSTANCE_MANAGER_FOR_TAGS) {
                try {
                    instanceManager.destroyInstance(handlers[i]);
                } catch (Exception e) {
                    // Ignore
                }
            }
        }
    }
 
    protected static String getOption( ServletConfig config, String name, String defaultV) {
        if( config == null ) return defaultV;
 
        String value=config.getInitParameter(name);
        if( value != null ) return value;
        if( config.getServletContext() ==null )
            return defaultV;
        value=config.getServletContext().getInitParameter(name);
        if( value!=null ) return value;
        return defaultV;
    }
 
}</pre>通过以上源码可以看出&#13;
<p><code class="java keyword" style="font-size:1em!important; line-height:1.1em!important; white-space:pre; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-weight:bold!important; min-height:inherit!important; color:rgb(0,102,153)!important; background:none!important">if</code><code class="java plain" style="font-size:1em!important; line-height:1.1em!important; white-space:pre; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; min-height:inherit!important; background:none!important">(&#13;
 result==</code><code class="java keyword" style="font-size:1em!important; line-height:1.1em!important; white-space:pre; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-weight:bold!important; min-height:inherit!important; color:rgb(0,102,153)!important; background:none!important">null</code><code class="java plain" style="font-size:1em!important; line-height:1.1em!important; white-space:pre; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; min-height:inherit!important; background:none!important">)&#13;
 result=</code><code class="java keyword" style="font-size:1em!important; line-height:1.1em!important; white-space:pre; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-weight:bold!important; min-height:inherit!important; color:rgb(0,102,153)!important; background:none!important">new</code><code class="java plain" style="font-size:1em!important; line-height:1.1em!important; white-space:pre; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; min-height:inherit!important; background:none!important">PerThreadTagHandlerPool();</code></p>&#13;
<div class="line number57 index56 alt2" style="line-height:15.3999996185303px; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:inherit!important; white-space:pre!important">&#13;
<code class="java plain" style="border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:inherit!important; background:none!important">result.init(config);</code></div>&#13;
<div class="line number57 index56 alt2" style="line-height:15.3999996185303px; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:inherit!important; white-space:pre!important">&#13;
<code class="java plain" style="border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:inherit!important; background:none!important">下面我们再来看看<span style="line-height:15.3999996185303px">PerThreadTagHandlerPool类中的两个方法：</span></code></div>&#13;
<div class="line number57 index56 alt2" style="line-height:15.3999996185303px; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:inherit!important; white-space:pre!important">&#13;
<code class="java plain" style="border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:inherit!important; background:none!important"><span style="font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; line-height:15.3999996185303px; white-space:pre"></span></code><pre code_snippet_id="537823" snippet_file_name="blog_20141201_4_2903839" name="code" class="html">protected void init(ServletConfig config) {
        instanceManager = InstanceManagerFactory.getInstanceManager(config);
        maxSize = Constants.MAX_POOL_SIZE;
        String maxSizeS = getOption(config, OPTION_MAXSIZE, null);
        if (maxSizeS != null) {
            maxSize = Integer.parseInt(maxSizeS);
            if (maxSize &lt; 0) {
                maxSize = Constants.MAX_POOL_SIZE;
            }
        }
 
        perThread = new ThreadLocal&lt;PerThreadData&gt;() {
            protected PerThreadData initialValue() {
                PerThreadData ptd = new PerThreadData();
                ptd.handlers = new Tag[maxSize];
                ptd.current = -1;
                perThreadDataVector.addElement(ptd);
                return ptd;
            }
        };
    }
 
    /**
     * Gets the next available tag handler from this tag handler pool,
     * instantiating one if this tag handler pool is empty.
     *
     * @param handlerClass Tag handler class
     *
     * @return Reused or newly instantiated tag handler
     *
     * @throws JspException if a tag handler cannot be instantiated
     */
    public Tag get(Class handlerClass) throws JspException {
        PerThreadData ptd = (PerThreadData)perThread.get();
        if(ptd.current &gt;=0 ) {
            return ptd.handlers[ptd.current--];
        } else {
            try {
                if (Constants.USE_INSTANCE_MANAGER_FOR_TAGS) {
                    return (Tag) instanceManager.newInstance(handlerClass);
                } else {
                    Tag instance = (Tag) handlerClass.newInstance();
                    if (Constants.INJECT_TAGS) {
                        instanceManager.newInstance(instance);
                    }
                    return instance;
                }
            } catch (Exception e) {
                throw new JspException(e.getMessage(), e);
            }
        }
    }</pre>&#13;
 从以上代码可以看出<span style="font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; line-height:15.3999996185303px; white-space:pre">PerThreadTagHandlerPool继承类TagHandlerPool，</span>jsp引擎编译后的servlet</div>&#13;
<div class="line number57 index56 alt2" style="line-height:15.3999996185303px; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:inherit!important; white-space:pre!important">&#13;
首选通过<span style="font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; line-height:15.3999996185303px; white-space:pre">PerThreadTagHandlerPool的get方法获取相应标签处理对象实例</span></div>&#13;
<div class="line number57 index56 alt2" style="line-height:15.3999996185303px; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:inherit!important; white-space:pre!important">&#13;
<span style="font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; line-height:15.3999996185303px; white-space:pre">（首先判断线程池中是否存在需要的标签处理对象实例，如果存在直接返回，</span></div>&#13;
<div class="line number57 index56 alt2" style="line-height:15.3999996185303px; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:inherit!important; white-space:pre!important">&#13;
<span style="font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; line-height:15.3999996185303px; white-space:pre">不存在的话，通过上下文以及反射来创建新的标签处理对象）。</span></div>&#13;
<div class="line number57 index56 alt2" style="line-height:15.3999996185303px; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:inherit!important; white-space:pre!important">&#13;
<span style="font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; line-height:15.3999996185303px; white-space:pre">那么以上提出的<strong>jsp自定义标签代码片段中出现出来多个相同类型的标签&lt;JB:ToobarCellComponent。</strong></span></div>&#13;
<div class="line number57 index56 alt2" style="line-height:15.3999996185303px; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:inherit!important; white-space:pre!important">&#13;
<span style="font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; line-height:15.3999996185303px; white-space:pre"><strong>那么jsp引擎是否实例化多个标签对象呢？</strong>问题的答案就很清楚了！</span></div>&#13;
<div class="line number57 index56 alt2" style="line-height:15.3999996185303px; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:inherit!important; white-space:pre!important">&#13;
<span style="font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; line-height:15.3999996185303px; white-space:pre">该篇文章回答http://www.iteye.com/problems/30505链接提出的问题。</span></div>&#13;
<div class="line number57 index56 alt2" style="line-height:15.3999996185303px; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:inherit!important; white-space:pre!important">&#13;
<code class="java plain" style="border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; margin:0px!important; outline:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:inherit!important; background:none!important"><span style="font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; line-height:15.3999996185303px; white-space:pre"><br />&#13;
</span></code></div>&#13;
<p></p>&#13;
<br />&#13;
   &#13;
