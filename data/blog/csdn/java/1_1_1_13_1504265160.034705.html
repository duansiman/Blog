
                
<p>/*  <br/>&#13;
 * The source code for this program is not published or otherwise divested of<br/>&#13;
 * its trade secrets.<br/>&#13;
 * <br/>&#13;
 */</p>&#13;
<p>/** Ajax 请求的封装类 <br/>&#13;
 * Example:<br/>&#13;
 *  //实例化一个请求对象<br/>&#13;
 *  var ajaxObj = new AjaxProxyII();<br/>&#13;
 *  //设置ajax请求的url<br/>&#13;
 *  ajaxObj.setRequestUrl("localhost/projectName/path/someAction.action")<br/>&#13;
 *  //设置回调函数 回调函数 要有两个参function someFunc(data , textStatus);<br/>&#13;
 *  ajaxObj.setOnSuccess(someFunc);<br/>&#13;
 *  //设置要传递的参数 如果参数是对象形式<br/>&#13;
 *  ajaxObj.addParaObj(paraObject);<br/>&#13;
 *  //如果参数为键值对形势<br/>&#13;
 *  ajaxObj.addParameter("key" , value);<br/>&#13;
 *  //设置同步异步 默认为异步<br/>&#13;
 *  ajaxObj.setAsync(false);<br/>&#13;
 *  //发送请求<br/>&#13;
 *  ajaxObj.sendRequest();<br/>&#13;
 */<br/>&#13;
var AjaxProxyII = function(){<br/>&#13;
 this.parameter = new Object();<br/>&#13;
 this.pojoPackagePath = "com.taiyang.search.bean";<br/>&#13;
 this._props = new Object();<br/>&#13;
 this._argArray = new Array();<br/>&#13;
 this._pojoName = '';<br/>&#13;
 this._paraStr = '';<br/>&#13;
 this._props['asyn'] = true;<br/>&#13;
 this.setPojoName = function(pojoName){<br/>&#13;
  this._pojoName = this.pojoPackagePath + pojoName ;<br/>&#13;
 }<br/>&#13;
 <br/>&#13;
 this.setRequestUrl = function(url){<br/>&#13;
  this._props['url'] = url;<br/>&#13;
 }<br/>&#13;
 <br/>&#13;
 this.setOnSuccess = function(func){<br/>&#13;
  this._props['onSuccess'] = func;<br/>&#13;
 }<br/>&#13;
 <br/>&#13;
 this.addParaObj = function(obj){<br/>&#13;
  this._argArray.push(obj);<br/>&#13;
 }<br/>&#13;
 <br/>&#13;
 this.sendRequest = function(){<br/>&#13;
  var callfunc=this._props['onSuccess'];<br/>&#13;
  this.setupParaStr();<br/>&#13;
  $.ajax({<br/>&#13;
   <br/>&#13;
   type : 'POST',<br/>&#13;
   url : this._props['url'],<br/>&#13;
   success :function(data){<br/>&#13;
    if(data.indexOf('errormessage')&gt;-1){<br/>&#13;
     var tmpObj = eval( '(' + data + ')' );<br/>&#13;
     if(tmpObj['errorcode']=="0"){<br/>&#13;
      var windowsArr=new Array();<br/>&#13;
      getWindowTop(window,windowsArr,tmpObj['errormessage']);<br/>&#13;
      return;<br/>&#13;
     }else if(tmpObj['errorcode']=="1"){<br/>&#13;
      window.location.href=homeUrl+"/error.jsp?errormessage="+encodeURI(encodeURI(tmpObj['errormessage']));<br/>&#13;
      return;<br/>&#13;
     }<br/>&#13;
    }<br/>&#13;
    callfunc(data);<br/>&#13;
   },<br/>&#13;
   data :this._paraStr,<br/>&#13;
   async : this._props['asyn'],<br/>&#13;
   error : function(data , textStatus){<br/>&#13;
    //alert("错误" + data);<br/>&#13;
   }<br/>&#13;
  });<br/>&#13;
 }<br/>&#13;
 <br/>&#13;
 this.setParaStr = function(str){<br/>&#13;
  this._paraStr = str;<br/>&#13;
 }<br/>&#13;
 <br/>&#13;
 this.addParameter = function(key , value){<br/>&#13;
  this.parameter['' + key] = value;<br/>&#13;
 }<br/>&#13;
 this.setAsync = function(flag){<br/>&#13;
  this._props['asyn'] = flag;<br/>&#13;
 }<br/>&#13;
 this.setupParaStr = function(){<br/>&#13;
  <br/>&#13;
  if(this._pojoName != 'undefined' &amp;&amp; this._pojoName != ''){<br/>&#13;
   this._paraStr += '&amp;pojoName=' + this._pojoName  + '&amp;jsonData=';<br/>&#13;
   this._paraStr += JSON.stringify(this._argArray);<br/>&#13;
   <br/>&#13;
  }<br/>&#13;
  for(var i = 0 ; i&lt;this._argArray.length; i++){<br/>&#13;
   this._argArray[i] = null;<br/>&#13;
  }<br/>&#13;
  for(var p in this.parameter){<br/>&#13;
   this._paraStr += p + '=' + this.parameter[p] + '&amp;';<br/>&#13;
  }<br/>&#13;
//  this._paraStr = "乱码"<br/>&#13;
  //this._paraStr = encodeURI(this._paraStr);<br/>&#13;
  <br/>&#13;
 }  <br/>&#13;
} <br/>&#13;
</p>&#13;
<link rel="stylesheet" href="http://static.blog.csdn.net/public/res-min/markdown_views.css?v=1.0"/>&#13;
            