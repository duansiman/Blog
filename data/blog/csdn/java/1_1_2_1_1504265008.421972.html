
        <div class="markdown_views"><p>问题描述：一个web项目想在一个tomcat下运行多个实例（通过修改war包名称的实现），然后每个实例都将日志输出到tomcat的logs目录下实例名命名的文件夹下进行区分查看每个实例日志，要求通过尽可能少的改动配置文件，最好修改实例名后可以不修改log4j的配置文件。 <br />
实现分析：一般实现上面需求，需要在修改完war包名称之外要再做下面配置： <br />
1、修改每个实例名下web.xml中参数webAppRootKey为不同值。同一个tomcat下运行多个web应用时，该值相同的话，运行时会抛异常。 <br />
          <br />
        webAppRootKey <br />
        webApp.root <br />
     <br />
2、log4j配置文件日志输出路径修改 <br />
     log4j配置文件中路径配置一般有三种方法： <br />
（1）绝对路径法：直接配置为系统觉得路径； <br />
（2）相对路径法： <br />
            log4j.appender.logfile.File=../logs/app.log，将日志记录到tomcat下的logs文件夹； <br />
            log4j.appender.logfile.File=logs/app.log，将日志记录到tomcat的bin目录下的logs文件夹； <br />
（3）使用环境变量相对路径法：程序会优先找jvm环境变量，然后再找系统环境变量，来查找配置文件中的变量。 <br />
        log4j.appender.logfile.File=<span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-4-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-122" style="width: 21.976em; display: inline-block;"><span style="display: inline-block; position: relative; width: 17.549em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.763em 1000em 3.149em -0.477em); top: -2.717em; left: 0.003em;"><span class="mrow" id="MathJax-Span-123"><span class="texatom" id="MathJax-Span-124"><span class="mrow" id="MathJax-Span-125"><span class="mi" id="MathJax-Span-126" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-127" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-128" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-129" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-130" style="font-family: MathJax_Main;">.</span><span class="mi" id="MathJax-Span-131" style="font-family: MathJax_Math-italic; padding-left: 0.163em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-132" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-133" style="font-family: MathJax_Math-italic;">r</span></span></span><span class="texatom" id="MathJax-Span-134"><span class="mrow" id="MathJax-Span-135"><span class="mo" id="MathJax-Span-136" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-137" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-138" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-139" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-140" style="font-family: MathJax_Math-italic;">s</span><span class="texatom" id="MathJax-Span-141"><span class="mrow" id="MathJax-Span-142"><span class="mo" id="MathJax-Span-143" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-144" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-145" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-146" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-147" style="font-family: MathJax_Main;">.</span><span class="mi" id="MathJax-Span-148" style="font-family: MathJax_Math-italic; padding-left: 0.163em;">l</span><span class="mi" id="MathJax-Span-149" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-150" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-151"><span class="mrow" id="MathJax-Span-152"><span class="mo" id="MathJax-Span-153"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 80%; font-style: normal; font-weight: normal;">，</span></span></span></span><span class="texatom" id="MathJax-Span-154"><span class="mrow" id="MathJax-Span-155"><span class="mo" id="MathJax-Span-156"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 80%; font-style: normal; font-weight: normal;">使</span></span></span></span><span class="texatom" id="MathJax-Span-157"><span class="mrow" id="MathJax-Span-158"><span class="mo" id="MathJax-Span-159"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 80%; font-style: normal; font-weight: normal;">用</span></span></span></span><span class="mi" id="MathJax-Span-160" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-161" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-162" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-163" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-164" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-165" style="font-family: MathJax_Math-italic;">t</span><span class="texatom" id="MathJax-Span-166"><span class="mrow" id="MathJax-Span-167"><span class="mo" id="MathJax-Span-168"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 80%; font-style: normal; font-weight: normal;">容</span></span></span></span><span class="texatom" id="MathJax-Span-169"><span class="mrow" id="MathJax-Span-170"><span class="mo" id="MathJax-Span-171"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 80%; font-style: normal; font-weight: normal;">器</span></span></span></span><span class="texatom" id="MathJax-Span-172"><span class="mrow" id="MathJax-Span-173"><span class="mo" id="MathJax-Span-174"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 80%; font-style: normal; font-weight: normal;">时</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.723em;"></span></span></span><span style="border-left: 0.003em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.47em; vertical-align: -0.397em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-4">{user.dir}/logs/app.log，使用tomcat容器时</script>{user.dir}对应tomcat的bin目录； <br />
        log4j.appender.logfile.File=<span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-175" style="width: 14.509em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.576em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.763em 1000em 3.149em -0.477em); top: -2.717em; left: 0.003em;"><span class="mrow" id="MathJax-Span-176"><span class="texatom" id="MathJax-Span-177"><span class="mrow" id="MathJax-Span-178"><span class="mi" id="MathJax-Span-179" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-180" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-181" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-182" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-183" style="font-family: MathJax_Main;">.</span><span class="mi" id="MathJax-Span-184" style="font-family: MathJax_Math-italic; padding-left: 0.163em;">h</span><span class="mi" id="MathJax-Span-185" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-186" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-187" style="font-family: MathJax_Math-italic;">e</span></span></span><span class="texatom" id="MathJax-Span-188"><span class="mrow" id="MathJax-Span-189"><span class="mo" id="MathJax-Span-190" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-191" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-192" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-193" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-194" style="font-family: MathJax_Math-italic;">s</span><span class="texatom" id="MathJax-Span-195"><span class="mrow" id="MathJax-Span-196"><span class="mo" id="MathJax-Span-197" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-198" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-199" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-200" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-201" style="font-family: MathJax_Main;">.</span><span class="mi" id="MathJax-Span-202" style="font-family: MathJax_Math-italic; padding-left: 0.163em;">l</span><span class="mi" id="MathJax-Span-203" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-204" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-205"><span class="mrow" id="MathJax-Span-206"><span class="mo" id="MathJax-Span-207"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 80%; font-style: normal; font-weight: normal;">，</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.723em;"></span></span></span><span style="border-left: 0.003em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.47em; vertical-align: -0.397em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5">{user.home}/logs/app.log，</script>{user.home}对应操作系统当前用户目录； <br />
        log4j.appender.logfile.File=<span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-6-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-208" style="width: 15.469em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.376em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.763em 1000em 3.149em -0.477em); top: -2.717em; left: 0.003em;"><span class="mrow" id="MathJax-Span-209"><span class="texatom" id="MathJax-Span-210"><span class="mrow" id="MathJax-Span-211"><span class="mi" id="MathJax-Span-212" style="font-family: MathJax_Math-italic;">w</span><span class="mi" id="MathJax-Span-213" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-214" style="font-family: MathJax_Math-italic;">b</span><span class="mi" id="MathJax-Span-215" style="font-family: MathJax_Math-italic;">A</span><span class="mi" id="MathJax-Span-216" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-217" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-218" style="font-family: MathJax_Main;">.</span><span class="mi" id="MathJax-Span-219" style="font-family: MathJax_Math-italic; padding-left: 0.163em;">r</span><span class="mi" id="MathJax-Span-220" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-221" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-222" style="font-family: MathJax_Math-italic;">t</span></span></span><span class="texatom" id="MathJax-Span-223"><span class="mrow" id="MathJax-Span-224"><span class="mo" id="MathJax-Span-225" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-226" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-227" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-228" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-229" style="font-family: MathJax_Math-italic;">s</span><span class="texatom" id="MathJax-Span-230"><span class="mrow" id="MathJax-Span-231"><span class="mo" id="MathJax-Span-232" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-233" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-234" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-235" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-236" style="font-family: MathJax_Main;">.</span><span class="mi" id="MathJax-Span-237" style="font-family: MathJax_Math-italic; padding-left: 0.163em;">l</span><span class="mi" id="MathJax-Span-238" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-239" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-240"><span class="mrow" id="MathJax-Span-241"><span class="mo" id="MathJax-Span-242"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 80%; font-style: normal; font-weight: normal;">，</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.723em;"></span></span></span><span style="border-left: 0.003em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.47em; vertical-align: -0.397em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-6">{webApp.root}/logs/app.log，</script>{webApp.root}对应当前应用根目录；</p>

<p>暂时没找到不修改log4j配置而实现上面需求的方法。在log4j配置文件中可以获取环境变量来配置，但变量里没有当前应用的名称（不能直接通过webApp.root，因为它在不同的实例名称不一样），尝试在web.xml中增加listener，获取应用名称，然后调用System.setProperty(“contextPath”, sce.getServletContext().getContextPath());将上下文设置到系统变量中在log4j应用，但多实例运行时每个实例都会改变该属性值。 <br />
结论，该问题的解决方法： <br />
1、手动修改配置，修改war名称后手动修改web.xml和log4j配置文件，实现上述需求。 <br />
2、通过其它程序来进行批量修改，若bat或maven等在修改war包名称时，自动修改掉web.xml和log4j中相关配置。</p></div>&#13;
        <script type="text/javascript">&#13;
            $(function () {&#13;
                $('pre.prettyprint code').each(function () {&#13;
                    var lines = $(this).text().split('\n').length;&#13;
                    var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;
                    $(this).addClass('has-numbering').parent().append($numbering);&#13;
                    for (i = 1; i &lt;= lines; i++) {&#13;
                        $numbering.append($('&lt;li/&gt;').text(i));&#13;
                    };&#13;
                    $numbering.fadeIn(1700);&#13;
                });&#13;
            });&#13;
        </script>&#13;
   &#13;
