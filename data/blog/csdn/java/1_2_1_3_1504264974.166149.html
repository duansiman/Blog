

<br />&#13;
<br />&#13;
<strong>一、定义（概念）</strong><br />&#13;
<br />&#13;
<br />&#13;
允许一个对象在其内部状态改变的时候改变其行为。<br />&#13;
<p>看上去就像是改变了它的类一样。</p>&#13;
<p><br />&#13;
</p>&#13;
<strong>二、适用场景</strong><br />&#13;
<br />&#13;
<br />&#13;
一个对象的行为取决于他的状态，并且它必须在运行时根据状态改变它的行为；<br />&#13;
<p>一个操作中含有庞大的多分支结构，并且这些分支决定于对象的状态。</p>&#13;
<p><br />&#13;
</p>&#13;
<strong>涉及角色：</strong><br />&#13;
　　●　　环境(Context)角色，也成上下文：定义客户端所感兴趣的接口，并且保留一个具体状态类的实例。这个具体状态类的实例给出此环境对象的现有状态。<br />&#13;
<br />&#13;
<br />&#13;
　　●　　抽象状态(State)角色：定义一个接口，用以封装环境（Context）对象的一个特定的状态所对应的行为。<br />&#13;
<br />&#13;
<br />&#13;
　　●　　具体状态(ConcreteState)角色：每一个具体状态类都实现了环境（Context）的一个状态所对应的行为。<br />&#13;
<br />&#13;
<br />&#13;
<strong>三、UML</strong><br />&#13;
<p>用一句话来表述，状态模式把所研究的对象的行为包装在不同的状态对象里，每一个状态对象都属于一个抽象状态类的一个子类。状态模式的意图是让一个对象在其内部状态改变的时候，其行为也随之改变。状态模式的示意性类图如下所示：</p>&#13;
<p><img src="http://pic002.cnblogs.com/images/2012/73404/2012120416314284.jpg" alt="" /><br />&#13;
</p>&#13;
<br />&#13;
<br />&#13;
<strong>四、代码</strong><br />&#13;
<br />&#13;
<div class="cnblogs_code" style="word-wrap:break-word; border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; line-height:28px; font-family:'Courier New'!important; background-color:rgb(245,245,245)">&#13;
<pre style="margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="color:rgb(0,0,255); line-height:1.5!important">public</span> <span style="color:rgb(0,0,255); line-height:1.5!important">class</span><span style="line-height:1.5!important"> Context {
    </span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important">持有一个State类型的对象实例</span>
    <span style="color:rgb(0,0,255); line-height:1.5!important">private</span><span style="line-height:1.5!important"> State state;

    </span><span style="color:rgb(0,0,255); line-height:1.5!important">public</span> <span style="color:rgb(0,0,255); line-height:1.5!important">void</span><span style="line-height:1.5!important"> setState(State state) {
        </span><span style="color:rgb(0,0,255); line-height:1.5!important">this</span>.state =<span style="line-height:1.5!important"> state;
    }
    </span><span style="color:rgb(0,128,0); line-height:1.5!important">/**</span><span style="color:rgb(0,128,0); line-height:1.5!important">
     * 用户感兴趣的接口方法
     </span><span style="color:rgb(0,128,0); line-height:1.5!important">*/</span>
    <span style="color:rgb(0,0,255); line-height:1.5!important">public</span> <span style="color:rgb(0,0,255); line-height:1.5!important">void</span><span style="line-height:1.5!important"> request(String sampleParameter) {
        </span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important">转调state来处理</span>
<span style="line-height:1.5!important">        state.handle(sampleParameter);
    }
}</span></pre>&#13;
<div class="cnblogs_code_toolbar" style="word-wrap:break-word; margin-top:5px"><span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important"><a target="_blank" title="复制代码" style="color:rgb(46,156,233); border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px; border:none!important" /></a></span></div>&#13;
</div>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　抽象状态类</p>&#13;
<div class="cnblogs_code" style="word-wrap:break-word; border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; line-height:28px; font-family:'Courier New'!important; background-color:rgb(245,245,245)">&#13;
<div class="cnblogs_code_toolbar" style="word-wrap:break-word; margin-top:5px"><span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important"><a target="_blank" title="复制代码" style="color:rgb(46,156,233); border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px; border:none!important" /></a></span></div>&#13;
<pre style="margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="color:rgb(0,0,255); line-height:1.5!important">public</span> <span style="color:rgb(0,0,255); line-height:1.5!important">interface</span><span style="line-height:1.5!important"> State {
    </span><span style="color:rgb(0,128,0); line-height:1.5!important">/**</span><span style="color:rgb(0,128,0); line-height:1.5!important">
     * 状态对应的处理
     </span><span style="color:rgb(0,128,0); line-height:1.5!important">*/</span>
    <span style="color:rgb(0,0,255); line-height:1.5!important">public</span> <span style="color:rgb(0,0,255); line-height:1.5!important">void</span><span style="line-height:1.5!important"> handle(String sampleParameter);
}</span></pre>&#13;
<div class="cnblogs_code_toolbar" style="word-wrap:break-word; margin-top:5px"><span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important"><a target="_blank" title="复制代码" style="color:rgb(46,156,233); border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px; border:none!important" /></a></span></div>&#13;
</div>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　具体状态类</p>&#13;
<div class="cnblogs_code" style="word-wrap:break-word; border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; line-height:28px; font-family:'Courier New'!important; background-color:rgb(245,245,245)">&#13;
<div class="cnblogs_code_toolbar" style="word-wrap:break-word; margin-top:5px"><span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important"><a target="_blank" title="复制代码" style="color:rgb(46,156,233); border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px; border:none!important" /></a></span></div>&#13;
<pre style="margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="color:rgb(0,0,255); line-height:1.5!important">public</span> <span style="color:rgb(0,0,255); line-height:1.5!important">class</span> ConcreteStateA <span style="color:rgb(0,0,255); line-height:1.5!important">implements</span><span style="line-height:1.5!important"> State {

    @Override
    </span><span style="color:rgb(0,0,255); line-height:1.5!important">public</span> <span style="color:rgb(0,0,255); line-height:1.5!important">void</span><span style="line-height:1.5!important"> handle(String sampleParameter) {
        
        System.out.println(</span>"ConcreteStateA handle ：" +<span style="line-height:1.5!important"> sampleParameter);
    }

}</span></pre>&#13;
<div class="cnblogs_code_toolbar" style="word-wrap:break-word; margin-top:5px"><span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important"><a target="_blank" title="复制代码" style="color:rgb(46,156,233); border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px; border:none!important" /></a></span></div>&#13;
</div>&#13;
<div class="cnblogs_code" style="word-wrap:break-word; border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; line-height:28px; font-family:'Courier New'!important; background-color:rgb(245,245,245)">&#13;
<div class="cnblogs_code_toolbar" style="word-wrap:break-word; margin-top:5px"><span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important"><a target="_blank" title="复制代码" style="color:rgb(46,156,233); border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px; border:none!important" /></a></span></div>&#13;
<pre style="margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="color:rgb(0,0,255); line-height:1.5!important">public</span> <span style="color:rgb(0,0,255); line-height:1.5!important">class</span> ConcreteStateB <span style="color:rgb(0,0,255); line-height:1.5!important">implements</span><span style="line-height:1.5!important"> State {

    @Override
    </span><span style="color:rgb(0,0,255); line-height:1.5!important">public</span> <span style="color:rgb(0,0,255); line-height:1.5!important">void</span><span style="line-height:1.5!important"> handle(String sampleParameter) {
        
        System.out.println(</span>"ConcreteStateB handle ：" +<span style="line-height:1.5!important"> sampleParameter);
    }

}</span></pre>&#13;
<div class="cnblogs_code_toolbar" style="word-wrap:break-word; margin-top:5px"><span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important"><a target="_blank" title="复制代码" style="color:rgb(46,156,233); border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px; border:none!important" /></a></span></div>&#13;
</div>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　客户端类</p>&#13;
<div class="cnblogs_code" style="word-wrap:break-word; border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; line-height:28px; font-family:'Courier New'!important; background-color:rgb(245,245,245)">&#13;
<div class="cnblogs_code_toolbar" style="word-wrap:break-word; margin-top:5px"><span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important"><a target="_blank" title="复制代码" style="color:rgb(46,156,233); border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px; border:none!important" /></a></span></div>&#13;
<pre style="margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="color:rgb(0,0,255); line-height:1.5!important">public</span> <span style="color:rgb(0,0,255); line-height:1.5!important">class</span><span style="line-height:1.5!important"> Client {

    </span><span style="color:rgb(0,0,255); line-height:1.5!important">public</span> <span style="color:rgb(0,0,255); line-height:1.5!important">static</span> <span style="color:rgb(0,0,255); line-height:1.5!important">void</span><span style="line-height:1.5!important"> main(String[] args){
        </span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important">创建状态</span>
        State state = <span style="color:rgb(0,0,255); line-height:1.5!important">new</span><span style="line-height:1.5!important"> ConcreteStateB();
        </span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important">创建环境</span>
        Context context = <span style="color:rgb(0,0,255); line-height:1.5!important">new</span><span style="line-height:1.5!important"> Context();
        </span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important">将状态设置到环境中</span>
<span style="line-height:1.5!important">        context.setState(state);
        </span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important">请求</span>
        context.request("test"<span style="line-height:1.5!important">);
    }
}</span></pre>&#13;
<div class="cnblogs_code_toolbar" style="word-wrap:break-word; margin-top:5px"><span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important"><a target="_blank" title="复制代码" style="color:rgb(46,156,233); border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px; border:none!important" /></a></span></div>&#13;
</div>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　从上面可以看出，环境类Context的行为request()是委派给某一个具体状态类的。通过使用多态性原则，可以动态改变环境类Context的属性State的内容，使其从指向一个具体状态类变换到指向另一个具体状态类，从而使环境类的行为request()由不同的具体状态类来执行。</p>&#13;
<br />&#13;
<br />&#13;
<br />&#13;
<br />&#13;
<br />&#13;
<strong>五、小结</strong><br />&#13;
使用状态模式前，客户端外界需要介入改变状态，而状态改变的实现是琐碎或复杂的。<br />&#13;
使用状态模式后，客户端外界可以直接使用事件Event实现，根本不必关心该事件导致如何状态变化，这些是由状态机等内部实现。<br />&#13;
这是一种Event-condition-State，状态模式封装了condition-State部分。<br />&#13;
每个状态形成一个子类，每个状态只关心它的下一个可能状态，从而无形中形成了状态转换的规则。如果新的状态加入，只涉及它的前一个状态修改和定义。<br />&#13;
<br />&#13;
<br />&#13;
状态模式的主要优点在于封装了转换规则，并枚举可能的状态，它将所有与某个状态有关的行为放到一个类中，并且可以方便地增加新的状态，只需要改变对象状态即可改变对象的行为，还可以让多个环境对象共享一个状态对象，从而减少系统中对象的个数；其缺点在于使用状态模式会增加系统类和对象的个数，且状态模式的结构与实现都较为复杂，如果使用不当将导致程序结构和代码的混乱，对于可以切换状态的状态模式不满足“开闭原则”的要求。<br />&#13;
<br />&#13;
<br />&#13;
<br />&#13;
<strong>六、总结</strong><br />&#13;
<br />&#13;
<br />&#13;
<h1 style="margin:0px; height:auto; padding-right:0px; font-family:verdana,Arial,Helvetica,sans-serif; font-size:16px; border-bottom-style:none; line-height:1.5">&#13;
<span style="font-size:18pt">状态模式</span></h1>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　●　　<strong>状态和行为</strong></p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　所谓对象的状态，通常指的就是对象实例的属性的值；而行为指的就是对象的功能，再具体点说，行为大多可以对应到方法上。</p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　状态模式的功能就是分离状态的行为，通过维护状态的变化，来调用不同状态对应的不同功能。也就是说，状态和行为是相关联的，它们的关系可以描述为：<strong>状态决定行为</strong>。</p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　由于状态是在运行期被改变的，因此行为也会在运行期根据状态的改变而改变。</p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　●　　<strong>行为的平行性</strong></p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
<strong>　　</strong>注意平行线而不是平等性。所谓平行性指的是各个状态的行为所处的层次是一样的，相互独立的、没有关联的，是根据不同的状态来决定到底走平行线的哪一条。行为是不同的，当然对应的实现也是不同的，相互之间是不可替换的。</p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　<img src="http://blog.csdn.net/singit/article/details/54867186" alt="" style="border:0px; max-width:900px; display:block; margin-left:auto; margin-right:auto" /></p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　而平等性强调的是可替换性，大家是同一行为的不同描述或实现，因此在同一个行为发生的时候，可以根据条件挑选任意一个实现来进行相应的处理。</p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　<img src="http://blog.csdn.net/singit/article/details/54867186" alt="" style="border:0px; max-width:900px; display:block; margin-left:auto; margin-right:auto" /></p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　大家可能会发现状态模式的结构和策略模式的结构完全一样，但是，它们的目的、实现、本质却是完全不一样的。还有行为之间的特性也是状态模式和策略模式一个很重要的区别，状态模式的行为是平行性的，不可相互替换的；而策略模式的行为是平等性的，是可以相互替换的。</p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　● 　　<strong>环境和状态处理对象</strong></p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
<strong>　　</strong>在状态模式中，环境(Context)是持有状态的对象，但是环境(Context)自身并不处理跟状态相关的行为，而是把处理状态的功能委托给了状态对应的状态处理类来处理。</p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　在具体的状态处理类中经常需要获取环境(Context)自身的数据，甚至在必要的时候会回调环境(Context)的方法，因此，通常将环境(Context)自身当作一个参数传递给具体的状态处理类。</p>&#13;
<p style="word-wrap:break-word; margin:10px auto; font-family:'ms shell dlg'; font-size:14px; line-height:28px">&#13;
　　客户端一般只和环境(Context)交互。客户端可以用状态对象来配置一个环境(Context)，一旦配置完毕，就不再需要和状态对象打交道了。客户端通常不负责运行期间状态的维护，也不负责决定后续到底使用哪一个具体的状态处理对象。</p>&#13;
<br />&#13;
       &#13;
   &#13;
