

<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
　<span class="black9b" style="padding:0px; margin:0px">作者：李强<span style="padding:0px; margin:0px">,</span></span><span class="STYLE2" style="padding:0px; margin:0px"><span style="padding:0px; margin:0px">华清远见嵌入式学院</span><span style="padding:0px; margin:0px">讲师。</span></span><span class="STYLE2" style="padding:0px; margin:0px"></span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
     设备驱动中，设备号设一个很重要的概念和变量。不论是主设备号，还是次设备号，在设备驱动中都占据了很重要的地位。那么他在Kernel中是如何操作的？这个数据结构都是通过那些函数可以很容易的在我们写Linux设备驱动模块时被我们所使用呢？</p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
</p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　在include/linux/type.h文件中我们能看到一个关于dev_t的定义如下：</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　...</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　typedef __u32 __kernel_dev_t;</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　typedef __kernel_fd_set fd_set;</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　typedef __kernel_dev_t dev_t;</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　...</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　从这个定义中我们能看到dev_t是一个无符号的32位的整型。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　首先我们需要说明的是，在linux中主次设备号是放置在一个无符号的32位的整型中，那么这32位整型对于主次设备号如何分配呢？</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　从源代码中我们可以看到，主设备号占据12个位，次设备好占据20位。这在一定的时期内，主次设备号是完全可以满足系统需要的。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　同时在include/linux/kdev_t.h文件中我们能发现很多函数或者宏定义的操作都是针对dev_t的。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　具体可以看到我们经常用到的MAJOR(dev)、MINOR(dev)、MKDEV(ma,mi)。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　下面我们就具体分析下这三个我们经常用到的宏定义：</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　#define MINORBITS 20</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　#define MINORMASK ((1U &lt;&lt; MINORBITS) - 1)</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　#define MAJOR(dev) ((unsigned int) ((dev) &gt;&gt; MINORBITS))</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　从这个宏定义中我们可以看到其把无符号的32位的整型做位操作运算：右移20位。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
中如果是右移，那么左边补0，这样在这32位的整型中通过这个操作就只保留了原先第19位到31位的有效值，而这也正是我们所需要的。</p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　下面我们看下MINOR这个宏定义：</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　#define MINOR(dev) ((unsigned int) ((dev) &amp; MINORMASK))</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　要明白这个宏定义的具体是多少，我们需要首先明白宏定义MINORMASK是什么？</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　我们从前面的宏定义中，我们看到：</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　#define MINORMASK ((1U &lt;&lt; MINORBITS) - 1)</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　MINORMASK 是1U也就是1左移位20个字节，二进制的话就是10000000000000000000，也就是1后面带20个0。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　然后在减1呢，就成了二进制11111111111111111111，也就是20个1，十六进制的话是0xFFFFF。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　好现在我们知道MINORMASK是20个1，也就是十六进制0xFFFFF，那么我们在与dev_t做一个位的与运算，就把32位中的前12为置0，保留其后面的20位，也正是我们想要的表是设备次设备号的后20个字节。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　好下面我们看下如果我们知道了主设备号、次设备号，我们如何生成一个dev_t的数据结构。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　宏定义：</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　#define MKDEV(ma,mi) (((ma) &lt;&lt; MINORBITS) | (mi))</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　明白了前面我们所说的，其实这个就比较简单了，把主设备号左移20位，然后与上次设备号，就是我们所需要的dev_t的数据结构。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　那么我们前面所说的关于dev_t的操作是新的2.6.x系列中的，在之前的2.4.x系列中，由于对设备号的总共就16个字节，也就是一个短整型，那么一个系统中所能拥有的设备号就是及其有限的了。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　我们看下在老版本中的内核中他们的表示：</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　#define MAJOR(dev) ((dev)&gt;&gt;8)</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　#define MINOR(dev) ((dev) &amp; 0xff)</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　#define MKDEV(ma,mi) ((ma)&lt;&lt;8 | (mi))</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　从中我们可以看出，他是以8为为分界线，高8位为主设备号，低8位为次设备号，那么一个8位所能表示的最多也即是255个数值，那么当我们系统中如果拥有的设备大于这个数值的时候，在老版本的内核中就没有办法处理了。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　在内核实现中还实现了两个打印的函数，其实也是宏定义：</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　#define print_dev_t(buffer, dev)                        /</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　sprintf((buffer), "%u:%u/n", MAJOR(dev), MINOR(dev))</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　#define format_dev_t(buffer, dev)                        /</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　({                                                                                /</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　sprintf(buffer, "%u:%u", MAJOR(dev), MINOR(dev));        /</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　buffer;                                        /</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　})</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　从代码中我们可以看出。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　第一就是把设备的主设备号和次设备号以字符串的形式存放到buffer中，在使用这个宏定义的时候需要注意的是：</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　buffer需要提前开辟空间，而且还需要是够用的空间。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　第二所实现的功能和第一个很类似。这儿我们就不具体说明，请参考第一个宏定义的实现。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　在这个文件中还有很多的函数，这些函数的主要功能就是和老版本的内核代码兼容而产生的，比如：</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　     static inline int old_valid_dev(dev_t dev)</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">         {</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　               return MAJOR(dev) &lt; 256 &amp;&amp; MINOR(dev) &lt; 256;</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　    　}</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　此函数是判断一个dev_t是否可以转换成旧制的dev_t。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　static inline u16 old_encode_dev(dev_t dev)</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　{</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　return (MAJOR(dev) &lt;&lt; 8) | MINOR(dev);</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　}</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　把32位的设备号转换成16位的旧制的设备号。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　其中主要操作为：首先把主设备号左移8位，为次设备好空出8位的位置，然后与上次设备号。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　在使用这个函数的时候需要注意的就是需要首先判断下32位的设备号是否可以有效的转换成16位的设备号。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　static inline dev_t old_decode_dev(u16 val)</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　{</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　return MKDEV((val &gt;&gt; 8) &amp; 255, val &amp; 255);</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　}</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　上面函数的反操作。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　主设备号右移8位，然后与上255，即8个1。也就是取此变量的低8位，</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　次设备号与上255，也是取此变量的低8位即可。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　static inline u32 new_encode_dev(dev_t dev)</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　{</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　unsigned major = MAJOR(dev);</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　unsigned minor = MINOR(dev);</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　return (minor &amp; 0xff) | (major &lt;&lt; 8) | ((minor &amp; ~0xff) &lt;&lt; 12);</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　^^^^^^^^^^^^^</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　次设备号取其低8位 ^^^^^^^^^^^^^^</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　主设备号左移8位。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　^^^^^^^^^^^^^^^^^^^^^^^</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　次设备号低8位清零，左移12位。</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　}</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
 </p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　static inline dev_t new_decode_dev(u32 dev)</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　{</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　unsigned major = (dev &amp; 0xfff00) &gt;&gt; 8;</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　unsigned minor = (dev &amp; 0xff) | ((dev &gt;&gt; 12) &amp; 0xfff00);</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　return MKDEV(major, minor);</span></p>&#13;
<p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px">&#13;
<span class="STYLE2" style="padding:0px; margin:0px">　　}</span></p>&#13;
   &#13;
