
<p><span style="font-size:24px;"><strong>      <span style="font-family:Comic Sans MS;">系统中的每一个进程都有自己的一组打开的文件，像根文件系统，当前工作目录，安装点等。有三个数据结构将 VFS 层和系统的进程紧密的联系在一起，它们分别是：</span></strong></span></p><p><span style="font-family:Comic Sans MS;font-size:24px;"><strong>file_struct，fs_struct 和 namespace 结构体。</strong></span></p><p><span style="font-family:Comic Sans MS;font-size:24px;"><strong><br /></strong></span></p><p><span style="font-family:Comic Sans MS;font-size:24px;"><strong>      file_struct 结构体定义在文件 &lt;linux/fdtable.h&gt; 中。该结构体由进程描述符中的 files 目录项指向。所有的单个进程相关的信息（如打开的文件和文件描述符）都包含在其中，其结构和描述如下：</strong></span></p><p><span style="font-family:Comic Sans MS;font-size:24px;"><strong>      </strong></span><span style="color: rgb(51, 102, 255); font-weight: bold; font-family: 'Comic Sans MS'; font-size: 24px;">struct files_struct {</span></p><p><span style="font-family: 'Comic Sans MS'; font-size: 24px;"><strong><span style="color:#3366ff;">          atomic_t count;   /*结构的使用计数*/<br />          struct fdtable *fdt;  /*指向其他 fd 表的指针*/<br />          struct fdtable fdtab;  /*基 fd 表*/<br />    <br />          spinlock_t file_lock;  /*单个文件的锁*/<br />          int next_fd;  /*缓存下一个可用的 fd */<br />          struct embedded_fd_set close_on_exec_init;  /*exec() 时关闭的文件描述符链表*/<br />          struct embedded_fd_set open_fds_init;  /*打开的文件描述符链表*/<br />          struct file * fd_array[NR_OPEN_DEFAULT];  /*缺省的文件对象数组*/<br />        };</span></strong></span></p><p><span style="font-family:Comic Sans MS;font-size:24px;"><strong><br /></strong></span></p><p><span style="font-family:Comic Sans MS;font-size:24px;"><strong>      和进程相关的第二个结构体是 fs_struct 。该结构由进程描述符的 fs 域指向。它包含文件系统和进程的相关信息，定义在文件 &lt;linux/fs_struct.h&gt; 中，下面是它的具体结构体和各项描述：</strong></span></p><p><span style="font-family:Comic Sans MS;font-size:24px;"><strong>        <span style="color:#3366ff;">struct fs_struct {<br />                 int users;   /*用户数目*/<br />                 rwlock_t lock;  /*保护该结构体的锁*/<br />                 int umask;  /*掩码*/<br />                 int in_exec;  /*当前正在执行的文件*/<br />                 struct path root;  /*根目录路径*/<br /><span style="white-space:pre">		</span> struct path pwd;   /*当前工作目录的路径*/<br />         };</span><br /></strong></span></p><p><span style="font-family:Comic Sans MS;font-size:24px;"><strong>      该结构包含了当前进程的当前工作目录（pwd）和根目录。</strong></span></p><p><span style="font-family:Comic Sans MS;font-size:24px;"><strong><br /></strong></span></p><p><span style="font-family:Comic Sans MS;font-size:24px;"><strong>      第三个也是最后一个相关的结构体是 namespace 结构体。它定义在文件 &lt;linux/mnt_namespace.h&gt; 中，由进程描述符中的 mnt_namespace 域指向。2.4版内核以后，单进程命名空间被加入到内核中，它使得每一个进程在系统中都看到唯一的安装文件系统，不仅是唯一的根目录，而且是唯一的文件系统层次结构。下面是其具体结构和描述：</strong></span></p><p><span style="font-family:Comic Sans MS;font-size:24px;"><strong>   <span style="white-space:pre">	<span style="color:#3366ff;">struct mnt_namespace {<br />         	atomic_t                count;   /*结构的使用数目*/<br />         	struct vfsmount *       root;    /*根目录的安装点对象*/<br />         	struct list_head        list;    /*安装点链表*/<br />         	wait_queue_head_t poll;          /*轮询的等待队列*/<br />         	int event;                       /*事件计数*/ <br />	};</span></span></strong></span></p><p><span style="font-family:Comic Sans MS;font-size:24px;">     <strong> list域是连接已安装文件系统的双向链表，它包含的元素组成了全体命名空间。</strong></span></p>   &#13;
