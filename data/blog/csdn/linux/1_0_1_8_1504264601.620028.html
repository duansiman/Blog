
                
<p><span style="font-size:18px">Linux上的/proc目录是一种文件系统，称为proc文件系统（虚拟文件系统），它存储内核状态信息，包括cpu、内存以及进程等信息。proc文件系统有很多优点：应用程序获取内核数据不用切换到内核态，增加了系统的安全性（像ps命令就是通过proc获取进程信息）；应用程序可以通过proc直接改变内核参数，这样不用重新编译内核就可以改变和优化内核行为。总之，proc为用户应用程序获取系统内部信息提供了一个安全、方便的界面。proc存在内存中，不占用外存。</span></p>&#13;
<p><span style="font-size:18px">下面是/proc目录下的文件：</span></p>&#13;
<p><span style="font-size:18px"/>&#13;
</p><table border="1" width="500" height="20" cellspacing="1" cellpadding="1" style="text-align:center">&#13;
<tbody>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">apm</span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">高级电源管理信息</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">cmdline</span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">内核命令行</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Cpuinfo</span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">关于 Cpu 信息</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Devices</span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">可以用到的设备（块设备/字符设备）</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Dma</span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Used DMS channels </span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Filesystems</span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">支持的文件系统</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Interrupts</span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">中断的使用</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Ioports   </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px"> I/O 端口的使用</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Kcore    </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">内核核心印象</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Kmsg      </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">内核消息</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Ksyms   </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">内核符号表</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Loadavg      </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">负载均衡</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Locks     </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">内核锁 </span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Meminfo      </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">内存信息</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Misc    </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Miscellaneous </span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Modules    </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">加载模块列表 </span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Mounts    </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">加载的文件系统</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Partitions </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">系统识别的分区表 </span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Rtc    </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Real time clock</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Slabinfo </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Slab pool info</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Stat    </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">全面统计状态表</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Swaps    </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">对换空间的利用情况</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Version      </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">内核版本</span></span></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">Uptime     </span></span></td>&#13;
<td style="text-align:left"><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">系统正常运行时间</span></span></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<br/>&#13;
&#13;
<p><span style="font-size:18px">下面是我自己写得一个查看cpu和内核版本信息以及启动时间的程序：</span></p>&#13;
<p><span style="font-size:18px">因为要涉及文件读写，先介绍一下几个文件读写函数。</span></p>&#13;
<p><span style="font-size:18px">1)fgetc从流中读取一个字符，并增加文件指针的位置，常与EOF配合使用，将流中的字符全部读出。</span></p>&#13;
<p><span style="font-size:18px">2)putchar向终端输出一个字符。</span></p>&#13;
<p><span style="font-size:18px">3)fgets(char *s, int size, FILE *stream)，从文件流中读取一行到s中，size一般为数组s的大小，且s以字符'/0'结束。</span></p>&#13;
<p><span style="font-size:18px">4)int feof(FILE *stream)判断是否遇到文件结束，如果遇到则返回非零值，否则为0。</span></p>&#13;
<p><span style="font-size:18px">5)int fscanf(FILE *stream, const char *format, ...)从文件流（或标准输入）中进行格式化输入，用法如下：</span></p>&#13;
<p/>&#13;
<pre code_snippet_id="275826" snippet_file_name="blog_20140404_1_7677575" name="code" class="cpp">#include&lt;stdio.h&gt;

int main()
{
   
    int i;
    char s[5];

    fscanf(stdin, "%d %5[a-z]%*s", &amp;i, s);

    printf("%d %s \n", i, s);

    return 0;    
}</pre><br/>&#13;
<span style="font-size:18px">执行结果（命令行输入99 abcdefghijk，由于fscanf遇到空格和换行时结束，则99存到i，abcde存到s）：</span>&#13;
<p/>&#13;
<p><span style="font-size:18px"><img src="http://img.blog.csdn.net/20140404214738468" alt=""/><br/>&#13;
</span></p>&#13;
<pre code_snippet_id="275826" snippet_file_name="blog_20140404_2_6481418" name="code" class="cpp">#include&lt;stdio.h&gt;
#include&lt;sys/time.h&gt;

#define LB_SIZE 80
enum TYPE{STANDARD, SHORT, LONG};
FILE *thisProcFile; //Proc open file pointer
struct timeval now; //system time date
enum TYPE reportType; //the type of observation report
char repTypeName[16];
char *lineBuf; //read out buffer
int interval; //system overload detect interval
int duration; //system overload detect duration
int iteration;
char c1, c2; //character handle uint

void getTwoTime(FILE *fp) 
{
	long uptime, idletime;
	int day, hour,minute, second;
	int m, n;
	char temp[80];
	m = n = 0;

	int ret;
	int i = 0;
	char s[100][100];
	int j;
	while((ret=fscanf(fp, "%s", s[i])) != EOF) i++;
	
	//print
	for(j = 0; j &lt; i; j++)
	{
		printf("%s\n", s[j]);
	}

	uptime = atol(s[0]);
	idletime = atol(s[1]);

	printf("&lt;&lt;---------------------___________-------------------------&gt;\n");
	printf("the uptime of system -----------------------------&gt; %ld\n", uptime);
	printf("the idletime of process -----------------------------&gt; %ld\n", idletime);
	printf("&lt;&lt;---------------------___________-------------------------&gt;\n");
	
/*	time_t uptime_timet = uptime;
	printf("xixixixixi%ld\n", uptime_timet);
	char *result = ctime(&amp;uptime_timet); 	
	printf("hahahahahahah %s\n", result);
*/

	int days;
	int hours;
	int minutes;
	int seconds;

	//uptime of system
	days = (int)uptime/86400;
	hours = (int)uptime%86400/3600;
	minutes = (int)uptime%3600/60;
	seconds = (int)uptime%3600%60;
	printf("the uptime of system-------------days %d----hours %d-----minutes %d-----seconds %d----\n", days, hours, minutes, seconds);
	

	//idletime
	days = (int)idletime/86400;
	hours = (int)idletime%86400/3600;
	minutes = (int)idletime%3600/60;
	seconds = (int)idletime%3600%60;
	printf("the idletime of system-------------days %d----hours %d-----minutes %d-----seconds %d----\n", days, hours, minutes, seconds);
}

//get time from starting
void sampleTime()
{
	//open timer file
	FILE *fp;
	if((fp=fopen("/proc/uptime", "r")) == NULL)
	{
		printf("not open /proc/uptime");
		exit(0);
	}
	
	getTwoTime(fp);
	
	fclose(fp);

}

void getCPUinfo()
{
	FILE *cpuinfo;
	char ch;
	if((cpuinfo=fopen("/proc/cpuinfo","r")) == NULL)
	{
		printf("not open /proc/cpuinfo");
		exit(0);
	}
	
/*	while((ch=fgetc(cpuinfo)) != EOF)
		putchar(ch);
	fclose(cpuinfo);
*/

	printf("*********************cpu*******************\n");	
	while(!feof(cpuinfo))
	{
		fgets(lineBuf, LB_SIZE+1, cpuinfo);
		printf("%s", lineBuf);
	}	
	fclose(cpuinfo);

}

void getKernelVersion() 
{
	
	FILE *version;
	char ch;
	if((version=fopen("/proc/version","r")) == NULL)
	{
		printf("not open /proc/version");
		exit(0);
	}

	printf("*****************version*************************\n");
	while(!feof(version))
	{
		fgets(lineBuf, LB_SIZE+1, version);
		printf("%s", lineBuf);
	}
	
	fclose(version);

}

int main(int argc, char *argv[]) 
{
	lineBuf = (char *)malloc(LB_SIZE + 1);
	reportType = STANDARD;
	strcpy(repTypeName, "Standard");
	if(argc &gt; 1) 
	{
		sscanf(argv[1], "%c%c", &amp;c1, &amp;c2);
		if(c1 != '-')  exit(1);
		if(c2 == 'b')
		{
			printf("********************************Memory Info*********************************\n");
			//open memory info 
			FILE *meminfo; 
			char ch;
			if((meminfo=fopen("/proc/meminfo","r")) == NULL)
			{
				printf("not open /proc/meminfo");
				exit(0);
			}
			while((ch=fgetc(meminfo)) != EOF)
				putchar(ch);
			fclose(meminfo);
			
			printf("********************************TIME*********************************\n");
			//cat the start time
			sampleTime();

		} else if(c2 == 'c')
		{
			//get cpu info and kernel version
			printf("*************************CPU &amp; kernel*************************\n");
			
			getCPUinfo();

			getKernelVersion();
			
		}
	}
}
</pre><span style="font-size:18px">执行：</span>&#13;
<p/>&#13;
<p><span style="font-size:18px">./main -b 查看内存信息以及经过格式化的启动时间。</span></p>&#13;
<p><span style="font-size:18px">./main -c查看cpu类型和kernel版本。<br/>&#13;
</span></p>&#13;
<div style="font-size:18px; text-align:center"><br/>&#13;
</div>&#13;
<br/>&#13;
<p/>&#13;
<link rel="stylesheet" href="http://static.blog.csdn.net/public/res-min/markdown_views.css?v=1.0"/>&#13;
            