
<p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong><span style="font-family: Calibri, sans-serif;">1.</span>句柄就是一个标识符，只要获得对象的句柄，我们就可以对对象进行任意的操作。<br /><br /></strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong><span style="font-family: Calibri, sans-serif;">2.</span>句柄不是指针，操作系统用句柄可以找到一块内存，这个句柄可能是标识符，<span style="font-family: Calibri, sans-serif;">map</span>的<span style="font-family: Calibri, sans-serif;">key</span>，也可能是指针，看操作系统怎么处理的了。</strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong><span style="font-family: Calibri, sans-serif;">fd</span>算是在某种程度上替代句柄吧；</strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong><span style="font-family: Calibri, sans-serif;">Linux </span>有相应机制，但没有统一的句柄类型，各种类型的系统资源由各自的类型来标识，由各自的接口操作。<br /><br /></strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-family: Calibri, sans-serif;"><span style="font-size:24px;"><strong>3.http://tech.ddvip.com/2009-06/1244006580122204_11.html</strong></span></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong>在操作系统层面上，文件操作也有类似于<span style="font-family: Calibri, sans-serif;">FILE</span>的一个概念，在<span style="font-family: Calibri, sans-serif;">Linux</span>里，这叫做文件描述符<span style="font-family: Calibri, sans-serif;">(File Descriptor)</span>，而在<span style="font-family: Calibri, sans-serif;">Windows</span>里，叫做句柄<span style="font-family: Calibri, sans-serif;">(Handle)(</span>以下在没有歧义的时候统称为句柄<span style="font-family: Calibri, sans-serif;">)</span>。用户通过某个函数打开文件以获得句柄，此 后用户操纵文件皆通过该句柄进行。</strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong> </strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong>设计这么一个句柄的原因在于句柄可以防止用户随意读写操作系统内核的文件对象。无论是<span style="font-family: Calibri, sans-serif;">Linux</span>还是<span style="font-family: Calibri, sans-serif;">Windows</span>，文件句柄总是和内核的文件对象相关联的，但如何关联细节用户并不可见。内核可以通过句柄来计算出内核里文件对象的地址，但此能力并不对用户开放。</strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong> </strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong>下面举一个实际的例子，在<span style="font-family: Calibri, sans-serif;">Linux</span>中，值为<span style="font-family: Calibri, sans-serif;">0</span>、<span style="font-family: Calibri, sans-serif;">1</span>、<span style="font-family: Calibri, sans-serif;">2</span>的<span style="font-family: Calibri, sans-serif;">fd</span>分别代表标准输入、标准输出和标准错误输出。在程序中打开文件得到的<span style="font-family: Calibri, sans-serif;">fd</span>从<span style="font-family: Calibri, sans-serif;">3</span>开始增长。<span style="font-family: Calibri, sans-serif;"> fd</span>具体是什么呢<span style="font-family: Calibri, sans-serif;">?</span>在内核中，每一个进程都有一个私有的<span style="font-family: Calibri, sans-serif;">“</span>打开文件表<span style="font-family: Calibri, sans-serif;">”</span>，这个表是一个指针数组，每一个元素都指向一个内核的打开文件对象。而<span style="font-family: Calibri, sans-serif;">fd</span>，就是这 个表的下标。当用户打开一个文件时，内核会在内部生成一个打开文件对象，并在这个表里找到一个空项，让这一项指向生成的打开文件对象，并返回这一项的下标 作为<span style="font-family: Calibri, sans-serif;">fd</span>。由于这个表处于内核，并且用户无法访问到，因此用户即使拥有<span style="font-family: Calibri, sans-serif;">fd</span>，也无法得到打开文件对象的地址，只能够通过系统提供的函数来操作。</strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong> </strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong>在<span style="font-family: Calibri, sans-serif;">C</span>语言里，操纵文件的渠道则是<span style="font-family: Calibri, sans-serif;">FILE</span>结构，不难想象，<span style="font-family: Calibri, sans-serif;">C</span>语言中的<span style="font-family: Calibri, sans-serif;">FILE</span>结构必定和<span style="font-family: Calibri, sans-serif;">fd</span>有一对一的关系，每个<span style="font-family: Calibri, sans-serif;">FILE</span>结构都会记录自己唯一对应的<span style="font-family: Calibri, sans-serif;">fd</span>。</strong></span></p><span style="font-size:24px;"><strong><span style="line-height: 33.33333206176758px; font-family: 宋体;"><br />句柄 </span><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 20px;"><a href="http://zh.wikipedia.org/wiki/%E5%8F%A5%E6%9F%84" style="color: rgb(0, 102, 170); text-decoration: none;">http://zh.wikipedia.org/wiki/%E5%8F%A5%E6%9F%84</a><br /><br /></span><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 20px;"></span></strong></span><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong>在<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1" title="程序设计" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">程序设计</span></a> </span>中<span style="font-family: Calibri, sans-serif;">,</span>句柄是一种特殊的<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/w/index.php?title=%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88&amp;action=edit&amp;redlink=1" title="智能指针（尚未撰写）" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">智能指针</span></a> </span>。当一个<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" title="应用程序" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">应用程序</span></a> </span>要引用其他系统<span style="font-family: Calibri, sans-serif;">(</span>如<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E6%95%B0%E6%8D%AE%E5%BA%93" title="数据库" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">数据库</span></a></span>、<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F" title="操作系统" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">操作系统</span></a> )</span>所管理的<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E5%86%85%E5%AD%98" title="内存" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">内存</span></a> </span>块或<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E5%AF%B9%E8%B1%A1_%28%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%29" title="对象 (计算机科学)" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">对象</span></a> </span>时，就要使用句柄。</strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong>句柄与普通<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E6%8C%87%E9%92%88_%28%E4%BF%A1%E6%81%AF%E5%AD%A6%29" title="指针 (信息学)" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">指针</span></a> </span>的区别在于，指针包含的是引用<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E5%AF%B9%E8%B1%A1_%28%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%29" title="对象 (计算机科学)" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">对象</span></a> </span>的<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80" title="物理地址" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">内存地址</span></a> </span>，而句柄则是由系统所管理的引用标识，该标识可以被系统重新定位到一个<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80" title="物理地址" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">内存地址</span></a> </span>上。这种间接访问<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E5%AF%B9%E8%B1%A1_%28%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%29" title="对象 (计算机科学)" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">对象</span></a> </span>的模式增强了系统对引用<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E5%AF%B9%E8%B1%A1_%28%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%29" title="对象 (计算机科学)" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">对象</span></a> </span>的控制。（参见<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/w/index.php?title=%E5%B0%81%E8%A3%85&amp;action=edit&amp;redlink=1" title="封装（尚未撰写）" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">封装</span></a> )</span>。</strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong>在上世纪<span style="font-family: Calibri, sans-serif;">80</span>年代的操作系统（如<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/Mac_OS" title="Mac OS" style="color: rgb(0, 102, 170); text-decoration: none;">Mac OS</a> </span>和<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/Windows" title="Windows" style="color: rgb(0, 102, 170); text-decoration: none;">Windows</a> </span>）的<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86" title="内存管理" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">内存管理</span></a> </span>中，句柄被广泛应用。<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/Unix" title="Unix" style="color: rgb(0, 102, 170); text-decoration: none;">Unix</a> </span>系统的<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6" title="文件描述符" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">文件描述符</span></a> </span>基本上也属于句柄。和其它<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E6%A1%8C%E9%9D%A2%E7%8E%AF%E5%A2%83" title="桌面环境" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">桌面环境</span></a> </span>一样，<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/Windows_API" title="Windows API" style="color: rgb(0, 102, 170); text-decoration: none;">Windows API</a> </span>大量使用句柄来标识系统中的<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E5%AF%B9%E8%B1%A1_%28%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%29" title="对象 (计算机科学)" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">对象</span></a> </span>，并建立操作系统与<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/w/index.php?title=%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4&amp;action=edit&amp;redlink=1" title="用户空间（尚未撰写）" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">用户空间</span></a> </span>之间的通信渠道。例如，桌面上的一个窗体由一个<span style="font-family: Calibri, sans-serif;">HWND </span>类型的句柄来标识。</strong></span></p><p style="margin: 0cm 0cm 0.0001pt; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 22.5pt;"><span style="font-size:24px;"><strong>如今，<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E5%86%85%E5%AD%98" title="内存" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">内存</span></a> </span>容量的增大和<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98" title="虚拟内存" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">虚拟内存</span></a> </span>算法使得更简单的<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E6%8C%87%E9%92%88_%28%E4%BF%A1%E6%81%AF%E5%AD%A6%29" title="指针 (信息学)" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">指针</span></a> </span>愈加受到青睐，而指向另一指针的那类句柄受到冷淡。尽管如此，许多<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F" title="操作系统" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">操作系统</span></a> </span>仍然把指向私有<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E5%AF%B9%E8%B1%A1_%28%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%29" title="对象 (计算机科学)" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">对象</span></a> </span>的指针以及<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E8%BF%9B%E7%A8%8B" title="进程" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">进程</span></a></span>传递给<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E5%AE%A2%E6%88%B7%E7%AB%AF" title="客户端" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">客户端</span></a> </span>的内部<span style="font-family: Calibri, sans-serif;"><a href="http://zh.wikipedia.org/zh-cn/%E6%95%B0%E7%BB%84" title="数组" style="color: rgb(0, 102, 170); text-decoration: none;"><span style="font-family: 宋体;">数组</span></a> </span>下标称为句柄。</strong></span></p>   &#13;
