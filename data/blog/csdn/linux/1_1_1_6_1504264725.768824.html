

<span style="font-size:16px"><span style="font-weight:bold">好吧，我承认找了好久，网上都没有像样的完整的实例，然后自己参照书自己写一个吧！</span><br style="font-weight:bold" />&#13;
<br style="font-weight:bold" />&#13;
<span style="font-weight:bold">//!&gt; server端代码</span><br style="font-weight:bold" />&#13;
<span style="font-weight:bold">//!&gt;server.c</span></span><br />&#13;
<br />&#13;
#include &lt;stdio.h&gt;<br />&#13;
#include &lt;unistd.h&gt;<br />&#13;
#include &lt;stdlib.h&gt;<br />&#13;
#include &lt;string.h&gt;<br />&#13;
#include &lt;errno.h&gt;<br />&#13;
#include &lt;netinet/in.h&gt;<br />&#13;
#include &lt;sys/select.h&gt;<br />&#13;
#include &lt;sys/types.h&gt;<br />&#13;
#include &lt;sys/socket.h&gt;<br />&#13;
<br />&#13;
#define BUF_LEN 1024<br />&#13;
#define SERV_PORT 6000<br />&#13;
#define FD_SIZE 100<br />&#13;
#define MAX_BACK 100<br />&#13;
<br />&#13;
int main( int argc, char ** argv )<br />&#13;
{<br />&#13;
 &#13;
<div id="sina_keyword_ad_area2" class="articalContent  "><wbr> <wbr> <wbr> int <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> listenfd,connfd, sockfd, maxfd, maxi, i;<br />&#13;
 <wbr> <wbr> <wbr> int <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> nready,client[FD_SIZE]; <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>//!&gt; 接收select返回值、保存客户端套接字<br />&#13;
 <wbr> <wbr> <wbr> int <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> lens;<br />&#13;
 <wbr> <wbr> <wbr> ssize_t <wbr> <wbr> <wbr>n; <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>//!&gt; read字节数<br />&#13;
 <wbr> <wbr> <wbr>fd_set <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> rset,allset; <wbr> <wbr> <wbr>//!&gt; 不要理解成就只能保存一个，其实fd_set有点像封装的数组<br />&#13;
 <wbr> <wbr> <wbr> char <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>buf[BUF_LEN]; <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr><br />&#13;
 <wbr> <wbr> <wbr>socklen_t <wbr> <wbr> <wbr>clilen;<br />&#13;
 <wbr> <wbr> <wbr> structsockaddr_in servaddr, chiaddr;<br />&#13;
 <wbr> <wbr> <wbr><br />&#13;
 <wbr> <wbr> <wbr> if( (listenfd = socket( AF_INET, SOCK_STREAM, 0 ) ) == -1 )<br />&#13;
 <wbr> <wbr> <wbr> {<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> printf("Create socket Error : %d\n", errno );<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> exit(EXIT_FAILURE );<br />&#13;
 <wbr> <wbr> <wbr> }<br />&#13;
 <wbr> <wbr> <wbr><br />&#13;
 <wbr> <wbr> <wbr>//!&gt;<br />&#13;
 <wbr> <wbr> <wbr>//!&gt; 下面是接口信息<br />&#13;
 <wbr> <wbr> <wbr> bzero(&amp;servaddr, sizeof( servaddr ) );<br />&#13;
 <wbr> <wbr> <wbr>servaddr.sin_family = AF_INET;<br />&#13;
 <wbr> <wbr> <wbr>servaddr.sin_addr.s_addr <wbr> =htonl( INADDR_ANY);<br />&#13;
 <wbr> <wbr> <wbr>servaddr.sin_port = htons( SERV_PORT );<br />&#13;
 <wbr> <wbr> <wbr><br />&#13;
 <wbr> <wbr> <wbr>//!&gt;<br />&#13;
 <wbr> <wbr> <wbr>//!&gt; 绑定<br />&#13;
 <wbr> <wbr> <wbr> if( bind(listenfd, ( struct sockaddr * )&amp;servaddr, sizeof(servaddr ) ) == -1 )<br />&#13;
 <wbr> <wbr> <wbr>{ <wbr> <wbr> <wbr><br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> printf("BindError : %d\n", errno);<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>exit(EXIT_FAILURE <wbr> );<br />&#13;
 <wbr> <wbr> <wbr> }<br />&#13;
 <wbr> <wbr> <wbr><br />&#13;
 <wbr> <wbr> <wbr>//!&gt;<br />&#13;
 <wbr> <wbr> <wbr>//!&gt; 监听<br />&#13;
 <wbr> <wbr> <wbr> if( listen(listenfd, MAX_BACK ) == -1 )<br />&#13;
 <wbr> <wbr> <wbr> {<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>printf("Listen Error : %d\n", errno );<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> exit(EXIT_FAILURE );<br />&#13;
 <wbr> <wbr> <wbr> }<br />&#13;
 <wbr> <wbr> <wbr><br />&#13;
 <wbr> <wbr> <wbr>//!&gt; 当前最大的感兴趣的套接字fd<br />&#13;
 <wbr> <wbr> <wbr> maxfd =listenfd; <wbr> <wbr> <wbr>//!&gt; 当前可通知的最大的fd<br />&#13;
 <wbr> <wbr> <wbr> maxi =-1; <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>//!&gt; 仅仅是为了client数组的好处理<br />&#13;
 <wbr> <wbr> <wbr><br />&#13;
 <wbr> <wbr> <wbr> for( i = 0;i &lt; FD_SIZE; i++) <wbr> <wbr> <wbr>//!&gt; 首先置为全-1<br />&#13;
 <wbr> <wbr> <wbr> {<br /></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></div>