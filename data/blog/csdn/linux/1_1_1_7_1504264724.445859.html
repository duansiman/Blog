

<span style="font-size:18px"><span style="font-weight:bold; font-style:italic">注意：可以开启一个server和多个client，同时可以对server进行发送data处理,请注意client的参数，格式是：./client <wbr> <wbr>IP</wbr></wbr></span> <wbr> <wbr> <wbr><span style="font-weight:bold; font-style:italic">char_data</span><br style="font-weight:bold; font-style:italic" />&#13;
<span style="font-weight:bold; font-style:italic">IP：就是server所在的IP，char_data就是发送的数据</span><br style="font-weight:bold; font-style:italic" />&#13;
 <wbr><br style="font-weight:bold; font-style:italic" />&#13;
<span style="font-weight:bold; font-style:italic">server.c</span></wbr></wbr></wbr></wbr></span><br />&#13;
<br />&#13;
#include&lt;sys/types.h&gt;<br />&#13;
#include&lt;sys/socket.h&gt;<br />&#13;
#include&lt;strings.h&gt;<br />&#13;
#include&lt;arpa/inet.h&gt;<br />&#13;
#include&lt;unistd.h&gt;<br />&#13;
#include&lt;stdlib.h&gt;<br />&#13;
#include&lt;stdio.h&gt;<br />&#13;
#include&lt;string.h&gt;<br />&#13;
#include&lt;errno.h&gt;<br />&#13;
#include&lt;signal.h&gt;<br />&#13;
#include&lt;sys/wait.h&gt;<br />&#13;
<br />&#13;
#define  &#13;
<div id="sina_keyword_ad_area2" class="articalContent  "><wbr> <wbr> <wbr>LISTEN_PORT <wbr> <wbr>6000 <wbr> <wbr> <wbr> <wbr>  <wbr>  <wbr>//!&gt; 端口<br />&#13;
#define  <wbr> <wbr> <wbr>MAX <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>5 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>//!&gt; 最大的等待请求数目<br />&#13;
<br />&#13;
void str_echo( int sockfd) <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>//!&gt; 从client中读取数据<br />&#13;
{<br />&#13;
 <wbr> <wbr> <wbr>ssize_t <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> n;<br />&#13;
 <wbr> <wbr> <wbr> charline[512];<br />&#13;
 <wbr> <wbr> <wbr><br />&#13;
 <wbr> <wbr> <wbr>printf("准备读数据：");<br />&#13;
 <wbr> <wbr> <wbr><br />&#13;
 <wbr> <wbr> <wbr> while( 1)<br />&#13;
 <wbr> <wbr> <wbr> {<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> while( ( n =read( sockfd, line, 512 ) ) &gt; 0) <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>//!&gt; 注意是：根据accept得到的client的操作描述符来处理的呗～<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> {<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> line[n] ='\0';<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>printf("Client <wbr> send: %s\n", line );<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> bzero(&amp;line, sizeof( line )); <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>//!&gt; 再次置NULL<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> }<br />&#13;
 <wbr> <wbr> <wbr> }<br />&#13;
}<br />&#13;
<br />&#13;
int main( int argc, char ** argv )<br />&#13;
{<br />&#13;
 <wbr> <wbr> <wbr> int <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> listenfd,connfd; <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>//!&gt; 描述符<br />&#13;
 <wbr> <wbr> <wbr>pid_t <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>childpid; <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>//!&gt; 子进程号<br />&#13;
 <wbr> <wbr> <wbr>socklen_t <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>chilen; <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>//!&gt;<br />&#13;
 <wbr> <wbr> <wbr><br />&#13;
 <wbr> <wbr> <wbr> structsockaddr_in chiaddr, servaddr;<br />&#13;
 <wbr> <wbr> <wbr><br />&#13;
 <wbr> <wbr> <wbr>//!&gt; 建立socket( TCP )<br />&#13;
 <wbr> <wbr> <wbr>//!&gt;<br />&#13;
 <wbr> <wbr> <wbr> if( (listenfd = socket( AF_INET, SOCK_STREAM, 0 ) ) == -1 )<br />&#13;
 <wbr> <wbr> <wbr> {<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr>printf("socket error... : <wbr> %s\n",(char*)strerror(errno));<br />&#13;
 <wbr> <wbr> <wbr> <wbr> <wbr> <wbr> exit(EXIT_FAILURE );<br /></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></div>