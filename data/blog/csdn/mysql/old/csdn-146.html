\n <div class="markdown_views"><h1 id="全文本搜索">全文本搜索</h1>\n\n<p>MySQL支持几种基本的数据库引擎，但并非所有的引擎都支持全文本搜索。两个最常使用的引擎为MyISAM和InnoDB，前者支持全文本搜索，后者就不支持。</p>\n\n\n\n<h2 id="理解全文本搜索">理解全文本搜索</h2>\n\n<p>在前面的学习中，我们都知道有两种方式来匹配文本。一种是使用like关键字来进行匹配，另外一种就是使用正则表达式来进行匹配。</p>\n\n<p>虽然使用正则表达式就可以编写查找所需行的足够复杂的匹配模式。但是，这些存在几个重要的限制影响：</p>\n\n<p>1、性能：通配符和正则表达式时尝试匹配表中所有行，而这些搜索极少使用了表索引，因此，相当慢</p>\n\n<p>2、明确控制：在匹配过程中，我们很少会相当的明确的知道我们想匹配什么，不匹配什么。</p>\n\n<p>3、具有优先级的结果：在使用通配符和正则表达式进行匹配时，只是返回包含该匹配条件的结果，而不区分匹配程度（多个匹配和单个匹配的区别，在前面就匹配和在后面匹配的区别）。</p>\n\n<p>上面提到的这些限制，都可以利用全文本搜索来进行解决。</p>\n\n\n\n<h2 id="使用全文本搜索">使用全文本搜索</h2>\n\n<p>为了进行全文本搜索，必须索引被搜索的列，而且要随着数据的改变不断地重新索引。</p>\n\n<p><font color="red">在对表进行适当的设计之后，MySQL会自动进行所有的索引和重新索引。</font></p>\n\n<p>在索引之后，select可与match() 和against()一起使用以实际执行索引。</p>\n\n<p>那么，在建表的时候，如何启用全文本搜索支持呢？？？</p>\n\n<p>如下： <br />\n<img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_fulltext.PNG" alt="" title="" /></p>\n\n<p>上面就这样通过fulltext 为指定行建立的相应的索引，如果，想指定多个列，将多个列都放入fulltext里面即可。</p>\n\n<p>在定义之后，MySQL会自动维护该索引。无论是在增加、更新还是删除，索引也会随之更新。</p>\n\n\n\n<h2 id="进行全文本搜索">进行全文本搜索</h2>\n\n<p>上面在建表后此表就有了全文本搜索的能力了，下面我们开始尝试下全文本搜索。 <br />\n在索引之前，我为test_text表增加了如下内容： <br />\n<img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_fulltext_v1.PNG" alt="" title="" /></p>\n\n<p>当我们想利用全文本搜索得到 包含MySQL内容的数据。</p>\n\n<p>如下：</p>\n\n<pre><code>select csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-14.html csdn-15.html csdn-16.html csdn-17.html csdn-18.html csdn-19.html csdn-1.html csdn-20.html csdn-21.html csdn-22.html csdn-23.html csdn-24.html csdn-25.html csdn-26.html csdn-27.html csdn-28.html csdn-29.html csdn-2.html csdn-30.html csdn-31.html csdn-32.html csdn-33.html csdn-34.html csdn-35.html csdn-36.html csdn-37.html csdn-38.html csdn-39.html csdn-3.html csdn-40.html csdn-41.html csdn-42.html csdn-43.html csdn-44.html csdn-45.html csdn-46.html csdn-47.html csdn-48.html csdn-49.html csdn-4.html csdn-50.html csdn-51.html csdn-52.html csdn-53.html csdn-54.html csdn-55.html csdn-56.html csdn-57.html csdn-58.html csdn-59.html csdn-5.html csdn-60.html csdn-61.html csdn-62.html csdn-63.html csdn-64.html csdn-65.html csdn-66.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh from test_text where match(content) against('MySQL');\n</code></pre>\n\n<p>上面语句中 match(content) 指示MySQL针对指定的列进行搜索，注意：传递给match()的值必须与fulltext()定义中的相同。against(‘MySQL’)指定词MySQL作为搜索文本。</p>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_fulltext_v2.PNG" alt="" title="" /></p>\n\n<p>从结果可以看出，我们得到了两行包括MySQL字符串的数据。</p>\n\n<p>上面的搜索利用我们学过的Like也可以完成，如下：</p>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_fulltext_v5.PNG" alt="" title="" /></p>\n\n<p><font color="red">这两种方法的结果是一样的。次序也一样，理论上来说，利用全文本搜索会对出来的结果按照优先级来进行排序输出，但是从结果可以看出，在第一条语句中MySQL出现的位置相比第二条语句中的MySQL的位置还要滞后，为什么会出现在前面呢？？,与MySQL必知必会上面介绍的有一点出入</font></p>\n\n<p>为了验证上面出现的问题，我们可以查下结果的优先级。在查看优先级之前，我又加入了一个以MySQL开头的行数据。下面举来看下优先级。</p>\n\n<pre><code>select id,content,match(content) against('MySQL') from test_text ;\n</code></pre>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_fulltext_v3.PNG" alt="" title="" /></p>\n\n<p><font color="red">从结果可以看出，确实是id=7的行的优先级大于id=8的优先级，原因在于优先级并不至于出现的先后位置有关系，还与诸如文本长度等因素也有关系。 <br />\n</font></p>\n\n<p>在增加了一行以MySQL开头的行数据之后，我们来一起观察下上面这两种方法的结果。</p>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_fulltext_v6.PNG" alt="" title="" /></p>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_fulltext_v7.PNG" alt="" title="" /></p>\n\n<p>从上面两图可以明显看出，确实，利用全文本搜索对搜索到的内容进行一定的排序，而通配符却没有进行排序。至于全文本搜索对搜索到的内容进行排序由很多因素来进行决定，比如：出现的位置、出现的次数、文本自身的长度等等。</p>\n\n<p>等级越高，出现的位置就越靠前，在我们生活中使用的搜索引擎（例如百度、google等）进行搜索东西的时候，我相信也是按照这样的逻辑来出现结果，当然除了百度公司收了别人钱把不匹配的内容人为的放在更前面。</p>\n\n\n\n<h2 id="使用查询扩展with-query-expansion">使用查询扩展:with query expansion</h2>\n\n<p>前面介绍的只是普通的全文本搜索。</p>\n\n<p>但是，我们在生活中常常有更严格的要求，例如，我希望搜索 的内容包括MySQL字符串，你还想得到与MySQL相关的内容（即使没有出现MySQL字眼），应该怎么来做呢？？</p>\n\n<p>这就需要我们使用查询扩展了。</p>\n\n<p>用法 ：在against(关键字 with query expansion) 即可 <br />\n<img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_fulltext_v8.PNG" alt="" title="" /></p>\n\n<p>从结果可以看出，当我们使用了查询扩展之后，就得到了更多相关的内容，即使这些内容不包括MySQL字眼。</p>\n\n<p>至于MySQL是如何根据MySQL来得到与之相关的关键字，目前我还不清楚。</p>\n\n\n\n<h2 id="布尔文本搜索">布尔文本搜索</h2>\n\n<p>MySQL支持全文本搜索的另外一种形式，称为布尔方式。以布尔方式，可以提供如下内容的细节：</p>\n\n<blockquote>\n <ul>\n <li>要匹配的词；</li>\n <li>要排斥的词、</li>\n <li>排列提示（指定某些词比其他词更重要，更重要的词等级更高）</li>\n <li>表达式分组。</li>\n </ul>\n</blockquote>\n\n<p>要说明的是：即使没有fulltext索引也可以使用，只是速度相当相当的慢。</p>\n\n<p>为显示 in boolean mode的作用，以一个简单的例子来进行说明。</p>\n\n<pre><code>select csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-14.html csdn-15.html csdn-16.html csdn-17.html csdn-18.html csdn-19.html csdn-1.html csdn-20.html csdn-21.html csdn-22.html csdn-23.html csdn-24.html csdn-25.html csdn-26.html csdn-27.html csdn-28.html csdn-29.html csdn-2.html csdn-30.html csdn-31.html csdn-32.html csdn-33.html csdn-34.html csdn-35.html csdn-36.html csdn-37.html csdn-38.html csdn-39.html csdn-3.html csdn-40.html csdn-41.html csdn-42.html csdn-43.html csdn-44.html csdn-45.html csdn-46.html csdn-47.html csdn-48.html csdn-49.html csdn-4.html csdn-50.html csdn-51.html csdn-52.html csdn-53.html csdn-54.html csdn-55.html csdn-56.html csdn-57.html csdn-58.html csdn-59.html csdn-5.html csdn-60.html csdn-61.html csdn-62.html csdn-63.html csdn-64.html csdn-65.html csdn-66.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh from test_text where match(content) against('MySQL -interesting' in boolean mode);//返回必须包含MySQL不能包含interesting内容的数据。\n</code></pre>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_fulltext_v9.PNG" alt="" title="" /></p>\n\n<p>关于全文本布尔操作符，见下表（来源于：《MySQL必知必会》这本书）</p>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_fulltext_v10.PNG" alt="" title="" /></p>\n\n<p>关于全文本布尔操作符的具体使用实例，与上面的例子类似，这里不在进行具体介绍。</p>\n\n\n\n<h2 id="全文本搜索的使用说明">全文本搜索的使用说明</h2>\n\n<p>1、MySQL带有一个内建的非用词列表。这些词在索引全文本数据时总是被忽略。如果需要，可以覆盖这个列表。</p>\n\n<p>2、许多词出现的频率很高，搜索他们没有用处（因为返回太多的结果）。因此，MySQL规定了一条50%规则，如果一个词出现在50%以上的行中，则将它作为一个非用词忽略。50%规则不用于in boolean mode.</p>\n\n<p>3、如果表中的数据的行数小于3行，则全文本搜索不返回结果。因此每个词要么不出现，出现就至少为50%。</p>\n\n<p>4、忽略词中的单引号。例如：don’t 索引为dont。</p>\n\n\n\n<h2 id="小结">小结</h2>\n\n<p><font color="red" size="4">关于全文本搜索就到这里就介绍完了，给我的一个感受就是：自己看《MySQL必知必会》这本书的这一节的时候花了10来分钟就看完了，然而跟着这一节实践下来加上写博客的时间，却花了2个小时之久，虽然花了这么多时间，但是收获还是有的，比只看书的理解要更多了一些，以及对match/against的使用要更熟悉的一些。就是因为如此，才有了我一直跟着这本书来了解MySQL的动力，到目前为止，自己跟着这本书已经跟到了18章，前前后后花了将近2周了吧，以前一直以为自己对数据库的知识还是了解一些的，现在看来以前的自己只懂的数据库中的”增删改查”这几个简单的步骤。</font></p></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
