\n <div class="markdown_views"><h1 id="存储过程">存储过程</h1>\n\n<p>什么是存储过程？？</p>\n\n<p>简单来说，<font color="red" size="4">存储过程就是为了以后使用而保存的一条或多条SQL语句的集合 </font> .</p>\n\n<p>和我们编程语言中的<strong>函数</strong>这个概念比较像。</p>\n\n<p>在编程语言中，我们经常要完成某个功能,我们都会将它写成一个函数，然后在需要这个函数的时候调用它就好了。</p>\n\n<p>同样的道理，存储过程也是这样，我们首先先声明这个存储过程，在我们需要这个存储过程的时候，我们调用这个存储过程就行了。</p>\n\n<p>例如：在C语言中，我们想求两个数值a/b中的最大值。则我们可以写如下这样一个函数：</p>\n\n<pre><code>int myMax(int a,int b){\n return a&gt;b?a:b;\n}\n</code></pre>\n\n<p>在main函数中相应的位置调用即可。</p>\n\n<pre><code>int main(void){\n int a,b;\n scanf("%d%d",&amp;a,&amp;b);\n int maxValue=myMax(a,b);//调用\n printf("max value %d",maxValue);\n}\n</code></pre>\n\n<p>存储过程的定义和调用上面函数的定义是类似的。</p>\n\n<p>存储过程的定义中，也可以有输入参数，也可以有返回值。下面我们介绍下存储过程的定义和调用。</p>\n\n<p>还是以例子来进行说明：</p>\n\n<p>在student表中的最后一列为学生成绩score，现在我们想为成绩写一个存储过程，以供以后一直使用。</p>\n\n<p>在命令行应该这样来创建和调用如下：</p>\n\n<pre><code>delimiter // 改变MySQL语句的结束分隔符为//\n create procedure p_scoreAvg()\n begin\n select avg(score) as avg_score from student;\n end //\ndelimiter ; 恢复MySQL语句的结束分隔符为分号\n</code></pre>\n\n<p><font color="red">注： <br />\n1、这里最要注意的是开始和结束位置的delimiter //和delimiter ;这两句，delimiter是分隔符的意思，由于MySQL默认的是以”;”z作为分隔符，而存储过程中会出现分号作为语句的一部分，如果我们之前不改变分隔符的号，MySQL还是会以分号作为语句分隔符结束。分隔符除了,其它的符号都可以作为分隔符，例如 $$</font></p>\n\n<p>2、存储过程可以有输入参数，输出参数，也可以都没有，但是存储过程名后面的一对圆括号是不能少的。这一点和编程语言中的函数一致。</p>\n\n<p>3、存储过程的过程体开始与结束使用begin和end进行标识。</p>\n\n<p>上面就定义了一个无输入参数，也没有返回值的存储过程，调用此存储过程的方法如下：</p>\n\n<pre><code>call p_scoreAvg();\n</code></pre>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_p_v1.PNG" alt="" title="" /></p>\n\n<p>下面分别举一个既有输入也有输出的例子。</p>\n\n<p>在举例子之前，我student2表中，插入了一些数据，这次是借助于SQLyog工具来做的，确实方便多了。</p>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_p_v2.PNG" alt="" title="" /></p>\n\n<p>现在我们想根据学生的学号来得到学生的各科成绩以平均成绩。存储过程如下：</p>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_p_v3.PNG" alt="" title="" /></p>\n\n<p>有了如上的存储过程之后，调用方法如下：</p>\n\n<pre><code>call p_student1(1,@avgScore);\nselect @avgScore;//显示出变量avgScore的值\n</code></pre>\n\n<p>在SQLyog中实践如下：</p>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_p_v4.PNG" alt="" title="" /></p>\n\n<p>下面将讲解下存储过程的参数： <br />\n共有三种参数，形如：</p>\n\n<p>create procedure ([IN|OUT|INOUT] 参数名 数据类型)</p>\n\n<p>1、IN 输入参数</p>\n\n<p>2、OUT 输出参数，可以被返回</p>\n\n<p>3、INOUT 输入输出参数</p>\n\n<p><strong>MySQL存储过程的调用</strong> <br />\n用call和你过程名以及一个括号，括号里面根据需要，加入参数，参数包括输入参数、输出参数、输入输出参数。具体如下：</p>\n\n<pre><code>call procedure_name();//如果有参数，传入参数即可。\ncall procedure_name(@p1,@p2);//参数都是以@开头\n</code></pre>\n\n\n\n<h2 id="变量">变量</h2>\n\n\n\n<h3 id="变量定义">变量定义</h3>\n\n<p>DECLARE variable_name [,variable_name …] datatype [DEFAULT value];</p>\n\n<p>其中datatype为MySQL的数据类型，如INT 、DECIMAL VARCHAR(length)等；</p>\n\n\n\n<h3 id="变量赋值">变量赋值</h3>\n\n<p>set varible_name=expression;</p>\n\n\n\n<h3 id="用户变量">用户变量</h3>\n\n<p>1、在MySQL客户端使用用户变量</p>\n\n<p>主要有select 和set为变量赋值：</p>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_p_v6.PNG" alt="" title="" /></p>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_p6.PNG" alt="" title="" /></p>\n\n<p>例如：当有如下的存储过程：</p>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_p_v3.PNG" alt="" title="" /></p>\n\n<p>当调用时，可以给输入参数作为一个变量，如下：</p>\n\n<pre><code>SET @id=1;//变量\nCALL p_student1(@id,@avgScore);\nSELECT @avgScore;\n</code></pre>\n\n<p><font color="red" size="4">注意：用户变量名一般以@开头</font></p>\n\n\n\n<h2 id="存储过程中条件语句的应用">存储过程中条件语句的应用</h2>\n\n<p>前面一直强调MySQL中的存储过程和其它编程语言中的函数类似，因此像IF-ELSE CASE WHILE 等都可以应用于存储过程中。 <br />\n下面将分别举例来进行讲解。</p>\n\n\n\n<h3 id="if-else的应用">IF ELSE的应用</h3>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_p_v7.PNG" alt="" title="" /></p>\n\n\n\n<h3 id="case-的应用">CASE 的应用</h3>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_p_useCase.PNG" alt="" title="" /></p>\n\n<p>上面就是关于case的用法，语法目前还不怎么熟悉，写起来怪怪的。</p>\n\n\n\n<h3 id="while的应用">while的应用</h3>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_p8.PNG" alt="" title="" /></p>\n\n<p>调用后的结果如下：</p>\n\n<p><img src="http://7xknzt.com1.z0.glb.clouddn.com/MySQL_p9.PNG" alt="" title="" /></p>\n\n<p>上面只是简单的介绍了下IF-ELSE 、WHILE 、case的用法。存储过程还支持许多其他的语法。如：repeat等</p>\n\n\n\n<h2 id="删除存储过程">删除存储过程</h2>\n\n<p>在MySQL中删除都是用DROP 来做。</p>\n\n<p>因此，删除存储过程的命令如下：</p>\n\n<pre><code>drop procedure pro_name;\n</code></pre>\n\n\n\n<h2 id="使用存储过程的优点">使用存储过程的优点</h2>\n\n<p>和编程语言中使用的函数一样优点类似，模块化、重用等。</p></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
