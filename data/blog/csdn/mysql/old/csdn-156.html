\n <div class="markdown_views"><h1 id="环境简介">环境简介</h1>\n\n<p>主服务器：CentOS6.5下mysql5.6.30 <br />\n安装请参考<a href="http://blog.csdn.net/hsd2012/article/details/51232612">这里</a>网址：<a href="http://blog.csdn.net/hsd2012/article/details/51232612">http://blog.csdn.net/hsd2012/article/details/51232612</a> <br />\n从服务器：win7下5.6.17</p>\n\n\n\n<h1 id="原理简介及优缺点">原理简介及优缺点</h1>\n\n<p>MySQL从3.23版本开始提供复制功能，复制主要是指将主服务器的DDL和DML操作，通过二进制日志（binLog日志），传到服务的服务器上，然后在从服务器上对这些日志从新执行，从而实现从服务器与主服务器的数据同步。MySQL支持一台主服务器同时向多台从服务器进行复制，从服务器同时也可以作为其他服务器的主服务器，实现链状的复制。</p>\n\n\n\n<h2 id="优点">优点</h2>\n\n<ul>\n<li>如果主服务器出现问题，可以快速切换到从服务器提供服务。</li>\n<li>可以在从服务器上执行查询，降低主服务器的压力</li>\n<li>可以在从服务器上执行备份，以避免备份期间影响主服务器的性能</li>\n</ul>\n\n<h2 id="局限">局限</h2>\n\n<p>由于MySQL实现的是异步复制，所以主从服务器之间的数据存在一定差异，对实时性要求高的数据仍然需要从主服务器上获得。</p>\n\n<h1 id="前期准备">前期准备</h1>\n\n<p>1.在linux下创建账号 <br />\n在win的命令提示符中输入ipconfig，查看ip <br />\n<img src="http://img.blog.csdn.net/20160426114702107" alt="这里写图片描述" title="" /> <br />\n因为我的win下ip为192.168.153.1，所以，我创建将Host设置为192.168.153.%，关于原因，可参考<a href="http://blog.csdn.net/hsd2012/article/details/51200006">这里</a> <br />\n<img src="http://img.blog.csdn.net/20160426114505783" alt="这里写图片描述" title="" /> <br />\n2.赋予权限 <br />\n<img src="http://img.blog.csdn.net/20160425220526810" alt="这里写图片描述" title="" /> <br />\nREPLICATION SLAVE权限针对所有的数据库，只能通过<em>.</em> ，而不能shool.*,因为REPLICATION SLAVE是复制binlog日志。 <br />\n<img src="http://img.blog.csdn.net/20160426115113745" alt="这里写图片描述" title="" /> <br />\n3.将主服务器中的数据，复制到从服务器，确保两者搭建主从之前，数据一致。关于这，之前写过一篇文章专门介绍，可以参考<a href="http://blog.csdn.net/hsd2012/article/details/51182192">这里</a></p>\n\n<h1 id="配置">配置</h1>\n\n\n\n<h2 id="主服务器配置">主服务器配置</h2>\n\n<p>1.开启binlog日志，并设置server_id <br />\n<img src="http://img.blog.csdn.net/20160426151731112" alt="这里写图片描述" title="" /></p>\n\n<h2 id="从服务器配置">从服务器配置</h2>\n\n<p>1.配置server_id <br />\n设置：server-id=2 <br />\n<img src="http://img.blog.csdn.net/20160426152056457" alt="这里写图片描述" title="" /> <br />\n2.指定主服务器配置格式如下 <br />\nchange master to <br />\nmaster_host=’master_host_name’, //从服务器的主机 <br />\nmaster_user=’replication_user_name’,//执行复制用户名 <br />\nmaster_password=’replication_password’,//执行复制用户密码 <br />\nmaster_log_file=’recorded_log_file_name’,//二进制日志文件名 <br />\nmaster_log_pos=’recorded_log_postion’;//复制开始位置</p>\n\n<p>根据我的配置信息 <br />\nbin-log信息 <br />\n<img src="http://img.blog.csdn.net/20160426103840893" alt="这里写图片描述" title="" /> <br />\n复制用户信息 <br />\n<img src="http://img.blog.csdn.net/20160426104106472" alt="这里写图片描述" title="" /> <br />\n我执行的配置代码如下： <br />\nchange master to <br />\nmaster_host=’192.168.153.140’, <br />\nmaster_user=’lidequan’, <br />\nmaster_password=’lidequan’, <br />\nmaster_log_file=’bin-log.000003’, <br />\nmaster_log_pos=120; <br />\n<img src="http://img.blog.csdn.net/20160426104637208" alt="这里写图片描述" title="" /></p>\n\n<h2 id="查看从服务器是否已连接主服务器">查看从服务器是否已连接主服务器</h2>\n\n\n\n<h3 id="执行start-slave">执行start slave;</h3>\n\n<p><img src="http://img.blog.csdn.net/20160426111238234" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="执行show-processlist">执行show processlist;</h3>\n\n<p><img src="http://img.blog.csdn.net/20160426111500844" alt="这里写图片描述" title="" /></p>\n\n<h2 id="修改主服务器数据查看同步效果">修改主服务器数据，查看同步效果</h2>\n\n<p>在这里修改主服务器数据，主要是执行插入，更新操作。 <br />\n操作之前，数据信息如下 <br />\n<img src="http://img.blog.csdn.net/20160426105400305" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="执行插入操作">执行插入操作</h3>\n\n<pre class="prettyprint"><code class=" hljs asciidoc">insert into <span class="hljs-smartquote">`class` (`name`) values ('</span>三年二班<span class="hljs-emphasis">'),('</span>三年五班<span class="hljs-emphasis">'),('</span>三年七班<span class="hljs-emphasis">');</span></code></pre>\n\n<p><img src="http://img.blog.csdn.net/20160426111708158" alt="这里写图片描述" title="" /> <br />\n此时从服务器中也有数据了 <br />\n<img src="http://img.blog.csdn.net/20160426111627276" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="执行更新操作">执行更新操作</h3>\n\n<pre class="prettyprint"><code class=" hljs asciidoc">update class set <span class="hljs-smartquote">`name`='</span>三年三班' where id=3;</code></pre>\n\n<p>观察下图，发现数据确实发生了变化 <br />\n<img src="http://img.blog.csdn.net/20160426112144253" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="删除操作">删除操作</h3>\n\n<p>观察下图，数据也是同步的 <br />\n<img src="http://img.blog.csdn.net/20160426112414113" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="数据表定义操作">数据表定义操作</h3>\n\n<p>1.添加一个student表</p>\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> student(\n <span class="hljs-string">`id`</span> <span class="hljs-keyword">INT</span>(<span class="hljs-number">3</span>) UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT<span class="hljs-string">'学生编号'</span>,\n <span class="hljs-string">`name`</span> <span class="hljs-keyword">CHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">''</span> COMMENT<span class="hljs-string">'学生名'</span>,\n <span class="hljs-string">`class_id`</span> <span class="hljs-keyword">INT</span>(<span class="hljs-number">3</span>) UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT<span class="hljs-string">'班级编号'</span>,\n <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span>(<span class="hljs-string">`id`</span>)\n) ENGINE=MYISAM <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8;</span></code></pre>\n\n<p><img src="http://img.blog.csdn.net/20160426113102125" alt="这里写图片描述" title="" /></p>\n\n<p>2.往student表中添加一个字段</p>\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> student <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> age TINYINT(<span class="hljs-number">2</span>) UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT<span class="hljs-string">'学生年龄'</span>;</span></code></pre>\n\n<p><img src="http://img.blog.csdn.net/20160426114305078" alt="这里写图片描述" title="" /></p>\n\n\n\n<h1 id="指定负责的数据库或者表">指定负责的数据库或者表</h1>\n\n<p>可以通过replicate-do-db、replicate-do-table、replicate-ignore-db、replicate-ignore-table或者replicate-wild-do-table来指定主从数据库复制到从数据库的数据库或者表。</p>\n\n<h1 id="关于数据复制的一些重要参数">关于数据复制的一些重要参数</h1>\n\n<p>在上面搭建主从服务器的时候，使用了MASTER_HOST,MASTER_PORT,MASTER_USER,MASTER_PASSWORD,MASTER_LOG_FILE,MASTER_LOG_POS这些参数都要在从服务器上配置，下面再来说几个常用的启动选项，如log_slave_updates、read_only、master_verify_checksum</p>\n\n<h2 id="logslaveupdates">log_slave_updates</h2>\n\n<p>log_slave_updates这个参数用来配置从服务器上的更新操作是否写入二进制日志，默认是不打开的。 <br />\n首先我们来看一下刚刚win下mysql的binlog日志内容 <br />\n<img src="http://img.blog.csdn.net/20160426120203416" alt="这里写图片描述" title="" /> <br />\n可以发现，刚刚我们执行了增、删、改等操作，它并没有记录。 <br />\n我们可以看到log_slave_updates是没有启动的 <br />\n<img src="http://img.blog.csdn.net/20160426120528504" alt="这里写图片描述" title="" /> <br />\n且该属性是只读属性，不可以动态的设置，只能在配置文件中设置,如下图设置将会报错 <br />\n<img src="http://img.blog.csdn.net/20160426130143760" alt="这里写图片描述" title="" /></p>\n\n\n\n<h2 id="readonly">read_only</h2>\n\n<p>read-only选项：对所有的非临时表进行只读控制。但是有两种特殊情况 <br />\n1. 对replication threads例外，以保证slave能够正常的进行replication。 <br />\n 2. 对于拥有super权限的用户，可以ignore这个选项。 <br />\n<img src="http://img.blog.csdn.net/20160426133117743" alt="这里写图片描述" title="" /> <br />\n当以没有拥有super权限的用户登录时候，会提示如下： <br />\n<img src="http://img.blog.csdn.net/20160426134520865" alt="这里写图片描述" title="" /> <br />\n这样就确保了从数据只负责读数据操作，而拒绝写数据的操作。 <br />\n补充： <br />\nSUPER 权限 ： <br />\n1. 可以有change master to, kill其他用户的线程的权限。 <br />\n2. Purge binary logs 来删除binary log, set global来动态设置变量的权限。 <br />\n3. 执行mysqladmin debug命令，开启或者关闭log，在read-only打开时执行update/insert操作。 <br />\n4. 执行start slave, stop slave. <br />\n5. 当连接数已经达到max_connections的最大值时，也可以连接到server。</p>\n\n\n\n<h2 id="masterverifychecksum">master_verify_checksum</h2>\n\n<p>由于软硬件或者网络传输出错，导致主服务器上运行的sql语句与从服务器上运行的sql语句不一致，很难找到问题原因，mysql的开发人员在 5.6 Milestone Development Release版本中加入了 replication event checksum(主从复制事件校验)功能。master_verify_checksum主要用于复制事件校验。当一个event被写入binary log(二进制日志)的时候，checksum也同时写入binary log，然后在event通过网络传输到从服务器(slave)之后，再在从服务器中对其进行验证并写入从服务器的relay log。由于每一步都记录了event和checksum，所以我们可以很快地找出问题所在。</p>\n\n\n\n<h1 id="管理与维护">管理与维护</h1>\n\n\n\n<h2 id="查看从服务器状态">查看从服务器状态</h2>\n\n<p>使用show slave stauts; <br />\n<img src="http://img.blog.csdn.net/20160426142758469" alt="这里写图片描述" title="" /> <br />\n在查看这些信息中，比较重要的是”slave_io_runing”和”slave_sql_runing”这两个进程 <br />\nslave_io_runing :此进程负责从服务器从主服务器上读取Binlog日志，并写入从服务器上的中继日志中。 <br />\nSlave_SQL_Runing:此进程负责读取并执行中继日志中的binlog日子。 <br />\n只要期中有一个进程的状态时no，则表示复制进程停止。</p>\n\n<h1 id="总结">总结</h1>\n\n<p>主从配置 <br />\n一、主服务器上配置 <br />\n1.创建用户，并赋予REPLICATION SLAVE权限 <br />\n2.开启binlog日志，并设置server_id <br />\n二、从服务器配置 <br />\n1.指定server_id <br />\n2.指定主服务器配置</p>\n\n<h1 id="备注">备注：</h1>\n\n<p>1.win下mysql开启与关闭（前提是需要配置path路径） <br />\n<img src="http://img.blog.csdn.net/20160426141759839" alt="这里写图片描述" title="" /></p>\n\n<p>2.server-id做什么用的</p>\n\n<ul>\n<li>mysql的同步的数据中是包含server-id的，用于标识该语句最初是从哪个server写入的，所以server-id一定要有的，如果设置多个从服务器，每个从服务器必须有一个唯一的server-id值，必须与主服务器的以及其它从服务器的不相同。</li>\n<li>每一个同步中的slave在master上都对应一个master线程，该线程就是通过slave的server-id来标识的；每个slave在master端最多有一个master线程，如果两个slave的server-id 相同，则后一个连接成功时，前一个将被踢掉。 </li>\n<li>在mysql做主从同步时，要保证一条数据不会陷入死循环，这里就是靠server-id来实现的。</li>\n</ul></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
