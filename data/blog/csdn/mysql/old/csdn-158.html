\n\n<p style="margin-top:0px; margin-bottom:12px; padding-top:0px; padding-bottom:0px; text-indent:28px; text-align:justify; color:rgb(51,51,51); font-size:14px; line-height:22px">&#13;\n<a target="_blank" href="http://dev.mysql.com/doc/refman/5.6/en/mysqladmin.html" style="margin:0px; padding:0px; color:rgb(0,84,179); outline:none">mysqladmin</a>是MySQL一个重要的客户端，最常见的是使用它来关闭数据库，除此，该命令还可以了解MySQL运行状态、进程信息、进程杀死等。本文介绍一下如何使用mysqladmin&#13;\n extended-status(因为没有"歧义"，所以可以使用ext代替)了解MySQL的运行状态。</p>&#13;\n<div id="toc_container" class="toc_black no_bullets" style="margin:0px 0px 1em; padding:10px; border:1px solid rgb(170,170,170); width:275px; display:table; font-size:13px; color:rgb(51,51,51); line-height:22px; background:rgb(0,0,0)">&#13;\n<p class="toc_title" style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:28px; text-align:center; font-weight:bold; color:rgb(170,170,170)">&#13;\n目录 <span class="toc_toggle" style="margin:0px; padding:0px; font-weight:normal; font-size:12px">[<a target="_blank" href="http://www.orczhou.com/index.php/2014/03/some-tricky-about-mysqladmin-extended-status/" style="margin:0px; padding:0px; color:rgb(0,84,179); text-decoration:none; outline:none">hide</a>]</span></p>&#13;\n<ul class="toc_list" style="margin:1em 0px 0px; padding:0px; list-style:none; background:none">&#13;\n<li style="margin:0px; padding:0px; list-style:none; background:none"><a target="_blank" href="http://www.orczhou.com/index.php/2014/03/some-tricky-about-mysqladmin-extended-status/#1_-r-i" style="margin:0px; padding:0px; color:rgb(0,84,179); text-decoration:none; outline:none">1.&#13;\n 使用-r/-i参数</a></li><li style="margin:0px; padding:0px; list-style:none; background:none"><a target="_blank" href="http://www.orczhou.com/index.php/2014/03/some-tricky-about-mysqladmin-extended-status/#2_grep" style="margin:0px; padding:0px; color:rgb(0,84,179); text-decoration:none; outline:none">2.&#13;\n 配合grep使用</a></li><li style="margin:0px; padding:0px; list-style:none; background:none"><a target="_blank" href="http://www.orczhou.com/index.php/2014/03/some-tricky-about-mysqladmin-extended-status/#3_awk" style="margin:0px; padding:0px; color:rgb(0,84,179); text-decoration:none; outline:none">3.&#13;\n 配合简单的awk使用</a></li><li style="margin:0px; padding:0px; list-style:none; background:none"><a target="_blank" href="http://www.orczhou.com/index.php/2014/03/some-tricky-about-mysqladmin-extended-status/#4_awk" style="margin:0px; padding:0px; color:rgb(0,84,179); text-decoration:none; outline:none">4.&#13;\n 配合复杂一点的awk</a></li></ul>&#13;\n</div>&#13;\n<h3 style="margin:0px; padding:0px; font-family:&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;,Arial,Helvetica,sans-serif; font-size:14px; line-height:26px; color:red; clear:both">&#13;\n<span id="1_-r-i" style="margin:0px; padding:0px; font-family:Arial,Helvetica,sans-serif">1. 使用-r/-i参数</span></h3>&#13;\n<p style="margin-top:0px; margin-bottom:12px; padding-top:0px; padding-bottom:0px; text-indent:28px; text-align:justify; color:rgb(51,51,51); font-size:14px; line-height:22px">&#13;\n使用mysqladmin extended-status命令可以获得所有MySQL性能指标，即show global status的输出，不过，因为多数这些指标都是累计值，如果想了解当前的状态，则需要进行一次差值计算，这就是mysqladmin extended-status的一个额外功能，非常实用。默认的，使用extended-status，看到也是累计值，但是，加上参数-r(--relative)，就可以看到各个指标的差值，配合参数-i(--sleep)就可以指定刷新的频率，那么就有如下命令：<span id="more-4795" style="margin:0px; padding:0px"></span></p>&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; font-family:Arial,Helvetica,sans-serif; color:rgb(51,51,51); font-size:14px; line-height:22px; background-color:rgb(255,255,255)"><div class="mycode" style="margin:0px 0px 12px; padding:10px; font-family:Fixedsys,'Courier New',Courier,monospace; border-left-width:6px; border-left-style:solid; border-left-color:rgb(22,100,217); color:rgb(0,204,0); font-size:1em; line-height:normal; overflow:scroll; width:724px; background:rgb(34,34,34)">mysqladmin -uroot -r -i 1 -pxxx extended-status\n+------------------------------------------+----------------------+\n| Variable_name | Value |\n+------------------------------------------+----------------------+\n| Aborted_clients | 0 |\n| Com_select | 336 |\n| Com_insert | 243 |\n......\n| Threads_created | 0 |\n+------------------------------------------+----------------------+</div></pre>&#13;\n<h3 style="margin:0px; padding:0px; font-family:&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;,Arial,Helvetica,sans-serif; font-size:14px; line-height:26px; color:red; clear:both">&#13;\n<span id="2_grep" style="margin:0px; padding:0px; font-family:Arial,Helvetica,sans-serif">2. 配合grep使用</span></h3>&#13;\n<p style="margin-top:0px; margin-bottom:12px; padding-top:0px; padding-bottom:0px; text-indent:28px; text-align:justify; color:rgb(51,51,51); font-size:14px; line-height:22px">&#13;\n配合grep使用，我们就有：</p>&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; font-family:Arial,Helvetica,sans-serif; color:rgb(51,51,51); font-size:14px; line-height:22px; background-color:rgb(255,255,255)"><div class="mycode" style="margin:0px 0px 12px; padding:10px; font-family:Fixedsys,'Courier New',Courier,monospace; border-left-width:6px; border-left-style:solid; border-left-color:rgb(22,100,217); color:rgb(0,204,0); font-size:1em; line-height:normal; overflow:scroll; width:724px; background:rgb(34,34,34)">mysqladmin -uroot -r -i 1 -pxxx extended-status \\\n|grep "Questions\\|Queries\\|Innodb_rows\\|Com_select \\|Com_insert \\|Com_update \\|Com_delete "\n| Com_delete | 1 |\n| Com_delete_multi | 0 |\n| Com_insert | 321 |\n| Com_select | 286 |\n| Com_update | 63 |\n| Innodb_rows_deleted | 1 |\n| Innodb_rows_inserted | 207 |\n| Innodb_rows_read | 5211 |\n| Innodb_rows_updated | 65 |\n| Queries | 2721 |\n| Questions | 2721 |</div></pre>&#13;\n<h3 style="margin:0px; padding:0px; font-family:&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;,Arial,Helvetica,sans-serif; font-size:14px; line-height:26px; color:red; clear:both">&#13;\n<span id="3_awk" style="margin:0px; padding:0px; font-family:Arial,Helvetica,sans-serif">3. 配合简单的awk使用</span></h3>&#13;\n<p style="margin-top:0px; margin-bottom:12px; padding-top:0px; padding-bottom:0px; text-indent:28px; text-align:justify; color:rgb(51,51,51); font-size:14px; line-height:22px">&#13;\n使用awk，同时输出时间信息：</p>&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; font-family:Arial,Helvetica,sans-serif; color:rgb(51,51,51); font-size:14px; line-height:22px; background-color:rgb(255,255,255)"><div class="mycode" style="margin:0px 0px 12px; padding:10px; font-family:Fixedsys,'Courier New',Courier,monospace; border-left-width:6px; border-left-style:solid; border-left-color:rgb(22,100,217); color:rgb(0,204,0); font-size:1em; line-height:normal; overflow:scroll; width:724px; background:rgb(34,34,34)">mysqladmin -uroot -p -h127.0.0.1 -P3306 -r -i 1 ext |\\\nawk -F"|" '{\\\n if($2 ~ /Variable_name/){\\\n print " &lt;------------- " strftime("%H:%M:%S") " -------------&gt;";\\\n }\\\n if($2 ~ /Questions|Queries|Innodb_rows|Com_select |Com_insert |Com_update |Com_delete |Innodb_buffer_pool_read_requests/)\\\n print $2 $3;\\\n}'\n&lt;------------- 12:38:49 -------------&gt;\n Com_delete 0\n Com_insert 0\n Com_select 0\n Com_update 0\n Innodb_buffer_pool_read_requests 589\n Innodb_rows_deleted 0\n Innodb_rows_inserted 2\n Innodb_rows_read 50\n Innodb_rows_updated 50\n Queries 105\n Questions 1\n &lt;------------- 12:38:50 -------------&gt;\n Com_delete 0\n Com_insert 0\n Com_select 0\n Com_update 0\n Innodb_buffer_pool_read_requests 1814\n Innodb_rows_deleted 0\n Innodb_rows_inserted 0\n Innodb_rows_read 8\n Innodb_rows_updated 8\n Queries 17\n Questions 1</div></pre>&#13;\n<h3 style="margin:0px; padding:0px; font-family:&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;,Arial,Helvetica,sans-serif; font-size:14px; line-height:26px; color:red; clear:both">&#13;\n<span id="4_awk" style="margin:0px; padding:0px; font-family:Arial,Helvetica,sans-serif">4. 配合复杂一点的awk</span></h3>&#13;\n<p style="margin-top:0px; margin-bottom:12px; padding-top:0px; padding-bottom:0px; text-indent:28px; text-align:justify; color:rgb(51,51,51); font-size:14px; line-height:22px">&#13;\n反正也不简单了，那就更复杂一点，这样让输出结果<span style="margin:0px; padding:0px">更友好</span>点，因为awk不支持动态变量，所以代码看起来比较复杂：</p>&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; font-family:Arial,Helvetica,sans-serif; color:rgb(51,51,51); font-size:14px; line-height:22px; background-color:rgb(255,255,255)"><div class="mycode" style="margin:0px 0px 12px; padding:10px; font-family:Fixedsys,'Courier New',Courier,monospace; border-left-width:6px; border-left-style:solid; border-left-color:rgb(22,100,217); color:rgb(0,204,0); font-size:1em; line-height:normal; overflow:scroll; width:724px; background:rgb(34,34,34)">mysqladmin -P3306 -uroot -p -h127.0.0.1 -r -i 1 ext |\\\nawk -F"|" \\\n"BEGIN{ count=0; }"\\\n'{ if($2 ~ /Variable_name/ &amp;&amp; ++count == 1){\\\n print "----------|---------|--- MySQL Command Status --|----- Innodb row operation ----|-- Buffer Pool Read --";\\\n print "---Time---|---QPS---|select insert update delete| read inserted updated deleted| logical physical";\\\n}\\\nelse if ($2 ~ /Queries/){queries=$3;}\\\nelse if ($2 ~ /Com_select /){com_select=$3;}\\\nelse if ($2 ~ /Com_insert /){com_insert=$3;}\\\nelse if ($2 ~ /Com_update /){com_update=$3;}\\\nelse if ($2 ~ /Com_delete /){com_delete=$3;}\\\nelse if ($2 ~ /Innodb_rows_read/){innodb_rows_read=$3;}\\\nelse if ($2 ~ /Innodb_rows_deleted/){innodb_rows_deleted=$3;}\\\nelse if ($2 ~ /Innodb_rows_inserted/){innodb_rows_inserted=$3;}\\\nelse if ($2 ~ /Innodb_rows_updated/){innodb_rows_updated=$3;}\\\nelse if ($2 ~ /Innodb_buffer_pool_read_requests/){innodb_lor=$3;}\\\nelse if ($2 ~ /Innodb_buffer_pool_reads/){innodb_phr=$3;}\\\nelse if ($2 ~ /Uptime / &amp;&amp; count &gt;= 2){\\\n printf(" %s |%9d",strftime("%H:%M:%S"),queries);\\\n printf("|%6d %6d %6d %6d",com_select,com_insert,com_update,com_delete);\\\n printf("|%6d %8d %7d %7d",innodb_rows_read,innodb_rows_inserted,innodb_rows_updated,innodb_rows_deleted);\\\n printf("|%10d %11d\\n",innodb_lor,innodb_phr);\\\n}}'</div></pre>&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; font-family:Arial,Helvetica,sans-serif; color:rgb(51,51,51); font-size:14px; line-height:22px; background-color:rgb(255,255,255)"><div class="mycode" style="margin:0px 0px 12px; padding:10px; font-family:Fixedsys,'Courier New',Courier,monospace; border-left-width:6px; border-left-style:solid; border-left-color:rgb(22,100,217); color:rgb(0,204,0); font-size:1em; line-height:normal; overflow:scroll; width:724px; background:rgb(34,34,34)">----------|---------|--- MySQL Command Status --|----- Innodb row operation ----|-- Buffer Pool Read --\n---Time---|---QPS---|select insert update delete| read inserted updated deleted| logical physical\n 10:37:13 | 2231| 274 214 70 0| 4811 160 71 0| 4146 0\n 10:37:14 | 2972| 403 256 84 23| 2509 173 85 23| 4545 0\n 10:37:15 | 2334| 282 232 66 1| 1266 154 67 1| 3543 0\n 10:37:15 | 2241| 271 217 66 0| 1160 129 66 0| 2935 0\n 10:37:17 | 2497| 299 224 97 0| 1141 149 95 0| 3831 0\n 10:37:18 | 2871| 352 304 74 23| 8202 226 73 23| 6167 0\n 10:37:19 | 2441| 284 233 82 0| 1099 121 78 0| 3292 0\n 10:37:20 | 2342| 279 242 61 0| 1083 224 61 0| 3366 0</div></pre>&#13;\n<p style="margin-top:0px; margin-bottom:12px; padding-top:0px; padding-bottom:0px; text-indent:28px; text-align:justify; color:rgb(51,51,51); font-size:14px; line-height:22px">&#13;\n就这样了，这几个命令自己用的比较多，随手分享出来。</p>&#13;\n &#13;\n
