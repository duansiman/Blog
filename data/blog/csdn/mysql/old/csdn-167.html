\n\n<p>本文适用于新安装的主库和备库，假定主备库为空，如果你是从已存在的主库复制，请转到<a target="_blank" href="http://blog.csdn.net/dbanote/article/details/17025837">《[MySQL] 复制（3）- 创建主备复制（从另一个服务器开始复制）</a>》</p>&#13;\n<h3>主库的配置</h3>&#13;\n<p>主库需要打开二进制日志，并制定一个唯一的server id，my.cnf文件中增加或修改如下内容：</p>&#13;\n<p></p>&#13;\n<pre code_snippet_id="84562" snippet_file_name="blog_20131127_1_1827713" name="code" class="plain">server_id=60\nlog-bin = /data/mysql/log/mysql-bin</pre>&#13;\n<p></p>&#13;\n<h3>备库的配置</h3>&#13;\n<div>备库my.cnf的配置如下：</div>&#13;\n<div><pre code_snippet_id="84562" snippet_file_name="blog_20131127_2_2939745" name="code" class="sql">server_id=61\nread_only=1\nlog_bin = /data/mysql/log/mysql-bin \nlog_slave_updates = 1 \nrelay_log = /data/mysql/log/mysqld-relay-bin</pre>&#13;\n<div>和主库类似，备库也要指定一个唯一的server id，还有备库的二进制日志最好和主库的命名一致，方便以后切换。</div>&#13;\n此外，relay_log用于配置中继日志，log_slave_updates=1表示允许备库将其重放的事件也记录在其自身的二进制日志中，read_only=1表示备库为只读。</div>&#13;\n<div>&#13;\n<h3>创建复制账号</h3>&#13;\n<div>我们需要在主库创建一个用户，备库的I/O线程将以该用户连接到主库读取二进制日志。</div>&#13;\n<div><pre code_snippet_id="84562" snippet_file_name="blog_20131127_3_6178348" name="code" class="sql">GRANT REPLICATION SLAVE ON csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-16.html csdn-17.html csdn-18.html csdn-19.html csdn-1.html csdn-20.html csdn-21.html csdn-22.html csdn-23.html csdn-24.html csdn-25.html csdn-26.html csdn-27.html csdn-28.html csdn-29.html csdn-2.html csdn-30.html csdn-31.html csdn-32.html csdn-33.html csdn-34.html csdn-35.html csdn-36.html csdn-37.html csdn-38.html csdn-39.html csdn-3.html csdn-40.html csdn-41.html csdn-42.html csdn-43.html csdn-44.html csdn-45.html csdn-46.html csdn-47.html csdn-48.html csdn-49.html csdn-4.html csdn-50.html csdn-51.html csdn-52.html csdn-53.html csdn-54.html csdn-55.html csdn-56.html csdn-57.html csdn-58.html csdn-59.html csdn-5.html csdn-60.html csdn-61.html csdn-62.html csdn-63.html csdn-64.html csdn-65.html csdn-66.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh TO repluser@'192.168.1.%' IDENTIFIED BY 'replpwd';</pre>最好在备库里也创建这样一个用户，方便以后切换。<br />&#13;\n<h3>启动复制</h3>&#13;\n</div>&#13;\n<div>首先，我们要获得主库当前的二进制日志和其偏移量：</div>&#13;\n<div><pre code_snippet_id="84562" snippet_file_name="blog_20131127_4_1576542" name="code" class="sql">show master status;\n+------------------+----------+--------------+------------------+\n| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |\n+------------------+----------+--------------+------------------+\n| mysql-bin.000003 | 245 | | |\n+------------------+----------+--------------+------------------+</pre>然后，在备库执行如下语句连接主库获取二进制日志：</div>&#13;\n<div><pre code_snippet_id="84562" snippet_file_name="blog_20131127_5_6210585" name="code" class="sql">\tchange master to\n\t\t master_host='192.168.1.60',\n\t\t master_user='repluser',\n\t\t master_password='replpwd',\n\t\t master_log_file='mysql-bin.000003',\n\t\t master_log_pos=245;</pre>接着，在备库执行如下语句启动复制：</div>&#13;\n<div><pre code_snippet_id="84562" snippet_file_name="blog_20131127_6_4117034" name="code" class="sql">start slave</pre>下面是备库的状态：</div>&#13;\n<div><pre code_snippet_id="84562" snippet_file_name="blog_20131127_7_7355636" name="code" class="sql">show slave status\\G\n*************************** 1. row ***************************\n Slave_IO_State: Waiting for master to send event\n Master_Host: 192.168.1.60\n Master_User: repluser\n Master_Port: 3306\n Connect_Retry: 60\n Master_Log_File: mysql-bin.000003\n Read_Master_Log_Pos: 647\n Relay_Log_File: mysqld-relay-bin.000002\n Relay_Log_Pos: 655\n Relay_Master_Log_File: mysql-bin.000003\n Slave_IO_Running: Yes\n Slave_SQL_Running: Yes\n Replicate_Do_DB: \n Replicate_Ignore_DB: \n Replicate_Do_Table: \n Replicate_Ignore_Table: \n Replicate_Wild_Do_Table: \n Replicate_Wild_Ignore_Table: \n Last_Errno: 0\n Last_Error: \n Skip_Counter: 0\n Exec_Master_Log_Pos: 647\n Relay_Log_Space: 812\n Until_Condition: None\n Until_Log_File: \n Until_Log_Pos: 0\n Master_SSL_Allowed: No\n Master_SSL_CA_File: \n Master_SSL_CA_Path: \n Master_SSL_Cert: \n Master_SSL_Cipher: \n Master_SSL_Key: \n Seconds_Behind_Master: 0\nMaster_SSL_Verify_Server_Cert: No\n Last_IO_Errno: 0\n Last_IO_Error: \n Last_SQL_Errno: 0\n Last_SQL_Error: \n Replicate_Ignore_Server_Ids: \n Master_Server_Id: 60</pre>我们通过Slave_IO_Running和Slave_SQL_Running来判断备库是否和主库在同步。<br />&#13;\n在主库上可以看到由备库I/O线程向主库发起的连接：</div>&#13;\n<div><pre code_snippet_id="84562" snippet_file_name="blog_20131127_8_1150648" name="code" class="plain">show processlist\\G\n Id: 9\n User: repluser\n Host: 192.168.1.61:36722\n db: NULL\n Command: Binlog Dump\n Time: 379\n State: Master has sent all binlog to slave; waiting for binlog to be updated\n Info: NULL\n Rows_sent: 0\nRows_examined: 0\n Rows_read: 2</pre>在备库上可以看到两个线程，分别是I/O线程和SQL线程：</div>&#13;\n<div><pre code_snippet_id="84562" snippet_file_name="blog_20131127_9_1880996" name="code" class="sql">show processlist\\G\n Id: 10\n User: system user\n Host: \n db: NULL\n Command: Connect\n Time: 615\n State: Waiting for master to send event\n Info: NULL\n Rows_sent: 0\nRows_examined: 0\n Rows_read: 1\n*************************** 3. row ***************************\n Id: 11\n User: system user\n Host: \n db: NULL\n Command: Connect\n Time: 907\n State: Slave has read all relay log; waiting for the slave I/O thread to update it\n Info: NULL\n Rows_sent: 0\nRows_examined: 0\n Rows_read: 1\n3 rows in set (0.00 sec)</pre><br />&#13;\n</div>&#13;\n</div>&#13;\n<p></p>&#13;\n &#13;\n
