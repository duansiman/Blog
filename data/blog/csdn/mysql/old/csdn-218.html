\n\n一、理论：<br />&#13;\n1.错误日志：<br />&#13;\na.记录了mysqld启动和停止时以及出错时的相关信息，当数据库出现故障导致无法启动时可以先查看此信息。<br />&#13;\nb.可用--log-error来指定mysqld保存错误日志文件的位置<br />&#13;\n2.二进制日志：<br />&#13;\na.statement:记录的都是语句。优点：日志记录清晰易读、日志量少、对I/O影响较小，缺点：在某些情况下slave的日志复制会出错<br />&#13;\nb.row:将每一行的变更记录到日志中，而不是记录sql语句。优点：记录每一行的数据变化细节，不会出现某些情况下无法复制的情况，缺点：日志量大，对I/O影响较大<br />&#13;\nc.mixed:目前mysql的默认日志格式。尽可能对上两种模式的优点加以利用而避开它们的缺点<br />&#13;\nd.可以在global和session级别对binlog_format进行日志格式的操作，确保从库的复制能够正常进行<br />&#13;\n3.日志的读取：<br />&#13;\na.mysqlbinlog工具<br />&#13;\n4.日志的删除：<br />&#13;\na.reset master.可以删除所有的binlog日志<br />&#13;\nb.purge master logs to 'mysql-bin.*'，将删除*编号前的所有日志<br />&#13;\nc.purge master logs before 'yyyy-mm-dd hh24:mi:ss',将删除日期为指定日期之前的所有日志<br />&#13;\nd.--expire_logs_days=#：设置日志的过期天数<br />&#13;\n5.其他选项：<br />&#13;\na.--binlog-do-db=db_name:仅更新db_name数据库记录到二进制日志中而不更新其他数据库<br />&#13;\nb.--binlog-ignore-db=db_name:忽略db_name数据库记录到二进制日志中<br />&#13;\nc.--innodb-safe-binlog:与--sync-binlog=N(每写N次日志同步磁盘)一起配合使用，使得事务在日志中的记录更加安全<br />&#13;\nd.sql_log_bin=0:具有super权限的客户端可以通过设置此值使得禁止将自己的操作写入二进制记录。但有可能会导致主从数据不一致<br />&#13;\n6.日志的读取：查询日志记录的格式是纯文本，所以可以直接进行读取<br />&#13;\n7.慢查询日志：<br />&#13;\na.记录了所有时间超过long_query_time的设置值并且扫描记录数不小于in_examined_row_limit的所有sql语句的日志 <br />&#13;\nb.默认情况下，管理语句和不使用索引进行查询的语句不会记录到慢查询日志<br />&#13;\nc.--slow_query_log指定慢查询的状态，--show_query_log_file指定慢查询输出的路径，--log-out指定输出慢查询的方式（输出到表则只能精确到秒，输出到文件则能精确到微秒）<br />&#13;\n8.日志的读取：<br />&#13;\na.查询long_query_time的值:show variables like 'long%';<br />&#13;\nb.set long_query_time：设置long_query_time的值<br />&#13;\nc.more localhost-slow.log:查看慢查询日志的值<br />&#13;\n9.其他查看日志的相关工具：<br />&#13;\na.mysqlsla:查看日志<br />&#13;\n<p>b.sqlprofi,mysql-expain-slow-log,mysqllogfilter：分析日志</p>&#13;\n<p>二、实践：</p>&#13;\n<p></p><pre name="code" class="sql">mysql&gt; use test;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\n\nmysql&gt; create table emp(\n -&gt; id int(11),\n -&gt; info varchar(20)\n -&gt; ) engine = innnodb charset = utf8;\nQuery OK, 0 rows affected, 2 warnings (0.05 sec)\n\nmysql&gt; insert into emp values(1,'z1');\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; insert into emp values(1,'z2');\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; exit\n\nabc@ubuntu:~/Downloads/mysql$ mysql -uroot -p123 \nWelcome to the MySQL monitor. Commands end with ; or \\g.\nYour MySQL connection id is 98\nServer version: 5.5.44-log Source distribution\n\nCopyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql&gt; \nmysql&gt; show global variables like '%log%';\n+-----------------------------------------+---------------------------------------+\n| Variable_name | Value |\n+-----------------------------------------+---------------------------------------+\n| back_log | 50 |\n| binlog_cache_size | 32768 |\n| binlog_direct_non_transactional_updates | OFF |\n| binlog_format | STATEMENT |\n| binlog_stmt_cache_size | 32768 |\n| expire_logs_days | 14 |\n| general_log | OFF |\n| general_log_file | /usr/local/mysql/data/ubuntu.log |\n| innodb_flush_log_at_trx_commit | 2 |\n| innodb_locks_unsafe_for_binlog | OFF |\n| innodb_log_buffer_size | 8388608 |\n| innodb_log_file_size | 67108864 |\n| innodb_log_files_in_group | 2 |\n| innodb_log_group_home_dir | ./ |\n| innodb_mirrored_log_groups | 1 |\n| log | OFF |\n| log_bin | ON |\n| log_bin_trust_function_creators | OFF |\n| log_error | /usr/local/mysql/data/mysql-error.log |\n| log_output | FILE |\n| log_queries_not_using_indexes | ON |\n| log_slave_updates | OFF |\n| log_slow_queries | ON |\n| log_warnings | 1 |\n| max_binlog_cache_size | 18446744073709547520 |\n| max_binlog_size | 1073741824 |\n| max_binlog_stmt_cache_size | 18446744073709547520 |\n| max_relay_log_size | 0 |\n| relay_log | |\n| relay_log_index | |\n| relay_log_info_file | relay-log.info |\n| relay_log_purge | ON |\n| relay_log_recovery | OFF |\n| relay_log_space_limit | 0 |\n| slow_query_log | ON |\n| slow_query_log_file | /usr/local/mysql/data/mysql-slow.log |\n| sql_log_bin | ON |\n| sql_log_off | OFF |\n| sync_binlog | 1 |\n| sync_relay_log | 0 |\n| sync_relay_log_info | 0 |\n+-----------------------------------------+---------------------------------------+\n41 rows in set (0.02 sec)\n\n -&gt; Ctrl-C -- exit!\nAborted\nabc@ubuntu:~/Downloads/mysql$ mysqld --verbose --help | grep -A 1 'Default options'\n151106 15:37:14 [Warning] option 'table_definition_cache': unsigned value 100 adjusted to 400\n151106 15:37:14 [Note] mysqld (mysqld 5.5.44-log) starting as process 76330 ...\n151106 15:37:14 [Warning] Can't create test file /usr/local/mysql/data/ubuntu.lower-test\n151106 15:37:14 [Warning] Can't create test file /usr/local/mysql/data/ubuntu.lower-test\n151106 15:37:14 [Warning] One can only use the --user switch if running as root\n\nmysqld: File '/usr/local/mysql/data/mysql-bin.index' not found (Errcode: 13)\nDefault options are read from the following files in the given order:\n/etc/my.cnf /etc/mysql/my.cnf /usr/local/mysql/etc/my.cnf ~/.my.cnf \n151106 15:37:14 [ERROR] Aborting\n\nabc@ubuntu:~/Downloads/mysql$ mysqld --verbose --help | grep -A 1 'Default options'\n151106 15:37:32 [Warning] option 'table_definition_cache': unsigned value 100 adjusted to 400\n151106 15:37:32 [Note] mysqld (mysqld 5.5.44-log) starting as process 76335 ...\n151106 15:37:32 [Warning] Can't create test file /usr/local/mysql/data/ubuntu.lower-test\n151106 15:37:32 [Warning] Can't create test file /usr/local/mysql/data/ubuntu.lower-test\n151106 15:37:32 [Warning] One can only use the --user switch if running as root\n\nmysqld: File '/usr/local/mysql/data/mysql-bin.index' not found (Errcode: 13)\nDefault options are read from the following files in the given order:\n/etc/my.cnf /etc/mysql/my.cnf /usr/local/mysql/etc/my.cnf ~/.my.cnf \n151106 15:37:32 [ERROR] Aborting\n\n//以下文件就是mysql的本机上的配置文件\nabc@ubuntu:~/Downloads/mysql$ vi /usr/local/mysql/etc/my.cnf \n\nmysql&gt; select count(*) from payment p left join customer c on p.payment_id = c.customer_id;\n+----------+\n| count(*) |\n+----------+\n| 16049 |\n+----------+\n1 row in set (0.06 sec)\n\nmysql&gt; show variables like 'long%';\n+-----------------+----------+\n| Variable_name | Value |\n+-----------------+----------+\n| long_query_time | 2.000000 |\n+-----------------+----------+\n1 row in set (0.00 sec)\n\nmysql&gt; set long_query_time = 0.05;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; show variables like 'long%';\n+-----------------+----------+\n| Variable_name | Value |\n+-----------------+----------+\n| long_query_time | 0.050000 |\n+-----------------+----------+\n1 row in set (0.00 sec)\n\nmysql&gt; select count(*) from payment p left join customer c on p.payment_id = c.customer_id order by c.customer_id;\n+----------+\n| count(*) |\n+----------+\n| 16049 |\n+----------+\n1 row in set (0.07 sec)\n\nmysql&gt; Ctrl-C -- exit!\nAborted\n\nabc@ubuntu:/usr/local/mysql/data$ sudo tail ./mysql-slow.log \n[sudo] password for abc: \n# Time: 151106 23:40:39\n# User@Host: root[root] @ localhost []\n# Query_time: 0.047216 Lock_time: 0.000099 Rows_sent: 1 Rows_examined: 16650\nSET timestamp=1446882039;\nselect count(*) from payment p left join customer c on p.payment_id = c.customer_id;\n# Time: 151106 23:41:02\n# User@Host: root[root] @ localhost []\n# Query_time: 0.075027 Lock_time: 0.000083 Rows_sent: 1 Rows_examined: 32699\nSET timestamp=1446882062;\nselect count(*) from payment p left join customer c on p.payment_id = c.customer_id order by c.customer_id;</pre>&#13;\n<br />&#13;\n &#13;\n
