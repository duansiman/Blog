\n\n<p>一、理论：<br />&#13;\n1.内存优化原则：<br />&#13;\na.将尽量多的内存分配给mysql做缓存，但要给操作系统和其他程序预留足够的内存，否则将产生SWAP页交换，影响自身性能<br />&#13;\nb.MyISAM的数据文件读取依赖于操作系统自身的IO缓存，因此，如果有MyISAM表，就要预留更多的内存给操作系统做IO缓存<br />&#13;\nc.排序区、连接区等缓存是分配给每个数据库会话专用的，其默认值的设置要根据最大连接数合理分配。不能设置太大否则在并发连接较高时会导致物理内存耗尽<br />&#13;\n2.MyISAM内存优化：<br />&#13;\na.key_buffer_size决定MyISAM索引块缓存区的大小，它直接影响MyISAM表的存取效率。可以在mysql参数文件中设置key_buffer_size的值，对于一般MyISAM的数据库建议至少将1/4可用内存分配给key_buffer_size<br />&#13;\nkey buffer使用率计算公式如下：<br />&#13;\n1 - ( (key_blocks_unused csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-23.html csdn-24.html csdn-25.html csdn-26.html csdn-27.html csdn-28.html csdn-29.html csdn-2.html csdn-30.html csdn-31.html csdn-32.html csdn-33.html csdn-34.html csdn-35.html csdn-36.html csdn-37.html csdn-38.html csdn-39.html csdn-3.html csdn-40.html csdn-41.html csdn-42.html csdn-43.html csdn-44.html csdn-45.html csdn-46.html csdn-47.html csdn-48.html csdn-49.html csdn-4.html csdn-50.html csdn-51.html csdn-52.html csdn-53.html csdn-54.html csdn-55.html csdn-56.html csdn-57.html csdn-58.html csdn-59.html csdn-5.html csdn-60.html csdn-61.html csdn-62.html csdn-63.html csdn-64.html csdn-65.html csdn-66.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh key_cache_block_size) / key_buffer_size )<br />&#13;\n在80%左右合适。大于80%将因索引缓存不足导致性能下降，小于80%会导致内存浪费　<br />&#13;\nb.使用多个索引缓存：<br />&#13;\n1)mysql通过各session共享key buffer提高了MyISAM索引存取的性能，但它并不能消除session间key buffer间的竞争。<br />&#13;\n3.调整LRU策略：<br />&#13;\na.通过调节key_cache_division_limit来控制多大比例的缓存用做warm子表。<br />&#13;\n在最后：<br />&#13;\nN csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-23.html csdn-24.html csdn-25.html csdn-26.html csdn-27.html csdn-28.html csdn-29.html csdn-2.html csdn-30.html csdn-31.html csdn-32.html csdn-33.html csdn-34.html csdn-35.html csdn-36.html csdn-37.html csdn-38.html csdn-39.html csdn-3.html csdn-40.html csdn-41.html csdn-42.html csdn-43.html csdn-44.html csdn-45.html csdn-46.html csdn-47.html csdn-48.html csdn-49.html csdn-4.html csdn-50.html csdn-51.html csdn-52.html csdn-53.html csdn-54.html csdn-55.html csdn-56.html csdn-57.html csdn-58.html csdn-59.html csdn-5.html csdn-60.html csdn-61.html csdn-62.html csdn-63.html csdn-64.html csdn-65.html csdn-66.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh key_cache_age_threshold / 100次缓存命准内未被访问过，就会被降级到warm子表<br />&#13;\nb.调整read_buffer_size和read_md_buffer_size<br />&#13;\nc.如带用order by子句，可以适当增大read_rnd_buffer_size的值。但read_rnd_buffer_size的值也是按session分配的<br />&#13;\n4.InnoDB内存优化：<br />&#13;\na.InnoDB用一块内存区做IO缓存池，该缓存池不仅用来缓存InnoDB的索引块，而且也用来缓存InnoDB的数据块。与MyISAM不同<br />&#13;\nb.在内部，InnoDB缓存池逻辑上由free list、flush list、LRU list组成。顾名思义，free list是空闲缓存块列表，flush list是需要缓新到磁盘的缓存块列表，而LRU　list是InnoDB正在使用的缓存块，它是InnoDB buffer pool的核心。<br />&#13;\nInnoDB使用LRU算法与MyISAM的‘中点插入策略’LRU算法类似。<br />&#13;\n脏页的刷新<br />&#13;\nc.可以通过调整InnoDB buffer pool的大小，改变young sublist和old sublist的分配比例、控制脏缓存的刷新活动、使用多个InnoDB缓存池等方法来优化InnoDB的性能<br />&#13;\n5.innodb_buffer_pool_size的设置：<br />&#13;\na.innodb_buffer_pool_size决定InnoDB存储引擎表数据和索引数据的最大缓存区大小。innodb buffer pool同时为数据块和索引块提供数据缓存，若innodb_buffer_pool_size值越大，缓存命中率越高，访问InnoDB表需要的磁盘I/O就越少，性能也就越高。<br />&#13;\n可以通过：<br />&#13;\nmysqladmin -S /tmp/mysql.sock ext | grep -i innodb_buffer_pool<br />&#13;\n查看buffer pool的使用情况<br />&#13;\n可用以下公式InnoDB缓存池的命中率：<br />&#13;\n( 1- innodb_buffer_pool_reads/innodb_buffer_pool_read_request) csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-23.html csdn-24.html csdn-25.html csdn-26.html csdn-27.html csdn-28.html csdn-29.html csdn-2.html csdn-30.html csdn-31.html csdn-32.html csdn-33.html csdn-34.html csdn-35.html csdn-36.html csdn-37.html csdn-38.html csdn-39.html csdn-3.html csdn-40.html csdn-41.html csdn-42.html csdn-43.html csdn-44.html csdn-45.html csdn-46.html csdn-47.html csdn-48.html csdn-49.html csdn-4.html csdn-50.html csdn-51.html csdn-52.html csdn-53.html csdn-54.html csdn-55.html csdn-56.html csdn-57.html csdn-58.html csdn-59.html csdn-5.html csdn-60.html csdn-61.html csdn-62.html csdn-63.html csdn-64.html csdn-65.html csdn-66.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh 100<br />&#13;\n若太低则应该扩充内存、增加innodb_buffer_pool_size的值<br />&#13;\n6.调整innodb_old_blocks_time的设置：<br />&#13;\na.innodb_old_blocks_time参数决定了缓存数据块由old sublist转移到young sublist的快慢，当一个缓存数据块被插入到midpoint(old sublist)后，至少要在old sublist停留超过innodb_old_blocks_time(ms)后，才有可能被转移到new sublist.<br />&#13;\n可以根据InnoDB Monitor的输出信息来调整innodb_old_blocks_time的值，在进行表扫描时，如果non-youngs/s很低，young/s很高，就应考虑将innodb_old_blocks_time适当调大，以防止表扫描将真正的热数据淘汰，此值可以进行动态设置<br />&#13;\n7.调整缓存池数量，减少内部对缓存池数据结构的争用：<br />&#13;\na.InnoDB的缓存系统引入了innodb_buffer_pool_instances配置参数。对于较大的缓存池，适当增大此参数的值，可以降低并发导致的内部缓存访问冲突，改善性能。InnoDB缓存系统会将参数innodb_buffer_pool_size指定大小的缓存平分为innodb_buffer_pool_instances个buffer pool.<br />&#13;\n8.控制innodb buffer刷新，延长数据缓存时间，减缓磁盘I/O<br />&#13;\na.innodb buffer pool的刷新快慢主要取决于两个参数<br />&#13;\n1)innodb_max_dirty_pages_pct：控制缓存池中脏页的最大比例，默认值是75%，如果脏页的数量达到或超过该值，innoDB后台线程将开台缓存刷新<br />&#13;\n2)innodb_io_capacity：在某种程度上代表磁盘中每秒可完成的I/O次数，对于转速较低的磁盘，可将innodb_io_capacity降低。对于固态磁盘和由多个磁盘组成的阵列，innodb_io_capacity的值可适当增大<br />&#13;\n3)如无法增大缓存池，应将innodb_max_dirty_pages_pct的值调小，将innodb_io_capactity的值提高，以加快脏页的刷新<br />&#13;\n9.InnoDB doublewrite：<br />&#13;\na.在做恢复时，如果发现不一致的页，InnoDB会用系统表空间double buffer区的相应副本来恢复数据页<br />&#13;\nb.由于同步到doublewrite buffer是对连续磁盘空间的顺序写，因此开启双写对性能的影响并不太大。对需要高性能并且可以容忍丢失数据的应用，可将innodb_doublewrite=0来关闭双写以满足性能<br />&#13;\n10.调整用户服务线程排序缓存区：<br />&#13;\na.若查看show global status看到sort_merge_passes的值很大，则可以调整参数sort_buffer_size的值来调整排序缓存区，以改善order by子句或group子句的sql性能<br />&#13;\nb.可通过调整join_buffer_size的值来改善没使用索引的查询<br />&#13;\nc.最好的策略是设置较小的全局join_buffer_size,对较复杂的操作session单独设置join_buffer_size<br />&#13;\n11.InnoDB log机制及优化：<br />&#13;\na.innodb_flush_log_at_trx_commit的设置：<br />&#13;\n0：每秒触发一次，可满足持久化要求（效率最高，但最不安全）<br />&#13;\n1：每个事务提交时立刻将缓存中的redo日志回写到日志文件，并调用操作系统fsync刷新IO缓存（默认值，效率最低，但最安全）<br />&#13;\n2：每个事务提交时,InnoDB立刻将redo日志回写到日志文件，但并不马上调用fsync来刷新IO缓存，而是每秒只做一次磁盘IO缓存刷新操作（性能和数据安全性都在中间）<br />&#13;\n12.设置log file size,控制检查点：<br />&#13;\na.可以通过一些方法计算innodb每小时产生的日志量并估计合适的innodb_log_file_size值<br />&#13;\n13.调整innodb_log_buffer_size：<br />&#13;\na.可以通过增大innodb_log_buffer_size来减少日志写磁盘操作，从而提高事务处理的性能<br />&#13;\n14.调整max_connections，提高并发连接：<br />&#13;\na.max_connections控制允许连接到mysql数据库的最大数量，默认值是151<br />&#13;\n15.调整back_log：<br />&#13;\na.如果需要数据库在较短时间内处理大量连接请求，可适当增大back_log的值<br />&#13;\n16.调整table_open_cache：<br />&#13;\na.在未执行flush tables命令的情况下，如果mysql状态变量opened_tables的值较大，就说明table_open_cache设置的太小，应适当增大<br />&#13;\n17.调整thread_cache_size：<br />&#13;\na.可以通过计算cache的失败率threads_created/connections来衡量thread_cached_size的值是否合适。此值越接近1，说明线程cache命中率越低，应考虑适当增加thread_cache_size的值<br />&#13;\n18.innodb_lock_wait_timeout的设置：<br />&#13;\na.innodb_lock_wait_timeout可以控制innodb事务等待行锁的时间，默认值是50ms.<br />&#13;\nb.对于需要快速反馈的交互式OLTP应用，可以将行锁等待超时时间调小，以避免事务长时间挂起<br />&#13;\nc.对于后台运行的批处理操作，可以将行锁等待超时时间调大，以避免发生大的回滚操作<br />&#13;\n二、实践：<br />&#13;\n</p>&#13;\n<p></p><pre name="code" class="sql">mysql&gt; use sakila;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\n\nDatabase changed\nmysql&gt; show engine innodb status \\G;\n*************************** 1. row ***************************\n Type: InnoDB\n Name: \nStatus: \n=====================================\n151102 7:13:01 INNODB MONITOR OUTPUT\n=====================================\nPer second averages calculated from the last 15 seconds\n-----------------\nBACKGROUND THREAD\n-----------------\nsrv_master_thread loops: 113 1_second, 113 sleeps, 7 10_second, 47 background, 47 flush\nsrv_master_thread log flush and writes: 113\n----------\nSEMAPHORES\n----------\nOS WAIT ARRAY INFO: reservation count 18, signal count 18\nMutex spin waits 8, rounds 240, OS waits 7\nRW-shared spins 11, rounds 330, OS waits 11\nRW-excl spins 0, rounds 0, OS waits 0\nSpin rounds per wait: 30.00 mutex, 30.00 RW-shared, 0.00 RW-excl\n------------\nTRANSACTIONS\n------------\nTrx id counter B0A\nPurge done for trx's n:o &lt; 920 undo n:o &lt; 0\nHistory list length 103\nLIST OF TRANSACTIONS FOR EACH SESSION:\n---TRANSACTION 0, not started\nMySQL thread id 28, OS thread handle 0x7f5dbdfe6700, query id 568 localhost root\nshow engine innodb status\n--------\nFILE I/O\n--------\nI/O thread 0 state: waiting for i/o request (insert buffer thread)\nI/O thread 1 state: waiting for i/o request (log thread)\nI/O thread 2 state: waiting for i/o request (read thread)\nI/O thread 3 state: waiting for i/o request (read thread)\nI/O thread 4 state: waiting for i/o request (read thread)\nI/O thread 5 state: waiting for i/o request (read thread)\nI/O thread 6 state: waiting for i/o request (write thread)\nI/O thread 7 state: waiting for i/o request (write thread)\nI/O thread 8 state: waiting for i/o request (write thread)\nI/O thread 9 state: waiting for i/o request (write thread)\nPending normal aio reads: 0 [0, 0, 0, 0] , aio writes: 0 [0, 0, 0, 0] ,\n ibuf aio reads: 0, log i/o's: 0, sync i/o's: 0\nPending flushes (fsync) log: 0; buffer pool: 0\n586 OS file reads, 55 OS file writes, 48 OS fsyncs\n0.00 reads/s, 0 avg bytes/read, 0.00 writes/s, 0.00 fsyncs/s\n-------------------------------------\nINSERT BUFFER AND ADAPTIVE HASH INDEX\n-------------------------------------\nIbuf: size 1, free list len 0, seg size 2, 0 merges\nmerged operations:\n insert 0, delete mark 0, delete 0\ndiscarded operations:\n insert 0, delete mark 0, delete 0\nHash table size 553229, node heap has 1 buffer(s)\n0.00 hash searches/s, 0.00 non-hash searches/s\n---\nLOG\n---\nLog sequence number 13476957\nLog flushed up to 13476957\nLast checkpoint at 13476957\n0 pending log writes, 0 pending chkp writes\n32 log i/o's done, 0.00 log i/o's/second\n----------------------\nBUFFER POOL AND MEMORY\n----------------------\nTotal memory allocated 274726912; in additional pool allocated 0\nDictionary memory allocated 182244\nBuffer pool size 16383\nFree buffers 15829\nDatabase pages 553\nOld database pages 224\nModified db pages 0\nPending reads 0\nPending writes: LRU 0, flush list 0, single page 0\nPages made young 0, not young 0\n0.00 youngs/s, 0.00 non-youngs/s\nPages read 553, created 0, written 27\n0.00 reads/s, 0.00 creates/s, 0.00 writes/s\nNo buffer pool page gets since the last printout\nPages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s\nLRU len: 553, unzip_LRU len: 0\nI/O sum[0]:cur[0], unzip sum[0]:cur[0]\n--------------\nROW OPERATIONS\n--------------\n0 queries inside InnoDB, 0 queries in queue\n1 read views open inside InnoDB\nMain thread process no. 62305, id 140040552920832, state: waiting for server activity\nNumber of rows inserted 5, updated 0, deleted 0, read 12\n0.00 inserts/s, 0.00 updates/s, 0.00 deletes/s, 0.00 reads/s\n----------------------------\nEND OF INNODB MONITOR OUTPUT\n============================\n\n\n1 row in set (0.00 sec)\n\n\nERROR: \nNo query specified\n\nmysql&gt; set global hot_cache.key_buffer_size = 128* 1024;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; set global hot_cache.key_buffer_size = 0;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; show variables like 'key_buffer_size';\n+-----------------+----------+\n| Variable_name | Value |\n+-----------------+----------+\n| key_buffer_size | 33554432 |\n+-----------------+----------+\n1 row in set (0.00 sec)\n\nmysql&gt; set global key_buffer_size = 0;\nERROR 1438 (HY000): Cannot drop default keycache\nmysql&gt; show warnings;\n+-------+------+------------------------------+\n| Level | Code | Message |\n+-------+------+------------------------------+\n| Error | 1438 | Cannot drop default keycache |\n+-------+------+------------------------------+\n1 row in set (0.00 sec)\n\n\nmysql&gt; cache index sales,sales2 in hot_cache;\n+---------------+--------------------+----------+-------------------------------------+\n| Table | Op | Msg_type | Msg_text |\n+---------------+--------------------+----------+-------------------------------------+\n| sakila.sales | assign_to_keycache | Error | Table 'sakila.sales' doesn't exist |\n| sakila.sales | assign_to_keycache | status | Operation failed |\n| sakila.sales2 | assign_to_keycache | Error | Table 'sakila.sales2' doesn't exist |\n| sakila.sales2 | assign_to_keycache | status | Operation failed |\n+---------------+--------------------+----------+-------------------------------------+\n4 rows in set (0.00 sec)\n\nmysql&gt; set global key_cache_division_limit = 70;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; set global hot_cache.key_cache_division_limit = 70;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; show global variables like '%innodb_old_blocks_pct%';\n+-----------------------+-------+\n| Variable_name | Value |\n+-----------------------+-------+\n| innodb_old_blocks_pct | 37 |\n+-----------------------+-------+\n1 row in set (0.01 sec)\n\n\nmysql&gt; show global variables like '%doublewrirte%';\nEmpty set (0.00 sec)\n\nmysql&gt; show global variables like '%doublewrite%';\n+--------------------+-------+\n| Variable_name | Value |\n+--------------------+-------+\n| innodb_doublewrite | ON |\n+--------------------+-------+\n1 row in set (0.01 sec)\n\nmysql&gt; select @a1 := variable_value as a1;\nERROR 1054 (42S22): Unknown column 'variable_value' in 'field list'\nmysql&gt; select @a1 := variable_value as a1 \n -&gt; from information_schema.global_status \n -&gt; where variable_name = 'innodb_os_log_written'\n -&gt; union all\n -&gt; select sleep(60)\n -&gt; union all\n -&gt; select @a2 := variable_value as a2\n -&gt; from information_schema.global_status \n -&gt; where variable_name = 'innodb_os_log_written';\n+------+\n| a1 |\n+------+\n| 9216 |\n| 0 |\n| 9216 |\n+------+\n3 rows in set (1 min 0.02 sec)\n\nmysql&gt; select round((@a2-@a1)/1024/1024 / @@innodb_log_files_in_group) as MB;\n+------+\n| MB |\n+------+\n| 0 |\n+------+\n1 row in set (0.01 sec)</pre><br />&#13;\n<br />&#13;\n&#13;\n &#13;\n
