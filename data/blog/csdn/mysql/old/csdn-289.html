\n\n<h1 style="text-align:center">mysql<span style="font-family:宋体">游标简易教程</span></h1>&#13;\n<p>        从<span style="font-family:Times New Roman">mysql V5.5</span><span style="font-family:宋体">开始，进行了一次大的改变，就是将</span><span style="font-family:Times New Roman">InnoDB</span><span style="font-family:宋体">作为默认的存储引擎。</span><span style="font-family:Times New Roman">InnoDB</span><span style="font-family:宋体">支持事务，而且拥有相关的</span><span style="font-family:Times New Roman">RDBMS</span><span style="font-family:宋体">特性：</span><span style="font-family:Times New Roman">ACID</span><span style="font-family:宋体">事务支持，数据完整性（支持外键），灾难恢复能力等等。</span></p>&#13;\n<p>现在简单总结一下游标的知识。</p>&#13;\n<h2>（一）认识游标<span style="font-family:Times New Roman">(cursor)</span></h2>&#13;\n<p>游标简单来说就是查询出来的数据索引，通过对游标的操作（第一个位置、最后一个位置、上一个位置、下一个位置）可以遍历出数据。</p>&#13;\n<p>使用游标<span style="font-family:Times New Roman">(cursor)</span><span style="font-family:宋体">的一个主要的原因就是把集合操作转换成单个记录处理方式。用</span><span style="font-family:Times New Roman">SQL</span><span style="font-family:宋体">语言从数据库中检索数据后，结果放在内存的一块区域中，且结果往往是一个含有多个记录的集合。游标机制允许用户在</span><span style="font-family:Times New Roman">SQL server</span><span style="font-family:宋体">内逐行地访问这些记录，按照用户自己的意愿来显示和处理这些记录。</span></p>&#13;\n<p>在数据库中，游标是一个十分重要的概念。游标提供了一种对从表中检索出的数据进行操作的灵活手段，就本质而言，<span style="color:rgb(255,0,0)">游标实际上是一种能从包括多条数据记录的结果集中每次提取一条记录的机制</span>。<span style="color:rgb(0,0,255)">游标总是与一条<span style="font-family:Times New Roman">SQL </span><span style="font-family:宋体">选择语句相关联</span></span><span style="color:rgb(0,0,255)">，</span>因为游标由结果集（可以是零条、一条或由相关的选择语句检索出的多条记录）和结果集中指向特定记录的游标位置组成。当决定对结果集进行处理时，必须声明一个指向该结果集的游标。如果曾经用 <span style="font-family:Times New Roman">C </span><span style="font-family:宋体">语言写过对文件进行处理的程序，那么游标就像您打开文件所得到的文件句柄一样，只要文件打开成功，该文件句柄就可代表该文件。对于游标而言，其道理是相同的。可见游标能够实现按与传统程序读取平面文件类似的方式处理来自基础表的结果集，从而把表中数据以平面文件的形式呈现给程序。</span></p>&#13;\n<p>我们知道关系数据库管理系统实质是面向集合的，在<span style="font-family:Times New Roman">MS SQL SERVER </span><span style="font-family:宋体">中并没有一种描述表中单一记录的表达形式，除非使用</span><span style="font-family:Times New Roman">where </span><span style="font-family:宋体">子句来限制只有一条记录被选中。因此我们必须借助于游标来进行面向单条记录的数据处理。由此可见，游标允许应用程序对查询语句</span><span style="font-family:Times New Roman">select </span><span style="font-family:宋体">返回的行结果集中每一行进行相同或不同的操作，而不是一次对整个结果集进行同一种操作；它还提供对基于游标位置而对表中数据进行删除或更新的能力；而且，正是游标把作为面向集合的数据库管理系统和面向行的程序设计两者联系起来，使两个数据处理方式能够进行沟通。 </span></p>&#13;\n<p>在数据库开发过程中，当你检索的数据只是一条记录时，你所编写的事务语句代码往往使用<span style="font-family:Times New Roman">SELECT INSERT </span><span style="font-family:宋体">语句。但是我们常常会遇到这样情况，即从某一结果集中逐一地读取一条记录。那么如何解决这种问题呢？游标为我们提供了一种极为优秀的解决方案——那就是使用游标</span></p>&#13;\n<p>就是一个可读的标识，用来标识数据取到什么地方了。</p>&#13;\n<h2>（二）游标特性</h2>&#13;\n<p>1,<span style="font-family:宋体">只读</span></p>&#13;\n<p>2,<span style="font-family:宋体">不滚动</span></p>&#13;\n<p>3,<span style="font-family:宋体">不敏感的</span></p>&#13;\n<h2>（三）使用游标</h2>&#13;\n<p>需要强调的是，游标必须在定义处理程序之前被定义，但变量必须在定义游标之前被定义，顺序就是变量定义<span style="font-family:Times New Roman">-</span><span style="font-family:宋体">游标定义</span><span style="font-family:Times New Roman">-</span><span style="font-family:宋体">处理程序。</span></p>&#13;\n<h3>1.<span style="font-family:宋体">定义游标</span></h3>&#13;\n<p>DECLARE cursor_name CURSOR FOR select_statement</p>&#13;\n<p>这个语句声明一个游标。也可以在子程序中定义多个游标，一个块中的每一个游标必须命名唯一。声明游标后也是单条操作的。</p>&#13;\n<p> </p>&#13;\n<h3>2. <span style="font-family:宋体">游标</span><span style="font-family:Times New Roman">OPEN</span></h3>&#13;\n<p>OPEN cursor_name</p>&#13;\n<p>这个语句打开先前声明的游标。</p>&#13;\n<p> </p>&#13;\n<p>3. <span style="font-family:宋体">游标</span><span style="font-family:Times New Roman">FETCH</span></p>&#13;\n<p>FETCH cursor_name INTO var_name [, var_name] ...</p>&#13;\n<p>这个语句用指定的打开游标读取下一行（如果有下一行的话），并且前进游标指针至该行。</p>&#13;\n<p> </p>&#13;\n<h3>4. <span style="font-family:宋体">游标</span><span style="font-family:Times New Roman">CLOSE</span></h3>&#13;\n<p>CLOSE cursor_name</p>&#13;\n<p>这个语句关闭先前打开的游标，注意，用完后必须关闭。</p>&#13;\n<h2>（四）示例</h2>&#13;\n<p>下面是一个存储过程，里面用到游标，逐条更新数据（批量更新数据）</p>&#13;\n<p> </p>&#13;\n<p>BEGIN</p>&#13;\n<p> DECLARE  no_more_record INT DEFAULT 0;</p>&#13;\n<p> DECLARE  pID BIGINT(20);</p>&#13;\n<p> DECLARE  pValue DECIMAL(15,5);</p>&#13;\n<p> DECLARE  cur_record CURSOR FOR   SELECT colA, colB from tableABC;  /*<span style="font-family:宋体">首先这里对游标进行定义</span><span style="font-family:Times New Roman">*/</span></p>&#13;\n<p> DECLARE  CONTINUE HANDLER FOR NOT FOUND  SET  no_more_record = 1; /*<span style="font-family:宋体">这个是个条件处理</span><span style="font-family:Times New Roman">,</span><span style="font-family:宋体">针对</span><span style="font-family:Times New Roman">NOT FOUND</span><span style="font-family:宋体">的条件</span><span style="font-family:Times New Roman">,</span><span style="font-family:宋体">当没有记录时赋值为</span><span style="font-family:Times New Roman">1*/</span></p>&#13;\n<p> </p>&#13;\n<p> </p>&#13;\n<p> OPEN  cur_record; /*<span style="font-family:宋体">接着使用</span><span style="font-family:Times New Roman">OPEN</span><span style="font-family:宋体">打开游标</span><span style="font-family:Times New Roman">*/</span></p>&#13;\n<p> FETCH  cur_record INTO pID, pValue; /*<span style="font-family:宋体">把第一行数据写入变量中</span><span style="font-family:Times New Roman">,</span><span style="font-family:宋体">游标也随之指向了记录的第一行</span><span style="font-family:Times New Roman">*/</span></p>&#13;\n<p> </p>&#13;\n<p> </p>&#13;\n<p> WHILE no_more_record != 1 DO</p>&#13;\n<p> INSERT  INTO testTable(ID, Value)</p>&#13;\n<p> VALUES  (pID, pValue);</p>&#13;\n<p> FETCH  cur_record INTO pID, pValue;</p>&#13;\n<p> </p>&#13;\n<p> END WHILE;</p>&#13;\n<p> CLOSE  cur_record;  /*<span style="font-family:宋体">用完后记得用</span><span style="font-family:Times New Roman">CLOSE</span><span style="font-family:宋体">把资源释放掉</span><span style="font-family:Times New Roman">*/</span></p>&#13;\n<p>END</p>&#13;\n &#13;\n
