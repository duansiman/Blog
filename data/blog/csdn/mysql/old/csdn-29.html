\n\n<h1 style="text-align:center">MySQL<span style="font-family:宋体">多表查询</span></h1>&#13;\n<h2>一 使用<span style="font-family:Times New Roman">SELECT</span><span style="font-family:宋体">子句进行多表查询</span></h2>&#13;\n<p>SELECT <span style="font-family:宋体">字段名 </span><span style="font-family:Times New Roman">FROM </span><span style="font-family:宋体">表</span><span style="font-family:Times New Roman">1</span><span style="font-family:宋体">，表</span><span style="font-family:Times New Roman">2 </span><span style="font-family:宋体">… </span><span style="font-family:Times New Roman">WHERE </span><span style="font-family:宋体">表</span><span style="font-family:Times New Roman">1.</span><span style="font-family:宋体">字段 </span><span style="font-family:Times New Roman">= </span><span style="font-family:宋体">表</span><span style="font-family:Times New Roman">2.</span><span style="font-family:宋体">字段 </span><span style="font-family:Times New Roman">AND </span><span style="font-family:宋体">其它查询条件</span></p>&#13;\n<p>SELECT a.id,a.name,a.address,a.date,b.math,b.english,b.chinese FROM tb_demo065_tel AS b,tb_demo065 AS a WHERE a.id=b.id</p>&#13;\n<p>注<span style="font-family:Times New Roman">:</span><span style="font-family:宋体">在上面的的代码中，以两张表的</span><span style="font-family:Times New Roman">id</span><span style="font-family:宋体">字段信息相同作为条件建立两表关联，但在实际开发中不应该这样使用，最好用主外键约束来实现</span></p>&#13;\n<h2>二 使用表的别名进行多表查询</h2>&#13;\n<p>如<span style="font-family:Times New Roman">:SELECT a.id,a.name,a.address,b.math,b.english,b.chinese FROM tb_demo065  a,tb_demo065_tel  b WHERE a.id=b.id AND b.id='$_POST[textid]'</span></p>&#13;\n<p>SQL<span style="font-family:宋体">语言中，可以通过两种方式为表指定别名 </span></p>&#13;\n<p>第一种是通过关键字<span style="font-family:Times New Roman">AS</span><span style="font-family:宋体">指定</span><span style="font-family:Times New Roman">,</span><span style="font-family:宋体">如</span></p>&#13;\n<p>SELECT a.id,a.name,a.address,b.math,b.english,b.chinese FROM tb_demo065 AS a,tb_demo065_tel AS b WHERE a.id=b.id</p>&#13;\n<p>第二种是在表名后直接加表的别名实现</p>&#13;\n<p>SELECT a.id,a.name,a.address,b.math,b.english,b.chinese FROM tb_demo065  a,tb_demo065_tel  b WHERE a.id=b.id </p>&#13;\n<p>使用表的别名应注意几下几点</p>&#13;\n<p>(1)<span style="font-family:宋体">别名通常是一个缩短了的表名，用于在连接中引用表中的特定列，如果连接中的多个表中有相同的名称列存在，必须用表名或表的别名限定列名</span></p>&#13;\n<p>(2)<span style="font-family:宋体">如果定义了表的别名就不能再使用表名</span></p>&#13;\n<h2>三 合并多个结果集</h2>&#13;\n<p>SQL<span style="font-family:宋体">语言中，可以通过</span><span style="font-family:Times New Roman">UNION </span><span style="font-family:宋体">或 </span><span style="font-family:Times New Roman">ALL</span><span style="font-family:宋体">将多个</span><span style="font-family:Times New Roman">SELECT</span><span style="font-family:宋体">语句的查询结果合并输出，这两个关键字的使用说明如下：</span></p>&#13;\n<p>UNION:<span style="font-family:宋体">利用该关键字可以将多个</span><span style="font-family:Times New Roman">SELECT </span><span style="font-family:宋体">语句的查询结果合并输出，并删除重复行</span></p>&#13;\n<p>ALL:<span style="font-family:宋体">利用该关键字可以将多个</span><span style="font-family:Times New Roman">SELECT </span><span style="font-family:宋体">语句的查询结果合并输出，但不会删除重复行</span></p>&#13;\n<p>在使用<span style="font-family:Times New Roman">UNION</span><span style="font-family:宋体">或</span><span style="font-family:Times New Roman">ALL</span><span style="font-family:宋体">关键字将多个表合并输出时，查询结果必须具有相同的结构并且数据类型必须兼容</span><span style="font-family:Times New Roman">,</span><span style="font-family:宋体">另外使用</span><span style="font-family:Times New Roman">UNION</span><span style="font-family:宋体">时两张表的字段数量也必须相同，否则会提示</span><span style="font-family:Times New Roman">SQL</span><span style="font-family:宋体">语句有错误。</span></p>&#13;\n<p>e.x:SELECT id,name,pwd FROM tb_demo067 UNION SELECT  uid,price,date FROM tb_demo067_tel</p>&#13;\n<h2>四 简单嵌套查询</h2>&#13;\n<p>子查询<span style="font-family:Times New Roman">:</span><span style="font-family:宋体">子查询是一个</span><span style="font-family:Times New Roman">SELECT</span><span style="font-family:宋体">查询，返回单个值且嵌套在</span><span style="font-family:Times New Roman">SELECT</span><span style="font-family:宋体">、</span><span style="font-family:Times New Roman">INSERT</span><span style="font-family:宋体">、</span><span style="font-family:Times New Roman">UPDATE</span><span style="font-family:宋体">和</span><span style="font-family:Times New Roman">DELETE</span><span style="font-family:宋体">语句或其它查询语句中，任何可以使用表达式的地方都可以使用子查询</span><span style="font-family:Times New Roman">.</span></p>&#13;\n<p>SELECT id,name,sex,date FROM tb_demo068 WHERE id in(SELECT id FROM tb_demo068 WHERE id='$_POST[test]')</p>&#13;\n<p>内连接：把查询结果作为<span style="font-family:Times New Roman">WHERE</span><span style="font-family:宋体">子句的查询条件即称为内连接</span></p>&#13;\n<h2>五 复杂的嵌套查询</h2>&#13;\n<p>多表之间的嵌套查询可以通过谓词<span style="font-family:Times New Roman">IN</span><span style="font-family:宋体">实现，语法格式如下</span><span style="font-family:Times New Roman">:</span></p>&#13;\n<p>test_expression[NOT] IN{</p>&#13;\n<p> subquery</p>&#13;\n<p>}</p>&#13;\n<p>参数说明：<span style="font-family:Times New Roman">test_expression</span><span style="font-family:宋体">指</span><span style="font-family:Times New Roman">SQL</span><span style="font-family:宋体">表达式，</span><span style="font-family:Times New Roman">subquery</span><span style="font-family:宋体">包含某结果集的子查询</span></p>&#13;\n<p>多表嵌套查询的原理<span style="font-family:Times New Roman">:</span><span style="font-family:宋体">无论是多少张表进行嵌套，表与表之间一定存在某种关联，通过</span><span style="font-family:Times New Roman">WHERE</span><span style="font-family:宋体">子句建立此种关联实现查询</span></p>&#13;\n<h2>六 嵌套查询在查询统计中的应用</h2>&#13;\n<p>实现多表查询时，可以同时使用谓词<span style="font-family:Times New Roman">ANY</span><span style="font-family:宋体">、</span><span style="font-family:Times New Roman">SOME</span><span style="font-family:宋体">、</span><span style="font-family:Times New Roman">ALL,</span><span style="font-family:宋体">这些谓词被称为定量比较谓词，可以和比较运算符联合使用，判断是否全部返回值都满足搜索条件</span><span style="font-family:Times New Roman">.SOME</span><span style="font-family:宋体">和</span><span style="font-family:Times New Roman">ANY</span><span style="font-family:宋体">谓词是存在量的，只注重是否有返回值满足搜索条件，这两个谓词的含义相同，可以替换使用</span><span style="font-family:Times New Roman">;ALL</span><span style="font-family:宋体">谓词称为通用谓词，它只关心是否有谓词满足搜索要求</span><span style="font-family:Times New Roman">.</span></p>&#13;\n<p>SELECT * FROM tb_demo069_people WHERE uid IN(SELECT deptID FROM tb_demo069_dept WHERE deptName='$_POST[select]')</p>&#13;\n<p>SELECT a.id,a.name FROM tb_demo067 AS a WHERE id&lt;3)</p>&#13;\n<p>&gt;ANY <span style="font-family:宋体">大于子查询中的某个值 </span></p>&#13;\n<p> </p>&#13;\n<p>&gt;=ANY <span style="font-family:宋体">大于等于子查询中的某个值  </span></p>&#13;\n<p>&lt;=ANY <span style="font-family:宋体">小于等于子查询中的某个值 </span></p>&#13;\n<p>=ANY <span style="font-family:宋体">等于子查询中的某个值  </span></p>&#13;\n<p>!=ANY<span style="font-family:宋体">或</span><span style="font-family:Times New Roman">&lt;&gt;ANY </span><span style="font-family:宋体">不等于子查询中的某个值  </span></p>&#13;\n<p>&gt;ALL <span style="font-family:宋体">大于子查询中的所有值  </span></p>&#13;\n<p> </p>&#13;\n<p>&gt;=ALL <span style="font-family:宋体">大于等于子查询中的所有值 </span></p>&#13;\n<p>&lt;=ALL <span style="font-family:宋体">小于等于子查询中的所有值 </span></p>&#13;\n<p>=ALL <span style="font-family:宋体">等于子查询中的所有值 </span></p>&#13;\n<p>!=ALL<span style="font-family:宋体">或</span><span style="font-family:Times New Roman">&lt;&gt;ALL </span><span style="font-family:宋体">不等于子查询中的所有值</span></p>&#13;\n<h2>七 使用子查询作派生的表</h2>&#13;\n<p>在实际项目开发过程中经常用到从一个信息较为完善的表中派生出一个只含有几个关键字段的信息表，通过子查询就可以来实现这一目标<span style="font-family:Times New Roman">,</span><span style="font-family:宋体">如</span></p>&#13;\n<p>SELECT people.name,people.chinese,people.math,people.english FROM (SELECT name,chinese,math,english FROM tb_demo071) AS people</p>&#13;\n<p>注<span style="font-family:Times New Roman">:</span><span style="font-family:宋体">子查询应遵循以下规则</span><span style="font-family:Times New Roman">:</span></p>&#13;\n<p>(1)<span style="font-family:宋体">由比较运算符引入的内层子查询只包含一个表达式或列名，在外层语句中的</span><span style="font-family:Times New Roman">WHERE</span><span style="font-family:宋体">子句内命名的列必须与内层子查询命名的列兼容</span></p>&#13;\n<p>(2)<span style="font-family:宋体">由不可更改的比较运算符引入的子查询</span><span style="font-family:Times New Roman">(</span><span style="font-family:宋体">比较运算符后面不跟关键字</span><span style="font-family:Times New Roman">ANY</span><span style="font-family:宋体">或</span><span style="font-family:Times New Roman">ALL)</span><span style="font-family:宋体">不包括</span><span style="font-family:Times New Roman">GROUP BY </span><span style="font-family:宋体">或 </span><span style="font-family:Times New Roman">HAVING</span><span style="font-family:宋体">子句，除非预先确定了成组或单个的值</span></p>&#13;\n<p>(3)<span style="font-family:宋体">用</span><span style="font-family:Times New Roman">EXISTS</span><span style="font-family:宋体">引入的</span><span style="font-family:Times New Roman">SELECT</span><span style="font-family:宋体">列表一般都由</span><span style="font-family:Times New Roman">*</span><span style="font-family:宋体">组成，不必指定列名</span></p>&#13;\n<p>(4)<span style="font-family:宋体">子查询不能在内部处理其结果</span></p>&#13;\n<h2>八 使用子查询作表达式</h2>&#13;\n<p>SELECT (SELECT AVG(chinese)FROM tb_demo071),(SELECT AVG(english)FROM tb_demo071),(SELECT AVG(math)FROM tb_demo071) FROM tb_demo071</p>&#13;\n<p>注：在使用子查询时最好为列表项取个别名，这样可以方便用户在使用<span style="font-family:Times New Roman">mysql_fetch_array()</span><span style="font-family:宋体">函数时为表项赋值</span><span style="font-family:Times New Roman">,</span><span style="font-family:宋体">如</span></p>&#13;\n<p>SELECT (SELECT AVG(chinese) FROM tb_demo071) AS yuwen ,(SELECT AVG(english) FROM tb_demo071) AS yingyu,(SELECT AVG(math) FROM tb_demo071) AS shuxue FROM tb_demo071</p>&#13;\n<h2>九 使用子查询关联数据</h2>&#13;\n<p>SELECT * FROM tb_demo072_student WHERE id=(SELECT id FROM tb_demo072_class WHERE className = '$_POST[text]')</p>&#13;\n<h2>十 多表联合查询</h2>&#13;\n<p>利用<span style="font-family:Times New Roman">SQL</span><span style="font-family:宋体">语句中的</span><span style="font-family:Times New Roman">UNION</span><span style="font-family:宋体">，可以将不同表中符合条件的数据信息显示在同一列中。</span></p>&#13;\n<p>e.x:SELECT * FROM tb_demo074_student UNION SELECT * FROM tb_demo074_fasten</p>&#13;\n<p>注<span style="font-family:Times New Roman">:</span><span style="font-family:宋体">使用</span><span style="font-family:Times New Roman">UNION</span><span style="font-family:宋体">时应注意以下两点：</span></p>&#13;\n<p>(1)<span style="font-family:宋体">在使用</span><span style="font-family:Times New Roman">UNION</span><span style="font-family:宋体">运算符组合的语句中，所有选择列表的表达式数目必须相同，如列名、算术表达式及聚合函数等</span></p>&#13;\n<p>(2)<span style="font-family:宋体">在每个查询表中，对应列的数据结构必须一样。</span></p>&#13;\n<h2>十一 对联合后的结果进行排序</h2>&#13;\n<p>为了<span style="font-family:Times New Roman">UNION</span><span style="font-family:宋体">的运算兼容，要求所有</span><span style="font-family:Times New Roman">SELECT</span><span style="font-family:宋体">语句都不能有</span><span style="font-family:Times New Roman">ORDER BY</span><span style="font-family:宋体">语句，但有一种情况例外，那就是在最后一个</span><span style="font-family:Times New Roman">SELECT</span><span style="font-family:宋体">语句中放置</span><span style="font-family:Times New Roman">ORDER BY </span><span style="font-family:宋体">子句实现结果的最终排序输出。</span></p>&#13;\n<p>e.x:SELECT * FROM tb_demo074_student UNION SELECT * FROM tb_demo074_fasten ORDER BY id</p>&#13;\n<p>使用<span style="font-family:Times New Roman">UNION</span><span style="font-family:宋体">条件上相对比较苛刻，所以使用此语句时一定要注意两个表项数目和字段类型是否相同</span></p>&#13;\n<h2>十二 条件联合语句</h2>&#13;\n<p>SELECT * FROM tb_demo076_BEIJING GROUP BY name HAVING name='<span style="font-family:宋体">人民邮电出版社</span><span style="font-family:Times New Roman">' OR name='</span><span style="font-family:宋体">机械工业出版社</span><span style="font-family:Times New Roman">' UNION SELECT * FROM tb_demo076_BEIJING GROUP BY name HAVING name &lt;&gt;'</span><span style="font-family:宋体">人民邮电出版社</span><span style="font-family:Times New Roman">' AND name &lt;&gt;'</span><span style="font-family:宋体">机械工业再版社</span><span style="font-family:Times New Roman">' ORDER BY id</span></p>&#13;\n<p>上面语句应用了<span style="font-family:Times New Roman">GROUP BY</span><span style="font-family:宋体">分组语句和</span><span style="font-family:Times New Roman">HAVING</span><span style="font-family:宋体">语句实现条件联合查询。其实现目的是先保证将</span><span style="font-family:Times New Roman">'</span><span style="font-family:宋体">人民邮电出版社</span><span style="font-family:Times New Roman">'</span><span style="font-family:宋体">和</span><span style="font-family:Times New Roman">'</span><span style="font-family:宋体">机械工业出版社</span><span style="font-family:Times New Roman">'</span><span style="font-family:宋体">始终位于名单最前列，然后再输出其它的出版社</span></p>&#13;\n<h2>十三 简单内连接查询</h2>&#13;\n<p>SELECT filedlist FROM table1 [INNER] JOIN table2 ON table1.column1 = table2.column1</p>&#13;\n<p>其中，<span style="font-family:Times New Roman">filedlist</span><span style="font-family:宋体">是要显示的字段</span><span style="font-family:Times New Roman">,INNER</span><span style="font-family:宋体">表示表之间的连接方式为内连接，</span><span style="font-family:Times New Roman">table1.column1=table2.column1</span><span style="font-family:宋体">用于指明两表间的连接条件，如</span><span style="font-family:Times New Roman">:</span></p>&#13;\n<p>SELECT a.name,a.address,a.date,b.chinese,b.math,b.english FROM tb_demo065 AS a INNER JOIN tb_demo065_tel AS b on a.id=b.id</p>&#13;\n<h2>十四 复杂内连接查询</h2>&#13;\n<p>复杂的内连接查询是在基本的内连接查询的基础上再附加一些查询条件，如<span style="font-family:Times New Roman">:</span></p>&#13;\n<p>SELECT a.name,a.address,a.date,b.chinese,b.math,b.english FROM tb_demo065 AS a INNER JOIN tb_demo065_tel AS b on a.id=b.id WHERE b.id=(SELECT id FROM  tb_demo065 WHERE tb_demo065.name='$_POST[text]')</p>&#13;\n<p>总之，实现表与表之间的关联的本质是两表之间存在共同的数据项或者相同的数据项，通过<span style="font-family:Times New Roman">WHERE </span><span style="font-family:宋体">子句或内连接</span><span style="font-family:Times New Roman">INNER JOIN </span><span style="font-family:宋体">… </span><span style="font-family:Times New Roman">ON </span><span style="font-family:宋体">语句将两表连接起来，实现查询</span></p>&#13;\n<h2>十五 使用外连接实现多表联合查询</h2>&#13;\n<p>(1)LEFT OUTER JOIN<span style="font-family:宋体">表示表之间通过左连接方式相互连接，也可简写成</span><span style="font-family:Times New Roman">LEFT JOIN,</span><span style="font-family:宋体">它是以左侧的表为基准故称左连接，左侧表中所有信息将被全部输出，而右侧表信息则只会输出符合条件的信息，对不符合条件的信息则返回</span><span style="font-family:Times New Roman">NULL</span></p>&#13;\n<p>e.x:SELECT a.name,a.address,b.math,b.english FROM tb_demo065 AS A LEFT OUTER JOIN tb_demo065_tel AS b ON a.id=b.id</p>&#13;\n<p>(2)RIGHT OUTER JOIN<span style="font-family:宋体">表示表之间通过右连接方式相互连接，也可简写成</span><span style="font-family:Times New Roman">RIGHT JOIN,</span><span style="font-family:宋体">它是以右侧的表为基准故称右连接，右侧表中所有信息将被全部输出，而左侧表信息则只会输出符合条件的信息，对不符合条件的信息则返回</span><span style="font-family:Times New Roman">NULL</span></p>&#13;\n<p>E.X:SELECT a.name,a.address,b.math,b.english FROM tb_demo065 AS A RIGHT OUTER JOIN tb_demo065_tel AS b ON a.id=b.id</p>&#13;\n<h2>十六 利用<span style="font-family:Times New Roman">IN</span><span style="font-family:宋体">或</span><span style="font-family:Times New Roman">NOTIN</span><span style="font-family:宋体">关键字限定范围</span></h2>&#13;\n<p>e.x:SELECT * FROM tb_demo083 WHERE code IN(SELECT code FROM tb_demo083 WHERE code BETWEEN '$_POST[text1]' AND '$_POST[text2]')</p>&#13;\n<p>利用<span style="font-family:Times New Roman">IN</span><span style="font-family:宋体">可指定在范围内查询，若要求在某范围外查询可以用</span><span style="font-family:Times New Roman">NOT IN</span><span style="font-family:宋体">代替它</span></p>&#13;\n<h2>十七 由<span style="font-family:Times New Roman">IN</span><span style="font-family:宋体">引入的关联子查询</span></h2>&#13;\n<p>e.x:SELECT * FROM tb_demo083 WHERE code IN(SELECT code FROM tb_demo083 WHERE code = '$_POST[text]')</p>&#13;\n<h2>十八 利用<span style="font-family:Times New Roman">HAVING</span><span style="font-family:宋体">语句过滤分组数据</span></h2>&#13;\n<p>HAVING<span style="font-family:宋体">子句用于指定组或聚合的搜索条件，</span><span style="font-family:Times New Roman">HAVING</span><span style="font-family:宋体">通常与</span><span style="font-family:Times New Roman">GROUP BY </span><span style="font-family:宋体">语句一起使用，如果</span><span style="font-family:Times New Roman">SQL</span><span style="font-family:宋体">语句中不含</span><span style="font-family:Times New Roman">GROUP BY</span><span style="font-family:宋体">子句，则</span><span style="font-family:Times New Roman">HAVING</span><span style="font-family:宋体">的行为与</span><span style="font-family:Times New Roman">WHERE</span><span style="font-family:宋体">子句一样</span><span style="font-family:Times New Roman">.</span></p>&#13;\n<p>e.x:SELECT name,math FROM tb_demo083 GROUP BY id HAVING math &gt; '95'</p>&#13;\n<p> </p>&#13;\n &#13;\n
