\n\n<pre><a target="_blank" href="http://blog.csdn.net/l1028386804/article/details/48376017">转载请注明出处:http://blog.csdn.net/l1028386804/article/details/48376017</a>\n</pre>&#13;\n<p>mysql数据库没有增量备份的机制，当数据量太大的时候备份是一个很大的问题。还好mysql数据库提供了一种主从备份的机制，其实就是把主数据库的所有的数据同时写到备份数据库中。</p>&#13;\n<h3>一、说明<br />&#13;\n</h3>&#13;\n<p>1、mysql数据库没有增量备份的机制，当数据量太大的时候备份是一个很大的问题。还好mysql数据库提供了一种主从备份的机制，其实就是把主数据库的所有的数据同时写到备份数据库中。实现mysql数据库的热备份。<br />&#13;\n2、要想实现双机的热备首先要了解主从数据库服务器的版本的需求。要实现热备mysql的版本都要高于3.2，还有一个基本的原则就是作为从数据库的数据库版本可以高于主服务器数据库的版本，但是不可以低于主服务器的数据库版本。<br />&#13;\n</p>&#13;\n<h3>二、配置<br />&#13;\n</h3>&#13;\n<h4>1、配置主服务器</h4>&#13;\n<h5>a.查看版本</h5>&#13;\n<p>首先查看主服务器的版本是否是支持热备的版本。然后查看my.cnf(类unix)或者my.ini(windows)中mysqld配置块的配置有没有log-bin(记录数据库更改日志)，因为mysql的复制机制是基于日志的复制机制，所以主服务器一定要支持更改日志才行。然后设置要写入日志的数据库或者不要写入日志的数据库。这样只有您感兴趣的数据库的更改才写入到数据库的日志中。</p>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">server-id=1 //数据库的id这个应该默认是1就不用改动\nlog-bin=log_name //日志文件的名称，这里可以制定日志到别的目录 如果没有设置则默认主机名的一个日志名称\nbinlog-do-db=db_name //记录日志的数据库\nbinlog-ignore-db=db_name //不记录日志的数据库 </pre>以上的如果有多个数据库用","分割开 <br />&#13;\n然后设置同步数据库的用户帐号<br />&#13;\n<pre name="code" class="plain">mysql&gt; GRANT REPLICATION SLAVE ON *.*\n-&gt; TO 'repl'@'%.mydomain.com' IDENTIFIED BY 'slavepass'; </pre>4.0.2以前的版本, 因为不支持REPLICATION 要使用下面的语句来实现这个功能<br />&#13;\n<pre name="code" class="plain">mysql&gt; GRANT FILE ON *.*\n-&gt; TO 'repl'@'%.mydomain.com' IDENTIFIED BY 'slavepass'; </pre>设置好主服务器的配置文件后重新启动数据库 <br />&#13;\n<p></p>&#13;\n<h5>b.锁定现有的数据库并备份现在的数据 </h5>&#13;\n<p>锁定数据库<br />&#13;\n</p>&#13;\n<pre name="code" class="plain">mysql&gt; FLUSH TABLES WITH READ LOCK; </pre>备份数据库有两种办法一种是直接进入到mysql的data目录然后打包你需要备份数据库的文件夹，第二种是使用mysqldump的方式来备份数据库但是要加上"--master-data " 这个参数，建议使用第一种方法来备份数据库<br />&#13;\nc.查看主服务器的状态<br />&#13;\n<pre name="code" class="plain">mysql&gt; show master status\\G;\n+---------------+----------+--------------+------------------+\n| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |\n+---------------+----------+--------------+------------------+\n| mysql-bin.003 | 73 | test | manual,mysql |\n+---------------+----------+--------------+------------------+ </pre>记录File 和 Position 项目的值，以后要用的。 <br />&#13;\nd.然后把数据库的锁定打开<br />&#13;\n<pre name="code" class="plain">mysql&gt; UNLOCK TABLES; </pre>&#13;\n<p></p>&#13;\n<h4>4。配置从服务器 </h4>&#13;\n<h5>a.首先设置数据库的配置文件</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">server-id=n //设置数据库id默认主服务器是1可以随便设置但是如果有多台从服务器则不能重复。\nmaster-host=db-master.mycompany.com //主服务器的IP地址或者域名\nmaster-port=3306 //主数据库的端口号\nmaster-user=pertinax //同步数据库的用户\nmaster-password=freitag //同步数据库的密码\nmaster-connect-retry=60 //如果从服务器发现主服务器断掉，重新连接的时间差\nreport-host=db-slave.mycompany.com //报告错误的服务器 </pre>&#13;\n<p></p>&#13;\n<h5>b.把从主数据库服务器备份出来的数据库导入到从服务器中 </h5>&#13;\n<h5>c.启动从数据库</h5>&#13;\n<p>然后启动从数据库服务器，如果启动的时候没有加上"--skip-slave-start"这个参数则进入到mysql中<br />&#13;\n</p>&#13;\n<pre name="code" class="plain">mysql&gt; slave stop; //停止slave的服务 </pre>&#13;\n<p></p>&#13;\n<h5>d.设置主服务器的各种参数</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">mysql&gt; CHANGE MASTER TO\n-&gt; MASTER_HOST='master_host_name', //主服务器的IP地址\n-&gt; MASTER_PORT=3306, //主服务器端口\n-&gt; MASTER_USER='replication_user_name', //同步数据库的用户\n-&gt; MASTER_PASSWORD='replication_password', //同步数据库的密码\n-&gt; MASTER_LOG_FILE='recorded_log_file_name', //主服务器二进制日志的文件名(前面要求记住的参数)\n-&gt; MASTER_LOG_POS=recorded_log_position; //日志文件的开始位置(前面要求记住的参数)</pre>&#13;\n<pre></pre>&#13;\n<p></p>&#13;\n<h5>e.启动同步数据库的线程</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">mysql&gt; slave start; </pre>查看数据库的同步情况吧。如果能够成功同步那就恭喜了！ <br />&#13;\n查看主从服务器的状态&#13;\n<p></p>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">mysql&gt; SHOW PROCESSLIST\\G //可以查看mysql的进程看看是否有监听的进程 </pre>&#13;\n<p></p>&#13;\n<h3>三、清除日志</h3>&#13;\n<p>如果日志太大清除日志的步骤如下：<br />&#13;\n</p>&#13;\n<h4>1.锁定主数据库</h4>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">mysql&gt; FLUSH TABLES WITH READ LOCK;</pre>&#13;\n<p></p>&#13;\n<h4>2.停掉从数据库的slave</h4>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">mysql&gt; slave stop;</pre>&#13;\n<p></p>&#13;\n<h4>3.查看主数据库的日志文件名和日志文件的position</h4>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">show master status;\n+---------------+----------+--------------+------------------+\n| File | Position | Binlog_do_db | Binlog_ignore_db |\n+---------------+----------+--------------+------------------+\n| louis-bin.001 | 79 | | mysql |\n+---------------+----------+--------------+------------------+</pre>&#13;\n<p></p>&#13;\n<h4>4.解开主数据库的锁</h4>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">mysql&gt; unlock tables;</pre>&#13;\n<p></p>&#13;\n<h4>5.更新从数据库中主数据库的信息</h4>&#13;\n<p></p><pre name="code" class="sql">mysql&gt; CHANGE MASTER TO\n-&gt; MASTER_HOST='master_host_name', //主服务器的IP地址\n-&gt; MASTER_PORT=3306, //主服务器端口\n-&gt; MASTER_USER='replication_user_name', //同步数据库的用户\n-&gt; MASTER_PASSWORD='replication_password', //同步数据库的密码\n-&gt; MASTER_LOG_FILE='recorded_log_file_name', //主服务器二进制日志的文件名(前面要求记住的参数)\n-&gt; MASTER_LOG_POS=recorded_log_position; //日志文件的开始位置(前面要求记住的参数)</pre>&#13;\n<pre></pre>&#13;\n<h4>6.启动从数据库的slave</h4>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">mysql&gt; slave start; </pre><br />&#13;\n<br />&#13;\n<p></p>&#13;\n &#13;\n
