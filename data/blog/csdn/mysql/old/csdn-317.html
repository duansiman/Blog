\n\n<pre><a target="_blank" href="http://blog.csdn.net/l1028386804/article/details/48413681">转载请注明出处:http://blog.csdn.net/l1028386804/article/details/48413681</a>&#13;\n</pre>&#13;\n<p>数据库已搭建完成，各种配置均已完成，但是在start slave ;的时候，报错：</p>&#13;\n<span style="color:#e53333"><strong>ERROR 1200 (HY000): The server is not configured as slave; fix in config file or with CHANGE MASTER TO</strong></span><br />&#13;\n<p>这里说，我没有配置为从机，但我明明配置过的啊。<br />&#13;\n</p>&#13;\n<p>MySQL版本：5.6.19</p>&#13;\n<p>主：master IP  :  172.17.210.199<br />&#13;\n从：slave    IP ：172.17.206.138 <br />&#13;\n先看看从机172.17.206.138的my.cnf</p>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">[root@liuyazhuang ~]# vi /etc/my.cnf\n[mysqld]\ndatadir=/usr/local/mysql/data\nsocket=/tmp/mysql.sock\nskip-grant-tables\nuser=mysql\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\ntmpdir=/tmp\n[mysqld_safe]\nlog-error=/usr/local/data/mysqld.log\npid-file=/usr/local/mysql/data/mysqld.pid\n###############以下是添加主从的配置\nserver_id = 2\nlog-bin = /usr/local/mysql/log/solve-bin.log\nmaster-host = 172.17.210.199\nmaster-user = test\nmaster-pass = 123456\nmaster-port = 3306\nmaster-connect-retry = 60</pre>这是MySQL主机172.17.210.199的my.cnf<br />&#13;\n<pre name="code" class="plain">[root@liuyazhuang ~]$ cat /etc/my.cnf\n[mysqld]\nlog-bin = /u01/mysql/log/masters-bin.log\nread-only = 0\nbasedir = /u01/mysql\ndatadir = /u01/mysql/data\nport = 3306\nserver_id = 1\nsocket = /tmp/mysql.sock\njoin_buffer_size = 128M\nsort_buffer_size = 2M\nread_rnd_buffer_size = 2M\n\nsql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</pre>尝试过多次 重启主从还是报错;<br />&#13;\n接着手动chang to 后还是一样报错<br />&#13;\n<pre name="code" class="sql">mysql&gt; CHANGE MASTER TO\nMASTER_HOST='172.17.210.199',\nMASTER_USER='test',\nMASTER_PASSWORD='123456',\nMASTER_LOG_FILE='masters-bin.000003',\nMASTER_LOG_POS=120;\nQuery OK, 0 rows affected, 2 warnings (0.04 sec) </pre>在从库服务器执行START slave;命令启动slave&#13;\n<p></p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">mysql&gt; START slave;</pre>报错:<br />&#13;\n<span style="color:#FF0000">ERROR 1200 (HY000): The server is not configured as slave; fix in config file or with CHANGE MASTER TO</span>&#13;\n<p></p>&#13;\n<p></p>&#13;\n<p>于是查看日志<br />&#13;\n1.查看SLAVE172.17.206.138上的Mysql报错日志，有这么一句：<br />&#13;\n<span style="color:#e53333"><strong>141009  6:06:29 [ERROR] Server id not set, will not start slave</strong></span></p>&#13;\n<p>意思是，slave的server-id没有设置。<br />&#13;\n那就奇怪了，我明明在配置文件里面指定了server-id的了，并且有重启mysql服务，难道不起效？<br />&#13;\n分别在主从上执行命令“show variables like 'server_id';”。</p>&#13;\n<span style="color:#e53333">-------从机上面查看</span>端口&#13;\n<p></p>&#13;\n<pre name="code" class="sql">mysql&gt; mysql&gt; SHOW VARIABLES LIKE 'server_id';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| server_id | 0 |\n+---------------+-------+\n1 row in set (0.00 sec)</pre>命名设置的是2，怎么会变成0<span style="color:#e53333"><br />&#13;\n</span>&#13;\n<p></p>&#13;\n<p><span style="color:#e53333">-------主机上面查看</span> <br />&#13;\n</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">mysql&gt; SHOW VARIABLES LIKE 'server_id';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| server_id | 1 |\n+---------------+-------+\n1 row in set (0.00 sec)</pre>跟设置的一样。<br />&#13;\n既然参数文件不生效，就试试在数据库命令里面设置：在从机 172.17.206.138上执行命令&#13;\n<p></p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">mysql &gt; SET GLOBAL server_id=2;</pre>再次在从机 172.17.206.138上执行slave start和show slave status，成功了。<br />&#13;\n         <span style="color:#e53333"><strong>注意！！！</strong></span>由于“SET GLOBAL server_id=;”命令会在mysql服务重启后丢失，所以一定要写到配置文件里面。<br />&#13;\n但为什么我之前修改了my.cnf文件不起效？<br />&#13;\n仔细排查，发现配置里面有[mysqld]和[mysqld_safe]，之前将修改的配置内容基本都放在了[mysqld_safe]下面，新增的配置文件放的位置不一样也有关系？于是我尝试把配置文件里修改的部分放在[mysqld]下面，于是改成这样：<br />&#13;\n<pre name="code" class="plain">[root@liuyazhuang]# cat /etc/my.cnf\n[mysqld]\ndatadir=/usr/local/mysql/data\nsocket=/tmp/mysql.sock\nskip-grant-tables\nuser=mysql\nsymbolic-links=0\ntmpdir=/tmp\nserver_id = 2\nlog-bin = /usr/local/mysql/log/solve-bin.log\nmaster-host = 172.17.210.199\nmaster-user = test\nmaster-pass = 123456\nmaster-port = 3306\nmaster-connect-retry = 60\n\n[mysqld_safe]\nlog-error=/usr/local/data/mysqld.log\npid-file=/usr/local/mysql/data/mysqld.pid </pre>如图，就是将图中标注的内容从[mysqld_safe]下修改到[mysqld]下<br />&#13;\n<img src="http://img.blog.csdn.net/20150913112028685?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" height="251" width="480" />&#13;\n<p></p>&#13;\n<p><img src="http://img.blog.csdn.net/20150913112140228?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br />&#13;\n</p>&#13;\n<p>修改之后，再次同步，成功了！<br />&#13;\n</p>&#13;\n<pre name="code" class="sql">mysql&gt;\nmysql&gt; STOP slave;\nQuery OK, 0 rows affected (0.05 sec)\n\nmysql&gt; START slave;\nQuery OK, 0 rows affected (0.00 sec) </pre><br />&#13;\n<p></p>&#13;\n &#13;\n
