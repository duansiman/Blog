\n\n<p>  <a target="_blank" href="http://blog.csdn.net/l1028386804/article/details/50441457">&#13;\n     转载请注明出处:http://blog.csdn.net/l1028386804/article/details/50441457</a><br />&#13;\n</p>&#13;\n<p>    在微博系统中，<span style="color:red">当前用户、关注者（也就是粉丝）、被关注者（崇拜对象）</span>这三种角色是少不了的。他们之间看似简单的关系，但是其中数据库表将如何设计，却让我很难琢磨，在如下解决方案中，<span style="color:red">你们会选择哪种</span><span style="color:red">?</span><span style="color:red">为什么要选择这种</span><span style="color:red">?</span><span style="color:red">是否有更好的解决方案</span><span style="color:red">?</span></p>&#13;\n<p><span style="color:red">解决方案一：</span></p>&#13;\n<table border="1" cellpadding="0" cellspacing="0" width="100%">&#13;\n<tbody>&#13;\n<tr>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p>表名</p>&#13;\n</td>&#13;\n<td colspan="5" valign="top" width="77%">&#13;\n<p>用户信息表</p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>字段名</strong></p>&#13;\n</td>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>字段代码</strong></p>&#13;\n</td>&#13;\n<td colspan="2" valign="top" width="29%" style="background:#d9d9d9">&#13;\n<p><strong>字段类型</strong></p>&#13;\n</td>&#13;\n<td colspan="2" valign="top" width="24%" style="background:#d9d9d9">&#13;\n<p><strong>描述</strong></p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>用户名</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>User_id</p>&#13;\n</td>&#13;\n<td colspan="2" width="29%">&#13;\n<p>Varchar(20)</p>&#13;\n</td>&#13;\n<td colspan="2" width="24%">&#13;\n<p>主键</p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>登陆密码</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>Password</p>&#13;\n</td>&#13;\n<td colspan="2" width="29%">&#13;\n<p>Varchar(20)</p>&#13;\n</td>&#13;\n<td colspan="2" valign="top" width="24%"> </td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>……</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>……</p>&#13;\n</td>&#13;\n<td colspan="2" width="29%">&#13;\n<p>……</p>&#13;\n</td>&#13;\n<td colspan="2" valign="top" width="24%"> </td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top"> </td>&#13;\n<td valign="top"> </td>&#13;\n<td colspan="2" width="29%"> </td>&#13;\n<td colspan="2" valign="top" width="24%"> </td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p>表名</p>&#13;\n</td>&#13;\n<td colspan="5" valign="top" width="77%">&#13;\n<p>关注和被关注者表</p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>字段名</strong></p>&#13;\n</td>&#13;\n<td colspan="2" valign="top" width="23%" style="background:#d9d9d9">&#13;\n<p><strong>字段代码</strong></p>&#13;\n</td>&#13;\n<td colspan="2" valign="top" width="29%" style="background:#d9d9d9">&#13;\n<p><strong>字段类型</strong></p>&#13;\n</td>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>描述</strong></p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>用户名</p>&#13;\n</td>&#13;\n<td colspan="2" valign="top" width="23%">&#13;\n<p>User_id</p>&#13;\n</td>&#13;\n<td colspan="2" width="29%">&#13;\n<p>Varchar(20)</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>主键</p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>关注者</p>&#13;\n</td>&#13;\n<td colspan="2" valign="top" width="23%">&#13;\n<p>Funs</p>&#13;\n</td>&#13;\n<td colspan="2" width="29%">&#13;\n<p>Text</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p><strong> </strong></p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>被关注者</p>&#13;\n</td>&#13;\n<td colspan="2" valign="top" width="23%">&#13;\n<p>Wasfuns</p>&#13;\n</td>&#13;\n<td colspan="2" width="29%">&#13;\n<p>Text</p>&#13;\n</td>&#13;\n<td> </td>&#13;\n</tr>&#13;\n</tbody>&#13;\n</table>&#13;\n<p>    这是我最初想到的一种设计，这里“关注者”和“被关注者”都是采用拼接一些特殊字符分割存储的，比如A用户有只有关注者B、C、D、E，那么存入数据库关注者字段的数据将是B;C;D;E（暂且认为分割字符为；）。</p>&#13;\n<p>基于上述方案，我提出一个问题：<span style="color:#7030a0">当这个用户的“关注者”或“被关注者”数量很大的情况下（比如</span><span style="color:#7030a0">10</span><span style="color:#7030a0">万个关注者）将是怎样的一串字符呢？而且当我们需要查询“关注者”或者“被关注者”最近的博客信息，将面临和博文信息表的一些时间排序查询，处理难度是要浪费性能的。</span></p>&#13;\n<p><span style="color:red">解决方案二：</span></p>&#13;\n<p>    基于上述面临的问题，有人给我提供了一个扩展性的解决方案，同时也很好的解决了一个字段海量数据的问题。将方案一中的关注和被关注者表分解成两张表，如下：</p>&#13;\n<table border="1" cellpadding="0" cellspacing="0" width="100%">&#13;\n<tbody>&#13;\n<tr>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p>表名</p>&#13;\n</td>&#13;\n<td colspan="3" valign="top" width="77%">&#13;\n<p><strong>关注者表</strong></p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>字段名</strong></p>&#13;\n</td>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>字段代码</strong></p>&#13;\n</td>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>字段类型</strong></p>&#13;\n</td>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>描述</strong></p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>编号</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>Id</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>Number</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>主键</p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>用户名</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>User_id</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>Varchar(20)</p>&#13;\n</td>&#13;\n<td> </td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>关注者编号</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>Funs_id</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>Varchar(20)</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p><strong> </strong></p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p>表名</p>&#13;\n</td>&#13;\n<td colspan="3" valign="top" width="77%">&#13;\n<p><strong>被关注者表</strong></p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>字段名</strong></p>&#13;\n</td>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>字段代码</strong></p>&#13;\n</td>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>字段类型</strong></p>&#13;\n</td>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>描述</strong></p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>编号</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>Id</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>Number</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>主键</p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>用户名</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>User_id</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>Varchar(20)</p>&#13;\n</td>&#13;\n<td> </td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>被关注者编号</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>Wasfuns_id</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>Varchar(20)</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p><strong> </strong></p>&#13;\n</td>&#13;\n</tr>&#13;\n</tbody>&#13;\n</table>&#13;\n<p>我看到这样的设计我很吃惊，试想一下，假如我一个用户对应有1W个关注者，那么该用户就会在关注者表中存在一万条他的记录，这难道不是严重的数据冗余吗？这甚至不符合数据库的设计规范。但是事实上证明，这种设计对大数据量的扩展是很不错的，既然如此，<span style="color:#7030a0">那假如用户和用户之间的关系不只是限于关注和被关注的关系，是不是又要新增表</span>？</p>&#13;\n<p><span style="color:red">解决方案三：</span></p>&#13;\n<p>         话说“合久必分，分久必合”，对上述的设计再进一步修改，于是将方案二的两张表又合二为一，如下：</p>&#13;\n<table border="1" cellpadding="0" cellspacing="0" width="100%">&#13;\n<tbody>&#13;\n<tr>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p>表名</p>&#13;\n</td>&#13;\n<td colspan="3" valign="top" width="77%">&#13;\n<p>关注和被关注者表</p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>字段名</strong></p>&#13;\n</td>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>字段代码</strong></p>&#13;\n</td>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>字段类型</strong></p>&#13;\n</td>&#13;\n<td valign="top" style="background:#d9d9d9">&#13;\n<p><strong>描述</strong></p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>编号</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>Id</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>Int</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>主键</p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>用户名</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>User_id</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>Varchar(20)</p>&#13;\n</td>&#13;\n<td> </td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>目标对象</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>Operate_object</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>Varchar(20)</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p><strong> </strong></p>&#13;\n</td>&#13;\n</tr>&#13;\n<tr>&#13;\n<td valign="top">&#13;\n<p>状态</p>&#13;\n</td>&#13;\n<td valign="top">&#13;\n<p>Status</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>Number</p>&#13;\n</td>&#13;\n<td>&#13;\n<p>当目标对象为关注者，标示为1；</p>&#13;\n<p>当目标对象为被关注者，标示为2；</p>&#13;\n<p>当双方互相关注，标示为3；</p>&#13;\n<p>当目标对象为OO，标示为XX。</p>&#13;\n</td>&#13;\n</tr>&#13;\n</tbody>&#13;\n</table>&#13;\n<p>OK，这样的设计不仅解决了相当一部分的数据冗余，而且还能表示用户之间的多种关系，方便系统日后的扩展。但是问题又出来了，很明显这样设计对状态的维护也是存在疑问的，用一张表代替多张表，数据肯定是成倍的增长，是否不符合当前常说的“拆库拆表”的战略方针（好像这样的状态一般用于“标记男女”或者“是否删除了”之类的，貌似用于这种场合比较的少）。</p>&#13;\n<p>在上述用户关系的解决方案中，可以很简单的归结为就是一对多，多对一，多对多的关系嘛，那么究竟如何设计，究竟哪种更好，希望大家共同分析！</p>&#13;\n &#13;\n
