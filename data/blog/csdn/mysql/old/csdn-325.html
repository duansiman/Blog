\n\n<pre><a target="_blank" href="http://blog.csdn.net/l1028386804/article/details/48368937">转载请注明出处:http://blog.csdn.net/l1028386804/article/details/48368937</a>\n</pre>&#13;\n<p>Linux操作系统:centOS6.5 64bit(安装了系统默认开发包)</p>&#13;\n数据库一:<br />&#13;\nMYSQL版本:mysql-5.0.56<br />&#13;\nPORT:3306<br />&#13;\n系统目录:/usr/local/mysql3306<br />&#13;\n数据库二:<br />&#13;\nMYSQL版本:mysql-5.1.72<br />&#13;\nPORT:3307<br />&#13;\n<p>系统目录:/usr/local/mysql3307</p>&#13;\n<h3>一.安装开发包(使用默认CENTOS更新源):</h3>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">&lt;pre name="code" class="plain"&gt;# yum -y install wget gcc-c++ ncurses ncurses-devel cmake make perl bison openssl openssl-devel gcc* libxml2 libxml2-devel curl-devel libjpeg* libpng* freetype*</pre><br />&#13;\n<pre></pre>&#13;\n<h3>二.关闭iptables和SELINUX</h3>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># service iptables stop\n# setenforce 0\n# vi /etc/sysconfig/selinux\n---------------\nSELINUX=disabled</pre>&#13;\n<p></p>&#13;\n<h3>三.安装mysql数据库实例</h3>&#13;\n<h4>1.下载编译包</h4>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># su -\n# mkdir ~/src\n# cd src\n# wget http://mirrors.sohu.com/mysql/MySQL-5.1/mysql-5.1.73.tar.gz\n# wget http://down1.chinaunix.net/distfiles/mysql-5.0.56.tar.gz</pre>&#13;\n<p></p>&#13;\n<h4>2.安装前的初始配置工作：</h4>&#13;\n<h5>1).创建一个Mysql用户</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># useradd mysql </pre>&#13;\n<p></p>&#13;\n<h5>2).新建mysql下data和log子目录</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># mkdir -p /usr/local/mysql{3306,3307}/data \n# mkdir -p /usr/local/mysql{3306,3307}/log</pre>&#13;\n<p></p>&#13;\n<h5>3).修改目录的所属者以及所属组权限  </h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># chown -R mysql:mysql /usr/local/mysql{3306,3307}/data/\n# chown -R mysql:mysql /usr/local/mysql{3306,3307}/log/\n# chmod 750 /usr/local/mysql{3306,3307}/data \n# chmod 750 /usr/local/mysql{3306,3307}/log </pre>&#13;\n<p></p>&#13;\n<h5>4).创建mysql相关目录并配置权限</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># mkdir -p /usr/local/mysql{3306,3307}/etc\n# chown -R mysql.mysql /usr/local/mysql{3306,3307}/etc\n# mkdir -p /var/run/mysqld{3306,3307}\n# chown -R mysql.mysql /var/run/mysqld{3306,3307}\n# mkdir -p /var/lib/mysqld{3306,3307}\n# chown -R mysql.mysql /var/lib/mysqld{3306,3307}\n# cp /etc/my.cnf /usr/local/mysql{3306,3307}/etc</pre>&#13;\n<p></p>&#13;\n<h4>3.解包编译安装</h4>&#13;\n<h5>编译数据库一:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># cd ~/src\n# tar -zxvf mysql-5.0.56.tar.gz \n# cd mysql-5.0.56 \n./configure --prefix=/usr/local/mysql3306 --with-mysqld-user=mysql --sysconfdir=/usr/local/mysql3306/etc --localstatedir=/usr/local/mysql3306/data --with-tcp-port=3306 -enable-assembler --with-mysqld-ldflags=-all-static --with-charset=utf8 --with-extra-charsets=utf-8 -with-extra-charsets=all --with-plugins=csv,innobase,myisam,heap --with-unix-socket-path=/tmp/mysql3306.sock\n# make\n# make install</pre>&#13;\n<p></p>&#13;\n<h5>编译数据库二:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># cd ~/src\n# tar -zxvf mysql-5.1.71.tar.gz \n# cd mysql-5.1.71\n./configure --prefix=/usr/local/mysql3307 --with-mysqld-user=mysql --sysconfdir=/usr/local/mysql3307/etc --localstatedir=/usr/local/mysql3307/data --with-tcp-port=3307 -enable-assembler --with-mysqld-ldflags=-all-static --with-charset=utf8 --with-extra-charsets=utf-8 -with-extra-charsets=all --with-plugins=csv,innobase,myisam,heap --with-unix-socket-path=/tmp/mysql3307.sock\n# make\n# make install</pre>&#13;\n<p></p>&#13;\n<h4>4.编写mysql配置项：</h4>&#13;\n<h5>数据库一配置:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># vi /usr/local/mysql3306/etc/my.cnf\n-------------------------------------------------------\n[mysqld]\ndatadir=/usr/local/mysql3306/data\nsocket=/tmp/mysql3306.sock\nuser=mysql\nport=3306\npid-file=/var/lib/mysqld3306/mysql.pid\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\nmax_connections= 16384\nskip-name-resolve\nskip-locking\nkey_buffer = 256M\nmax_allowed_packet = 32M\ntable_cache = 3072\nthread_cache_size = 256\nsort_buffer_size = 16M\nread_buffer_size = 4M\nread_rnd_buffer_size = 16M\nnet_buffer_length = 256M\nthread_stack = 8M\nquery_cache_size = 128M\nquery_cache_limit = 2M\nwait_timeout=7200\ninteractive_timeout=7200\n#log\nlog-error=/usr/local/mysql3306/log/error.log\nlog=/usr/local/mysql3306/log/mysql.log\nlong_query_time=2\nlog-slow-queries= /usr/local/mysql3306/log/slowquery.log\nlog-bin= /usr/local/mysql3306/log/bin.log\nexpire_logs_days = 15\nsync_binlog = 1\nmax_binlog_cache_size = 4294967295\nlocal-infile=0&#13;\ndefault-storage-engine=INNODB &#13;\n[mysqld_safe]\nlog-error=/var/log/mysqld3306.log\npid-file=/var/run/mysqld3306/mysqld.pid</pre>&#13;\n<p></p>&#13;\n<h5>数据库二配置:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># vi /usr/local/mysql3307/etc/my.cnf\n-------------------------------------------------------\n[mysqld]\ndatadir=/usr/local/mysql3307/data\nsocket=/tmp/mysql3307.sock\nuser=mysql\nport=3307\npid-file=/var/lib/mysqld3307/mysql.pid\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\nmax_connections= 16384\nskip-name-resolve\nskip-locking\nkey_buffer = 256M\nmax_allowed_packet = 32M\ntable_cache = 3072\nthread_cache_size = 256\nsort_buffer_size = 16M\nread_buffer_size = 4M\nread_rnd_buffer_size = 16M\nnet_buffer_length = 256M\nthread_stack = 8M\nquery_cache_size = 128M\nquery_cache_limit = 2M\nwait_timeout=7200\ninteractive_timeout=7200\n#log\nlog-error=/usr/local/mysql3307/log/error.log\nlog=/usr/local/mysql3307/log/mysql.log\nlong_query_time=2\nlog-slow-queries= /usr/local/mysql3307/log/slowquery.log\nlog-bin= /usr/local/mysql3307/log/bin.log\nexpire_logs_days = 15\nsync_binlog = 1\nmax_binlog_cache_size = 4294967295\nlocal-infile=0&#13;\ndefault-storage-engine=INNODB&#13;\n[mysqld_safe]\nlog-error=/var/log/mysqld3307.log\npid-file=/var/run/mysqld3307/mysqld.pid\n-------------------------------------------------------</pre>&#13;\n<p></p>&#13;\n<h4>5.将mysql的库文件路径加入系统的库文件搜索路径中</h4>&#13;\n<h5>方法一：直接做软链接</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># ln -s /usr/local/mysql3306/lib/mysql /usr/lib/mysql</pre>&#13;\n<p></p>&#13;\n<h5>方法二：利用ldconfig导入系统库</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># echo "/usr/local/mysql3306/lib" &gt;&gt; /etc/ld.so.conf.d/mysql.conf\n# ldconfig</pre>&#13;\n<p></p>&#13;\n<h4>6.输出mysql的头文件到系统头文件</h4>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># ln -s /usr/local/mysql3306/include/mysql /usr/include/mysql</pre>注: 此处只需将一个mysql实例的库文件添加到系统库,无需多次添加<br />&#13;\n<p></p>&#13;\n<h4>7.进入相应实例的安装路径,初始化各自配置脚本</h4>&#13;\n<h5>数据库一配置:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># cd /usr/local/mysql3306\n# scripts/mysql_install_db --user=mysql --datadir=/usr/local/mysql3306/data</pre>&#13;\n<p></p>&#13;\n<h5>数据库二配置:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># cd /usr/local/mysql3307\n# scripts/mysql_install_db --user=mysql --datadir=/usr/local/mysql3307/data</pre>&#13;\n<p></p>&#13;\n<h4>8.复制mysql启动脚本到系统服务目录,并更改脚本配置</h4>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># cp /usr/local/mysql3306/support-files/mysql.server /etc/init.d/mysqld3306\n# cp /usr/local/mysql3307/support-files/mysql.server /etc/init.d/mysqld3307</pre>&#13;\n<p></p>&#13;\n<h5>数据库一配置:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># vi /etc/init.d/mysqld3006</pre><pre name="code" class="plain">basedir=/usr/local/mysql3306\ndatadir=/usr/local/mysql3306/data\nconf=/usr/local/mysql3306/etc/my.cnf\n$bindir/mysqld_safe --defaults-file=$conf --datadir=$datadir --pid-file=$server_pid_file $other_args &gt;/dev/null 2&gt;&amp;1 &amp;\n--------------------------------------------</pre>&#13;\n<p>如下图红色标注的为添加的参数:</p>&#13;\n<p><img src="http://img.blog.csdn.net/20150911150431808?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br />&#13;\n</p>&#13;\n<h5>数据库二配置:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># vi /etc/init.d/mysqld3007</pre><pre name="code" class="plain">basedir=/usr/local/mysql3307\ndatadir=/usr/local/mysql3307/data\nconf=/usr/local/mysql3307/etc/my.cnf\n$bindir/mysqld_safe --defaults-file=$conf --datadir=$datadir --pid-file=$server_pid_file $other_args &gt;/dev/null 2&gt;&amp;1 &amp;\n--------------------------------------------</pre>&#13;\n<p>如下图红色标注的为添加的参数:</p>&#13;\n<p><img src="http://img.blog.csdn.net/20150911150519202?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br />&#13;\n</p>&#13;\n<h4>9.系统启动项相关配置</h4>&#13;\n<h5>数据库一配置:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># chkconfig --add mysqld3306 #添加开机启动服务\n# chkconfig --level 35 mysqld3306 on #设置mysql启动</pre>&#13;\n<p></p>&#13;\n<h5>数据库二配置:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># chkconfig --add mysqld3307 \n# chkconfig --level 35 mysqld3307 on</pre>&#13;\n<p></p>&#13;\n<h4>10.启动mysql</h4>&#13;\n<h5>数据库一启动:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># service mysqld3306 start </pre>&#13;\n<p></p>&#13;\n<h5>数据库二启动:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># service mysqld3307 start </pre>&#13;\n<p></p>&#13;\n<h4>11 添加mysql命令集到系统全局变量</h4>&#13;\n<p>注:如果系统之前未安装mysql客户端,可以将编译好的mysql命令集导入系统全局变量<br />&#13;\n以后就可以直接使用mysql命令集,而不需要使用绝对路径访问.<br />&#13;\n</p>&#13;\n<pre name="code" class="plain"># echo "PATH=$PATH:/usr/local/mysql3306/bin;export PATH" &gt;&gt; /etc/profile\n# source /etc/profile</pre>&#13;\n<p></p>&#13;\n<h4>12. 设置初始账户,并登陆后台:</h4>&#13;\n<h5>数据库一:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># /usr/local/mysql3306/bin/mysqladmin -u root password 123456 #设置超级管理员密码\n# /usr/local/mysql3306/bin/mysql -P3306 -S/tmp/mysql3306.sock -uroot -p123456 #连接数据库</pre>&#13;\n<p></p>&#13;\n<h5>数据库二:</h5>&#13;\n<p></p>&#13;\n<pre name="code" class="plain"># /usr/local/mysql3307/bin/mysqladmin -u root password 123456 #设置超级管理员密码\n# /usr/local/mysql3307/bin/mysql -P3307 -S/tmp/mysql3307.sock -uroot -p123456 #连接数据库</pre>注: 因为加了mysql环境变量,以后系统后台可以直接使用mysql命令登录,这里使用绝对路径是为了规范操作<br />&#13;\n<pre name="code" class="plain"># mysql -P3307 -S/tmp/mysql3307.sock -uroot -p123456</pre>&#13;\n<p></p>&#13;\n<h4>13.端口测试:</h4>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">#lsof -i:3306\n#lsof -i:3307</pre>OK,大功告成!<br />&#13;\n<h3>四、问题</h3>&#13;\n<h4>1、-bash: ./scripts/mysql_install_db: No such file or directory<br />&#13;\n</h4>&#13;\n<p>安装过程中执行</p>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">scripts/mysql_install_db --user=mysql --datadir=/usr/local/mysql3306/data</pre>报错信息为:<br />&#13;\n<pre name="code" class="plain">-bash: ./scripts/mysql_install_db: No such file or directory</pre>&#13;\n<p>说明在mysql的安装目录下没有scripts目录，此时，可以将解压的源码中的script目录拷贝到安装目录下，重新执行命令。</p>&#13;\n<h4>2、cp: cannot stat `/usr/local/mysql3307/support-files/mysql.server': No such file or directory</h4>&#13;\n<p>安装过程中执行命令<br />&#13;\n</p>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld3307</pre>报错信息为:<br />&#13;\n<pre name="code" class="plain">cp: cannot stat `/usr/local/mysql3307/support-files/mysql.server': No such file or directory</pre>将解压的源码中的support-files目录拷贝到安装目录下，重新执行命令<br />&#13;\n<h4>3、env: /etc/init.d/mysqld3307: Permission denied</h4>&#13;\n<p>启动数据库的时候执行命令</p>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">service mysqld3307 start</pre>报错信息为：<br />&#13;\n<pre name="code" class="plain">env: /etc/init.d/mysqld3307: Permission denied</pre>此时要为相应的文件授权，执行命令<br />&#13;\n<pre name="code" class="plain">chmod a+wrx /etc/init.d/mysqld3307</pre>重新执行启动MySQL数据库服务的命令service mysqld3307 start<br />&#13;\n<br />&#13;\n<p></p>&#13;\n<p></p>&#13;\n &#13;\n
