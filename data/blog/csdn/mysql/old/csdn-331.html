\n\n备份/恢复策略：<br />&#13;\n1. 要定期做 mysql备份，并考虑系统可以承受的恢复时间。<br />&#13;\n2. 确保 mysql 打开log-bin，有了 binarylog，mysql才可以在必要的时候做完整恢复，或基于时间点的恢复，或基于位置的恢复。<br />&#13;\n<p>3. 要经常做备份恢复测试，确保备份是有效的，并且是可以恢复的。</p>&#13;\n<p>冷备份</p>&#13;\n<p>备份：<br />&#13;\n1. 停掉 mysql服务，在操作系统级别备份 mysql的数据文件。<br />&#13;\n2. 重启 mysql服务，备份重启以后生成的 binlog。<br />&#13;\n恢复：<br />&#13;\n1. 停掉 mysql服务，在操作系统级别恢复 mysql的数据文件。<br />&#13;\n2. 重启 mysql服务，使用 mysqlbinlog恢复自备份以来的 binlog。 </p>&#13;\n<p>逻辑备份 </p>&#13;\n<p>备份：<br />&#13;\n1. 选择在系统空闲时，比如在夜间，使用 mysqldump –F(flush-logs)备份数据<br />&#13;\n库。<br />&#13;\n</p>&#13;\n<div class="cnblogs_code">&#13;\n<div><pre code_snippet_id="618856" snippet_file_name="blog_20150313_1_6111054" name="code" class="sql">mysqldump –u root –p*** pointcard –F &gt; pointcard.sql</pre></div>&#13;\n</div>&#13;\n<p>2. 并备份 mysqldump开始以后生成的 binlog。<br />&#13;\n恢复：<br />&#13;\n1. 停掉应用，执行 mysql 导入备份文件.<br />&#13;\n</p>&#13;\n<div class="cnblogs_code">&#13;\n<div><pre code_snippet_id="618856" snippet_file_name="blog_20150313_2_4032055" name="code" class="sql">mysql –u root –p*** pointcard &lt; pointcard.sql</pre></div>&#13;\n</div>&#13;\n<p>2. 使用 mysqlbinlog 恢复自mysqldump 备份以来的binlog。<br />&#13;\n</p>&#13;\n<div class="cnblogs_code">&#13;\n<div><pre code_snippet_id="618856" snippet_file_name="blog_20150313_3_8822354" name="code" class="sql">mysqlbinlog $HOME/data/mysql-bin.123456 | mysql -u root –p*** </pre><span style="color:#000000"></span></div>&#13;\n</div>&#13;\n<p>单个表的备份：<br />&#13;\n备份：<br />&#13;\n1. 方法 1：<br />&#13;\n</p>&#13;\n<div class="cnblogs_code">&#13;\n<div><pre code_snippet_id="618856" snippet_file_name="blog_20150313_4_7167685" name="code" class="sql">mysql &gt; select csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-33.html csdn-34.html csdn-35.html csdn-36.html csdn-37.html csdn-38.html csdn-39.html csdn-3.html csdn-40.html csdn-41.html csdn-42.html csdn-43.html csdn-44.html csdn-45.html csdn-46.html csdn-47.html csdn-48.html csdn-49.html csdn-4.html csdn-50.html csdn-51.html csdn-52.html csdn-53.html csdn-54.html csdn-55.html csdn-56.html csdn-57.html csdn-58.html csdn-59.html csdn-5.html csdn-60.html csdn-61.html csdn-62.html csdn-63.html csdn-64.html csdn-65.html csdn-66.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh into outfile ‘/tmp/order_tab’ fields-terminated-by=’,’ from order_tab;</pre></div>&#13;\n</div>&#13;\n<p>2. 方法 2：<br />&#13;\n</p>&#13;\n<div class="cnblogs_code">&#13;\n<div><pre code_snippet_id="618856" snippet_file_name="blog_20150313_5_6941475" name="code" class="html">mysqldump –u root –p*** –T /tmp pointcard order_tab --fields-terminated-by=’,’;</pre><span style="color:#000000"></span>恢复：<br />&#13;\n</div>&#13;\n</div>&#13;\n<p>1. 方法 1：<br />&#13;\n</p>&#13;\n<div class="cnblogs_code">&#13;\n<div><pre code_snippet_id="618856" snippet_file_name="blog_20150313_6_2811570" name="code" class="sql">mysql &gt; load data [local] infile ‘/tmp/order_tab’ into table order_tab fields-terminated-by=’,’;</pre></div>&#13;\n</div>&#13;\n<p>2. 方法 2：<br />&#13;\n</p>&#13;\n<div class="cnblogs_code">&#13;\n<div><pre code_snippet_id="618856" snippet_file_name="blog_20150313_7_2552340" name="code" class="sql">mysqlimport –u root –p*** [--local] pointcatd order_tab.txt --fields-terminated-by=’,’;</pre><span style="color:#000000"></span><pre code_snippet_id="618856" snippet_file_name="blog_20150313_8_9817874" name="code" class="sql">注意：如果导入和导出是跨平台操作的（windows和 linux），那么要注意设置参数line-\nterminated-by， windows上设置为 line-terminated-by=’\\r\\n’，linux上设置为\nline-terminated-by=’\\n’.</pre></div>&#13;\n</div>&#13;\n<p>使用备份工具ibbackup</p>&#13;\n<p>ibbackup是 innodb公司（www.innodb.com)的一个热备份工具，专门对 innodb存储引擎进行物理热备份，此工具是收费的，不能免费使用。现在innodb 公司已经被oracle收购<br />&#13;\n使用方法：<br />&#13;\n编辑用于启动的配置文件my.cnf和用于备份的配置文件my2.cnf<br />&#13;\nmy.cnf的例子如下：<br />&#13;\n</p>&#13;\n<p></p><pre code_snippet_id="618856" snippet_file_name="blog_20150313_9_1227868" name="code" class="sql">[mysqld]\ndatadir = /home/heikki/data \n\ninnodb_data_home_dir = /home/heikki/data\ninnodb_data_file_path = ibdata1:10M:autoextend\ninnodb_log_group_home_dir = /home/heikki/data\nset-variable = innodb_log_files_in_group=2\nset-variable = innodb_log_file_size=20M</pre>&#13;\n<p>如果想备份到/home/heikki/backup，则my2.cnf的例子如下：</p>&#13;\n<p></p><pre code_snippet_id="618856" snippet_file_name="blog_20150313_10_2953505" name="code" class="sql">[mysqld]datadir = /home/heikki/backupinnodb_data_home_dir = /home/heikki/backupinnodb_data_file_path = ibdata1:10M:autoextendinnodb_log_group_home_dir = /home/heikki/backupset-variable = innodb_log_files_in_group=2\nset-variable = innodb_log_file_size=20M</pre>&#13;\n<p>开始备份ibbackup my.cnf my2.cnf如果需要恢复，则进行日志重做ibbackup --apply-log my2.cnf恢复后重启数据库服务./bin/mysqld_saft --defaults-file=my2.cnf &amp; </p>&#13;\n<p>时间点恢复：</p>&#13;\n<p>1. 如果上午 10点发生了误操作，可以用以下语句用备份和 binglog将数据恢复到故<br />&#13;\n障前：</p>&#13;\n<p></p><pre code_snippet_id="618856" snippet_file_name="blog_20150313_11_4363497" name="code" class="sql">mysqlbinlog --stop-date="2005-04-20 9:59:59"\n/var/log/mysql/bin.123456 | mysql -u root –pmypwd</pre>&#13;\n<div class="cnblogs_code">&#13;\n<div><span style="color:#000000"></span>2. 跳过故障时的时间点，继续执行后面的 binlog，完成恢复</div>&#13;\n</div>&#13;\n<div class="cnblogs_code">&#13;\n<div><pre code_snippet_id="618856" snippet_file_name="blog_20150313_12_4660675" name="code" class="sql">mysqlbinlog --start-date="2005-04-20 10:01:00"\n/var/log/mysql/bin.123456| mysql -u root -pmypwd \\</pre></div>&#13;\n</div>&#13;\n<p>位置恢复：</p>&#13;\n<p>和时间点恢复类似，但是更精确，步骤如下：</p>&#13;\n<p></p><pre code_snippet_id="618856" snippet_file_name="blog_20150313_13_4990872" name="code" class="sql">mysqlbinlog --start-date="2005-04-20 9:55:00" --stop-date="2005-04-20\n10:05:00" /var/log/mysql/bin.123456 &gt; /tmp/mysql_restore.sql</pre>&#13;\n<div class="cnblogs_code">&#13;\n<div><span style="color:#000000"></span>该命令将在/tmp目录创建小的文本文件，编辑此文件，找到出错语句前后的位置号 ，例如前后位置号分别是368312 和368315。恢复了以前的备份文件后，你应从命令行输入下面内容：<br />&#13;\n</div>&#13;\n</div>&#13;\n<div class="cnblogs_code">&#13;\n<div><pre code_snippet_id="618856" snippet_file_name="blog_20150313_14_8909119" name="code" class="sql">mysqlbinlog --stop-position="368312" /var/log/mysql/bin.123456 \\\n| mysql -u root -pmypwd\nmysqlbinlog --start-position="368315" /var/log/mysql/bin.123456 \\\n| mysql -u root -pmypwd \\</pre></div>&#13;\n</div>&#13;\n<p>上面的第1 行将恢复到停止位置为止的所有事务。下一行将恢复从给定的起始位置<br />&#13;\n直到二进制日志结束的所有事务。因为mysqlbinlog 的输出包括每个SQL 语句记录<br />&#13;\n之前的SET TIMESTAMP 语句，恢复的数据和相关MySQL 日志将反应事务执行的原时<br />&#13;\n间。</p>&#13;\n<p>MyISAM表修复：</p>&#13;\n<p>一张损坏的表的症状通常是查询意外中断并且能看到下述错误：<br />&#13;\n? “tbl_name.frm”被锁定不能更改。<br />&#13;\n? 不能找到文件“tbl_name.MYI”（Errcode：nnn）。<br />&#13;\n? 文件意外结束。<br />&#13;\n? 记录文件被毁坏。<br />&#13;\n? 从表处理器得到错误nnn<br />&#13;\n解决方法如下：</p>&#13;\n<p>方法一：<br />&#13;\n</p>&#13;\n<div class="cnblogs_code">&#13;\n<div><pre code_snippet_id="618856" snippet_file_name="blog_20150313_15_3143012" name="code" class="sql">myisamchk -r tablename</pre><span style="color:#000000"></span>上面的方法几乎能解决所有问题，如果不行，则使用：<br />&#13;\n</div>&#13;\n</div>&#13;\n<div class="cnblogs_code">&#13;\n<div><pre code_snippet_id="618856" snippet_file_name="blog_20150313_16_408547" name="code" class="sql">myisamchk -o tablename</pre><span style="color:#000000"></span>方法二：<br />&#13;\n</div>&#13;\n</div>&#13;\n<p></p><pre code_snippet_id="618856" snippet_file_name="blog_20150313_17_2657572" name="code" class="sql">1) CHECK TABLE tbl_name [, tbl_name] ... [option] ...\noption = {QUICK | FAST | MEDIUM | EXTENDED | CHANGED}\n2) REPAIR [LOCAL | NO_WRITE_TO_BINLOG] TABLE\ntbl_name [, tbl_name] ... [QUICK] [EXTENDED] [USE_FRM] </pre><br />&#13;\n&#13;\n &#13;\n
