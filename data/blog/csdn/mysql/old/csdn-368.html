\n\n<pre><a target="_blank" href="http://blog.csdn.net/l1028386804/article/details/46806677">转载请注明出处:http://blog.csdn.net/l1028386804/article/details/46806677</a>\n</pre>&#13;\n<p>MYSQL 从3.25.15版本开始提供数据库复制功能（replication）。mysql复制是指从一个mysql主服务器（MASTER）将数据复制到另一台或多台mysql从服务器（SLAVE）的过程，将主数据库的DDL和DML操作通过二进制日志传到复制服务器上，然后在从服务器上对这些日志重新执行，从而使从服务器的数据保持同步。在mysql中，复制操作是异步进行的，slave服务器不需要持续的保持连接接收master服务器的数据mysql支持一台主服务器同时向多台从服务器进行复制操作，从服务器同时可以作为其他从服务器的主服务器，如果mysql主服务器访问量大，可以通过复制数据，然后在从服务器上进行查询操作，从而降低主服务器的访问压力（读写分离），同时从服务器作为主服务器的备份，可以避免主服务器因为故障数据丢失的问题。</p>&#13;\n<p>mysql数据库复制操作大致可以分为三个步骤</p>&#13;\n<p>1主服务器将数据的改变记录到二进制日志（binlog）中。</p>&#13;\n<p>2、从服务器将主服务器的binary log events复制到他的中继日志（relay log）中。</p>&#13;\n<p>3、从服务器做中继日志中的事件，将数据的改变与从服务器保持同步。 <br />&#13;\n</p>&#13;\n<p>首先，主服务器会记录二进制日志，每个事务更新完毕数据之前，主服务器将这些操作的信息记录在二进制日志里面，在事件写入</p>&#13;\n<p>二进制日志完成后，主服务器 通知存储引擎提交事务。SLAVE上面的I/O进程连接上MASTER，并发出日志请求，MASTER接收到来自SLAVE的I/O进程的请求后，通过负责复制的I/O进程根据请求信息读取指定日志位置之后的日志信息，返回给SLAVE的I/O进程。返回信息中除了日志所包含的信息之外，还包括本次返回的信息已经到MASTER端的binlog文件的名称以及binlog的位置SLAVE的I/O进程接收到信息后，将接收到的日志内容依次添加到SLAVE端的relay-log文件的最末端，并将读取到的MASTER端的binlog文件名和位置记录到master-Info文件中。SLAVE的SQL进程检测到relay-log中新增了内容后，会马上解析relay-log的内容成为在master端真实执行时候的那些可执行内容，并在自身执行mysql复制环境，90%以上都是一个master带一个或者多个slave的架构模式。如果master和slave压力不是太大的话，异步复制的延时一般都很少。尤其是slave端的复制方式改成两个进程处理之后，更是减少了slave端的延时</p>&#13;\n<blockquote>&#13;\n<p><span style="color:#ff0000"><strong>提示：对于数据实时性要求不是特别严格的应用，只需要通过廉价的电脑服务器来扩展slave的数量，将读压力分散到多台slave的机器上面</strong></span></p>&#13;\n<p><span style="color:#ff0000"><strong>即可解决数据库端的读压力瓶颈。这在很大程度上解决了目前很多中小型网站的数据库压力瓶颈问题，甚至有些大型网站也在使用类似方案解决</strong></span></p>&#13;\n<p><span style="color:#ff0000"><strong>数据库瓶颈问题</strong></span></p>&#13;\n</blockquote>&#13;\n<hr />&#13;\n<p><span style="color:#ff9900"><strong>Windows环境下的mysql主从复制</strong></span></p>&#13;\n<p><strong>复制前的准备工作</strong></p>&#13;\n<p>在Windows环境下，如果想实现主从复制需要准备的操作环境</p>&#13;\n<p>角色          ip                      端口            操作系统          mysql版本</p>&#13;\n<p>master   192.168.1.100     3306           Windows7         5.5.20</p>&#13;\n<p>slave      192.168.1.102     3306           Windows8         5.5.20</p>&#13;\n<p>Windows环境下实现主从复制</p>&#13;\n<p>准备好两台安装mysql5.6的计算机，即可实现两台mysql服务器主从复制备份操作。</p>&#13;\n<p>具体操作步骤如下：</p>&#13;\n<p>1、在Windows下安装好两台mysql服务器，配置好两台主机的ip地址，实现两台计算机可以网络连通</p>&#13;\n<p> <img src="http://images.cnitblog.com/i/257159/201408/052118393975698.jpg" alt="" /></p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/052118490378375.jpg" alt="" /></p>&#13;\n<p>2、配置master的相关配置信息，在master主机上开启binlog日志，首先，看下datadir的具体路径</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">show variables LIKE '%datadir%'</pre>&#13;\n<p></p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/052120275844349.jpg" alt="" /></p>&#13;\n<p>3、此时需要打开在D:\\Program Files (x86)\\MySQL\\MySQL Server 5.5路径下的配置文件my.ini，添加如下代码，开启binlog功能</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">[mysqld]\nlog-bin="D:/MYSQLDataBase/binlog"\nexpire_logs_days=10\nmax_binlog_size=100M</pre>&#13;\n<p></p>&#13;\n<p>提示：此事我们需要在D盘下面创建MYSQLDATABASE文件夹，binlog日志记录在该文件夹里面，该配置文件中的其他参数如下所示</p>&#13;\n<p>expire_logs_days：表示二进制日志文件删除的天数</p>&#13;\n<p>max_binlog_size：表示二进制日志文件最大的大小</p>&#13;\n<p>4、登录mysql后，可以执行show VARIABLES LIKE '%log_bin%'命令来测试下log_bin是否成功开启</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">show VARIABLES LIKE '%log_bin%';</pre>&#13;\n<p></p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/052141520841504.jpg" alt="" /></p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/052143232565457.jpg" alt="" /></p>&#13;\n<p>如果log_bin参数是ON的话，那么表示二进制日志文件已经成功开启，如果为OFF的话，那么表示二进制日志文件开启失败</p>&#13;\n<p>5、在master上配置复制所需要的账户，这里创建一个repl的用户，%表示任何远程地址的repl用户都可以连接master主机</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">GRANT replication slave ON *.*TO repl@'%' IDENTIFIED BY '123';\nflush privileges;</pre>&#13;\n<p></p>&#13;\n<p>6、在my.ini配置文件里配置master主机的相关信息</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">[mysqld]\nlog-bin="D:/MYSQLDataBase/binlog"\nexpire_logs_days=10\nmax_binlog_size=100M\n\nserver-id=1\nbinlog-do-db=test\nbinlog-ignore-db=mysql</pre>&#13;\n<p></p>&#13;\n<p>这些配置语句的含义</p>&#13;\n<p>server-id：表示服务器表示id号，master和slave主机的server-id不能一样</p>&#13;\n<p>binlog-do-db：表示需要复制的数据库，这里以test库为例</p>&#13;\n<p>binlog-ignore-db：表示不需要复制的数据库</p>&#13;\n<p>7、重启master主机上的mysql服务，然后输入show master status命令查询master主机的信息</p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/061901275844118.jpg" alt="" /></p>&#13;\n<p>8、将master主机的数据备份出来，然后导入到slave主机中去，具体执行语句如下</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">mysqldump -u root -p -h 127.0.0.1 test &gt;D:\\TEST.TXT</pre>&#13;\n<p></p>&#13;\n<p>TEST库里面的表和数据</p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/052239176628981.jpg" alt="" /></p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/061901393975128.jpg" alt="" /></p>&#13;\n<p>innodb_monitor表是没有数据的</p>&#13;\n<p>dump出来的txt文件内容</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">-- MySQL dump 10.13 Distrib 5.5.20, for Win32 (x86)\n--\n-- Host: 127.0.0.1 Database: test\n-- ------------------------------------------------------\n-- Server version 5.5.20-log\n\n/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;\n/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;\n/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;\n/*!40101 SET NAMES utf8 */;\n/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;\n/*!40103 SET TIME_ZONE='+00:00' */;\n/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;\n/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;\n/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;\n/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;\n\n--\n-- Table structure for table `book`\n--\n\nDROP TABLE IF EXISTS `book`;\n/*!40101 SET @saved_cs_client = @@character_set_client */;\n/*!40101 SET character_set_client = utf8 */;\nCREATE TABLE `book` (\n `bookid` int(11) NOT NULL,\n `bookname` varchar(255) NOT NULL,\n `authors` varchar(255) NOT NULL,\n `info` varchar(255) DEFAULT NULL,\n `comment` varchar(255) DEFAULT NULL,\n `year_publication` year(4) NOT NULL,\n KEY `year_publication` (`year_publication`)\n) ENGINE=MyISAM DEFAULT CHARSET=latin1;\n/*!40101 SET character_set_client = @saved_cs_client */;\n\n--\n-- Dumping data for table `book`\n--\n\nLOCK TABLES `book` WRITE;\n/*!40000 ALTER TABLE `book` DISABLE KEYS */;\nINSERT INTO `book` VALUES (12,'dajiahao','NIHAO','??','henhao',1990);\n/*!40000 ALTER TABLE `book` ENABLE KEYS */;\nUNLOCK TABLES;\n\n--\n-- Table structure for table `innodb_monitor`\n--\n\nDROP TABLE IF EXISTS `innodb_monitor`;\n/*!40101 SET @saved_cs_client = @@character_set_client */;\n/*!40101 SET character_set_client = utf8 */;\nCREATE TABLE `innodb_monitor` (\n `a` int(11) DEFAULT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n/*!40101 SET character_set_client = @saved_cs_client */;\n\n--\n-- Dumping data for table `innodb_monitor`\n--\n\nLOCK TABLES `innodb_monitor` WRITE;\n/*!40000 ALTER TABLE `innodb_monitor` DISABLE KEYS */;\n/*!40000 ALTER TABLE `innodb_monitor` ENABLE KEYS */;\nUNLOCK TABLES;\n\n\n/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;\n\n/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;\n/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;\n/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;\n/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;\n/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;\n/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;\n/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;\n\n-- Dump completed on 2014-08-05 22:36:17</pre>&#13;\n<p></p>&#13;\n<p>将D:\\TEST.TXT文件复制到slave机器上，然后执行如下操作</p>&#13;\n<p>在命令行登录mysql，然后 <span class="cnblogs_code"><span style="color:#0000ff">USE</span> TEST;</span> </p>&#13;\n<p>记得一定要USE TEST，切换数据库上下文，否则会报错：NO DATABASE SELECTED 的错误信息</p>&#13;\n<p>然后执行source命令导入TEXT.txt文件的内容</p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/052302271629214.jpg" alt="" /></p>&#13;\n<p>可以看到，数据已经导入到slave上面了</p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/052303016784627.jpg" alt="" style="line-height:1.5" /></p>&#13;\n<p>9、配置slave机器（192.168.1.102）的my.ini配置文件</p>&#13;\n<p>具体配置信息如下</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">[mysql]\n\ndefault-character-set=utf8\nlog_bin="C:/MYSQLLOG/binlog"\nexpire_logs_days=10\nmax_binlog_size=100M\n\n[mysqld]\nserver-id=2</pre>&#13;\n<p></p>&#13;\n<p>提示：配置slave主机my.ini文件的时候，需要将server-id=2写到[mysqld]后面</p>&#13;\n<p>另外如果配置文件中还有log_bin的配置，可以将他注释掉，如下所示</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">#Binary Logging\n#log-bin\n#log_bin="xxx"</pre>&#13;\n<p></p>&#13;\n<p>10、重启slave主机（192.168.1.102）的mysql服务，在slave主机（192.168.1.102）的mysql中执行如下命令</p>&#13;\n<p>关闭slave服务</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">stop slave;</pre>&#13;\n<p></p>&#13;\n<p>11、设置slave从机实现复制相关的信息，命令如下</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">change master to\nmaster_host='192.168.1.100',\nmaster_user='repl',\nmaster_password='123',\nmaster_log_file='binlog。000004',\nmaster_log_pos=107;\n\nCommand(s) completed successfully.</pre>&#13;\n<p></p>&#13;\n<p> 各个参数所代表的具体含义如下：</p>&#13;\n<p>master_host：表示实现复制的主机ip地址</p>&#13;\n<p>master_user：表示实现复制的登录远程主机的用户</p>&#13;\n<p>master_password：表示实现复制的登录远程主机的密码</p>&#13;\n<p>master_log_file：表示实现复制的binlog日志文件</p>&#13;\n<p>master_log_pos：表示实现复制的binlog日志文件的偏移量</p>&#13;\n<p>12、继续在从机执行操作，显示slave从机的状况，如下所示</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">start slave;\n\nCommand(s) completed successfully.\n&lt;pre&gt;mysql&lt;span style="color:#808080;"&gt;&gt;&lt;/span&gt;&lt;span style="color:#000000;"&gt; SHOW SLAVE STATUS \\G;\n&lt;/span&gt;&lt;span style="color:#808080;"&gt;***************************&lt;/span&gt; &lt;span style="color:#800000;font-weight: bold;"&gt;1&lt;/span&gt;. row &lt;span style="color:#808080;"&gt;***************************&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Slave_IO_State:\n Master_Host: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;192.168&lt;/span&gt;.&lt;span style="color:#800000;font-weight: bold;"&gt;1.100&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Master_User: repl\n Master_Port: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;3306&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Connect_Retry: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;60&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Master_Log_File: binlog銆?&lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;00004&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Read_Master_Log_Pos: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;107&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Relay_Log_File: Steven&lt;/span&gt;&lt;span style="color:#808080;"&gt;-&lt;/span&gt;PC&lt;span style="color:#808080;"&gt;-&lt;/span&gt;relay&lt;span style="color:#808080;"&gt;-&lt;/span&gt;bin.&lt;span style="color:#800000;font-weight: bold;"&gt;000002&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Relay_Log_Pos: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;4&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Relay_Master_Log_File: binlog銆?&lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;00004&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Slave_IO_Running: No\n Slave_SQL_Running: Yes\n Replicate_Do_DB:\n Replicate_Ignore_DB:\n Replicate_Do_Table:\n Replicate_Ignore_Table:\n Replicate_Wild_Do_Table:\n Replicate_Wild_Ignore_Table:\n Last_Errno: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;0&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Last_Error:\n Skip_Counter: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;0&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Exec_Master_Log_Pos: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;107&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Relay_Log_Space: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;107&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Until_Condition: None\n Until_Log_File:\n Until_Log_Pos: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;0&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Master_SSL_Allowed: No\n Master_SSL_CA_File:\n Master_SSL_CA_Path:\n Master_SSL_Cert:\n Master_SSL_Cipher:\n Master_SSL_Key:\n Seconds_Behind_Master: &lt;/span&gt;&lt;span style="color:#0000ff;"&gt;NULL&lt;/span&gt;&lt;span style="color:#000000;"&gt;\nMaster_SSL_Verify_Server_Cert: No\n Last_IO_Errno: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;1236&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Last_IO_Error: Got fatal error &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;1236&lt;/span&gt; &lt;span style="color:#0000ff;"&gt;from&lt;/span&gt; master &lt;span style="color:#0000ff;"&gt;when&lt;/span&gt;&lt;span style="color:#000000;"&gt; reading dat\na &lt;/span&gt;&lt;span style="color:#0000ff;"&gt;from&lt;/span&gt; &lt;span style="color:#0000ff;"&gt;binary&lt;/span&gt; &lt;span style="color:#ff00ff;"&gt;log&lt;/span&gt;: &lt;span style="color:#ff0000;"&gt;'&lt;/span&gt;&lt;span style="color:#ff0000;"&gt;Could not find first log file name in binary log index file&lt;/span&gt;&lt;span style="color:#ff0000;"&gt;'&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n\n Last_SQL_Errno: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;0&lt;/span&gt;&lt;span style="color:#000000;"&gt;\n Last_SQL_Error:\n Replicate_Ignore_Server_Ids:\n Master_Server_Id: &lt;/span&gt;&lt;span style="color:#800000;font-weight: bold;"&gt;1&lt;/span&gt;\n&lt;span style="color:#800000;font-weight: bold;"&gt;1&lt;/span&gt; row &lt;span style="color:#808080;"&gt;in&lt;/span&gt; &lt;span style="color:#0000ff;"&gt;set&lt;/span&gt; (&lt;span style="color:#800000;font-weight: bold;"&gt;0.00&lt;/span&gt;&lt;span style="color:#000000;"&gt; sec)\n\nERROR:\nNo query specified&lt;/span&gt;</pre>&#13;\n<p></p>&#13;\n<pre></pre>&#13;\n<p></p>&#13;\n<p>在上述执行show slave status \\G命令中很显然存在一些问题，问题如下</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql"> Last_IO_Errno: 1236\n Last_IO_Error: Got fatal error 1236 from master when reading dat\na from binary log: 'Could not find first log file name in binary log index file'</pre>&#13;\n<p></p>&#13;\n<p>下面的步骤可以解决问题，具体步骤如下</p>&#13;\n<p>1、重启master（192.168.1.100）主机的mysql服务，执行show master status \\G命令</p>&#13;\n<p>记下File和Position的值，后面slave主机会用到，命令执行如下</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">SHOW MASTER STATUS;</pre>&#13;\n<p></p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/061930107254515.jpg" alt="" /></p>&#13;\n<p>2、在slave（192.168.1.102）主机上重新设置信息，命令执行如下</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">stop slave;\n\nchange master to\nmaster_log_file='binlog.000005',\nmaster_log_pos=107;\n\nstart slave;\n\nmysql&gt; SHOW SLAVE STATUS \\G;\n*************************** 1. row ***************************\n Slave_IO_State: Waiting for master to send event\n Master_Host: 192.168.1.100\n Master_User: repl\n Master_Port: 3306\n Connect_Retry: 60\n Master_Log_File: binlog.000005\n Read_Master_Log_Pos: 107\n Relay_Log_File: Steven-PC-relay-bin.000002\n Relay_Log_Pos: 250\n Relay_Master_Log_File: binlog.000005\n Slave_IO_Running: Yes\n Slave_SQL_Running: Yes\n Replicate_Do_DB:\n Replicate_Ignore_DB:\n Replicate_Do_Table:\n Replicate_Ignore_Table:\n Replicate_Wild_Do_Table:\n Replicate_Wild_Ignore_Table:\n Last_Errno: 0\n Last_Error:\n Skip_Counter: 0\n Exec_Master_Log_Pos: 107\n Relay_Log_Space: 410\n Until_Condition: None\n Until_Log_File:\n Until_Log_Pos: 0\n Master_SSL_Allowed: No\n Master_SSL_CA_File:\n Master_SSL_CA_Path:\n Master_SSL_Cert:\n Master_SSL_Cipher:\n Master_SSL_Key:\n Seconds_Behind_Master: 0\nMaster_SSL_Verify_Server_Cert: No\n Last_IO_Errno: 0\n Last_IO_Error:\n Last_SQL_Errno: 0\n Last_SQL_Error:\n Replicate_Ignore_Server_Ids:\n Master_Server_Id: 1\n1 row in set (0.00 sec)\n\nERROR:\nNo query specified</pre>&#13;\n<p></p>&#13;\n<p>这次正常了，实际上刚才有两个地方是错误的</p>&#13;\n<p><strong>第一个</strong>：在从机的my.ini里面</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">[mysql]\ndefault-character-set=utf8\n#log_bin="C:/MYSQLLOG/binlog"\n#expire_logs_days=10\n#max_binlog_size=100M</pre>&#13;\n<p></p>&#13;\n<p>在从机的my.ini里面的mysql配置节下面配置了binlog，实际上这样做是错误的，要配置binlog需要在[mysqld]配置节下</p>&#13;\n<p><strong>第二个</strong>：第一次配置从机的同步的时候本人写错了标点符号，.号写成。号</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">master_log_file='binlog。000004',</pre>&#13;\n<p></p>&#13;\n<p>这时候，我们可以在从机上面执行show processlist来查询从服务器的进程状态</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">mysql&gt; show processlist \\G\n*************************** 1. row ***************************\n Id: 4\n User: root\n Host: localhost:60968\n db: information_schema\nCommand: Sleep\n Time: 3613\n State:\n Info: NULL\n*************************** 2. row ***************************\n Id: 5\n User: system user\n Host:\n db: NULL\nCommand: Connect\n Time: 3613\n State: Waiting for master to send event\n Info: NULL\n*************************** 3. row ***************************\n Id: 6\n User: system user\n Host:\n db: NULL\nCommand: Connect\n Time: 2769\n State: Slave has read all relay log; waiting for the slave I/O thread to update it\n Info: NULL\n*************************** 4. row ***************************\n Id: 7\n User: root\n Host: localhost:61007\n db: NULL\nCommand: Query\n Time: 0\n State: NULL\n Info: show processlist\n4 rows in set (0.04 sec)</pre>&#13;\n<p></p>&#13;\n<p>结果表明slave已经连接上master，开始接收并执行日志</p>&#13;\n<div>relay-log.info文件里面的内容<br />&#13;\n<pre name="code" class="sql">.\\Steven-PC-relay-bin.000002\n250\nbinlog.000005\n107\n7 </pre>&#13;\n<p>relay-log.info文件里面记录了slave端的relaylog的当前文件名和位置，还有master端的binlog文件名和位置</p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/062054036939815.jpg" alt="" /></p>&#13;\n<hr />&#13;\n<p><span style="color:#ff9900"><strong>Windows环境下主从复制测试</strong></span></p>&#13;\n<p>1、在master端的mysql环境下，执行下面命令</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">use test;\ncreate table rep_test(data integer);\n\ninsert into rep_test values(2);</pre>&#13;\n<p></p>&#13;\n</div>&#13;\n<div>2、在slave端的mysql环境下，查看主机刚才添加的表和数据是否成功同步到从机上<br />&#13;\n<pre name="code" class="sql">use test;\n\nshow tables;\n\nselect csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-331.html csdn-332.html csdn-333.html csdn-334.html csdn-335.html csdn-336.html csdn-337.html csdn-338.html csdn-339.html csdn-33.html csdn-340.html csdn-341.html csdn-342.html csdn-343.html csdn-344.html csdn-345.html csdn-346.html csdn-347.html csdn-348.html csdn-349.html csdn-34.html csdn-350.html csdn-351.html csdn-352.html csdn-353.html csdn-354.html csdn-355.html csdn-356.html csdn-357.html csdn-358.html csdn-359.html csdn-35.html csdn-360.html csdn-361.html csdn-362.html csdn-363.html csdn-364.html csdn-365.html csdn-366.html csdn-367.html csdn-36.html csdn-37.html csdn-38.html csdn-39.html csdn-3.html csdn-40.html csdn-41.html csdn-42.html csdn-43.html csdn-44.html csdn-45.html csdn-46.html csdn-47.html csdn-48.html csdn-49.html csdn-4.html csdn-50.html csdn-51.html csdn-52.html csdn-53.html csdn-54.html csdn-55.html csdn-56.html csdn-57.html csdn-58.html csdn-59.html csdn-5.html csdn-60.html csdn-61.html csdn-62.html csdn-63.html csdn-64.html csdn-65.html csdn-66.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh FROM REP_TEST;</pre></div>&#13;\n<div>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/062048205066002.jpg" alt="" /></p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/062051046931997.jpg" alt="" /></p>&#13;\n<p>测试表明，数据已经成功地同步到slave上，实验中只是用到了主从同步，在实际生产环境中MYSQL架构可能会用到一主多从的架构</p>&#13;\n<hr />&#13;\n<p><span style="color:#ff9900"><strong>MYSQL主要复制启动选项</strong></span></p>&#13;\n<p>（1）log-slave-updates</p>&#13;\n<p>log-slave-updates这个参数主要用来配置从服务器的更新是否写入二进制日志，该选项默认是不打开的，如果这个</p>&#13;\n<p>从服务器同时也作为其他服务器的主服务器，搭建一个链式的复制，那么就需要开启这个选项，这样从服务器才能获取他</p>&#13;\n<p>的二进制日志进行同步操作</p>&#13;\n<p>（2）master-connect-retry</p>&#13;\n<p>master-connect-retry这个参数用来设置和主服务器连接丢失的时候进行重试的时间间隔，默认是60秒</p>&#13;\n<p>（3）read-only</p>&#13;\n<p>read-only是用来限制普通用户对从数据库的更新操作，以确保从数据库的安全性，不过如果是超级用户依然可以对</p>&#13;\n<p>从数据库进行更新操作。如果主数据库创建了一个普通用户，在默认情况下，该用户是可以更新从数据库的数据的，如果</p>&#13;\n<p>使用read-only选项启动从数据库以后，用户对从数据库进行更新时会提示错误</p>&#13;\n<p>在Linux下启动mysql例子<span style="color:#808080"> <br />&#13;\n</span></p>&#13;\n<p><span style="color:#808080"></span></p>&#13;\n<pre name="code" class="sql">[root@localhost~]#mysqld_safe -read-only</pre>&#13;\n<p></p>&#13;\n<p>（4）slave-skip-errors</p>&#13;\n<p>在复制过程中，从服务器可以会执行BINLOG中的错误SQL语句，此时如果不忽略错误，从服务器会停止复制进程，等待用户处理错误。</p>&#13;\n<p>这种错误如果不能及时发现，将会对应用或者备份产生影响。slave-skip-errors的作用就是用来定义复制过程中从服务器可以自动</p>&#13;\n<p>跳过的错误号，设置该参数后，mysql会自动跳过所配置的一系列错误，直接执行后面的SQL语句，该参数可以定义多个错误号，如果</p>&#13;\n<p>设置成all，则表示跳过所有的错误，在my.ini或者my.cnf里配置如下</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">slave-skip-errors=1007,1051,1062</pre>&#13;\n<p></p>&#13;\n<p>如果从数据库主要作为主库的备份，那么就不应该使用这个启动参数，因为一旦设置不当很可能造成主从库的数据不同步。</p>&#13;\n<p>如果从库仅仅是为了分担主库的查询压力，并且对数据的完整性要求不高，那么这个选项可以减轻DBA维护从库的工作量</p>&#13;\n<hr />&#13;\n<p><span style="color:#ff9900"><strong>查看slave的复制进度</strong></span></p>&#13;\n<p>很多情况下，用户都想知道从服务器复制的进度，从而判断从服务器上复制数据的完整性，同时判断是否需要手工来做</p>&#13;\n<p>主从同步工作。</p>&#13;\n<p>事实上，用户可以通过show processlist列表中的Slave_SQL_Running线程的Time值得到，他记录了从服务器当前执行的SQL时间戳</p>&#13;\n<p>和系统时间之间的差距，例如下面的例子</p>&#13;\n<p></p>&#13;\n<pre name="code" class="delphi"> Id: 6\n User: system user\n Host:\n db: NULL\nCommand: Connect\n Time: 2769\n State: Slave has read all relay log; waiting for the slave I/O thread to update it\n Info: NULL</pre>&#13;\n<p></p>&#13;\n<div>&#13;\n<p>Time时间说明从服务器最后执行的更新操作大概是主服务器<span style="color:#ff0000"><strong>2769秒</strong></span>前的更新操作</p>&#13;\n<hr />&#13;\n<p><span style="color:#ff9900"><strong>日常管理和维护</strong></span></p>&#13;\n</div>&#13;\n<p>复制配置完成后，DBA需要进行日常的监控和管理维护工作，以便能够及时发现问题和解决问题</p>&#13;\n<p>以保证主从数据库能够正常工作。</p>&#13;\n<p>1、了解服务器的状态</p>&#13;\n<p>一般使用show slave status命令来检查从服务器</p>&#13;\n<p>在查看服务器信息中，首先要查看下面的两个进程是否为YES。</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">Slave_IO_Running: Yes\nSlave_SQL_Running: Yes</pre>&#13;\n<p></p>&#13;\n</div>&#13;\n<p>Slave_IO_Running表明此进程是否能够由从服务器到主服务器上正确地读取binlog日志，并写入到从服务器的中继日志中</p>&#13;\n<p>Slave_SQL_Running表明此进程能否读取并执行中继日志中的binlog信息</p>&#13;\n<p>2、服务器复制出错原因</p>&#13;\n<p>问题一：出现“log event entry exceeded max_allowed_pack”错误</p>&#13;\n<p>如果在应用中使用大的BLOB列或CLOB列或者长字符串，那么在从服务器上回复时，可能会出现</p>&#13;\n<p>“log event entry exceeded max_allowed_pack”的错误，这是因为含有达文本的记录无法通过网络进行传输而导致的</p>&#13;\n<p>解决方法是在主服务器和从服务器上添加max_allowed_packet参数，该参数默认设置为1MB</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">show variables LIKE '%max_all%'\n\nVariable_name Value \n------------------ ------- \nmax_allowed_packet 1048576 \n\n(1 row(s) affected)\n\nset @@global.max_allowed_packet=16777216;</pre>&#13;\n<p></p>&#13;\n<p>同时在my.ini或my.cnf文件里设置max_allowed_packet=16M，数据库重启之后该参数将有效</p>&#13;\n<p>问题二：多主复制时的自增长变量冲突问题</p>&#13;\n<p>大多数情况下使用一台主服务器对一台或者多台从服务器，但是在某些情况下可能会存在多个服务器配置为复制主服务器，</p>&#13;\n<p>使用auto_increment时应采取特殊步骤以防止键值冲突，否则插入时多个主服务器会试图使用相同的<span style="line-height:1.5">auto_increment值</span></p>&#13;\n<p><span style="line-height:1.5">服务器变量</span><span style="line-height:1.5">auto_increment_</span><span style="line-height:1.5">increment和</span><span style="line-height:1.5">auto_increment_offset可以协调多主服务器复制</span><span style="line-height:1.5">auto_increment列</span></p>&#13;\n<p><span style="line-height:1.5">在多主服务器复制到从服务器的过程中会发生主键冲突问题，可以将不同的主服务器的这两个参数重新进行设置，将A库</span></p>&#13;\n<p><span style="line-height:1.5">上设置</span><span style="line-height:1.5">auto_increment_</span><span style="line-height:1.5">increment=1，</span><span style="line-height:1.5">auto_increment_offset=1，此时B库上设置</span></p>&#13;\n<p><span style="line-height:1.5">auto_increment_</span><span style="line-height:1.5">increment=1，</span><span style="line-height:1.5">auto_increment_offset=0</span></p>&#13;\n<p><span style="color:#ff0000"><strong><span style="line-height:1.5">提示：一般不建议使用双主或多主，因为这样会带来意想不到的冲突状况，就像SQLSERVER的对等复制，虽然有很多冲突检测措施</span></strong></span></p>&#13;\n<p><span style="color:#ff0000"><strong><span style="line-height:1.5">但是有时候冲突是不可预料的，出现冲突DBA要排查，维护成本较高，我们生产环境里是没有使用双主和多主，主要使用的是一主多从或一主一从</span></strong></span></p>&#13;\n<hr />&#13;\n<p><span style="color:#ff9900"><strong><span style="line-height:1.5">切换主从服务器</span></strong></span></p>&#13;\n<p><span style="line-height:1.5">在实际生产环境，如果主机上的主库发生故障，需要将从机上的从库切换成主库，同时需要修改服务器C的配置文件，使程序连接到从机</span></p>&#13;\n<p><span style="line-height:1.5">下面介绍主从切换的步骤</span></p>&#13;\n<p><span style="line-height:1.5">1、首先要确保所有的从库都已经执行了relay log中的全部更新，看从库的状态是否是Has read all relay log，是否更新都已经执行完成</span></p>&#13;\n<p>在从库上执行下面命令</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">STOP SLAVE IO_THREAD;\n\nCommand(s) completed successfully.\n\nmysql&gt; show processlist \\G\n*************************** 1. row ***************************\n Id: 4\n User: root\n Host: localhost:60968\n db: test\nCommand: Sleep\n Time: 45\n State:\n Info: NULL\n*************************** 2. row ***************************\n Id: 6\n User: system user\n Host:\n db: NULL\nCommand: Connect\n Time: 3949\n State: Slave has read all relay log; waiting for the slave I/O thread to update it\n Info: NULL\n*************************** 3. row ***************************\n Id: 7\n User: root\n Host: localhost:61007\n db: NULL\nCommand: Query\n Time: 0\n State: NULL\n Info: show processlist\n3 rows in set (0.00 sec)</pre>&#13;\n<p></p>&#13;\n<p>2、在从库上停止slave服务，然后执行reset master重置成为主库<span style="color:#000000"><br />&#13;\n</span></p>&#13;\n<p><span style="color:#000000"></span></p>&#13;\n<pre name="code" class="sql">STOP SLAVE;\n\nCommand(s) completed successfully.\n\nRESET MASTER;\nCommand(s) completed successfully.</pre>&#13;\n<p></p>&#13;\n<p>注意：如果从库上并未开binlog，那么在执行reset master的时候会报错：ERROR 1186(HY000):BINLOG CLOSED ,CANNOT RESET MASTER</p>&#13;\n<p>在切换之后，在从库的数据目录会多出master.info文件</p>&#13;\n<p>master.info文件里的内容</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">18\nbinlog.000005\n393\n192.168.1.100\nrepl\n123\n3306\n60\n0\n\n0\n1800.000\n\n0\n0</pre>&#13;\n<p></p>&#13;\n<p>基本上记录了主库的复制用户、密码和binlog文件名和位置等</p>&#13;\n<p>3、在从库B（192.168.1.102）上添加具有replication权限的用户repl，查询主库状态，命令如下</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">GRANT REPLICATION SLAVE ON *.*TO 'repl'@'localhost' identified by '123';\n\nshow master status;</pre>&#13;\n<p></p>&#13;\n<p> <img src="http://images.cnitblog.com/i/257159/201408/062232214123501.jpg" alt="" /></p>&#13;\n<p>4、修改主服务器的my.ini文件里的server-id为1，从服务器的server-id为2</p>&#13;\n<p>5、在原来的主库（192.168.1.100）上配置复制参数</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">change master TO\nmaster_host='192.168.1.102',\nmaster_user='repl',\nmaster_password='123',\nmaster_port=3306,\nmaster_log_file='on.000004',\nmaster_log_pos=107;</pre>&#13;\n<p></p>&#13;\n<p>6、在从库（192.168.1.100）上执行show slave status命令查看从库是否启动成功</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">START SLAVE;\n\nmysql&gt; show slave status \\G;\n*************************** 1. row ***************************\n Slave_IO_State: Waiting for master to send event\n Master_Host: 192.168.1.102\n Master_User: repl\n Master_Port: 3306\n Connect_Retry: 60\n Master_Log_File: on.000004\n Read_Master_Log_Pos: 107\n Relay_Log_File: joe-relay-bin.000006\n Relay_Log_Pos: 246\n Relay_Master_Log_File: on.000004\n Slave_IO_Running: Yes\n Slave_SQL_Running: Yes\n Replicate_Do_DB:\n Replicate_Ignore_DB:\n Replicate_Do_Table:\n Replicate_Ignore_Table:\n Replicate_Wild_Do_Table:\n Replicate_Wild_Ignore_Table:\n Last_Errno: 0\n Last_Error:\n Skip_Counter: 0\n Exec_Master_Log_Pos: 107\n Relay_Log_Space: 436\n Until_Condition: None\n Until_Log_File:\n Until_Log_Pos: 0\n Master_SSL_Allowed: No\n Master_SSL_CA_File:\n Master_SSL_CA_Path:\n Master_SSL_Cert:\n Master_SSL_Cipher:\n Master_SSL_Key:\n Seconds_Behind_Master: 0\nMaster_SSL_Verify_Server_Cert: No\n Last_IO_Errno: 0\n Last_IO_Error:\n Last_SQL_Errno: 0\n Last_SQL_Error:\n Replicate_Ignore_Server_Ids:\n Master_Server_Id: 1\n1 row in set (0.00 sec)\n\nERROR:\nNo query specified</pre>&#13;\n<p></p>&#13;\n<p>注意：如果在主库上面（192.168.1.102）的复制用户repl没有允许远程主机从库的访问，那么在执行show slave status的时候就会报错</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql"> Last_IO_Errno: 1130\n Last_IO_Error: error connecting to master 'repl@192.168.1.102:3360 retries: 8640006' - retry-time: 60 retries: 86400 </pre>&#13;\n<p></p>&#13;\n<div>&#13;\n<p>这时候，只需要在主库（192.168.1.102）上面执行下面语句即可</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">use mysql;\nselect csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-331.html csdn-332.html csdn-333.html csdn-334.html csdn-335.html csdn-336.html csdn-337.html csdn-338.html csdn-339.html csdn-33.html csdn-340.html csdn-341.html csdn-342.html csdn-343.html csdn-344.html csdn-345.html csdn-346.html csdn-347.html csdn-348.html csdn-349.html csdn-34.html csdn-350.html csdn-351.html csdn-352.html csdn-353.html csdn-354.html csdn-355.html csdn-356.html csdn-357.html csdn-358.html csdn-359.html csdn-35.html csdn-360.html csdn-361.html csdn-362.html csdn-363.html csdn-364.html csdn-365.html csdn-366.html csdn-367.html csdn-36.html csdn-37.html csdn-38.html csdn-39.html csdn-3.html csdn-40.html csdn-41.html csdn-42.html csdn-43.html csdn-44.html csdn-45.html csdn-46.html csdn-47.html csdn-48.html csdn-49.html csdn-4.html csdn-50.html csdn-51.html csdn-52.html csdn-53.html csdn-54.html csdn-55.html csdn-56.html csdn-57.html csdn-58.html csdn-59.html csdn-5.html csdn-60.html csdn-61.html csdn-62.html csdn-63.html csdn-64.html csdn-65.html csdn-66.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh from user where user='repl';\nupdate user set host = '%' where user ='repl';\nflush privileges;</pre>&#13;\n<p></p>&#13;\n<p>7、在主库和从库上面是否成功设置复制功能，首先在主库（192.168.1.102）上查看test库中的表</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">use test;\nshow tables;</pre>&#13;\n<p></p>&#13;\n<p> <img src="http://images.cnitblog.com/i/257159/201408/062244166479376.jpg" alt="" /></p>&#13;\n<p>查询从库中（192.168.1.100）test库里表的情况</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">use test;\nshow tables;</pre>&#13;\n<p></p>&#13;\n<p> <img src="http://images.cnitblog.com/i/257159/201408/062244166479376.jpg" alt="" /></p>&#13;\n<p>跟主库一样</p>&#13;\n<p>8、在主库（192.168.1.102）中增加表rep_t ，并插入数据</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">create table rep_t(data int);\n\ninsert into rep_t values(1);</pre>&#13;\n<p></p>&#13;\n</div>&#13;\n<p> 9、在从库（192.168.1.100）上查询表是否已经创建并复制数据到从库中</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">USE test;\n\nshow variables like '%server%';\n\nshow tables;\n\nSELECT csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-331.html csdn-332.html csdn-333.html csdn-334.html csdn-335.html csdn-336.html csdn-337.html csdn-338.html csdn-339.html csdn-33.html csdn-340.html csdn-341.html csdn-342.html csdn-343.html csdn-344.html csdn-345.html csdn-346.html csdn-347.html csdn-348.html csdn-349.html csdn-34.html csdn-350.html csdn-351.html csdn-352.html csdn-353.html csdn-354.html csdn-355.html csdn-356.html csdn-357.html csdn-358.html csdn-359.html csdn-35.html csdn-360.html csdn-361.html csdn-362.html csdn-363.html csdn-364.html csdn-365.html csdn-366.html csdn-367.html csdn-36.html csdn-37.html csdn-38.html csdn-39.html csdn-3.html csdn-40.html csdn-41.html csdn-42.html csdn-43.html csdn-44.html csdn-45.html csdn-46.html csdn-47.html csdn-48.html csdn-49.html csdn-4.html csdn-50.html csdn-51.html csdn-52.html csdn-53.html csdn-54.html csdn-55.html csdn-56.html csdn-57.html csdn-58.html csdn-59.html csdn-5.html csdn-60.html csdn-61.html csdn-62.html csdn-63.html csdn-64.html csdn-65.html csdn-66.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh FROM rep_t;</pre>&#13;\n<p></p>&#13;\n<p><img src="http://images.cnitblog.com/i/257159/201408/062253054122684.jpg" alt="" /></p>&#13;\n<p>至此，主从库成功切换</p>&#13;\n<hr />&#13;\n<p><span style="color:#ff9900"><strong>如果主机和从机server-id一样如何解决</strong></span></p>&#13;\n<p>通常情况下，master和slave的server-id是不会一样的，如果一样的话会出现报错</p>&#13;\n<p>出现这种情况，用户可以使用如下命令来查看服务器的server-id，然后手动进行修改，如下所示</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">show variables like '%server_id%';\n\nVariable_name Value \n------------- ----- \nserver_id 2 \n\n(1 row(s) affected)\n\nSET global server_id=1</pre>&#13;\n<p></p>&#13;\n<p>修改完成后，执行slave start命令，查询slave主机的状态，查看问题可否解决</p>&#13;\n<hr />&#13;\n<p><span style="color:#ff9900"><strong>从机状态显示Last_IO_Error错误代码为2013的原因</strong></span></p>&#13;\n<p>有时候会遇到这样的情况，在执行show slave status \\G 命令中 Slave_IO_Running和Slave_SQL_Running的值都是YES</p>&#13;\n<p>但是Last_IO_Error发生2013错误</p>&#13;\n<p>发生这种问题主要原因是网络问题，首先要检查下master主机创建的用户是否授予远程连接的权限</p>&#13;\n<p></p>&#13;\n<pre name="code" class="sql">GRANT replication slave ON *.*TO repl@'%' IDENTIFIED BY '123';</pre>&#13;\n<p></p>&#13;\n<p>这里%表示任何的repl用户都可以访问master主机，另外需要查看是否有防火墙设置和网络的其他故障</p>&#13;\n<hr />&#13;\n<p><span style="color:#ff9900"><strong>MYSQL复制不同步的原因</strong></span></p>&#13;\n<p>mysql replication（复制）采用binlog进行网络传输，所以网络延时是产生mysql主从不同步的主要原因，这会给我们进行读写分离带来</p>&#13;\n<p>一定困难为了避免这种情况，在配置服务器的时候推荐使用INNODB存储引擎的表，在主机上可以设置<span style="color:#ff0000"><strong>sync_binlog</strong></span></p>&#13;\n<p>下面内容摘抄自《MYSQL行调优和架构设计》</p>&#13;\n<blockquote>&#13;\n<p>“sync_binlog”：这个参数是对于 MySQL 系统来说是至关重要的，他不仅影响到 Binlog 对 MySQL 所</p>&#13;\n<p>带来的性能损耗，而且还影响到 MySQL 中数据的完整性。对于“sync_binlog”参数的各种设置的说明如</p>&#13;\n<p>下：</p>&#13;\n<p>● sync_binlog=0，当事务提交之后，MySQL 不做 fsync 之类的磁盘同步指令刷新 binlog_cache 中</p>&#13;\n<p>的信息到磁盘，而让 Filesystem 自行决定什么时候来做同步，或者 cache 满了之后才同步到磁</p>&#13;\n<p>盘。</p>&#13;\n<p>● sync_binlog=n，当每进行 n 次事务提交之后，MySQL 将进行一次 fsync 之类的磁盘同步指令来</p>&#13;\n<p>将 binlog_cache 中的数据强制写入磁盘。</p>&#13;\n<p>在 MySQL 中系统默认的设置是 sync_binlog=0，也就是不做任何强制性的磁盘刷新指令，这时候的性</p>&#13;\n<p>能是最好的，但是风险也是最大的。因为一旦系统 Crash，在 binlog_cache 中的所有 binlog 信息都会被</p>&#13;\n<p>丢失。而当设置为“1”的时候，是最安全但是性能损耗最大的设置。因为当设置为 1 的时候，即使系统</p>&#13;\n<p>Crash，也最多丢失 binlog_cache 中未完成的一个事务，对实际数据没有任何实质性影响。从以往经验</p>&#13;\n<p>和相关测试来看，对于高并发事务的系统来说，“sync_binlog”设置为 0 和设置为 1 的系统写入性能差</p>&#13;\n<p>距可能高达 5 倍甚至更多。</p>&#13;\n</blockquote>&#13;\n<p>如果master主机上的max_allowed_packet比较大，但是从机上没有配置该值的话，该参数还是使用默认值1MB</p>&#13;\n<p>此时很有可能导致同步失败，建议主从两台机器都设为5MB比较合适</p>&#13;\n &#13;\n
