\n\n<p><a target="_blank" href="http://blog.csdn.net/l1028386804/article/details/52761940">转载请注明出处：http://blog.csdn.net/l1028386804/article/details/52761940</a><br />&#13;\n</p>&#13;\n<h3>一、Replication容量</h3>&#13;\n<p>将Replication暂停一段时间(M),再重新开启,并观察Slave多久可以达到与Master一致(N)。<br />&#13;\nReplication容量=N:M<br />&#13;\n建议保持容量在3倍以上，即1:3</p>&#13;\n<h3>二、排除Replication故障</h3>&#13;\n<h4>1、日志错误</h4>&#13;\n<p>1)大多数replication错误都是因为日志错误引起的。<br />&#13;\n2)主日志和中继日志都可能会错，辨别的方法：</p>&#13;\n<p></p>&#13;\n<pre code_snippet_id="1918459" snippet_file_name="blog_20161009_1_8081868" name="code" class="plain">#mysqlbinlog MASTER_BINLOG_FILE &gt; /dev/null\n#mysqlbinlog SLAVE_BINLOG_FILE &gt; /dev/null</pre>&#13;\n<p></p>&#13;\n<h4>2、跳过日志错误</h4>&#13;\n<p>1)很多问题都可能导致日志错误。有时候也可能日志本身没有错误，SQL解析时出错了(例如主从数据本来就不一致)。可以手动跳过日志错误，不过这样做可能造成主从数据不一致。<br />&#13;\n2)如果是主日志错误，可以在Slave上执行(如果有多个错误可能要执行多次)。</p>&#13;\n<p></p>&#13;\n<pre code_snippet_id="1918459" snippet_file_name="blog_20161009_2_4079897" name="code" class="sql">mysql&gt; stop slave;\nmysql&gt; set global sql_slave_skip_counter=1;\nmysql&gt; start slave;</pre>3)如果是中继日志出错，可以在Slave上通过show slave status \\G命令查看Replication状态，根据日志信息跳过出错的日志：<br />&#13;\n<pre code_snippet_id="1918459" snippet_file_name="blog_20161009_3_1713346" name="code" class="sql">mysql&gt; stop slave;\nmysql&gt; charge master to\n\t-&gt; master_log_file='&lt;Relay_Master_Log_file&gt;',\n\t-&gt; master_log_pos=&lt;Exec_Master_Log_Pos&gt;;\nmysql&gt; start slave;</pre>4)如果Replcation工作在GTIDs模式下,则需要<br />&#13;\n<pre code_snippet_id="1918459" snippet_file_name="blog_20161009_4_5443100" name="code" class="sql">mysql&gt; stop slave;\nmysql&gt; set gtid_next='uuid:nexti_d';\nmysql&gt; begin;\nmysql&gt; commit;\nmysql&gt; set gtid_next='automatic';\nmysql&gt; start slave;</pre>注：uuid:nextid例如:'0470a4fd-93d1-11e3-86bf-4ec905bea80f:17'。<br />&#13;\n<p></p>&#13;\n<h3>三、多线程方式传输二进制日志</h3>&#13;\n<p>1、MySQL5.6开始支持多线程方式传输二进制日志。<br />&#13;\n2、只能工作在GTIDs模式下。<br />&#13;\n3、只有对不同的库执行的操作才能采用多线程传输。同一个库下不同表的操作仍只能用单线程传输。<br />&#13;\n</p>&#13;\n<p></p>&#13;\n<pre code_snippet_id="1918459" snippet_file_name="blog_20161009_5_6664599" name="code" class="plain">#vi /etc/my.cnf\n[mysqld]\nslave_parallel-workers=N (默认值为0,不开启)</pre>其他命令：<br />&#13;\n<pre code_snippet_id="1918459" snippet_file_name="blog_20161009_6_8758150" name="code" class="sql">mysql&gt; set sql_log_bin=OFF; (关闭二进制日志)\nmysql&gt; set sql_log_bin=ON; (开启二进制日志)</pre><br />&#13;\n<br />&#13;\n<p></p>&#13;\n &#13;\n
