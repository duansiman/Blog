\n\n<address><span style="font-style:normal">归根到底，MySQL是运行在操作系统上的一个软件，它需要借助于文件系统存储数据，本文主要介绍MySQL数据目录的组织架构。</span></address>&#13;\n<address><br />&#13;\n</address>&#13;\n<h3>数据目录的位置</h3>&#13;\n<div>可以通过以下几个方法查看MySQL数据目录的位置：</div>&#13;\n<div>1）对于一个正在运行的MySQL服务器来说，可以通过查看mysqld的进程获取MySQL数据目录的位置，如下所示：</div>&#13;\n<div><pre code_snippet_id="174443" snippet_file_name="blog_20140129_1_5438078" name="code" class="plain">[root@lx202 /data/mysql/data ]# ps -ef|grep mysqld\nroot 5841 7337 0 15:09 pts/1 00:00:00 grep --color=auto mysqld\nroot 27034 1 0 2012 ? 00:00:00 /bin/sh /opt/mysql/bin/mysqld_safe --datadir=/data/mysql/data --pid-file=/data/mysql/data/lx202.pid\nmysql 27889 27034 30 2012 ? 111-03:03:55 /opt/mysql/bin/mysqld --basedir=/opt/mysql --datadir=/data/mysql/data --plugin-dir=/opt/mysql/lib/mysql/plugin --user=mysql --log-error=/data/mysql/log/alert.log --open-files-limit=65535 --pid-file=/data/mysql/data/lx202.pid --socket=/opt/mysql/run/mysql.sock --port=3306</pre>其中的--datadir指定的就是数据目录的位置。</div>&#13;\n<div>2）查看my.cnf的配置信息：</div>&#13;\n<div><pre code_snippet_id="174443" snippet_file_name="blog_20140129_2_8076846" name="code" class="plain">[mysqld]\ndatadir = /data/mysql/data</pre>3）登陆数据库，运行show variables命令查看：</div>&#13;\n<div><pre code_snippet_id="174443" snippet_file_name="blog_20140129_3_4728776" name="code" class="sql">mysql&gt; show variables like 'datadir';\n+---------------+-------------------+\n| Variable_name | Value |\n+---------------+-------------------+\n| datadir | /data/mysql/data/ | \n+---------------+-------------------+\n1 row in set (0.00 sec)</pre>&#13;\n<div><br />&#13;\n</div>&#13;\n<h3>数据库在文件系统的表示方法</h3>&#13;\n</div>&#13;\n<div>MySQL里，每个数据库都对应一个数据目录里的一个字目录，当你用create database db_name语句创建一个数据库时，将在数据目录下创建一个同名的子目录，在该子目录下，有一个db.opt文件，用于记录数据库默认的字符集和排序方式，如下所示：</div>&#13;\n<div><pre code_snippet_id="174443" snippet_file_name="blog_20140129_4_8349063" name="code" class="plain">[root@lx202 /data/mysql/data/portal ]# cat db.opt\ndefault-character-set=utf8\ndefault-collation=utf8_general_ci</pre><br />&#13;\n<h3>表在文件系统的表示方式</h3>&#13;\n</div>&#13;\n<div>因为MySQL支持多个存储引擎，所以表在文件系统的表示方式根据存储引擎的不同而不同。但无论哪种存储引擎，每个表至少对应一个同名的.frm文件，该文件用于描述表结构信息。除了.frm文件之外，各个存储引擎用于存储数据的文件各不相同，下面我们介绍几种常见的存储引擎：</div>&#13;\n<div><br />&#13;\n</div>&#13;\n<div><strong>MyISAM</strong></div>&#13;\n<div>- table_name.MYD：数据文件</div>&#13;\n<div>- table_name.MYI：索引文件</div>&#13;\n<div><strong>MERGE</strong></div>&#13;\n<div>- table_name.MRG：文本文件</div>&#13;\n<div><strong>InnoDB</strong></div>&#13;\n<div>InnoDB表的存储是基于表空间的，有两种类型的表空间：</div>&#13;\n<div>1）共享表空间：由数据目录里的一个或多个大文件构成，这些文件共同组成了一个在逻辑上连续不断的存储区域，共享表空间是通过参数innodb_data_file_path设置的，如下所示：</div>&#13;\n<div><pre code_snippet_id="174443" snippet_file_name="blog_20140129_5_889555" name="code" class="plain">innodb_data_file_path = ibdata1:10G;ibdata2:5G:autoextend</pre>根据上面的配置，将在数据目录下创建两个文件ibdata1和ibdata2来存放innodb的数据。</div>&#13;\n<div>2）独占表空间：当设置innodb_file_per_table = 1后，每个表对对应一个单独使用的表空间文件.ibd（在其对应的数据库目录下）</div>&#13;\n<div>这里需要注意的是：即使你配置了独占表空间，共享表空间也是需要的，因为InnoDB的数据字典必须存放在共享表空间里。</div>&#13;\n<div><br />&#13;\n</div>&#13;\n<h3>视图和触发器在文件系统的表示方式</h3>&#13;\n<div>每个视图包含一个.frm文件，它包含该视图的定义和属性等。</div>&#13;\n<div>触发器保存在一个.TRG文件里，里面包含着它的定义和属性，但文件不是以触发器命名，而是以触发器相关联的表命名。</div>&#13;\n<div><br />&#13;\n<h3>存储过程和函数在文件系统的表示方法</h3>&#13;\n</div>&#13;\n<div>MySQL的存储过程和函数分别存放在mysql数据库目录的proc*和func*文件里，如：</div>&#13;\n<div><pre code_snippet_id="174443" snippet_file_name="blog_20140129_6_573128" name="code" class="plain">[root@lx202 /data/mysql/data/mysql ]# ls proc*\nproc.frm proc.MYD proc.MYI procs_priv.frm procs_priv.MYD procs_priv.MYI\n[root@lx202 /data/mysql/data/mysql ]# ls func*\nfunc.frm func.MYD func.MYI</pre></div>&#13;\n<div><br />&#13;\n<strong>附：数据目录的迁移方法</strong><br />&#13;\n原目录：/var/lib/mysql<br />&#13;\n新目录：/data/mysql<br />&#13;\n1）关闭MySQL<br />&#13;\n/etc/init.d/mysqld stop<br />&#13;\n2）修改/etc/my.cnf的datadir和socket指向新的目录：<br />&#13;\n<pre code_snippet_id="174443" snippet_file_name="blog_20140129_7_6668650" name="code" class="plain">datadir = /data/mysql\nsocket = /data/mysql/mysql.sock</pre>3）拷贝数据文件<br />&#13;\n<pre code_snippet_id="174443" snippet_file_name="blog_20140129_8_7988425" name="code" class="plain">mkdir -p /data/mysql\nchown mysql:mysql /data/mysql\ncp -a /var/lib/mysql/auto.cnf /var/lib/mysql/binlog.000001 /var/lib/mysql/binlog.000002 /var/lib/mysql/binlog.000003 /var/lib/mysql/binlog.000004 /var/lib/mysql/binlog.000005 /var/lib/mysql/binlog.000006 /var/lib/mysql/binlog.000007 /var/lib/mysql/binlog.000008 /var/lib/mysql/binlog.000009 /var/lib/mysql/binlog.000010 /var/lib/mysql/binlog.index /var/lib/mysql/blog /var/lib/mysql/ca-key.pem /var/lib/mysql/ca.pem /var/lib/mysql/client-cert.pem /var/lib/mysql/client-key.pem /var/lib/mysql/devin.err /var/lib/mysql/ib_buffer_pool /var/lib/mysql/ibdata1 /var/lib/mysql/ib_logfile0 /var/lib/mysql/ib_logfile1 /var/lib/mysql/ibtmp1 /var/lib/mysql/mysql /var/lib/mysql/performance_schema /var/lib/mysql/private_key.pem /var/lib/mysql/public_key.pem /var/lib/mysql/server-cert.pem /var/lib/mysql/server-key.pem /var/lib/mysql/sys /data/mysql</pre>这一步一定要注意目录和文件的权限要保持一致。<br />&#13;\n4）修改/etc/init.d/mysqld中datadir的路径<br />&#13;\n<pre code_snippet_id="174443" snippet_file_name="blog_20140129_9_1052305" name="code" class="plain">get_mysql_option mysqld datadir "/data/mysql"</pre>5）修改/usr/bin/mysqld_safe中datadir的路径<br />&#13;\n<pre code_snippet_id="174443" snippet_file_name="blog_20140129_10_6198545" name="code" class="plain">else\n DATADIR=/data/mysql\nfi</pre>6）重新启动MySQL即可<br />&#13;\n/etc/init.d/mysqld start<br />&#13;\n<br />&#13;\n<br />&#13;\n<br />&#13;\n</div>&#13;\n &#13;\n
