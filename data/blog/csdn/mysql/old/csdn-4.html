\n\n<h2 style="margin:1.33rem 0px 0.667rem; padding:0px; font-size:1.33rem; font-family:Helvetica,&quot;Hiragino Sans GB&quot;,&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;,&quot;Microsoft YaHei UI&quot;,SimSun,SimHei,arial,sans-serif; widows:1">&#13;\n<strong>获取插入数据时的自增长值</strong></h2>&#13;\n<div><strong></strong><pre code_snippet_id="2277871" snippet_file_name="blog_20170320_1_407170" name="code" class="java">package com.cn.auto_increment;\n\nimport java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\n\nimport org.junit.Test;\n\nimport com.cn.Util.JdbcUtil;\n\n/**\n csdn-1.html csdn-2.html csdn-3.html mysql.sh 向数据库插入数据，顺便返回自增长值\n csdn-1.html csdn-2.html csdn-3.html mysql.sh @author liuzhiyong\n *\n */\npublic class Demo1 {\n\n\t@Test\n\tpublic void testGetAutoIncrement() throws Exception {\n\t\tConnection conn = null;\n\t\tPreparedStatement pstmt = null;\n\t\tResultSet rs = null;\n\t\ttry {\n\t\t\t//获取连接\n\t\t\tconn = JdbcUtil.getConnection();\n\t\t\t//准备sql\n\t\t\tString sql = "insert into users(name, password) values(?,?)";\n\t\t\t//创建pstm对象，在参数中指定返回自增长列\n\t\t\tpstmt = conn.prepareStatement(sql, PreparedStatement.RETURN_GENERATED_KEYS);\n\t\t\t//设置参数\n\t\t\tpstmt.setString(1, "龚玥菲");\n\t\t\tpstmt.setString(2, "8888");\n\t\t\t//执行sql\n\t\t\tpstmt.executeUpdate();\n\t\t\t\n\t\t\t//在执行更新后，获取返回自增长结果集\n\t\t\trs = pstmt.getGeneratedKeys();\n\t\t\tif(rs.next()){\n\t\t\t\tSystem.out.println("刚刚插入数据的自增长编码是：" + rs.getInt(1));\n\t\t\t}\n\t\t} catch (Exception e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\te.printStackTrace();\n\t\t\tthrow new RuntimeException(e);\n\t\t}finally{\n\t\t\tJdbcUtil.close(conn, pstmt, rs);\n\t\t}\n\t}\n}\n</pre>&#13;\n<div><strong>JdbcUtil.java</strong></div>&#13;\n<div><strong></strong><pre code_snippet_id="2277871" snippet_file_name="blog_20170320_2_9043966" name="code" class="java">package com.cn.Util;\n\nimport java.io.FileInputStream;\nimport java.io.InputStream;\nimport java.sql.CallableStatement;\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport java.sql.Statement;\nimport java.util.Properties;\n\n/**\n csdn-1.html csdn-2.html csdn-3.html mysql.sh jdbc的工具类\n csdn-1.html csdn-2.html csdn-3.html mysql.sh @author liuzhiyong\n *\n */\npublic class JdbcUtil {\n\tprivate static String url = null;\n\tprivate static String user = null;\n\tprivate static String password = null;\n\tprivate static String driverClass = null;\n\t\n\t/**\n\t csdn-1.html csdn-2.html csdn-3.html mysql.sh 静态代码块（只调用一次）\n\t */\n\tstatic{\n\t\ttry {\n\t\t\t//读取db.properties文件\n\t\t\tProperties properties = new Properties();\n\t\t\t/**\n\t\t\t csdn-1.html csdn-2.html csdn-3.html mysql.sh \n\t\t\t csdn-1.html csdn-2.html csdn-3.html mysql.sh 加载文件\n\t\t\t csdn-1.html csdn-2.html csdn-3.html mysql.sh \n\t\t\t csdn-1.html csdn-2.html csdn-3.html mysql.sh . 代表java的命令运行的目录\n\t\t\t csdn-1.html csdn-2.html csdn-3.html mysql.sh 在java项目下， . java命令的运行目录从项目的根目录MyEclipse工作空间/bin 目录开始\n\t\t\t csdn-1.html csdn-2.html csdn-3.html mysql.sh 在web项目下， . java命令的运行目录从tomact/bin 目录开始\n\t\t\t csdn-1.html csdn-2.html csdn-3.html mysql.sh 所以不能用.\n\t\t\t */\n\t\t\t\n\t\t\t/**\n\t\t\t csdn-1.html csdn-2.html csdn-3.html mysql.sh 使用类路径的读取方式\n\t\t\t csdn-1.html csdn-2.html csdn-3.html mysql.sh \t/ 斜杠表示classpath的根目录\n\t\t\t csdn-1.html csdn-2.html csdn-3.html mysql.sh 在java项目下，classpath的根目录从bin目录开始\n\t\t\t csdn-1.html csdn-2.html csdn-3.html mysql.sh 在web项目下，classpath的根目录从WEB-INF/classes目录开始\n\t\t\t */\n\t\t\tInputStream in = JdbcUtil.class.getResourceAsStream("/db.properties");\n\t\t\tproperties.load(in);\n\t\t\t//读取信息\n\t\t\turl = properties.getProperty("url");\n\t\t\tuser = properties.getProperty("user");\n\t\t\tpassword = properties.getProperty("password");\n\t\t\tdriverClass = properties.getProperty("driverClass");\n//\t\t\tSystem.out.println(url);\n//\t\t\tSystem.out.println(user);\n//\t\t\tSystem.out.println(password);\n//\t\t\tSystem.out.println(driverClass);\n\t\t\t//注册驱动程序\n\t\t\tClass.forName(driverClass);\n\t\t} catch (Exception e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\te.printStackTrace();\n\t\t\tSystem.out.println("驱动程序注册出错！");\n\t\t}\n\t}\n\t\n\t/**\n\t csdn-1.html csdn-2.html csdn-3.html mysql.sh 获取连接对象的方法\n\t */\n\tpublic static Connection getConnection(){\n\t\t\n\t\ttry {\n\t\t\tConnection conn = DriverManager.getConnection(url, user, password);\n\t\t\treturn conn;\n\t\t} catch (SQLException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\te.printStackTrace();\n\t\t\tthrow new RuntimeException(e);\n\t\t}\n\t}\n\n\t/**\n\t csdn-1.html csdn-2.html csdn-3.html mysql.sh 释放资源的重载方法\n\t */\n\tpublic static void close(Connection conn, Statement stmt, ResultSet rs){\n\t\t\n\t\t//关闭资源（顺序：后打开，先关闭）\n\t\tif(rs != null){\n\t\t\ttry {\n\t\t\t\trs.close();\n\t\t\t} catch (SQLException e) {\n\t\t\t\tSystem.out.println("ResultSet关闭失败！");\n\t\t\t\tthrow new RuntimeException(e);\n\t\t\t}\n\t\t}if(stmt != null){\n\t\t\ttry {\n\t\t\t\tstmt.close();\n\t\t\t} catch (SQLException e) {\n\t\t\t\tSystem.out.println("Statement关闭失败！");\n\t\t\t\tthrow new RuntimeException(e);\n\t\t\t}\n\t\t}\n\t\tif(conn != null){\n\t\t\ttry {\n\t\t\t\tconn.close();\n\t\t\t} catch (SQLException e) {\n\t\t\t\tSystem.out.println("Connection关闭失败！");\n\t\t\t\tthrow new RuntimeException(e);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t csdn-1.html csdn-2.html csdn-3.html mysql.sh 释放资源的重载方法\n\t */\n\tpublic static void close(Connection conn, Statement stmt){\n\t\t\n\t\t//关闭资源（顺序：后打开，先关闭）\n\t\tif(stmt != null){\n\t\t\ttry {\n\t\t\t\tstmt.close();\n\t\t\t} catch (SQLException e) {\n\t\t\t\tSystem.out.println("Statement关闭失败！");\n\t\t\t\tthrow new RuntimeException(e);\n\t\t\t}\n\t\t}\n\t\tif(conn != null){\n\t\t\ttry {\n\t\t\t\tconn.close();\n\t\t\t} catch (SQLException e) {\n\t\t\t\tSystem.out.println("Connection关闭失败！");\n\t\t\t\tthrow new RuntimeException(e);\n\t\t\t}\n\t\t}\n\t}\n\t\n}\n</pre><br />&#13;\n<br />&#13;\n</div>&#13;\n<div><strong><br />&#13;\n</strong></div>&#13;\n<img src="http://img.blog.csdn.net/20170320165955462?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUVExMDEyNDIxMzk2/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br />&#13;\n<br />&#13;\n</div>&#13;\n<div style="margin:0px; font-family:Helvetica,&quot;Hiragino Sans GB&quot;,&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;,&quot;Microsoft YaHei UI&quot;,SimSun,SimHei,arial,sans-serif; font-size:15px; line-height:24px; widows:1">&#13;\n<div style="margin:0px; font-weight:bold">&#13;\n<div style="margin:0px"> <img src="http://img.blog.csdn.net/20170320170011331?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUVExMDEyNDIxMzk2/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></div>&#13;\n</div>&#13;\n</div>&#13;\n &#13;\n
