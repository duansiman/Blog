\n\n<h1 style="text-align:center">mysql<span style="font-family:宋体">批量删除大量数据</span></h1>&#13;\n<p>假设有一个表<span style="font-family:Times New Roman">(syslogs)</span><span style="font-family:宋体">有</span><span style="font-family:Times New Roman">1000</span><span style="font-family:宋体">万条记录，需要在业务不停止的情况下删除其中</span><span style="font-family:Times New Roman">statusid=1</span><span style="font-family:宋体">的所有记录，差不多有</span><span style="font-family:Times New Roman">600</span><span style="font-family:宋体">万条， 直接执行 </span><span style="font-family:Times New Roman">DELETE FROM syslogs WHERE statusid=1 </span><span style="font-family:宋体">会发现删除失败，因为</span><span style="font-family:Times New Roman">lock wait timeout exceed</span><span style="font-family:宋体">的错误。</span></p>&#13;\n<p>因为这条语句所涉及的记录数太多，因此我们通过<span style="font-family:Times New Roman">LIMIT</span><span style="font-family:宋体">参数分批删除，比如每</span><span style="font-family:Times New Roman">10000</span><span style="font-family:宋体">条进行一次删除，那么我们可以利用 </span><span style="font-family:Times New Roman">MySQL</span><span style="font-family:宋体">这样的语句来完成</span>:</p>&#13;\n<p><span style="color:rgb(0,0,255)"> DELETE FROM syslogs WHERE status=1 ORDER BY statusid LIMIT 10000;</span></p>&#13;\n<p>然后分多次执行就可以把这些记录成功删除。</p>&#13;\n<h2>注：</h2>&#13;\n<p>执行大批量删除的时候注意要使用上<span style="font-family:Times New Roman">limit</span><span style="font-family:宋体">。因为如果不用</span><span style="font-family:Times New Roman">limit</span><span style="font-family:宋体">，删除大量数据很有可能造成死锁。</span></p>&#13;\n<p>如果<span style="font-family:Times New Roman">delete</span><span style="font-family:宋体">的</span><span style="font-family:Times New Roman">where</span><span style="font-family:宋体">语句不在索引上，可以先找主键，然后根据主键删除数据库。</span></p>&#13;\n<p>平时<span style="font-family:Times New Roman">update</span><span style="font-family:宋体">和</span><span style="font-family:Times New Roman">delete</span><span style="font-family:宋体">的时候最好也加上</span><span style="font-family:Times New Roman">limit 1 </span><span style="font-family:宋体">来防止误操作。</span></p>&#13;\n &#13;\n
