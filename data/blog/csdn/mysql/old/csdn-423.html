\n <div class="markdown_views"><p>除了bin log, 其余日志都是文本文件</p>\n\n<p>默认情况只启用错误日志err log, 其他3类日志都需要数据库管理员进行设置</p>\n\n<blockquote>\n <p>如果MySQL数据库系统意外停止服务, 可以通过错误日志查看出现错误的原因. 并且, 可以通过bin log文件来查看用户执行了哪些操作 <br />\n , 对数据库文件做了哪些修改. 然后, 可以根据bin log中的记录来修复数据库</p>\n \n <p>但是, 启动log功能会降低MySQL数据库的执行速度. 例如, 一个查询操作比较频繁的MySQL中, 记录通用查询日志和慢查询日志要花费 <br />\n 很多的时间. 并且, log文件会占用大量的硬盘空间. 对于用户量非常大, 操作非常频繁的数据库, 日志文件需要的存储空间甚至比数 <br />\n 据库文件需要的存储空间还要大.</p>\n</blockquote>\n\n\n\n<h3 id="二进制日志bin-log">二进制日志(bin log)</h3>\n\n<p>也叫update log, 主要用于记录数据库的变化情况. 通过bin log可以查询MySQL数据库进行了哪些改变.</p>\n\n\n\n<h5 id="启动和设置bin-log">启动和设置bin log</h5>\n\n\n\n<pre class="prettyprint"><code class="language-bash hljs "><span class="hljs-comment"># my.cnf</span>\n[mysqld]\nlog-bin [=DIR \\ [filename]]\n\nDIR: 指定bin log的存储路径\nfilename: 指定bin log的文件名, 其形式为filename.number, 例如filename.<span class="hljs-number">000001</span>, filename.<span class="hljs-number">000002</span>等. 每次重启MySQL服务, 都会\n生成一个新的bin log文件. 这些bin log文件的<span class="hljs-string">'number'</span>会不断递增. 除了生成上述文件外, 还会生成一个名为filename.index的文件.\n这个文件中存储所有bin log文件的清单.\n\n如果没有指定DIR, filename, bin log将默认存储在数据库的数据目录下, 默认的文件名为hostname-bin.number, 其中hostname为主机\n名.</code></pre>\n\n<p>bin log与数据库的数据文件最好不要放在同一块硬盘上. 即使数据文件所在的硬盘被破坏, 也可以使用另一块硬盘上的bin log来回复数 <br />\n据文件. 两块硬盘同时坏了的可能性要小得多. 这样可以保证数据库中数据的安全.</p>\n\n\n\n<h5 id="查看bin-log">查看bin log</h5>\n\n<p><code>mysqlbinlog filename.number</code></p>\n\n\n\n<h5 id="使用bin-log来还原数据库">使用bin log来还原数据库</h5>\n\n<p><code>mysqlbinlog filename.number | mysql -u root -p</code></p>\n\n<p>注意, 编号(number)小的文件开始还原</p>\n\n\n\n<pre class="prettyprint"><code class="language-bash hljs ">mysqlbinlog mylog.<span class="hljs-number">00001</span> | mysql -u root -p\nmysqlbinlog mylog.<span class="hljs-number">00002</span> | mysql -u root -p\nmysqlbinlog mylog.<span class="hljs-number">00003</span> | mysql -u root -p\nmysqlbinlog mylog.<span class="hljs-number">00004</span> | mysql -u root -p</code></pre>\n\n\n\n<h5 id="暂停和重启bin-log功能">暂停和重启bin log功能</h5>\n\n\n\n<pre class="prettyprint"><code class="language-bash hljs ">SET SQL_LOG_BIN=<span class="hljs-number">0</span>; <span class="hljs-comment"># 暂停</span>\nSET SQL_LOG_BIN=<span class="hljs-number">1</span>; <span class="hljs-comment"># 重新启用</span></code></pre>\n\n\n\n<h3 id="错误日志error-log">错误日志(error log)</h3>\n\n<p>err log是默认开启的, 并且无法被禁止. 默认存储路径为数据库的数据文件夹. 文件名通常为hostname.err.</p>\n\n<p>存储路径可以通过 <code>log-error</code>选项来设置</p>\n\n\n\n<pre class="prettyprint"><code class="language-bash hljs "><span class="hljs-comment"># my.cnf</span>\n[mysqld]\nlog-error=DIR [/ filename]</code></pre>\n\n\n\n<h3 id="通用查询日志">通用查询日志</h3>\n\n<p>通用查询日志是用来记录用户的所有操作, 包括启动和关闭MySQL服务, 更新语句和查询语句等.</p>\n\n<p>默认文件名为hostname.log, 默认存储路径为数据库的数据文件夹.</p>\n\n<p>默认情况下, 通用查询日志功能是关闭的. 可以通过下面方式设置开启</p>\n\n\n\n<pre class="prettyprint"><code class="language-bash hljs "><span class="hljs-comment"># my.cnf</span>\n[mysqld]\nlog [=DIR \\ [filename]]</code></pre>\n\n\n\n<h3 id="慢查询日志">慢查询日志</h3>\n\n<p>慢查询日志是用来记录执行时间超过指定时间的查询语句. 通过慢查询日志, 可以查找出哪些查询语句的执行效率很低, 以便进行优化.</p>\n\n<p>默认该日志是关闭的. 默认存储路径为数据库的数据文件夹, 默认文件名为hostname-slow.log</p>\n\n\n\n<pre class="prettyprint"><code class="language-bash hljs "><span class="hljs-comment"># my.cnf</span>\n[mysqld]\nlog-slow-queries [=DIR \\ [filename]]\nlong_query_time=n\n\n<span class="hljs-comment"># 执行时间超过n秒的语句会被记录下来, n不设置的话, 默认是10s</span></code></pre></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
