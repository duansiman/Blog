\n <div class="markdown_views"><p>之前的项目基本上都是用mongodb，以至于mysql相关的知识异常薄弱，这次连续一个半月的加班，总算是实际用到了mysql，也使自己对mysql了解的更多，对mybatis了解的更多，这里就说一说经过这一个项目，我对mybatis配置的进一步理解。 <br />\n一般来说，一个比较完整的mybatis文件大概如下：</p>\n\n\n\n<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">！--第一部分--</span>&gt;</span>\n<span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>\n<span class="hljs-doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;</span>\n<span class="hljs-comment">&lt;!--第二部分--&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-title">mapper</span> <span class="hljs-attribute">namespace</span>=<span class="hljs-value">"com.cmsz.om.dao.automaticInspection.HostCollectionDao"</span>&gt;</span>\n<span class="hljs-comment">&lt;!--第三部分--&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">resultMap</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"hostCollection"</span>\n <span class="hljs-attribute">type</span>=<span class="hljs-value">"com.cmsz.om.model.automaticInspection.HostCollectionModel"</span>&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">id</span> <span class="hljs-attribute">column</span>=<span class="hljs-value">"id"</span> <span class="hljs-attribute">property</span>=<span class="hljs-value">"id"</span> <span class="hljs-attribute">jdbcType</span>=<span class="hljs-value">"INTEGER"</span> /&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">column</span>=<span class="hljs-value">"pred_exec_time"</span> <span class="hljs-attribute">property</span>=<span class="hljs-value">"predExecTime"</span> <span class="hljs-attribute">jdbcType</span>=<span class="hljs-value">"TIMESTAMP"</span> /&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">column</span>=<span class="hljs-value">"exec_time"</span> <span class="hljs-attribute">property</span>=<span class="hljs-value">"execTime"</span> <span class="hljs-attribute">jdbcType</span>=<span class="hljs-value">"TIMESTAMP"</span> /&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">column</span>=<span class="hljs-value">"host_ip"</span> <span class="hljs-attribute">property</span>=<span class="hljs-value">"hostIp"</span> <span class="hljs-attribute">jdbcType</span>=<span class="hljs-value">"VARCHAR"</span> /&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">column</span>=<span class="hljs-value">"host_name"</span> <span class="hljs-attribute">property</span>=<span class="hljs-value">"hostName"</span> <span class="hljs-attribute">jdbcType</span>=<span class="hljs-value">"VARCHAR"</span> /&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">column</span>=<span class="hljs-value">"check_type"</span> <span class="hljs-attribute">property</span>=<span class="hljs-value">"checkType"</span>\n <span class="hljs-attribute">jdbcType</span>=<span class="hljs-value">"INTEGER"</span> /&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">column</span>=<span class="hljs-value">"excute_time"</span> <span class="hljs-attribute">property</span>=<span class="hljs-value">"excuteTime"</span>\n <span class="hljs-attribute">jdbcType</span>=<span class="hljs-value">"FLOAT"</span> /&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">column</span>=<span class="hljs-value">"latency"</span> <span class="hljs-attribute">property</span>=<span class="hljs-value">"latency"</span> <span class="hljs-attribute">jdbcType</span>=<span class="hljs-value">"FLOAT"</span> /&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">column</span>=<span class="hljs-value">"opr_result"</span> <span class="hljs-attribute">property</span>=<span class="hljs-value">"oprResult"</span> <span class="hljs-attribute">jdbcType</span>=<span class="hljs-value">"VARCHAR"</span> /&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">column</span>=<span class="hljs-value">"tranc_result"</span> <span class="hljs-attribute">property</span>=<span class="hljs-value">"trancResult"</span>\n <span class="hljs-attribute">jdbcType</span>=<span class="hljs-value">"VARCHAR"</span> /&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">column</span>=<span class="hljs-value">"create_time"</span> <span class="hljs-attribute">property</span>=<span class="hljs-value">"createTime"</span> <span class="hljs-attribute">jdbcType</span>=<span class="hljs-value">"TIMESTAMP"</span> /&gt;</span>\n <span class="hljs-tag">&lt;/<span class="hljs-title">resultMap</span>&gt;</span>\n<span class="hljs-comment">&lt;!--第四部分--&gt;</span>\n <span class="hljs-tag">&lt;<span class="hljs-title">select</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"findPer"</span> <span class="hljs-attribute">parameterType</span>=<span class="hljs-value">"map"</span> <span class="hljs-attribute">resultMap</span>=<span class="hljs-value">"hostCollection"</span>&gt;</span>\n SELECT t.HOST_IP,DATE_FORMAT(t.CREATE_TIME,"%Y-%m-%d %H:00:00") createTime,t.CHECK_TYPE,t.OPR_RESULT \n FROM om_test.host_collect_datas t \n WHERE \n <span class="hljs-cdata">&lt;![CDATA[\n T.CREATE_TIME&gt;=#{startTime} and T.CREATE_TIME&lt;#{endTime} \n ]]&gt;</span>\n GROUP BY t.HOST_IP,t.check_type,DATE_FORMAT(t.CREATE_TIME,"%Y-%m-%d %H:00:00")\n <span class="hljs-tag">&lt;/<span class="hljs-title">select</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-title">mapper</span>&gt;</span></code></pre>\n\n<p><strong>上边我标注了一至四四个部分，正常情况来说，这基本的四部分是必不可少的，下边是我对这四部分的理解：</strong></p>\n\n<p><strong>第一部分</strong>是mybatis配置文件必不可少的，也可以说是基本固定的，算是mybatis文件的头部声明，以便于spring扫描时能够知道这是个mybatis文件，从而正常的解析。</p>\n\n<p>**第二部分**namespace，直接指向我们对应的dao接口的完整路径，包括包名和类名，这个就需要根据不同的dao接口进行适当的改变。</p>\n\n<p><strong>第四部分</strong>是我们操作数据库的sql语句，结合mybatis的一些标签使mybatis生成正确的sql语句，这一步分很重要，主要涉及到sql语句和编写和mysql标签的使用。</p>\n\n<p><strong>而我这里要着重说明的是第三部分</strong>，因为有比较长的一段时间我并不能真正的理解这个配置具体的含义，以至于实际运用中犯了若干个错误。 <br />\n在这一部分中又可以分为几个比较小的部分，其中的id，相信了解spring的都应该明白是什么意思以及他的作用，就像我们这里第四部分resultMap=”hostCollection”就直接引用了这个id。 <br />\n接下来的type，这里是直接指向的我们java代码中的实体类，和dao接口一样需要完整的路径，即完整包名和类名。 <br />\n最重头的其实在下边，也就是我们可以看到的若干个重复的result，以及result里边的column和property以及jdbcType。 <br />\n很早以前，我知道这里是数据库和实体类的对应，但是并不明白究竟是怎么个对应法，因此有一次我column配的是实体类的属性名，而property配的则是数据库中的字段名。由于当时的名字都起得一模一样，也就导致程序正常运行，我以为这样就是对的。 <br />\n但是后来在一个新的mybatis配置中，我依然这样的配置，结果由于数据库字段名和实体类的属性名并不一样，就导致程序无法正常运行，最后我一番修改后，把column对应到了数据库中的字段名，把property对应到了实体类的属性名。 <br />\n然后，因为sql不是太麻烦，不论是查询条件还是返回结构都没有额外的字段，所以这样之后运行程序也再次正常，于是我便以为这样便是对的。 <br />\n知道最近，又一次的业务需求，使得返回值不仅仅包括数据库表中原有的字段，经过了一番挣扎后，我才终于发现，原来property确实是对应实体类的属性。 <br />\n但是，column实际上对应的是mybatis中sql语句的返回值，而不是我之前所以为的数据库表中的实际字段。 <br />\n至此，我觉得自己大概算是真正的理解了mybatis配置的具体含义，只是不知道是不是还有下一次遇到新的问题，然后再像之前一样，继续推翻这个理解。</p></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
