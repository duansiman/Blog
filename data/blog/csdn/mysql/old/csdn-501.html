\n\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">Mysql监控属于DB监控的模块之一，包括采集、展示、监控告警。本文主要介绍Mysql监控的主要指标和采集方法。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　Mysql监控和Redis监控的逻辑类似，可参考文章《<a target="_blank" href="http://www.cnblogs.com/lxmhhy/p/6034549.html" style="margin:0px; padding:0px; color:black">Redis监控</a>》。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　DBA前台添加Mysql监控时系统会调用自动调度平台接口将Mysql监控的加密账户密码和ip端口等信息发送至目标，同时发送采集Agent。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　一、采集指标和命令</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　1、Mysql服务运行状态</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">约定所有Mysql服务都必须以ip1（内网ip）来绑定，每个机器只有一个ip1，可以有多个端口，即多个Mysql Server。采集程序读取ip端口信息文件来判断server是否存在。</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px"><span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.5!important; background-color:rgb(255,255,255)"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; text-decoration:underline; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important" /></a></span></div>&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)">sockParam=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">ps</span> aux | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> -P <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">mysqld.*--port=${port}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span> | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> -oP <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important"> --socket.*\\.sock</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; line-height:1.5!important">` # 空则获取不到该服务器端口mysql socket配置，请检查mysql配置是否正确\nMYSQL</span>=<span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">/usr/local/mysql/bin/mysql -hlocalhost --port=${port} ${sockParam} -u${user} -p${password} </span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; line-height:1.5!important">\nMYSQL_ADMIN</span>=<span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">/usr/local/mysql/bin/mysqladmin -hlocalhost --port=${port} ${sockParam} -u${user} -p${password} </span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; line-height:1.5!important">\ncurStatus</span>=`${MYSQL} -e<span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">show global status</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; line-height:1.5!important">` # 空则是获取不到该服务器mysql状态，请检查mysql是否正常运行\n</span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">if</span> [ -z <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">${curStatus}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; line-height:1.5!important"> ]\n</span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">then</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n portExists</span>=<span style="margin:0px; padding:0px; color:rgb(128,0,128); line-height:1.5!important">0</span>\n<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">else</span>\n <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">echo</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">${curStatus}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span> &gt;&gt;<span style="margin:0px; padding:0px; line-height:1.5!important"> ${curFile}\n portExists</span>=<span style="margin:0px; padding:0px; color:rgb(128,0,128); line-height:1.5!important">1</span></span></pre>&#13;\n<div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px"><span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.5!important; background-color:rgb(255,255,255)"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; text-decoration:underline; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important" /></a></span></div>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; font-family:verdana,Arial,Helvetica,sans-serif; line-height:1.5">　　2、</span><span style="margin:0px; padding:0px; font-family:verdana,Arial,Helvetica,sans-serif; line-height:1.5">连接数</span></span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)">${MYSQL_ADMIN} processlist -v | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">wc</span> -l</span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)"> </span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　3、线程数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Threads_connected</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　4、慢查询数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Slow_queries</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="margin:0px; padding:0px; line-height:1.5; background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值，等于最近1分钟的慢查询次数。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　5、打开表数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Open_tables</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　6、每秒执行select数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Com_select</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值除以时间差，等于最近1分钟的执行数量。上次数据保存在last.cache。　　</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　7、每秒执行delete数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Com_delete</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> -v <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">multi</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值除以时间差，等于最近1分钟的执行数量。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　8、每秒执行insert数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Com_insert</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> -v <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">select</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值除以时间差，等于最近1分钟的执行数量。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　9、每秒执行update数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Com_update</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> -v <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">multi</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值除以时间差，等于最近1分钟的执行数量。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　10、每秒钟执行replace数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Com_replace</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> -v <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">select</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值除以时间差，等于最近1分钟的执行数量。上次数据保存在last.cache。　</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　11、每秒钟执行的 Innodb_rows_deleted</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Innodb_rows_deleted</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值除以时间差，等于最近1分钟的执行数量。上次数据保存在last.cache。　　</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　12、每秒钟执行的 Innodb_rows_inserted</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Innodb_rows_inserted</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值除以时间差，等于最近1分钟的执行数量。上次数据保存在last.cache。　　</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　13、每秒钟执行的 Innodb_rows_read</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Innodb_rows_read</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值除以时间差，等于最近1分钟的执行数量。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　14、每秒钟执行的 Innodb_rows_updated</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Innodb_rows_updated</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值除以时间差，等于最近1分钟的执行数量。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　15、每秒钟执行的 innodb rows total</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">expr</span> ${innodbRowsDeletedPS} + ${innodbRowsInsertedPS} + ${innodbRowsReadPS} + ${innodbRowsUpdatedPS}</span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">等于前面四个Innodb_rows_*执行次数的总和</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　16、每秒处理命令数 qps</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">expr</span> ${mysqlSelectNumPS} + ${mysqlInsertNumPS} + ${mysqlUpdateNumPS} + ${mysqlDeleteNumPS} + ${mysqlReplaceNumPS}</span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">等于前面五个mysql命令Com_*的数量总和</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　17、每秒接收字节数 KByte/s</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Bytes_received</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值除以时间差，等于最近1分钟的执行数量，<span style="margin:0px; padding:0px">除以1024得到单位KByte/s</span>。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　18、每秒发送字节数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Bytes_sent</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值除以时间差，等于最近1分钟的执行数量，<span style="margin:0px; padding:0px">除以1024得到单位KByte/s</span>。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　19、可立即获得锁的次数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Table_locks_immediate</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值，等于最近1分钟的可立即获得锁数量。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　20、不可立即获得锁的次数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Table_locks_waited</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值，等于最近1分钟的不可立即获得锁数量。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　21、一行锁定需等待时间</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Innodb_row_lock_waits</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值，等于最近1分钟的一行锁定需等待时间。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　22、 当前脏页数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Innodb_buffer_pool_pages_dirty</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　23、要求清空的缓冲池页数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Innodb_buffer_pool_pages_flushed</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值，等于最近1分钟的要求清空的缓冲池页数。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　24、Innodb 写入日志字节数 KByte</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Innodb_os_log_written</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span></span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">需要计算两次的慢查询次数得到差值，等于最近1分钟的写入日志字节数，除以1024得到KByte。上次数据保存在last.cache。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　25、占用内存大小 MByte</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)">pid=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">ps</span> aux | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">mysqld</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> -Ev <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">safe|grep</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; line-height:1.5!important"> `\nmem</span>=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">cat</span> /proc/${pid}/status | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">VmRSS</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; line-height:1.5!important">`\nmysqlMem</span>=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">echo</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">scale=2;${mem} / 1024</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span> | bc`</span></pre>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">除以1024得到MByte</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　26、handler socket每秒处理数</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px"><span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.5!important; background-color:rgb(255,255,255)"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; text-decoration:underline; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important" /></a></span></div>&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)">curHsTableLock=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Hs_table_lock</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; line-height:1.5!important">`\npreHsTableLock</span>=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Hs_table_lock</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${preFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; line-height:1.5!important">`\n</span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">if</span> [ -n <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">${curHsTableLock}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; line-height:1.5!important"> ]\n</span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">then</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n hsQPS</span>=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">echo</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">scale=0;(${curHsTableLock} - ${preHsTableLock}) / ${intervalTime}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span> |<span style="margin:0px; padding:0px; line-height:1.5!important"> bc`\n</span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">else</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n hsQPS</span>=<span style="margin:0px; padding:0px; color:rgb(128,0,128); line-height:1.5!important">0</span>\n<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">fi</span></span></pre>&#13;\n<div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px"><span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.5!important; background-color:rgb(255,255,255)"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; text-decoration:underline; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important" /></a></span></div>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　27、主从同步和状态</span></p>&#13;\n<div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:'Courier New'!important">&#13;\n<div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px"><span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.5!important; background-color:rgb(255,255,255)"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; text-decoration:underline; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important" /></a></span></div>&#13;\n<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="background-color:rgb(255,255,255)"><span style="margin:0px; padding:0px; line-height:1.5!important">#主从信息\n#是否为从服务器\nslave_running</span>=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Slave_running</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${curFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; line-height:1.5!important">`\n</span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">if</span> [ <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">${slave_running}A</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span> = <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">ONA</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; line-height:1.5!important"> ]\n</span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">then</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n slaveRunning</span>=<span style="margin:0px; padding:0px; color:rgb(128,0,128); line-height:1.5!important">1</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n slaveStatus</span>=`${MYSQL} -e<span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">show slave status\\G</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; line-height:1.5!important">`\n </span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">echo</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">${slaveStatus}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span> &gt;<span style="margin:0px; padding:0px; line-height:1.5!important"> ${slaveFile}\n \n slaveIoRunning</span>=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Slave_IO_Running</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${slaveFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">:</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; line-height:1.5!important">`\n slaveSqlRunning</span>=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Slave_SQL_Running</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${slaveFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">:</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; line-height:1.5!important">`\n\n </span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">if</span> [ <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">${slaveIoRunning}A</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span> == <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">NoA</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span> -o <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">${slaveSqlRunning}A</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span> == <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">NoA</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; line-height:1.5!important"> ]\n </span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">then</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n slaveRunning</span>=<span style="margin:0px; padding:0px; color:rgb(128,0,128); line-height:1.5!important">3</span>\n <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">fi</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n \n secondsBehindMaster</span>=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Seconds_Behind_Master</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${slaveFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">:</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; line-height:1.5!important">`\n </span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">if</span> [ <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">${secondsBehindMaster}A</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span> = <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">NULLA</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">"</span><span style="margin:0px; padding:0px; line-height:1.5!important"> ]\n </span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">then</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n secondsBehindMaster</span>=<span style="margin:0px; padding:0px; color:rgb(128,0,128); line-height:1.5!important">8888 # 表示主从不同步</span>\n <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">fi</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n\n #是从库时 获取主库ip\n master</span>=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Master_Host</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${slaveFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">:</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; line-height:1.5!important">`\n masterPort</span>=`<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">grep</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">Master_Port</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> ${slaveFile} | <span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">awk</span> -F <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">:</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span> <span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">{print $2}</span><span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">'</span><span style="margin:0px; padding:0px; line-height:1.5!important">`\n</span><span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">else</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n master</span>=<span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">""</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n masterPort</span>=<span style="margin:0px; padding:0px; color:rgb(128,0,0); line-height:1.5!important">""</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n slaveRunning</span>=<span style="margin:0px; padding:0px; color:rgb(128,0,128); line-height:1.5!important">0</span><span style="margin:0px; padding:0px; line-height:1.5!important">\n secondsBehindMaster</span>=<span style="margin:0px; padding:0px; color:rgb(128,0,128); line-height:1.5!important">10000 # 不用检测</span>\n<span style="margin:0px; padding:0px; color:rgb(0,0,255); line-height:1.5!important">fi</span></span></pre>&#13;\n<div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px"><span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.5!important; background-color:rgb(255,255,255)"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; text-decoration:underline; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important" /></a></span></div>&#13;\n</div>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">注：<span style="margin:0px; padding:0px">Seconds_Behind_Master，该值作为判断主从延时的指标，那么它又是怎么得到这个值的呢，同时，它为什么又受到很多人 的质疑？ （本段引用自 http://blog.chinaunix.net/uid-27038861-id-3686311.html）</span></span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">Seconds_Behind_Master是通过比较sql_thread执行的event的timestamp和io_thread复制好的 event的timestamp(简写为ts)进行比较，而得到的这么一个差值。我们都知道的relay-log和主库的bin-log里面的内容完全一样，在记录sql语句的同时会被记录上当时的ts，所以比较参考的值来自于binlog，其实主从没有必要与NTP进行同步，也就是说无需保证主从时钟的&#13;\n 一致。你也会发现，其实比较真正是发生在io_thread与sql_thread之间，而io_thread才真正与主库有关联，于是，问题就出来了， 当主库I/O负载很大或是网络阻塞，io_thread不能及时复制binlog（没有中断，也在复制），而sql_thread一直都能跟上 io_thread的脚本，这时Seconds_Behind_Master的值是0，也就是我们认为的无延时，但是，实际上不是，你懂得。这也就是为什 么大家要批判用这个参数来监控数据库是否发生延时不准的原因，但是这个值并不是总是不准，如果当io_thread与master网络很好的情况下，那么&#13;\n 该值也是很有价值的。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">之前，提到 Seconds_Behind_Master这个参数会有负值出现，我们已经知道该值是io_thread的最近跟新的ts与sql_thread执行到 的ts差值，前者始终是大于后者的，唯一的肯能就是某个event的ts发生了错误，比之前的小了，那么当这种情况发生时，负值出现就成为可能。</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)">　　28、检测采集Agent心跳情况</span></p>&#13;\n<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px">&#13;\n<span style="background-color:rgb(255,255,255)"> </span></p>&#13;\n &#13;\n
