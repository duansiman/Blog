\n\nCleverCode最近在研究mysql的多实例，发现有两种方式：<br />&#13;\n<span style="color:#ff6600">        第一种是使用多个配置文件启动不同的进程来实现多实例。</span>这种方式的优势逻辑简单，配置简单，缺点是管理起来不太方便。<br />&#13;\n<span style="background-color:rgb(255,255,255)"><span style="color:#ff6600">        第二种是通过官方自带的mysqld_multi。</span></span>使用单独的配置文件来实现多实例，这种方式定制每个实例的配置不太方面，优点是管理起来很方便，集中管理。<br />&#13;\n       <span style="color:#ff6600"> 推荐使用多个配置文件方式。</span>这种实际应用中好，耦合性不强，配置方便，特别是主从复制的时候。<br />&#13;\n       上一篇《mysql多实例（多个配置文件方式）》：http://blog.csdn.net/clevercode/article/details/47610619。介绍了多个配置文件方式。本篇将介绍mysqld_multi方式。<br />&#13;\n<br />&#13;\n<br />&#13;\n<span style="font-size:18px; color:#ff0000">1 环境介绍：</span><br />&#13;\n<br />&#13;\n1）简介<br />&#13;\nmysql 版本：mysql-5.5.27<br />&#13;\ncmake：cmake-2.8.8<br />&#13;\n操作系统：CentOS6.5<br />&#13;\nmysql实例数：3个<br />&#13;\n实例占用端口分别为：3306、3307、3308<br />&#13;\n<br />&#13;\n2）本次安装所有的软件资源包下载地址<br />&#13;\nhttp://download.csdn.net/detail/clevercode/8662323<br />&#13;\n<br />&#13;\n<span style="font-size:18px; color:#ff0000">2 配置防火墙</span><br />&#13;\n1) 在防火墙配置文件中添加3306，3307,3308（允许3306，3307,3308端口通过防火墙） <br />&#13;\n# vi /etc/sysconfig/iptables   #编辑防火墙配置文件 <br />&#13;\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 3306 -j ACCEPT<br />&#13;\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 3307 -j ACCEPT<br />&#13;\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 3308 -j ACCEPT<br />&#13;\n2）重启防火墙<br />&#13;\n# /etc/init.d/iptables restart  #最后重启防火墙使配置生效<br />&#13;\n<br />&#13;\n<span style="font-size:18px; color:#ff0000">3 安装cmake</span><br />&#13;\n解压<br />&#13;\n# cd /usr/local/src/mysql<br />&#13;\n# tar zxvf cmake-2.8.8.tar.gz<br />&#13;\n# cd cmake-2.8.8<br />&#13;\n<br />&#13;\n配置<br />&#13;\n# ./configure<br />&#13;\n<br />&#13;\n编译<br />&#13;\n# make<br />&#13;\n<br />&#13;\n安装<br />&#13;\n# make install<br />&#13;\n<br />&#13;\n查看版本<br />&#13;\n# cmake -version<br />&#13;\n<br />&#13;\n<span style="font-size:18px; color:#ff0000">4 安装Mysql</span><br />&#13;\n1) 创建用户<br />&#13;\n# groupadd mysql  #添加mysql组    <br />&#13;\n# useradd -g mysql mysql -s /bin/false  #创建用户mysql并加入到mysql组，不允许mysql用户直接登录系统<br />&#13;\n<br />&#13;\n2) 解压<br />&#13;\n# cd /usr/local/src/mysql<br />&#13;\n# tar zxvf mysql-5.5.27.tar.gz<br />&#13;\n# cd mysql-5.5.27<br />&#13;\n<br />&#13;\n4) 配置<br />&#13;\n# cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql <br />&#13;\n<br />&#13;\nPS: cmake的时候，参数可以不用那么多，只要一个-DCMAKE_INSTALL_PREFIX=/usr/local/mysql就行了，我们可以在 my.cnf里面配置。[mysqld]中的内容，看看你copy后的my.cnf有没有这些设置，有就不用了在设置了。  <br />&#13;\n<br />&#13;\n5）编译<br />&#13;\n# make<br />&#13;\n<br />&#13;\n6)安装<br />&#13;\n# make install<br />&#13;\n<br />&#13;\n<br />&#13;\n<span style="font-size:18px; color:#ff0000">5 初始化数据库</span><br />&#13;\n# mkdir -p /data0/dbdata/mysql/3306<br />&#13;\n# mkdir -p /data0/dbdata/mysql/3307<br />&#13;\n# mkdir -p /data0/dbdata/mysql/3308<br />&#13;\n<br />&#13;\n# chown -R mysql:mysql /data0/dbdata/mysql/3306<br />&#13;\n# chown -R mysql:mysql /data0/dbdata/mysql/3307<br />&#13;\n# chown -R mysql:mysql /data0/dbdata/mysql/3308<br />&#13;\n<br />&#13;\n# /usr/local/mysql/scripts/mysql_install_db --basedir=/usr/local/mysql --datadir=/data0/dbdata/mysql/3306 --user=mysql<br />&#13;\n# /usr/local/mysql/scripts/mysql_install_db --basedir=/usr/local/mysql --datadir=/data0/dbdata/mysql/3307 --user=mysql<br />&#13;\n# /usr/local/mysql/scripts/mysql_install_db --basedir=/usr/local/mysql --datadir=/data0/dbdata/mysql/3308 --user=mysql<br />&#13;\n<br />&#13;\n<span style="font-size:18px; color:#ff0000">6 修改配置文件（只用/etc/my.cnf文件）</span><br />&#13;\n# cp /usr/local/mysql/support-files/my-huge.cnf /etc/my.cnf<br />&#13;\n<br />&#13;\n<p># vi /etc/my.cnf</p>&#13;\n<p></p>&#13;\n<pre name="code" class="plain">[mysqld_multi] \nmysqld = /usr/local/mysql/bin/mysqld_safe \nmysqladmin = /usr/local/mysql/bin/mysqladmin \n\n#用于登陆和关闭此服务\nuser = root\npassword = CleverCode123\n\n[mysqld3306] \n#数据目录\ndatadir = /data0/dbdata/mysql/3306\n\n#连接 \nport = 3306 \nsocket = /tmp/mysql3306.sock\n \n#binlog \nlog-bin=/data0/dbdata/mysql/3306/mysql-bin \n\npid-file = /data0/dbdata/mysql/3306/mysql_3306.pid\n\n[mysqld3307] \ndatadir = /data0/dbdata/mysql/3307\nport = 3307\nsocket = /tmp/mysql3307.sock \nlog-bin=/data0/dbdata/mysql/3307/mysql-bin \npid-file = /data0/dbdata/mysql/3307/mysql_3307.pid\n\n[mysqld3308] \ndatadir = /data0/dbdata/mysql/3308\nport = 3308\nsocket = /tmp/mysql3308.sock\nlog-bin=/data0/dbdata/mysql/3308/mysql-bin\npid-file = /data0/dbdata/mysql/3308/mysql_3308.pid</pre><br />&#13;\n<p></p>&#13;\n<span style="font-size:18px; color:#ff0000">7 启动3306、3307、3308的mysql </span><br />&#13;\n# /usr/local/mysql/bin/mysqld_multi start 3306<br />&#13;\n# /usr/local/mysql/bin/mysqld_multi start 3307<br />&#13;\n# /usr/local/mysql/bin/mysqld_multi start 3308<br />&#13;\n<br />&#13;\n<span style="font-size:18px; color:#ff0000">8 查看端口是否监听，如果出现3306,3307,3308则启动正常</span><br />&#13;\n# netstat -anp | grep 3308<br />&#13;\n<br />&#13;\ntcp        0      0 0.0.0.0:3308                0.0.0.0:*                   LISTEN      2348/mysqld         <br />&#13;\nunix  2      [ ACC ]     STREAM     LISTENING     10780  2348/mysqld         /tmp/mysql3308.sock  <br />&#13;\n<br />&#13;\n<br />&#13;\n<span style="font-size:18px; color:#ff0000">9 初始化密码并且授权远程登录，mysqladmin用户名和密码需要和/ect/my.cnf中保持一致，否则stop不了服务。</span><br />&#13;\n<br />&#13;\n# /usr/local/mysql/bin/mysqladmin -u root password "CleverCode123" -S /tmp/mysql3306.sock<br />&#13;\n# /usr/local/mysql/bin/mysql -uroot -pCleverCode123 -S  /tmp/mysql3306.sock<br />&#13;\nmysql&gt; grant all privileges on  *.* to 'root'@'%' identified by 'pwd3306' with grant option;<br />&#13;\nmysql&gt; flush privileges;<br />&#13;\n<br />&#13;\n# /usr/local/mysql/bin/mysqladmin -u root password "CleverCode123" -S /tmp/mysql3307.sock<br />&#13;\n# /usr/local/mysql/bin/mysql -uroot -pCleverCode123 -S  /tmp/mysql3307.sock<br />&#13;\nmysql&gt; grant all privileges on  *.* to 'root'@'%' identified by 'pwd3307' with grant option;<br />&#13;\nmysql&gt; flush privileges;<br />&#13;\n<br />&#13;\n# /usr/local/mysql/bin/mysqladmin -u root password "CleverCode123" -S /tmp/mysql3308.sock<br />&#13;\n# /usr/local/mysql/bin/mysql -uroot -pCleverCode123 -S  /tmp/mysql3308.sock<br />&#13;\nmysql&gt; grant all privileges on  *.* to 'root'@'%' identified by 'pwd3308' with grant option;<br />&#13;\nmysql&gt; flush privileges;<br />&#13;\n<br />&#13;\n<span style="font-size:18px; color:#ff0000">10 停止（必须先初始化密码）。可以使用netstat -anp | grep 3308查看监听进程是否还存在</span><br />&#13;\n# /usr/local/mysql/bin/mysqld_multi stop 3306<br />&#13;\n# /usr/local/mysql/bin/mysqld_multi stop 3307<br />&#13;\n# /usr/local/mysql/bin/mysqld_multi stop 3308<br />&#13;\n<br />&#13;\n<span style="font-size:18px; color:#ff0000">11 报告。显示进程的状态</span><br />&#13;\n# /usr/local/mysql/bin/mysqld_multi report 3306<br />&#13;\n# /usr/local/mysql/bin/mysqld_multi report 3307<br />&#13;\n# /usr/local/mysql/bin/mysqld_multi report 3308&#13;\n &#13;\n
