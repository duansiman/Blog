\n <div class="markdown_views"><blockquote>\n <p>数据库中的数据量不一定是可控的，在未进行分库分表的情况下，随着时间和业务的发展，库中的表会越来越多，表中的数据量也会越来越大，相应地，数据操作，增删改查的开销也会越来越大；另外，由于无法进行分布式式部署，而一台服务器的资源（CPU、磁盘、内存、IO等）是有限的，最终数据库所能承载的数据量、数据处理能力都将遭遇瓶颈。 <br />\n 说白了，就是分担写负载</p>\n</blockquote>\n\n\n\n<h4 id="分库分表一">分库分表一</h4>\n\n<blockquote>\n <p>节点：mysql数据库一主多从的数据库集群（数据一致），所以用节点表示 <br />\n 重新对数据库连接进行配置就行 <br />\n 优点：数据库拆分比较简单，尤其适合没有跨库查询的情况下 <br />\n 缺点：如果写操作主要在订单表，那就分库分表的作用不是很大了</p>\n</blockquote>\n\n<p><img src="http://img.blog.csdn.net/20170624105403693?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="分库分表二">分库分表二</h4>\n\n<blockquote>\n <p>当表所在的服务器也达到瓶颈时，无法继续升级 <br />\n <img src="http://img.blog.csdn.net/20170624110908091?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n</blockquote>\n\n<h3 id="分库分表三水平拆分分片-不同物理节点">分库分表三：水平拆分（分片-&gt;不同物理节点）</h3>\n\n<p><strong>类似分区表（不同：一个节点：数据库），分片很容易出现问题，难以维护，慎重</strong> <br />\n<img src="http://img.blog.csdn.net/20170624113907216?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="分片前准备">分片前准备</h4>\n\n<p><img src="http://img.blog.csdn.net/20170624114410099?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170624120125148?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n - 不经常更新的表 <br />\n - 数据量不大，字典列表 <br />\n - 使用多写的方式维护一致性（表更新时，同时更新所有分片的表操作） <br />\n - 定期检查（防止业务逻辑问题） <br />\n - 第二种方式优点是数据没有冗余问题，查询效率差一些，因为要关联，合并</p>\n\n<p><img src="http://img.blog.csdn.net/20170624120556461?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170624121556291?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><strong>数据量和访问量的平均，结合业务做分析</strong> <br />\n - 第一种：分区键并不总是数值，所有要用模来转换成数值性数据 <br />\n - 优点：可以比较平均的分配数据 <br />\n - 缺点：很难人为控制哪个数据分配到哪个分片中 <br />\n - 第二种：常用于分区键是日期类型或者是数据类型的情况 <br />\n - 优点：很清楚知道数据在哪个分片中 <br />\n - 缺点：数据（访问量）分配不平均 <br />\n - 第三种： <br />\n - 灵活对数据在哪些分片进行控制 <br />\n - 映射表会产生很大的服务压力，可以使用缓存（否则很可能成为系统的瓶颈）</p>\n\n<p><img src="http://img.blog.csdn.net/20170624123443876?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li>auto_increment_increment（总分片数） auto_increment_offset（不同的值） <br />\n<ul><li>只适用于一个节点保存一套分区表</li></ul></li>\n<li>全局节点ID-&gt;建表使用auto_increment属性，生成自增ID-&gt;性能瓶颈</li>\n<li>类似第二种</li>\n</ul>\n\n<h3 id="演示">演示</h3>\n\n<p><img src="http://img.blog.csdn.net/20170624123533149?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h4 id="分片工具演示不是很完美">分片工具（演示，不是很完美）</h4>\n\n<p><img src="http://img.blog.csdn.net/20170624123606866?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<blockquote>\n <p>三个节点：节点1（服务器节点），节点2（分片数据库节点），节点3（oneProxy节点）</p>\n</blockquote>\n\n<p>节点1,节点2添加oneProxy连接用户 <br />\n<img src="http://img.blog.csdn.net/20170624125558409?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<pre class="prettyprint"><code class=" hljs avrasm">demo<span class="hljs-preprocessor">.sh</span> 启动脚本</code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170624124814106?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li>修改配置 <br />\n<ul><li>添加分片节点</li>\n<li>通过oneProxy客户端获取加密字符串密码 ./demo.sh</li>\n<li>mysql -P4041 -uadmin -pOneProxy -h127.0.0.1;</li>\n<li>passwd “123456” （获取密码）</li>\n<li>修改proxy-user-list 用户/加密密码@数据库名</li>\n<li>peoxy-part-template 分片方式地址</li>\n<li>remote-address 远程管理地址</li>\n<li><img src="http://img.blog.csdn.net/20170624131233149?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></li></ul></li>\n</ul>\n\n<h4 id="设置分片方式">设置分片方式</h4>\n\n<p>订单表，订单商品表，相互关联，分片键一致 <br />\n - 表名 <br />\n - 分片键 <br />\n - 键类型 <br />\n - 分片方式 <br />\n - 分片方式（分片） <br />\n - suffix后缀 <br />\n - 分片组</p>\n\n<p><img src="http://img.blog.csdn.net/20170624133158301?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170624133244404?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="建表">建表</h4>\n\n<p>节点1 <br />\n<img src="http://img.blog.csdn.net/20170624133753149?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n节点2 <br />\n<img src="http://img.blog.csdn.net/20170624133933876?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170624133945092?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n节点3</p>\n\n\n\n<pre class="prettyprint"><code class=" hljs lasso">ps <span class="hljs-attribute">-ef</span> <span class="hljs-subst">|</span> grep oneproxy\n重启oneProxy\nkill <span class="hljs-subst">-</span><span class="hljs-number">9</span> <span class="hljs-number">1164</span>\n<span class="hljs-built_in">.</span>/demo<span class="hljs-built_in">.</span>sh\nmysql <span class="hljs-attribute">-P4041</span> <span class="hljs-attribute">-uadmin</span> <span class="hljs-attribute">-pOneProxy</span> <span class="hljs-attribute">-h127</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>;\n<span class="hljs-built_in">list</span> backend;</code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170624134433955?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170624134448172?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h4 id="测试">测试</h4>\n\n<p><img src="http://img.blog.csdn.net/20170624135212059?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<blockquote>\n <p>通过oneproxy连接 <br />\n mysql -utest -p123456 -h127.0.0.1 -p3306</p>\n</blockquote>\n\n<p><img src="http://img.blog.csdn.net/20170624135720756?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p>节点1： <br />\n<img src="http://img.blog.csdn.net/20170624135842655?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n节点2： <br />\n<img src="http://img.blog.csdn.net/20170624140022715?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
