\n <div class="markdown_views"><blockquote>\n <p>SQL查询优化目的：减少查询所消耗的时间，加快查询的相应速度</p>\n</blockquote>\n\n<h3 id="获取有性能问题的sql">获取有性能问题的SQL</h3>\n\n<p><img src="http://img.blog.csdn.net/20170621112532102?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="满查询日志开销比较低">满查询日志开销比较低</h4>\n\n<ul>\n<li>磁盘IO （顺序存储） 开销忽略不计</li>\n<li>存储日志大小所需要的磁盘空间 （依赖）</li>\n</ul>\n\n\n\n<h4 id="控制sql配置">控制sql配置</h4>\n\n<p><img src="http://img.blog.csdn.net/20170621114818424?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n - slow_query_log(默认关闭，启动on,运行系统启动满查询 set global) <br />\n - 定时，避免占用过多的磁盘空间（使用脚本来控制） <br />\n - slow_query_log_file(默认情况下，保存在mysql的数据目录中) <br />\n - 建议日志存储和数据存储分开，磁盘分区更好 <br />\n - long_query_time单位秒(默认10s),最小微妙 <br />\n - 记录所有符合条件的SQL <br />\n - 包括查询语句，数据修改语句，已经回滚的SQL <br />\n - 通常改为0.001秒（1毫秒）比较合适</p>\n\n<p><img src="http://img.blog.csdn.net/20170621115413497?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n - 使用用户信息，线程ID号（慢查可以代替审计日志） <br />\n - 查询时间和锁时间 <br />\n - 返回行数和扫描行数 <br />\n - sql执行时间 <br />\n - sql</p>\n\n<p><img src="http://img.blog.csdn.net/20170621115631697?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<pre class="prettyprint"><code class=" hljs lasso">mysqldumpslow <span class="hljs-attribute">-s</span> r <span class="hljs-attribute">-t</span> <span class="hljs-number">10</span> slow<span class="hljs-attribute">-mysql</span><span class="hljs-built_in">.</span><span class="hljs-keyword">log</span>\n<span class="hljs-attribute">-t</span> top \n指定取前几条做为结束输出</code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170621115838760?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="测试">测试</h4>\n\n<p><img src="http://img.blog.csdn.net/20170621114912409?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170621120224697?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170621120621304?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170621121249267?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170621121420601?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170621121832023?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li>汇总查询信息（总查询时间，总锁定时间，发送行数，检查行数，接受查询大小）</li>\n<li>SQL统计信息，ID是sql去掉空格和文本值转成小写，hash值</li>\n<li>Query1 性能最差的查询，次数，并发次数，查询id</li>\n<li>Query 查询计划（很棒）</li>\n</ul>\n\n<p><img src="http://img.blog.csdn.net/20170621122658240?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170621122906759?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170621123338758?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="实时获取有性能问题的sql">实时获取有性能问题的SQL</h3>\n\n<p><strong>利用information_schema数据库来获取PROCESSLIST表</strong> <br />\n使用脚本周期性执行</p>\n\n\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> id,<span class="hljs-string">`user`</span>,<span class="hljs-string">`host`</span>,DB,command,<span class="hljs-string">`time`</span>,state,info <span class="hljs-keyword">FROM</span> information_schema.PROCESSLIST <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">TIME</span>&gt;=<span class="hljs-number">60</span></span></code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170621135030998?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="慢查询产生的原因">慢查询产生的原因</h3>\n\n\n\n<h4 id="sql执行过程">sql执行过程</h4>\n\n<p><img src="http://img.blog.csdn.net/20170622102344731?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="第一阶段">第一阶段</h4>\n\n<blockquote>\n <p>缓存查找是利用对大小写敏感的哈希查找来实现的 <br />\n Hash查找只能进行全值查找（sql完全一致） <br />\n 如果缓存命中，检查用户权限，如果权限允许，直接返回 <br />\n 查询不被解析，也不会生成查询计划</p>\n</blockquote>\n\n<ul>\n<li>每次缓存中的表中的内容更新，缓存中的所有内容都会跟着刷新</li>\n<li>缓存查询加锁，对于一个读写频繁的系统使用查询，缓存很可能会降低查询处理的效率，不要使用查询缓存</li>\n</ul>\n\n\n\n<h4 id="配置参数">配置参数</h4>\n\n<p><img src="http://img.blog.csdn.net/20170622104556665?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n - query_cache_type 设置查询缓存是否可用 <br />\n - ON,OFF,DEMAND <br />\n - DEMAND使用SQL_CACHE和SQL_NO_CACHE来控制是否需要缓存 <br />\n - 如果缓存很大，在查询中可以加上SQL_NO_CACHE提交效率</p>\n\n\n\n<h4 id="第二阶段">第二阶段</h4>\n\n<p><strong>将msql转换成执行计划和存储引擎进行交互</strong></p>\n\n<p><img src="http://img.blog.csdn.net/20170622104759494?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170622104831297?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li>一条查询可以有多种查询方式，查询优化器会对每一种查询方式的（存储引擎）统计信息进行比较，找到成本最低的查询方式 <br />\n<ul><li>这也是缩影不能越来越多的原因</li></ul></li>\n</ul>\n\n<p><img src="http://img.blog.csdn.net/20170622105512492?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170622105604997?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170622105734657?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="mysql优化器可优化的sql类型">Mysql优化器可优化的SQL类型</h4>\n\n<p><strong>查询优化器：对查询进行优化并查询mysql认为的成本最低的执行计划</strong></p>\n\n<blockquote>\n <p>为了生成最优的执行计划，查询优化器会对一些查询进行改写</p>\n</blockquote>\n\n<p><img src="http://img.blog.csdn.net/20170622110516266?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170622110556501?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170622110859955?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170622111636617?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170624082257584?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170624082410956?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170624082546284?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170624082724909?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li>在一定情况下，外连接等价于内连接。比如 查询 a left join b where 对B表进行过滤</li>\n<li>利用索引列是否为空对聚合函数进行优化（count…），比如B树索引，顺序存储，所以如果要找到最小值，只需要查询B树索引最左边的记录就行了</li>\n<li>等价变换规则：比如当发现索引中的列包含所有的查询中所需要的信息时，会使用覆盖索引</li>\n<li>mysql对in（）列表中的数据先进行排序，通过二分查找的方式来确定列表中的值是否满足条件 <br />\n<strong>当优化过查询会，生成查询计划，根据查询计划，调用存储引擎的API,通过存储引擎调用所需的数据</strong></li>\n</ul>\n\n<h2 id="查询处理各个阶段所需要的时间">查询处理各个阶段所需要的时间</h2>\n\n<h3 id="使用profile">使用profile</h3>\n\n<ul>\n<li>set profile = 1; 启动profile,这是一个session级的配制</li>\n<li>执行查询</li>\n<li>show profiles; 查询每一个查询所消耗的总时间的信息 </li>\n<li>show profiles for query N; 查询的每个阶段所消耗的时间</li>\n</ul>\n\n<p><img src="http://img.blog.csdn.net/20170624093458452?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">show</span> profiles <span class="hljs-keyword">for</span> query <span class="hljs-number">1</span>;</span></code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170624093642999?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<blockquote>\n <p>影响sending data的因素很大：不同服务器的活动：关联时搜索匹配的行记录。通常可以使用索引来优化。</p>\n</blockquote>\n\n\n\n<pre class="prettyprint"><code class=" hljs sql">查询cpu的信息\n<span class="hljs-operator"><span class="hljs-keyword">show</span> profile cpu <span class="hljs-keyword">for</span> query <span class="hljs-number">1</span> ;</span></code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170624094140050?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170624094210321?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="performanceschema">performance_schema</h3>\n\n<blockquote>\n <p>performance_schema是5.5引入的一个性能分析引擎（5.5版本时期开销比较大）</p>\n</blockquote>\n\n<h4 id="启动监控和历史记录表">启动监控和历史记录表</h4>\n\n\n\n<pre class="prettyprint"><code class=" hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">performance_schema</span>;</code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170624094538837?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170624095202608?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170624095215052?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h4 id="performanceschema分析数据库中每一个sql中各个阶段执行消耗时间的信息">performance_schema分析数据库中每一个sql中各个阶段执行消耗时间的信息</h4>\n\n<p><img src="http://img.blog.csdn.net/20170624094945394?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170624095005756?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170624095327117?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h2 id="特定sql的查询优化">特定SQL的查询优化</h2>\n\n<h3 id="大表数据修改分批修改暂停几秒减少对主从复制的压力">大表数据修改（分批修改，暂停几秒（减少对主从复制的压力））</h3>\n\n<p><img src="http://img.blog.csdn.net/20170624095630762?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="大表表结构的修改">大表表结构的修改</h3>\n\n<p><img src="http://img.blog.csdn.net/20170624095747943?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="一">一</h4>\n\n<p><strong>利用主从复制，先对从服务器进入修改，然后主从切换</strong></p>\n\n\n\n<h4 id="二推荐">二（推荐）</h4>\n\n<ul>\n<li>添加一个新表（修改后的结构）</li>\n<li>老表数据导入新表</li>\n<li>老表建立触发器，修改数据同步到新表</li>\n<li>老表加一个排它锁（重命名）</li>\n<li>新表重命名</li>\n<li>删除老表</li>\n</ul>\n\n<p><img src="http://img.blog.csdn.net/20170624100151420?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h4 id="手工到工具pt-online-schema-change">手工到工具（pt-online-schema-change）</h4>\n\n<p><img src="http://img.blog.csdn.net/20170624100541254?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170624100615448?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<pre class="prettyprint"><code class=" hljs sql">修改语句这个样子\n<span class="hljs-operator"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> sbtest4 modify c <span class="hljs-keyword">varchar</span>(<span class="hljs-number">150</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-string">''</span>()</span></code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170624101028000?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170624101120187?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h3 id="优化not-in-和-查询">优化not in 和 &lt;&gt; 查询</h3>\n\n<p><strong>子查询改写为关联查询</strong></p>\n\n<p><img src="http://img.blog.csdn.net/20170624102208873?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h3 id="使用汇总表优化查询">使用汇总表优化查询</h3>\n\n<blockquote>\n <p>汇总表就是提前以要统计的数据进行汇总并记录到表中以备后续的查询使用 <br />\n 创建一个统计表，利用覆盖索引进行优化 <br />\n product_comment_cnt每隔一段时间进行对前天所有数据的汇总 <br />\n product_comment 当天的评论数 <br />\n <img src="http://img.blog.csdn.net/20170624102613275?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n</blockquote></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
