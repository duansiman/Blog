\n <div class="markdown_views"><p>基准测试（benchmarking）是一种测量和评估软件性能指标的活动。你可以在某个时候通过基准测试建立一个已知的性能水平（称为基准线），当系统的软硬件环境发生变化之后再进行一次基准测试以确定那些变化对性能的影响。 <br />\n说简单点，就是针对系统设置的一种压力测试。测量系统性能，然后确保优化是否有效。</p>\n\n<p><img src="http://img.blog.csdn.net/20170519124805105?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170519124905104?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="基准测试的目的">基准测试的目的：</h3>\n\n<p><img src="http://img.blog.csdn.net/20170519125210486?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n对整个系统进行基准测试： <br />\n<strong>从系统入口进行测试（如网站Web前端，手机APP前端）</strong></p>\n\n<p><img src="http://img.blog.csdn.net/20170519125548904?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><strong>单独对MySQL进行基准测试</strong> <br />\n<img src="http://img.blog.csdn.net/20170519125815293?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170519130035031?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li>响应时间是整个测试完成后的时间；</li>\n<li>并发量：同时处理的查询请求的数量（并发量不等于连接数）</li>\n<li>并发量实际上正在工作中的并发的操作数或同时工作的数量</li>\n</ul>\n\n\n\n<h3 id="基准测试的步骤">基准测试的步骤：</h3>\n\n<ul>\n<li>对整个系统还是某一组件</li>\n<li>使用什么样的数据</li>\n<li>实际情况：实际数据和实际运行的sql。利用生产环境的备份数据以及在一段时间产生的sql慢查日志运行多线程的回放来完成测试；如果是一个配置的测试（很小的修改）可以使用软件来完成</li>\n<li>准备基准测试以及数据收集脚本</li>\n<li>脚本自己编写（CPU使用率，IO，网络流量，状态与计数器信息等）</li>\n<li>运行基准测试，多次测试</li>\n<li>保存及分析基准测试结果 <br />\n收集脚本：</li>\n</ul>\n\n\n\n<pre class="prettyprint"><code class=" hljs bash"><span class="hljs-shebang">#!/bin/bash</span>\nINTERVAL=<span class="hljs-number">5</span> 运行间隔\nPREFIX=/home/imooc/benchmarks/<span class="hljs-variable">$INTERVAL</span>-sec-status 保存位置\nRUNFILE=/home/imooc/benchmarks/running 运行标识\n<span class="hljs-built_in">echo</span> <span class="hljs-string">"1"</span> &gt; <span class="hljs-variable">$RUNFILE</span> \nMYSQL=/usr/local/mysql/bin/mysql 记录mysql位置\n<span class="hljs-variable">$MYSQL</span> <span class="hljs-operator">-e</span> <span class="hljs-string">"show global variables"</span> &gt;&gt; mysql-variables\n<span class="hljs-keyword">while</span> test <span class="hljs-operator">-e</span> <span class="hljs-variable">$RUNFILE</span>; <span class="hljs-keyword">do</span>\n file=$(date +%F_%I)\n sleep=$(date +%s.%N | awk <span class="hljs-string">'{print 5 - ($1 % 5)}'</span>)\n sleep <span class="hljs-variable">$sleep</span>\n ts=<span class="hljs-string">"<span class="hljs-variable">$(date +"TS %s.%N %F %T")</span>"</span>\n loadavg=<span class="hljs-string">"<span class="hljs-variable">$(uptime)</span>"</span> 负载情况\n <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$ts</span> <span class="hljs-variable">$loadavg</span>"</span> &gt;&gt; <span class="hljs-variable">$PREFIX</span>-<span class="hljs-variable">${file}</span>-status\n <span class="hljs-variable">$MYSQL</span> <span class="hljs-operator">-e</span> <span class="hljs-string">"show global status"</span> &gt;&gt; <span class="hljs-variable">$PREFIX</span>-<span class="hljs-variable">${file}</span>-status &amp; 收集mysql全集的状态信息\n <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$ts</span> <span class="hljs-variable">$loadavg</span>"</span> &gt;&gt; <span class="hljs-variable">$PREFIX</span>-<span class="hljs-variable">${file}</span>-innodbstatus\n <span class="hljs-variable">$MYSQL</span> <span class="hljs-operator">-e</span> <span class="hljs-string">"show engine innodb status"</span> &gt;&gt; <span class="hljs-variable">$PREFIX</span>-<span class="hljs-variable">${file}</span>-innodbstatus &amp; 收集Innodb的状态信息\n <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$ts</span> <span class="hljs-variable">$loadavg</span>"</span> &gt;&gt; <span class="hljs-variable">$PREFIX</span>-<span class="hljs-variable">${file}</span>-processlist\n <span class="hljs-variable">$MYSQL</span> <span class="hljs-operator">-e</span> <span class="hljs-string">"show full processlist\\G"</span> &gt;&gt; <span class="hljs-variable">$PREFIX</span>-<span class="hljs-variable">${file}</span>-processlist &amp; 收集mysql的线程情况\n <span class="hljs-built_in">echo</span> <span class="hljs-variable">$ts</span>\n<span class="hljs-keyword">done</span>\n<span class="hljs-built_in">echo</span> Exiting because <span class="hljs-variable">$RUNFILE</span> does not exists\n</code></pre>\n\n\n\n<pre class="prettyprint"><code class=" hljs bash"><span class="hljs-shebang">#!/bin/bash</span>\nawk <span class="hljs-string">'\n BEGIN {\n printf "#ts date time load QPS";\n fmt=" %.2f";\n }\n /^TS/ {\n ts = substr($2,1,index($2,".")-1);\n load = NF -2;\n diff = ts - prev_ts;\n printf "\\n%s %s %s %s",ts,$3,$4,substr($load,1,length($load)-1);\n prev_ts=ts;\n }\n /Queries/{ 查询数量，QPS\n printf fmt,($2-Queries)/diff;\n Queries=$2\n }\n '</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span> \n 添加TPS,每秒插入量，删除量，更新量，并发量，线程量。。。。</code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170519133253621?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h3 id="基准测试工具">基准测试工具：</h3>\n\n<p><strong>mysqlslap:</strong></p>\n\n<p><img src="http://img.blog.csdn.net/20170519154709603?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170519155438307?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170519155902573?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170519160047983?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170519160913353?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170519160948893?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><strong>sysbench:</strong> <br />\n<img src="http://img.blog.csdn.net/20170519161718413?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<pre class="prettyprint"><code class=" hljs livecodeserver">./autogen.sh (unnecessary <span class="hljs-keyword">if</span> you are building <span class="hljs-built_in">from</span> <span class="hljs-operator">a</span> release tarball)\n ./configure (<span class="hljs-operator">or</span> ./configure <span class="hljs-comment">--without-mysql to compile w/o MySQL support)</span>\n make\n make install</code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170519162027522?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170519162416634?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170519162616312?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170519162706699?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170519162927060?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
