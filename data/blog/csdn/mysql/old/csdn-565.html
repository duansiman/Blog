\n <div class="markdown_views"><p><strong>Mysql复制功能提供分担读负载</strong></p>\n\n<ul>\n<li>复制基于主库上的二进制日志（异步）</li>\n<li>同一时间点，备库上的数据和主库不一致（主复数据延迟也无法控制）</li>\n</ul>\n\n<p><img src="http://img.blog.csdn.net/20170609114046405?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><strong>复制解决问题</strong> <br />\n<img src="http://img.blog.csdn.net/20170609114904192?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170609114917536?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170609114934599?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170609115008645?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170609115016801?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170609115024723?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="mysql日志">mysql日志</h3>\n\n<p><img src="http://img.blog.csdn.net/20170609115140818?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170609115305432?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">'binlog_format'</span>\n<span class="hljs-keyword">set</span> <span class="hljs-keyword">session</span> binlog_format = STATEMENT(直接记录修改时的<span class="hljs-keyword">sql</span>段)\n<span class="hljs-keyword">show</span> binary_logs;</span>\nflush logs;\n<span class="hljs-operator"><span class="hljs-keyword">show</span> binary logs;</span>\ncd /home/mysql/sql_log\nls -lh\nmysqlbinlog 日志名</code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170609132725514?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170609132903524?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<strong>而且对于特定函数如UUID(),USER()非确定函数还是无法复制，而且如果有使用这样的函数，可能会造成MySQL复制的主备服务器数据不一致</strong></p>\n\n\n\n<h4 id="statement日志格式">STATEMENT日志格式</h4>\n\n<p><img src="http://img.blog.csdn.net/20170609133709232?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="row日志格式推荐">ROW日志格式（推荐）</h4>\n\n<p>mysql5.7默认基于行的日志格式，记录增删改查操作所修改行的信息</p>\n\n<p><img src="http://img.blog.csdn.net/20170609133932280?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170609134114046?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<strong>主从复制延时的主要原因就是从服务器存放主服务器二进制日志的效率</strong></p>\n\n<p><img src="http://img.blog.csdn.net/20170609140652684?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170609143247289?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170609143052462?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">'binlog_row_image'</span>;</span></code></pre>\n\n<p>full：默认值，记录所有的行信息 <br />\n<strong>minimal:只记录要修改列的记录（推荐）</strong> <br />\nnoblob:记录除了blog和text之外(如果blog或者text没有修改的话)的所有字段</p>\n\n<p>row日志内容： <br />\n<img src="http://img.blog.csdn.net/20170609141735941?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<pre class="prettyprint"><code class=" hljs lasso">mysqlbinlog <span class="hljs-attribute">-vv</span> mysql<span class="hljs-attribute">-bin</span><span class="hljs-number">.000000</span>日志名</code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170609141922286?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><strong>minimal，只记录了3的修改</strong></p>\n\n<p><img src="http://img.blog.csdn.net/20170609142517803?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><strong>noblob,c2是text的类型，c2（第三列）没有显示</strong> <br />\n<img src="http://img.blog.csdn.net/20170609142843252?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170609143544559?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170609143825825?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="sbr">SBR</h4>\n\n<ul>\n<li>逻辑复制，主库记录数据修改的语句，备库读取并且存放这些数据语句（重新执行一遍），基于段 <br />\n<ul><li>定义不同，数据类型可以兼容，或者是列的顺序不同，对大表结构进行修改可以先修改小表，然后主从切换（在线进行大表结构修改的一个很好的方法）</li>\n<li><strong>优点</strong></li>\n<li><img src="http://img.blog.csdn.net/20170610113900579?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></li>\n<li><strong>缺点</strong></li>\n<li><img src="http://img.blog.csdn.net/20170610115253574?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></li>\n<li>非确定事件，比如UUID</li></ul></li>\n</ul>\n\n\n\n<h4 id="rbr">RBR</h4>\n\n<ul>\n<li><strong>优点</strong></li>\n<li><img src="http://img.blog.csdn.net/20170610120746405?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></li>\n<li>使用以上sql时，RBR就不再需要执行锁表的操作了</li>\n<li><strong>缺点</strong></li>\n<li><img src="http://img.blog.csdn.net/20170610121238616?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></li>\n<li>当我们想在从服务器上使用触发器进行数据变更记录时，数据抽取（不行）</li>\n</ul>\n\n\n\n<h3 id="mysql复制方式">Mysql复制方式</h3>\n\n<ul>\n<li>启动二进制日志需要重启服务器，注意上线之前确保二进制日志已经开启</li>\n</ul>\n\n<p><img src="http://img.blog.csdn.net/20170610122013454?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="基于日志点的复制配置步骤">基于日志点的复制配置步骤</h3>\n\n<p><img src="http://img.blog.csdn.net/20170610124900884?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><strong>建议ip网段只对存在从服务器的网段来授权</strong></p>\n\n\n\n<h4 id="配置主数据库服务器">配置主数据库服务器</h4>\n\n<p><img src="http://img.blog.csdn.net/20170610125932367?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="配置从数据库服务器">配置从数据库服务器</h4>\n\n<p><img src="http://img.blog.csdn.net/20170610130340434?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n - 启动mysql二进制文件(如果之前没有启动过，需要重启服务器) <br />\n - server_id 动态参数，也就是说可以通过set来设置（临时修改），配置文件（永久修改），唯一 <br />\n - relay_log中继日志进行固定，因为默认是以主机名为中继日志名的 <br />\n - log_slave_update链路复制(当该从服务器做为其他服务器的主服务器时，必须)</p>\n\n\n\n<h4 id="初始化从服务器数据">初始化从服务器数据</h4>\n\n<p><img src="http://img.blog.csdn.net/20170610131042501?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<pre class="prettyprint"><code class=" hljs lasso">mysqldump 逻辑备份\n如果是混合表的话，添加参数<span class="hljs-subst">--</span>lock<span class="hljs-attribute">-all</span><span class="hljs-attribute">-tables</span>\n备份对数据库需要加锁（影响并发性，在频繁系统，会造成大量的阻塞）\n<span class="hljs-subst">--</span>master<span class="hljs-attribute">-data</span>在备份时，主库当前的二进制文件拼音量的信息（只有使用了这个命令才能在从库使用change_master_to启动主从复制的链路）</code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170610165538192?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">第二种方式：</span>\n<span class="hljs-comment">不阻塞服务器的操作，可以在不影响主库的操作下设置从库（InnoDb，最好的方式）</span>\n<span class="hljs-comment">但是混合数据引擎时，同样会对表进行锁操作</span>\n<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">slave</span><span class="hljs-literal">-</span><span class="hljs-comment">info记录日志信息和日志偏移量信息</span></code></pre>\n\n\n\n<h4 id="启动复制链路">启动复制链路</h4>\n\n<p><img src="http://img.blog.csdn.net/20170610170036941?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="基于日志点的复制配置演示">基于日志点的复制配置演示：</h3>\n\n<p><img src="http://img.blog.csdn.net/20170610170315147?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<pre class="prettyprint"><code class=" hljs perl">more /etc/<span class="hljs-keyword">my</span>.cnf</code></pre>\n\n\n\n<h5 id="主服务器配置">主服务器配置</h5>\n\n<p><img src="http://img.blog.csdn.net/20170610170502290?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170610170513259?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h5 id="从服务器配置">从服务器配置</h5>\n\n<p><img src="http://img.blog.csdn.net/20170610170626620?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170610170704027?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><strong>修改配置后，就开始备份了</strong> <br />\n主库：</p>\n\n\n\n<pre class="prettyprint"><code class=" hljs lasso">mysqldump <span class="hljs-subst">--</span>single<span class="hljs-attribute">-transaction</span> <span class="hljs-subst">--</span>master<span class="hljs-attribute">-data</span> <span class="hljs-subst">--</span>tirggers <span class="hljs-subst">--</span>routines <span class="hljs-subst">--</span><span class="hljs-literal">all</span><span class="hljs-attribute">-databases</span> <span class="hljs-attribute">-uroot</span> <span class="hljs-attribute">-p</span> <span class="hljs-subst">&gt;&gt;</span> <span class="hljs-literal">all</span><span class="hljs-built_in">.</span>sql(前提，mysql版本号一致,如果不一致，就不要备份mysql数据库了)</code></pre>\n\n<p><em>日志名字和日志偏移量</em> <br />\n<img src="http://img.blog.csdn.net/20170610171900871?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n从库：</p>\n\n\n\n<pre class="prettyprint"><code class=" hljs cmake">yum <span class="hljs-keyword">install</span> openssh-clients</code></pre>\n\n<p>主库：</p>\n\n\n\n<pre class="prettyprint"><code class=" hljs ruby">备份到从库\nscp .all.sql root<span class="hljs-variable">@192</span>.<span class="hljs-number">168.3</span>.<span class="hljs-number">101</span><span class="hljs-symbol">:/root</span> 传输</code></pre>\n\n<p>从库：</p>\n\n\n\n<pre class="prettyprint"><code class=" hljs lasso">mysql <span class="hljs-attribute">-uroot</span> <span class="hljs-attribute">-p</span> <span class="hljs-subst">&lt;</span> <span class="hljs-literal">all</span><span class="hljs-built_in">.</span>sql</code></pre>\n\n\n\n<h4 id="启动复制链路-1">启动复制链路</h4>\n\n<p>从库： <br />\n<img src="http://img.blog.csdn.net/20170610171940125?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170610172043046?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p>查看主从进程 <br />\n<img src="http://img.blog.csdn.net/20170610172123813?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">start</span> slave;</span>启动复制链路。</code></pre>\n\n<p>主库： <br />\n<img src="http://img.blog.csdn.net/20170610172222689?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="基于日志点的复制">基于日志点的复制</h4>\n\n<p>优点： <br />\n<img src="http://img.blog.csdn.net/20170610172608738?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n缺点： <br />\n<img src="http://img.blog.csdn.net/20170610172818196?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n因为每一个服务器的二进制文件都是独立的，很难找到日志点 <br />\n<img src="http://img.blog.csdn.net/20170610173033794?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="基于gtid的复制56存在bug">基于GTID的复制（5.6，存在bug）</h3>\n\n<p><strong>mysql5.6开始</strong> <br />\n<img src="http://img.blog.csdn.net/20170610173124600?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="基于gtid的复制和基于日志的复制对比">基于GTID的复制和基于日志的复制对比</h3>\n\n<p><img src="http://img.blog.csdn.net/20170614215324763?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170614215407757?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<pre><code> - source_id执行事务主库的server UUID的值(server UUID是 mysql首次启动自动生成，保存在数据库中的数据目录中)\n - 每一个mysql事务的UUID都是不同的\n</code></pre>\n\n<p>- transaction_id从1开始逐级递增 <br />\n - 事务：GTID = 1 : 1 <br />\n - 不要手动在从服务器建立相同的账号，把所有没有在从服务器执行的事务都同步到从上去，会导致启动复制链路时出现错误</p>\n\n\n\n<h4 id="主db-server-建立-复制账号">主DB Server 建立 复制账号</h4>\n\n<p><img src="http://img.blog.csdn.net/20170614220615735?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="配置主数据库服务器-1">配置主数据库服务器</h4>\n\n<p><strong>数据目录和存放二进制的log目录最好分开（最好分类磁盘分区，会提高磁盘io的提升）</strong> <br />\n<img src="http://img.blog.csdn.net/20170614221456470?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170614221512986?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li>enforce-gtid-consiste 强制GTID的一致性，保证事务的安全 <br />\n<ul><li>不能存在create table … select 的操作</li>\n<li>不能存在create temporary table的操作</li>\n<li>不能在同一个事务中混合的更新事务表和非事务表</li>\n<li>log-slave-updates 从服务器记录主服务器传输过来的修改日志（5.7之前必填，不过会增加从服务器IO负载）</li></ul></li>\n</ul>\n\n\n\n<h4 id="配置从数据库服务器-1">配置从数据库服务器</h4>\n\n<p><img src="http://img.blog.csdn.net/20170614221557330?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170614221920408?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n - 从服务器连接主服务器的信息以及中继日志的存储方式，默认存储在文件中 <br />\n - 存到表中，Innodb存储引擎，如果数据库崩溃，利用Innodb存储引擎的特点，进行崩溃恢复，以保证从服务器可以从正确的位置重新同步主服务器</p>\n\n\n\n<h4 id="初始化从数据库服务器">初始化从数据库服务器</h4>\n\n<p><img src="http://img.blog.csdn.net/20170614222259053?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="启动基于gtid的复制">启动基于GTID的复制</h4>\n\n<p><img src="http://img.blog.csdn.net/20170614222401147?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="基于gtid的复制配置演示">基于GTID的复制配置演示：</h3>\n\n<p><img src="http://img.blog.csdn.net/20170614222558538?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h5 id="主服务器配置-1">主服务器配置</h5>\n\n<p><img src="http://img.blog.csdn.net/20170614222811305?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h5 id="从服务器配置-1">从服务器配置</h5>\n\n<p><img src="http://img.blog.csdn.net/20170614222914665?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<pre class="prettyprint"><code class=" hljs avrasm">全部重启数据库服务器\n/etc/init<span class="hljs-preprocessor">.d</span>/mysql restart</code></pre>\n\n\n\n<h4 id="备份主数据库文件">备份主数据库文件</h4>\n\n<p><img src="http://img.blog.csdn.net/20170614223220995?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170614223255739?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="转移主数据库文件">转移主数据库文件</h4>\n\n<p><img src="http://img.blog.csdn.net/20170614223412084?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="从数据库恢复传输过来的数据库文件">从数据库恢复传输过来的数据库文件</h4>\n\n<p><img src="http://img.blog.csdn.net/20170614223501747?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="从服务器启动复制">从服务器启动复制</h4>\n\n<p><img src="http://img.blog.csdn.net/20170614223650276?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">show</span> processlist\n<span class="hljs-keyword">show</span> slave status</span></code></pre>\n\n\n\n<h4 id="基于gtid复制的优缺点">基于GTID复制的优缺点</h4>\n\n<p><img src="http://img.blog.csdn.net/20170614224631705?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170614225305069?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li>从主从切换来看，倾向于GTID</li>\n<li>mm（只基于日志点的复制）和mha(Master High Availability)（都支持）</li>\n</ul>\n\n\n\n<h3 id="mysql复制拓扑">MySQL复制拓扑</h3>\n\n<ul>\n<li><strong>MySQL5.7之前，一个从库只能有一个主库</strong></li>\n<li>5.7之后，支持一从多主架构</li>\n</ul>\n\n\n\n<h4 id="一主多从的复制拓扑">一主多从的复制拓扑</h4>\n\n<p><img src="http://img.blog.csdn.net/20170615082217726?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><strong>优点</strong> <br />\n<img src="http://img.blog.csdn.net/20170615082157444?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li>方便主从切换，主（只读），从库同步完毕主数据，从库中选出一个充当新的主库</li>\n<li>延迟相同（mysql复制异步，使数据差异达到最小）</li>\n</ul>\n\n<p><strong>用途</strong></p>\n\n<ul>\n<li>（分隔）前台，数据量小，结果能比较快的返回</li>\n<li>（分隔）后台， 数据量大，查询速度要求不是很明显</li>\n<li>建立不同的索引（前台查询分别指定到不同的从数据库上）</li>\n<li>主库写还是会复制到从上面（解决：分库分表） <br />\n<img src="http://img.blog.csdn.net/20170615082752765?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></li>\n</ul>\n\n<h4 id="主-主双主复制拓扑">主-主（双主）复制拓扑</h4>\n\n<p><img src="http://img.blog.csdn.net/20170615083104766?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<strong>主备模式的主主复制（高可用）</strong> <br />\n<img src="http://img.blog.csdn.net/20170615083811787?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h5 id="配置注意事项">配置注意事项</h5>\n\n<p><img src="http://img.blog.csdn.net/20170615084030836?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<strong>主主模式的主主复制</strong></p>\n\n<p><img src="http://img.blog.csdn.net/20170615083401179?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h5 id="配置注意事项-1">配置注意事项</h5>\n\n<p><img src="http://img.blog.csdn.net/20170615083726756?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li>一台按奇数生成ID，一台按偶数生成ID（自增ID）</li>\n<li>尽量减少数据冲突(其他因素，比如两边同时对数据更新)</li>\n</ul>\n\n\n\n<h5 id="结合">结合</h5>\n\n<p><img src="http://img.blog.csdn.net/20170615084141774?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li>每一个从都会在主上bin_log_dump线程</li>\n<li>主上连接的从不要太多，否则会造成负载，增加网卡带宽</li>\n</ul>\n\n<p><img src="http://img.blog.csdn.net/20170615084619759?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h3 id="mysql复制性能优化">Mysql复制性能优化</h3>\n\n<ul>\n<li>（异步）事务在主库上执行完成后，并记录到二进制文件中，从库才能在二进制文件中，读取完结的事务，并把事务放在从库的中继日志，从库sql线程读取相应的事件，进行存放。</li>\n<li>所以，延迟是不可避免的</li>\n<li>分批复制</li>\n<li>减少二进制日志量</li>\n<li>mysql5.6的多线程复制（每个sql线程只能处理一个数据库上的sql存放）</li>\n</ul>\n\n<h4 id="影响主从延迟的因素">影响主从延迟的因素</h4>\n\n<p><img src="http://img.blog.csdn.net/20170615090010158?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170615090152187?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170615090559504?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="配置多线程复制57">配置多线程复制（5.7）</h4>\n\n<ol>\n<li>停止链路复制</li>\n<li>设置链路并发为逻辑时钟方式</li>\n<li>设置复制线程数量（并发线程处理数）</li>\n<li>重启复制</li>\n</ol>\n\n<p><img src="http://img.blog.csdn.net/20170615090901604?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170615091057340?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170615091132883?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h3 id="mysql复制常见问题">Mysql复制常见问题</h3>\n\n<ul>\n<li>sync_binlog=0，当事务提交之后，MySQL不做fsync之类的磁盘同步指令刷新binlog_cache中的信息到磁盘，而让Filesystem自行决定什么时候来做同步，或者cache满了之后才同步到磁盘。(机器宕机，导致主从数据不一致)</li>\n<li><p>sync_binlog=n，当每进行n次事务提交之后，MySQL将进行一次fsync之类的磁盘同步指令来将binlog_cache中的数据强制写入磁盘。</p>\n\n<p><img src="http://img.blog.csdn.net/20170615091633598?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="- 非正常关机" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170615092658546?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p></li>\n<li><p><strong>服务器每次重启都会生成一个新的二进制日志文件</strong></p></li>\n<li><p>会造成数据差异</p>\n\n<p><img src="http://img.blog.csdn.net/20170615092743379?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p></li>\n</ul>\n\n<p><img src="http://img.blog.csdn.net/20170615093151884?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li><strong>read_only很重要</strong></li>\n<li>在多个主服务器上相同server_id,uuid,启动复制会出现错误</li>\n<li>在多个从服务器上相同server_uuid,不容易发现，隐蔽，一旦生成不重新生成 <br />\n<ul><li><img src="http://img.blog.csdn.net/20170615093749158?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></li></ul></li>\n<li>max_allow_packet不一致,无限制报错，重试，中继日志的损坏</li>\n</ul>\n\n\n\n<h4 id="mysql复制无法解决的问题">Mysql复制无法解决的问题</h4>\n\n<p><img src="http://img.blog.csdn.net/20170615093212439?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<ul>\n<li>分裤分表</li>\n<li>引入组件</li>\n</ul></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
