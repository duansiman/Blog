\n <div class="markdown_views"><h3 id="监控对象">监控对象</h3>\n\n<p><img src="http://img.blog.csdn.net/20170610174233324?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n\n\n<h4 id="数据库可用性监控">数据库可用性监控</h4>\n\n<ul>\n<li><p><em>数据库进程或是端口存在并不意味着数据库就是可用的</em></p></li>\n<li><p><img src="http://img.blog.csdn.net/20170610173837757?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" />也就是说登陆服务器，并且能正确执行mysql命令</p></li>\n<li>数据库性能 <br />\n<ul><li>QPS和DPS</li>\n<li>并发线程数量（同时执行sql语句的数量，不是连接数）</li>\n<li>对Innodb阻塞和死锁进行监控</li></ul></li>\n<li>分区磁盘空间</li>\n</ul>\n\n<p><img src="http://img.blog.csdn.net/20170610175039672?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><strong>防火墙的限制，TCP/IP可能被沾满</strong> <br />\n<strong>确认数据库是否可以连接</strong> <br />\n通过测试账号ping命令返回的信息判断数据库可以通过网络连接（批量） <br />\n<img src="http://img.blog.csdn.net/20170610214037364?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<strong>确定数据库是否可读写</strong> <br />\n<img src="http://img.blog.csdn.net/20170610214408728?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<strong>监控数据库的连接数</strong> <br />\n导致数据库的连接数突然增长：</p>\n\n<ul>\n<li>出现阻塞（数据库并发请求突增）</li>\n<li>像Memcahe这样的缓存失效 <br />\n<img src="http://img.blog.csdn.net/20170610214758607?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n当大于0.8时报警通知管理员。</li>\n</ul>\n\n<h4 id="数据库性能监控">数据库性能监控</h4>\n\n\n\n<pre class="prettyprint"><code class=" hljs sql">周期性执行<span class="hljs-operator"><span class="hljs-keyword">show</span> <span class="hljs-keyword">global</span> status获取QPS</span></code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170610215215487?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170610215944403?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p>MyISAM使用的是表级锁，所有更容易阻塞（实时监控满查询来查看表阻塞）</p>\n\n<p><img src="http://img.blog.csdn.net/20170610220415332?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p>查询阻塞测试： <br />\n连接1（增加一个排它锁）： <br />\n<img src="http://img.blog.csdn.net/20170610220544022?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /> <br />\n<img src="http://img.blog.csdn.net/20170610220703380?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p>连接2（添加事务，被阻塞）： <br />\n<img src="http://img.blog.csdn.net/20170610220841240?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><img src="http://img.blog.csdn.net/20170610221004021?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h4 id="数据库主从复制监控">数据库主从复制监控</h4>\n\n<p><img src="http://img.blog.csdn.net/20170610221315210?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h3 id="数据库主从复制延迟监控">数据库主从复制延迟监控</h3>\n\n\n\n<pre class="prettyprint"><code class=" hljs rust">show slave status（不准确（不能发现这种延迟），网络问题，主上大量的<span class="hljs-keyword">log</span>没有同步到从上，同时从上的<span class="hljs-keyword">log</span>已经被重用完了）</code></pre>\n\n<p><img src="http://img.blog.csdn.net/20170610221550583?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<h4 id="使用多线程的程序同时对于主从服务器的状态进行检查">使用多线程的程序同时对于主从服务器的状态进行检查</h4>\n\n<p><img src="http://img.blog.csdn.net/20170610221732916?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p><strong>当每次修复完主从复制，都要检查主从复制数据的一致性</strong></p>\n\n<h4 id="验证主从复制的数据是否一致">验证主从复制的数据是否一致</h4>\n\n\n\n<pre class="prettyprint"><code class=" hljs lasso">pt<span class="hljs-attribute">-table</span><span class="hljs-attribute">-checksum</span></code></pre>\n\n<ul>\n<li>在主库下进行</li>\n<li>databases 指定数据库的名字</li>\n<li>在test库下创建checksums表，并将监测结果放在其中 <br />\n<img src="http://img.blog.csdn.net/20170610222915867?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzM5MzY0ODE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></li>\n</ul></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
