\n <div class="markdown_views"><h2 id="字符集和校对">字符集和校对</h2>\n\n<p>客户端和服务器设置要要保持一致。 <br />\n校对规则主要是mysql用来比较字符串，比如按照大小写敏感，或者是二进制。 分别对应了cs,ci(不敏感),bin三个对应项 <br />\n可以指定校对规则对字段排序，但是这样可能会不使用原来的索引。</p>\n\n\n\n<h2 id="分布式事务">分布式事务</h2>\n\n<p>XA事务需要一个事务协调器来保证所有的事务参与者都完成了准备工作(第一阶段)。 都准备好，则提交所有事务(第二阶段). Mysql不能扮演这个协调者，只能是参与节点。</p>\n\n\n\n<h3 id="内部xa">内部XA</h3>\n\n<p>平衡多个存储引擎， 以及存储引擎和写二进制日志之间。 <br />\n如果打开了写二进制日志那么对应的还有这部分XA的消耗。可以使用innodb_support_ca设置为0，但是这样又回导致复制不可用。 复制需要二进制日志和XA实物的支持。</p>\n\n\n\n<h3 id="外部xa">外部XA</h3>\n\n<p>也就是一种分布式同步数据的方法。 因为网络延迟，一人等待变成多人等待等等开销。分布式XA的代价表达。 可以使用别的方式来实现这种同步，比如本地写入数据，并且放入队列，更小的进行增量同步，或者使用Mysql本身的复制机制。</p>\n\n\n\n<h2 id="查询缓存">查询缓存</h2>\n\n<p>可以缓存执行计划，省去解析和生成执行计划的过程 <br />\n可以缓存数据，只有sql完全匹配才会命中缓存 <br />\n只要相关的表发生了变化，缓存即刻失效 <br />\n缓存很多时候会成为资源竞争点，所以都是关闭状态的，也可以设置的比较小。</p>\n\n\n\n<h3 id="mysql-如何判断缓存命中">Mysql 如何判断缓存命中</h3>\n\n<p>直接使用客户端发送过来的参数做hash，然后从引用表中查，如何的不同，包括空格等等都会无法命中。</p>\n\n<p>包含不确定因素的函数，比如now()，这种是不会把结果放入缓存的。</p>\n\n<p>缓存可能带来查询的提升，但是因为在查询前先查缓存，查询后插入缓存，这样会是的一些操作的性能下降，并且因为对于缓存的操作都是加锁排他的使得效率更低。</p>\n\n<p>特别是当事务中需改了某个表，这是会设置为该表部分的缓存失效，这个时候如果有该表的查询操作则会等待，这有可能会造成短暂僵死。</p>\n\n<h3 id="让缓存发挥最大作用">让缓存发挥最大作用</h3>\n\n<p>按照刚才说的，貌似用缓存有很多的副作用。为了让其发挥更好的作用，需要一些原则和技巧。 <br />\n使用 SQL_CACHE能够使用缓存， 使用SQL_NO_CACHE 强制不用缓存。</p>\n\n<p>一般对复杂查询，但是返回信息很少的这种数据用缓存比较合适。</p>\n\n<p>再有一个评价缓存好坏的是缓存命中率</p>\n\n<p>一些配置项：</p>\n\n<ul>\n<li>query_cache_type OFF,ON,DEMAND(只有明确写SQL_CACHE的语句才会放入查询缓存)</li>\n<li>query_cache_size 总内存空间</li>\n<li>query_cache_limit 能缓存的最大查询结果。</li>\n</ul>\n\n<p>Mysql缓存替代方案， 可以使用系统内部的缓存而不使用Mysql的缓存。</p></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
