\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-family: Times New Roman;">   </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">有一天，两个不懂</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">mysql</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">内核的人想去了解</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">mysql</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">内核代码，两个人不是去调试代码、查找资料，而是在那边思考。因为不了解内核，所以边思考边去验证。</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-family: Times New Roman;">   </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">使用的</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">mysql</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">代码是</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">5.1.7</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">，调试环境是</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">windows</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">平台下的</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">vs2003</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">。</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;"> </span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;">  </span>Bingxi</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">：“</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">alex</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">，你觉得</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">mysql</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">的启动过程会是什么样的呢？我们以银行为例吧。”</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;">  </span>Alex</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">：“嗯，</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">bingxi</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">。早上银行开门了，会先准备好环境，然后开门迎客，</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">mysql</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">也是这样。</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">Mysql</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">里面会有一个</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">handle_connections_sockets</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">函数，这个函数就好比是个叫号机，每个用户来了都会取个号，然后就会进行业务处理。”</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;">pthread_handler_t handle_connections_sockets(void *arg __attribute__((unused)))</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;">{</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">  </span>……</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">  </span>while (!abort_loop)</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;"> </span><span style="mso-spacerun: yes;"> </span>{</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;">    </span>select((int) max_used_connection,&amp;readFDs,0,0,0) &lt; 0) //</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">有连接了则往下来执行，否则一直等待</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">    </span>……</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;">    </span>accept(sock, my_reinterpret_cast(struct sockaddr *) (&amp;cAddr),&amp;length)<span style="mso-spacerun: yes;">  </span>//</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">接受请求</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">    </span>……</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">    </span>create_new_thread(thd);</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">  </span>}</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;">  </span>//abort_loop=1</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">，则执行到这里进行推出。今天业务不处理了</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;">}</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;"> </span></span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;">  </span>Bingxi</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">：“啊，这里面存在两种可能的，</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">1</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">）用户来一个就分配一个工作人员处理，</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">2</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">）将排号的人丢进工作队列，根据叫号机到指定窗口获取服务。前者的场景适合于请求量大，并且需要响应速度特别快的情况，但是分配也会有个限制，所谓的最大连接数，这样的情况常见于互联网行业，相应地我们可以看到机器的负载变化范围特别大。同样的，这也是它的一个弊端，假设每个业务都复杂（消耗资源型</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">sql</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">语句），同时处理的话，机器会支撑不住，这时候第二种方法就比较好，这种情况属于事务性场景。”</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;">  </span>Alex</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">：“嗯，是的。</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">Mysql</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">选择的是前者，</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">oracle</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">提供两种方法供选择。我们继续往下面的代码看，如果我们配置了线程缓存，且有可用的缓存，则唤醒该线程，否则创建新的线程。”</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;">static void create_new_thread(THD *thd)</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;">{</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"> </span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">    </span>if (cached_thread_count &gt; wake_thread)</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">    </span>{</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">      </span>start_cached_thread(thd);</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">    </span>}</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">    </span>else</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">    </span>{</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">      </span>if ((error=pthread_create(&amp;thd-&gt;real_id,&amp;connection_attrib,</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>handle_one_connection,</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>(void*) thd)))</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">  </span>}</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;">}</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;"> </span></span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;">  </span><span style="mso-spacerun: yes;"> </span>Bingxi</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">：“嗯，老杨。是不是理解银行为客户分配了一个服务人员，在这段期间一直为该客户服务。里面有个代码段，是一直在等用户下命令。但是有可能网络，或者被</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">kill</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">掉了，就像一个人存了</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">100</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">，不断取</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">1</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">块钱一样，被保安带走了。”</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;">pthread_handler_t handle_one_connection(void *arg)</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;">{</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">   </span><span style="mso-spacerun: yes;"> </span>while (!net-&gt;error &amp;&amp; net-&gt;vio != 0 &amp;&amp;</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">           </span>!(thd-&gt;killed == THD::KILL_CONNECTION))</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">    </span>{</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">      </span>net-&gt;no_send_error= 0;</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">      </span>if (do_command(thd))</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>break;</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">    </span>}</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;">}</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;">  </span></span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;">  </span>Alex</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">：“嗯，获取命令，然后执行命令。在</span><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;">dispatch_command</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">函数中，根据不同的客户请求进行响应的处理，比如开账户、存钱等”</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;">bool do_command(THD *thd)</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;">{</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"> </span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;">  </span>if ((packet_length=my_net_read(net)) == packet_error) //</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">获取命令</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;"> </span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="font-size: medium;"><span style="mso-spacerun: yes;">  </span>DBUG_RETURN(dispatch_command(command,thd, packet+1, (uint) packet_length));</span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-family: Times New Roman;"><span style="font-size: medium;">}</span></span></span></p>&#13;\n<p><span style="font-size: medium;"> </span></p> &#13;\n
