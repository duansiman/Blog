\n\n有时候，需要批量执行sql语句，例如批量保存数据等。\n<div><br />&#13;\n</div>&#13;\n<div><strong>批处理特点：</strong></div>&#13;\n<div>   批处理的SQL语句的主题必须一样，不同的是批处理中的占位符的值。</div>&#13;\n<div>&#13;\n<div>&#13;\n<p><br />&#13;\n</p>&#13;\n<p><strong>注意事项：</strong></p>&#13;\n<p>    使用批处理的时候，如果一次执行的记录数过多，最好按10条或者100条执行一次操作，并清空批处理，这样做主要是为了避免内存溢出。</p>&#13;\n</div>&#13;\n</div>&#13;\n<div>&#13;\n<p><br />&#13;\n</p>&#13;\n<p><strong>批处理相关方法</strong></p>&#13;\n<p>         |-- Statement</p>&#13;\n<p>                  void addBatch(String sql)     添加批处理</p>&#13;\n<p>                  void clearBatch()            清空批处理（PreparedStatement接口里面的方法）</p>&#13;\n<p>        <span style="white-space:pre"></span>          int[] executeBatch()         执行批处理</p>&#13;\n<p>         |--PreparedStatement</p>&#13;\n<p>                  void addBatch()              添加批处理</p>&#13;\n<p><br />&#13;\n</p>&#13;\n<p><strong>测试批处理Batch.java</strong></p>&#13;\n<p><strong></strong></p>&#13;\n<pre code_snippet_id="2276699" snippet_file_name="blog_20170320_1_7654061" name="code" class="java">package com.cn.statement;\n\nimport java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.util.ArrayList;\n\nimport org.junit.Test;\n\nimport com.cn.Util.JdbcUtil;\nimport com.cn.entity.User;\n\npublic class Batch {\n\t/**\n\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh 测试批处理\n\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh @throws Exception\n\t */\n\t@Test\n\tpublic void testBatch(){\n\t\t\n\t\tConnection conn = null;\n\t\tPreparedStatement pstmt = null;\n\t\t\n\t\t//准备参数\n\t\tArrayList&lt;User&gt; list = new ArrayList&lt;User&gt;();\n\t\tlist.add(new User("小李", "1234"));\n\t\tlist.add(new User("吴莫愁", "4444"));\n\t\t\n\t\ttry {\n\t\t\t//获取连接对象\n\t\t\tconn = JdbcUtil.getConnection();\n\t\t\t//准备sql\n\t\t\tString sql = "insert into users(name, password) values(?,?)";\n\t\t\t//预编译sql\n\t\t\tpstmt = conn.prepareCall(sql);\n\t\t\t//设置参数\n\t\t\tfor(int i=0; i&lt;list.size(); i++){\n\t\t\t\tUser user = list.get(i);\n\t\t\t\tpstmt.setString(1, user.getName());\n\t\t\t\tpstmt.setString(2, user.getPassword());\n\t\t\t\t\n\t\t\t\tpstmt.addBatch();//将给定的 SQL 命令添加到此 Statement 对象的当前命令列表中。不需要传入sql\n\t\t\t\t\n\t\t\t\tif(i%5 == 0){\n\t\t\t\t\tpstmt.executeBatch();//执行批处理\n\t\t\t\t\tpstmt.clearBatch();//空此 Statement 对象的当前 SQL 命令列表。\n\t\t\t\t}\n\t\t\t}\n\t\t\tpstmt.executeBatch();//执行批处理\n\t\t\tpstmt.clearBatch();//空此 Statement 对象的当前 SQL 命令列表。\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t\tthrow new RuntimeException(e);\n\t\t}finally{\n\t\t\tJdbcUtil.close(conn, pstmt);\n\t\t}\n\t}\n}\n</pre>&#13;\n<p><span style="font-weight:bold">User.java</span></p>&#13;\n<p></p>&#13;\n<pre code_snippet_id="2276699" snippet_file_name="blog_20170320_2_1143835" name="code" class="java">package com.cn.entity;\n\npublic class User {\n\tprivate String name;\n\tprivate String password;\n\tpublic User() {\n\t}\n\tpublic String getName() {\n\t\treturn name;\n\t}\n\tpublic void setName(String name) {\n\t\tthis.name = name;\n\t}\n\tpublic String getPassword() {\n\t\treturn password;\n\t}\n\tpublic void setPassword(String password) {\n\t\tthis.password = password;\n\t}\n\tpublic User(String name, String password) {\n\t\tsuper();\n\t\tthis.name = name;\n\t\tthis.password = password;\n\t}\n\t\n}\n</pre>&#13;\n<p><span style="font-weight:bold">JdbcUtil.java</span></p>&#13;\n<div><pre code_snippet_id="2276699" snippet_file_name="blog_20170320_3_8079955" name="code" class="java">package com.cn.Util;\n\nimport java.io.FileInputStream;\nimport java.io.InputStream;\nimport java.sql.CallableStatement;\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport java.sql.Statement;\nimport java.util.Properties;\n\n/**\n csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh jdbc的工具类\n csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh @author liuzhiyong\n *\n */\npublic class JdbcUtil {\n\tprivate static String url = null;\n\tprivate static String user = null;\n\tprivate static String password = null;\n\tprivate static String driverClass = null;\n\t\n\t/**\n\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh 静态代码块（只调用一次）\n\t */\n\tstatic{\n\t\ttry {\n\t\t\t//读取db.properties文件\n\t\t\tProperties properties = new Properties();\n\t\t\t/**\n\t\t\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh \n\t\t\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh 加载文件\n\t\t\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh \n\t\t\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh . 代表java的命令运行的目录\n\t\t\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh 在java项目下， . java命令的运行目录从项目的根目录MyEclipse工作空间/bin 目录开始\n\t\t\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh 在web项目下， . java命令的运行目录从tomact/bin 目录开始\n\t\t\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh 所以不能用.\n\t\t\t */\n\t\t\t\n\t\t\t/**\n\t\t\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh 使用类路径的读取方式\n\t\t\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh \t/ 斜杠表示classpath的根目录\n\t\t\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh 在java项目下，classpath的根目录从bin目录开始\n\t\t\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh 在web项目下，classpath的根目录从WEB-INF/classes目录开始\n\t\t\t */\n\t\t\tInputStream in = JdbcUtil.class.getResourceAsStream("/db.properties");\n\t\t\tproperties.load(in);\n\t\t\t//读取信息\n\t\t\turl = properties.getProperty("url");\n\t\t\tuser = properties.getProperty("user");\n\t\t\tpassword = properties.getProperty("password");\n\t\t\tdriverClass = properties.getProperty("driverClass");\n\t\t\tSystem.out.println(url);\n\t\t\tSystem.out.println(user);\n\t\t\tSystem.out.println(password);\n\t\t\tSystem.out.println(driverClass);\n\t\t\t//注册驱动程序\n\t\t\tClass.forName(driverClass);\n\t\t} catch (Exception e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\te.printStackTrace();\n\t\t\tSystem.out.println("驱动程序注册出错！");\n\t\t}\n\t}\n\t\n\t/**\n\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh 获取连接对象的方法\n\t */\n\tpublic static Connection getConnection(){\n\t\t\n\t\ttry {\n\t\t\tConnection conn = DriverManager.getConnection(url, user, password);\n\t\t\treturn conn;\n\t\t} catch (SQLException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\te.printStackTrace();\n\t\t\tthrow new RuntimeException(e);\n\t\t}\n\t}\n\n\t/**\n\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh 释放资源的重载方法\n\t */\n\tpublic static void close(Connection conn, Statement stmt, ResultSet rs){\n\t\t\n\t\t//关闭资源（顺序：后打开，先关闭）\n\t\tif(rs != null){\n\t\t\ttry {\n\t\t\t\trs.close();\n\t\t\t} catch (SQLException e) {\n\t\t\t\tSystem.out.println("ResultSet关闭失败！");\n\t\t\t\tthrow new RuntimeException(e);\n\t\t\t}\n\t\t}if(stmt != null){\n\t\t\ttry {\n\t\t\t\tstmt.close();\n\t\t\t} catch (SQLException e) {\n\t\t\t\tSystem.out.println("Statement关闭失败！");\n\t\t\t\tthrow new RuntimeException(e);\n\t\t\t}\n\t\t}\n\t\tif(conn != null){\n\t\t\ttry {\n\t\t\t\tconn.close();\n\t\t\t} catch (SQLException e) {\n\t\t\t\tSystem.out.println("Connection关闭失败！");\n\t\t\t\tthrow new RuntimeException(e);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t csdn-1.html csdn-2.html csdn-3.html csdn-4.html csdn-5.html mysql.sh 释放资源的重载方法\n\t */\n\tpublic static void close(Connection conn, Statement stmt){\n\t\t\n\t\t//关闭资源（顺序：后打开，先关闭）\n\t\tif(stmt != null){\n\t\t\ttry {\n\t\t\t\tstmt.close();\n\t\t\t} catch (SQLException e) {\n\t\t\t\tSystem.out.println("Statement关闭失败！");\n\t\t\t\tthrow new RuntimeException(e);\n\t\t\t}\n\t\t}\n\t\tif(conn != null){\n\t\t\ttry {\n\t\t\t\tconn.close();\n\t\t\t} catch (SQLException e) {\n\t\t\t\tSystem.out.println("Connection关闭失败！");\n\t\t\t\tthrow new RuntimeException(e);\n\t\t\t}\n\t\t}\n\t}\n\t\n}\n</pre></div>&#13;\n<div>&#13;\n<div><strong>数据插入成功：</strong></div>&#13;\n</div>&#13;\n<div>&#13;\n<div> <img src="http://img.blog.csdn.net/20170320124653596?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUVExMDEyNDIxMzk2/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></div>&#13;\n</div>&#13;\n</div>&#13;\n &#13;\n
