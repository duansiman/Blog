\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">在上一篇，</span><span lang="EN-US" xml:lang="EN-US">bingxi</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">和</span><span lang="EN-US" xml:lang="EN-US">alex</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">聊了关于</span><span lang="EN-US" xml:lang="EN-US">list</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的内容。在本篇里，</span><span lang="EN-US" xml:lang="EN-US">bingxi</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">和</span><span lang="EN-US" xml:lang="EN-US">alex</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">会聊到</span><span lang="EN-US" xml:lang="EN-US">innodb</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的动态数组，也称为</span><span lang="EN-US" xml:lang="EN-US">dyn</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">。</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">对应的文件为：</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt; mso-outline-level: 1;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">D:/mysql-5.1.7-beta/storage/innobase/include/dyn0dyn.h</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">D:/mysql-5.1.7-beta/storage/innobase/include/dyn0dyn.ic</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">D:/mysql-5.1.7-beta/storage/innobase/dyn/dyn0dyn.c</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US">1)</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">常用结构体</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Alex</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：“</span><span lang="EN-US" xml:lang="EN-US">bingxi</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，我们前两篇聊了常用结构</span><span lang="EN-US" xml:lang="EN-US">hash</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">、</span><span lang="EN-US" xml:lang="EN-US">list</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，这两个结构很常见。我们快要开始聊文件空间存储了，在那里面有一个常用结构，我们看一下</span><span lang="EN-US" xml:lang="EN-US">fsp0fsp.c</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">中函数，比如</span><span lang="EN-US" xml:lang="EN-US">fsp_get_space_header</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">函数，调用参数里面有</span><span lang="EN-US" xml:lang="EN-US">mtr_t</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">。</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/**************************************************************************</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; mso-outline-level: 1;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">Gets a pointer to the space header and x-locks its page. */</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">UNIV_INLINE</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">fsp_header_t*</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">fsp_get_space_header(</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/*=================*/</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 3;">                     </span>/* out: pointer to the space header, page x-locked */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ulint<span style="mso-tab-count: 1;"> </span>id,<span style="mso-tab-count: 1;">   </span>/* in: space id */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>mtr_t*<span style="mso-tab-count: 1;">     </span>mtr)<span style="mso-tab-count: 1;"> </span>/* in: mtr */</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">我们接着看一下</span><span lang="EN-US" xml:lang="EN-US">mtr_struct</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的定义，在结构体的定义前一行，我们可以看到</span><span lang="EN-US" xml:lang="EN-US">Mini-transaction</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，称为</span><span lang="EN-US" xml:lang="EN-US">mini</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">事务。用于锁信息、</span><span lang="EN-US" xml:lang="EN-US">mtr</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">日志信息。</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/* Mini-transaction handle and buffer */</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">struct mtr_struct{</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ulint<span style="mso-tab-count: 2;">        </span>state;<span style="mso-tab-count: 1;">       </span>/* MTR_ACTIVE, MTR_COMMITTING, MTR_COMMITTED */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>dyn_array_t<span style="mso-tab-count: 1;">    </span>memo;<span style="mso-tab-count: 1;">    </span>/* memo stack for locks etc. */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>dyn_array_t<span style="mso-tab-count: 1;">    </span>log;<span style="mso-tab-count: 1;">  </span>/* mini-transaction log */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ibool<span style="mso-tab-count: 2;">              </span>modifications;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>/* TRUE if the mtr made modifications to</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>buffer pool pages */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ulint<span style="mso-tab-count: 2;">        </span>n_log_recs;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>/* count of how many page initial log records</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>have been written to the mtr log */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ulint<span style="mso-tab-count: 2;">        </span>log_mode; /appex /bin /boot /dev /etc /home /initrd.img /lib /lib64 /lost+found /media /mnt /opt /proc /root /run /sbin /serverspeeder /srv /sys /tmp /usr /var /vmlinuz specifies which operations should be</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>logged; default value MTR_LOG_ALL */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>dulint<span style="mso-tab-count: 2;">             </span>start_lsn;/* start lsn of the possible log entry for</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>this mtr */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>dulint<span style="mso-tab-count: 2;">             </span>end_lsn;/* end lsn of the possible log entry for</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>this mtr */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ulint<span style="mso-tab-count: 2;">        </span>magic_n;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">};</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">我们将要开始</span><span lang="EN-US" xml:lang="EN-US">fsp0fsp.c</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的内容，为了便于内容的独立，会将</span><span lang="EN-US" xml:lang="EN-US">mtr</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的内容先剥离，在讲完存储之后，会继续讲</span><span lang="EN-US" xml:lang="EN-US">B</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">树，然后会到事务。</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;"><span style="font-size: medium;">”</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Bingxi</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：“</span><span lang="EN-US" xml:lang="EN-US">alex</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，我赞同这一点。不过我认为还是把该结构体中的一个常用算法讲下，就是动态数组，</span><span lang="EN-US" xml:lang="EN-US">mtr_t</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">结构体中会有两个这样的结构成员：</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">dyn_array_t<span style="mso-tab-count: 1;">    </span>memo;<span style="mso-tab-count: 1;">    </span>/* memo stack for locks etc. */</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">dyn_array_t<span style="mso-tab-count: 1;">    </span>log;<span style="mso-tab-count: 1;">  </span>/* mini-transaction log */</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">所谓动态数组，就是一个动态的虚拟线性数组，数组的基本元素是</span><span lang="EN-US" xml:lang="EN-US">byte</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，主要用于存放</span><span lang="EN-US" xml:lang="EN-US">mtr</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的锁信息以及</span><span lang="EN-US" xml:lang="EN-US">log</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">。如果对于一个</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">数组不够存放时，需要增加新的</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，每个</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">对应的存放数据字段的长度是固定的</span><span lang="EN-US" xml:lang="EN-US">(</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">默认值是</span><span lang="EN-US" xml:lang="EN-US">512)</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，但是不一定会用完。假设已经用了</span><span lang="EN-US" xml:lang="EN-US">500</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个字节，这时候需要继续存放</span><span lang="EN-US" xml:lang="EN-US">18</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个字节的内容，就会在该块中存放不了，会产生一个新的</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">用于存放。从而前一个</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">使用值为</span><span lang="EN-US" xml:lang="EN-US">500</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">。</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">我们先看了结构体的定义：</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">typedef struct dyn_block_struct<span style="mso-tab-count: 2;">            </span>dyn_block_t;</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">typedef dyn_block_t<span style="mso-tab-count: 3;">                    </span>dyn_array_t;</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;"><span style="font-size: medium;">……</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/*#################################################################*/</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/* NOTE! Do not use the fields of the struct directly: the definition</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">appears here only for the compiler to know its size! */</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">struct dyn_block_struct{</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>mem_heap_t*<span style="mso-tab-count: 1;"> </span>heap;<span style="mso-tab-count: 1;">       </span>/* in the first block this is != NULL </span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>if dynamic allocation has been needed */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ulint<span style="mso-tab-count: 2;">        </span>used;<span style="mso-tab-count: 1;">       </span>/* number of data bytes used in this block */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>byte<span style="mso-tab-count: 2;">        </span>data[DYN_ARRAY_DATA_SIZE];</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>/* storage for array elements */<span style="mso-tab-count: 1;">     </span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>UT_LIST_BASE_NODE_T(dyn_block_t) base;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>/* linear list of dyn blocks: this node is</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>used only in the first block */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>UT_LIST_NODE_T(dyn_block_t) list;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>/* linear list node: used in all blocks */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; mso-outline-level: 1;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">#ifdef UNIV_DEBUG</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ulint<span style="mso-tab-count: 2;">        </span>buf_end;/* only in the debug version: if dyn array is</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>opened, this is the buffer end offset, else</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>this is 0 */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ulint<span style="mso-tab-count: 2;">        </span>magic_n;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">#endif</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">};</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">在这个结构体中，我们可以看到上一篇聊到的</span><span lang="EN-US" xml:lang="EN-US">list</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">结构，可以通过</span><span lang="EN-US" xml:lang="EN-US">list</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">查找</span><span lang="EN-US" xml:lang="EN-US">prev</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">、</span><span lang="EN-US" xml:lang="EN-US">next</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">。</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Alex</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，这里面就带来了一些问题：</span><span lang="EN-US" xml:lang="EN-US">1) dyn_array_t</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">与</span><span lang="EN-US" xml:lang="EN-US">dyn_block_t</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">是同样的定义，而一个动态数组只有一个首结点，那么</span><span lang="EN-US" xml:lang="EN-US">UT_LIST_BASE_NODE_T(dyn_block_t) base</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">成员是不是每个结构体都是有效的，</span><span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">）一开始分配的时候只分配了一个结构体，也就是</span><span lang="EN-US" xml:lang="EN-US">512</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">字节的大小，如果不够用，则扩展了一个，插入到链表里面，链表成员是</span><span lang="EN-US" xml:lang="EN-US">1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个还是</span><span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个？</span><span lang="EN-US" xml:lang="EN-US">3</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">）使用的时候，如何判断一个</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">已经使用满了，比如前面我们说到一个情况：</span><span lang="EN-US" xml:lang="EN-US">500</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个字节剩下了</span><span lang="EN-US" xml:lang="EN-US">12</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个不够</span><span lang="EN-US" xml:lang="EN-US">18</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个时候，产生了一个新的</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，假设这时候要使用其中的</span><span lang="EN-US" xml:lang="EN-US">10</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个字节，两个</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">都是符合，用哪个？如果用后一个，怎么标识前一个是满的。</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;"><span style="font-size: medium;">”</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Alex</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：“你的问题太多了，呵呵。我们先放下问题，看一下动态数组的初始化过程。这里面，我们还需要主意一点。虽然数据结构用的是同一个</span><span lang="EN-US" xml:lang="EN-US">dyn_block_struct</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，但是我们称第一个节点为</span><span lang="EN-US" xml:lang="EN-US">arr</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，表明这个是动态数据的头节点。其它的节点，我们称为</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">节点。</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 15.75pt; mso-char-indent-count: 1.5;"><span style="font-size: small;"><span style="font-size: medium;"><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">现在开始进行</span><span lang="EN-US" xml:lang="EN-US">debug</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，在</span> <span lang="EN-US" xml:lang="EN-US">mtr0mtr.ic</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">文件中的</span><span lang="EN-US" xml:lang="EN-US">mtr_start</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">函数体内设置断点，这里也是动态数组创建的唯一入口，设置断点进行调试。</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/*******************************************************************</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; mso-outline-level: 1;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">Starts a mini-transaction and creates a mini-transaction handle </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">and a buffer in the memory buffer given by the caller. */</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">UNIV_INLINE</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">mtr_t*</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">mtr_start(</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/*======*/</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 3;">                     </span>/* out: mtr buffer which also acts as</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 3;">                     </span>the mtr handle */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>mtr_t*<span style="mso-tab-count: 1;">     </span>mtr)<span style="mso-tab-count: 1;"> </span>/* in: memory buffer for the mtr buffer */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">{</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">    </span>//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">会创建两个动态数组，在两个创建的任一个设置断点</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>dyn_array_create(&amp;(mtr-&gt;memo));</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>dyn_array_create(&amp;(mtr-&gt;log));</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>mtr-&gt;log_mode = MTR_LOG_ALL;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>mtr-&gt;modifications = FALSE;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>mtr-&gt;n_log_recs = 0;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">#ifdef UNIV_DEBUG</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>mtr-&gt;state = MTR_ACTIVE;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>mtr-&gt;magic_n = MTR_MAGIC_N;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">#endif</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>return(mtr);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;">}<span style="mso-tab-count: 2;">            </span></span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">点击</span><span lang="EN-US" xml:lang="EN-US">F11</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">进入函数，查看动态数据的创建过程</span><span lang="EN-US" xml:lang="EN-US">:</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/*************************************************************************</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; mso-outline-level: 1;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">Initializes a dynamic array. */</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">UNIV_INLINE</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">dyn_array_t*</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">dyn_array_create(</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/*=============*/</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>/* out: initialized dyn array */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>dyn_array_t*<span style="mso-tab-count: 1;">  </span>arr)<span style="mso-tab-count: 1;">  </span>/* in: pointer to a memory buffer of</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>size sizeof(dyn_array_t) */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">{</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(arr);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(DYN_ARRAY_DATA_SIZE &lt; DYN_BLOCK_FULL_FLAG);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>arr-&gt;heap = NULL;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>arr-&gt;used = 0;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">#ifdef UNIV_DEBUG</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>arr-&gt;buf_end = 0;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>arr-&gt;magic_n = DYN_BLOCK_MAGIC_N;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">#endif</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>return(arr);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">}</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">执行该函数之后，结构体的情况见图</span><span lang="EN-US" xml:lang="EN-US">1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"> </p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;"><img src="http://hi.csdn.net/attachment/201008/1/0_1280667603SooI.gif" alt="" /></span></span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">创建完成之后，我们就可以使用该动态数组了。作为例子，我们在</span><span lang="EN-US" xml:lang="EN-US">mtr_memo_push</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">函数体内设置断点。</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/*******************************************************</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; mso-outline-level: 1;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">Pushes an object to an mtr memo stack. */</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">UNIV_INLINE</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">void</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">mtr_memo_push(</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/*==========*/</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>mtr_t*<span style="mso-tab-count: 1;">     </span>mtr,<span style="mso-tab-count: 1;"> </span>/* in: mtr */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>void*<span style="mso-tab-count: 1;">      </span>object,<span style="mso-tab-count: 1;">     </span>/* in: object */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ulint<span style="mso-tab-count: 1;"> </span>type)<span style="mso-tab-count: 1;">       </span>/* in: object type: MTR_MEMO_S_LOCK, ... */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">{</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>dyn_array_t*<span style="mso-tab-count: 2;">         </span>memo;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>mtr_memo_slot_t*<span style="mso-tab-count: 1;"> </span>slot;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(object);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(type &gt;= MTR_MEMO_PAGE_S_FIX);<span style="mso-tab-count: 1;">     </span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(type &lt;= MTR_MEMO_X_LOCK);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(mtr);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(mtr-&gt;magic_n == MTR_MAGIC_N);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>memo = &amp;(mtr-&gt;memo);<span style="mso-tab-count: 1;">      </span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; text-indent: 21.75pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US">//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">从动态中分配大小为</span><span lang="EN-US" xml:lang="EN-US">sizeof(mtr_memo_slot_t)</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的空间</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; text-indent: 21.75pt; mso-outline-level: 1;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US">//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">然后对获取的空间进行赋值</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>slot = dyn_array_push(memo, sizeof(mtr_memo_slot_t));</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>slot-&gt;object = object;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>slot-&gt;type = type;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">}</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">从中我们可以得知</span><span lang="EN-US" xml:lang="EN-US">dyn_array_pus</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">是分配空间的地方（</span><span lang="EN-US" xml:lang="EN-US">dyn_array_open</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">函数有这样的功能，本文后面会提到），我们按</span><span lang="EN-US" xml:lang="EN-US">F11</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">进入该函数体。</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/*************************************************************************</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">Makes room on top of a dyn array and returns a pointer to the added element.</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; mso-outline-level: 1;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">The caller must copy the element to the pointer returned. */</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">UNIV_INLINE</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">void*</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">dyn_array_push(</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/*===========*/</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>/* out: pointer to the element */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>dyn_array_t*<span style="mso-tab-count: 1;">  </span>arr,<span style="mso-tab-count: 1;">  </span>/* in: dynamic array */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ulint<span style="mso-tab-count: 2;">        </span>size)<span style="mso-tab-count: 1;"> </span>/* in: size in bytes of the element */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">{</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>dyn_block_t*<span style="mso-tab-count: 1;">  </span>block;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ulint<span style="mso-tab-count: 2;">        </span>used;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(arr);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(arr-&gt;magic_n == DYN_BLOCK_MAGIC_N);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(size &lt;= DYN_ARRAY_DATA_SIZE);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(size);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-tab-count: 1;"><span style="font-size: medium;">       </span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; text-indent: 21pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US">//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">步骤</span><span lang="EN-US" xml:lang="EN-US">1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：取得使用的</span><span lang="EN-US" xml:lang="EN-US">used</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; text-indent: 21pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US">//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">存在多个节点是，</span><span lang="EN-US" xml:lang="EN-US">arr</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">表示的是链表中的首节点</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>block = arr;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>used = block-&gt;used;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-size: medium;">    </span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; text-indent: 21.75pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US">//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">步骤</span><span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：如果首结点</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">有足够的空间存储，则返回指针，并修改</span><span lang="EN-US" xml:lang="EN-US">used</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">值。这种情况只出现在：该动态数组只有一个节点。</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; text-indent: 21.75pt; mso-outline-level: 1;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US">// used + size &lt;= DYN_ARRAY_DATA_SIZE</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">表示有足够的空间存储</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>if (used + size &gt; DYN_ARRAY_DATA_SIZE) {</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>/* Get the last array block */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-tab-count: 2;"><span style="font-size: medium;">              </span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">        </span>//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">步骤</span><span lang="EN-US" xml:lang="EN-US">3</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：首结点没有空间存储，则取得</span><span lang="EN-US" xml:lang="EN-US">base</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">列表的最后一个结点</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">        </span>//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">该函数等价于：</span><span lang="EN-US" xml:lang="EN-US">block =UT_LIST_GET_LAST(arr-&gt;base);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">        </span>//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">如果有多个节点，首先肯定不符合</span><span lang="EN-US" xml:lang="EN-US">used + size &lt;= DYN_ARRAY_DATA_SIZE</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，在后文中有描述。</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>block = dyn_array_get_last_block(arr);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>used = block-&gt;used;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-size: medium;">        </span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">        </span>//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">步骤</span><span lang="EN-US" xml:lang="EN-US">4</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：如果最后一个结点有足够空间，则分配</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; mso-outline-level: 1;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">        </span>//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">否则增加一个新的</span><span lang="EN-US" xml:lang="EN-US">block</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>if (used + size &gt; DYN_ARRAY_DATA_SIZE) {</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 3;">                     </span>block = dyn_array_add_block(arr);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 3;">                     </span>used = block-&gt;used;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>}</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>}</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>block-&gt;used = used + size;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(block-&gt;used &lt;= DYN_ARRAY_DATA_SIZE);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>return((block-&gt;data) + used);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">}</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">该函数的功能就是进行分配空间，如果有足够的空间则分配，否则就调用函数</span><span lang="EN-US" xml:lang="EN-US">dyn_array_add_block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">生成一个新的</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">。假象现在的情形是一个</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">扩展为两个</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的情况。查看该函数的实现。</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/****************************************************************</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; mso-outline-level: 1;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">Adds a new block to a dyn array. */</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">dyn_block_t*</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">dyn_array_add_block(</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">/*================*/</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 4;">                            </span>/* out: created block */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>dyn_array_t*<span style="mso-tab-count: 1;">  </span>arr)<span style="mso-tab-count: 1;">  </span>/* in: dyn array */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">{</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>mem_heap_t*<span style="mso-tab-count: 1;"> </span>heap;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>dyn_block_t*<span style="mso-tab-count: 1;">  </span>block;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(arr);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>ut_ad(arr-&gt;magic_n == DYN_BLOCK_MAGIC_N);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-size: medium;">   </span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; text-indent: 21.75pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US">//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">步骤</span><span lang="EN-US" xml:lang="EN-US">1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：结点是</span><span lang="EN-US" xml:lang="EN-US">1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">扩展为</span><span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，还是</span><span lang="EN-US" xml:lang="EN-US">n</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">扩展为</span> <span lang="EN-US" xml:lang="EN-US">n+1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">（</span><span lang="EN-US" xml:lang="EN-US">n&gt;=2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">）</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; text-indent: 21.75pt; mso-outline-level: 1;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US">// arr-&gt;heap=NULL</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">则是</span><span lang="EN-US" xml:lang="EN-US">1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">扩展为</span> <span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，将自己作为首结点放在链表上，并分配一个内存堆</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>if (arr-&gt;heap == NULL) {</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>UT_LIST_INIT(arr-&gt;base);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>UT_LIST_ADD_FIRST(list, arr-&gt;base, arr);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-size: medium;">       </span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">      </span><span style="mso-spacerun: yes;">  </span>//1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">扩展为</span> <span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的时候，创建一个</span><span lang="EN-US" xml:lang="EN-US">heap</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，</span><span lang="EN-US" xml:lang="EN-US">n</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">扩展</span> <span lang="EN-US" xml:lang="EN-US">n+1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">（</span><span lang="EN-US" xml:lang="EN-US">n&gt;=2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">）时，则使用该</span><span lang="EN-US" xml:lang="EN-US">heap</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>arr-&gt;heap = mem_heap_create(sizeof(dyn_block_t));</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>}<span style="mso-tab-count: 1;">     </span></span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-size: medium;">    </span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; text-indent: 21.75pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US">//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">步骤</span><span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：取得最后一个结点，将该</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的</span><span lang="EN-US" xml:lang="EN-US">used</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">字段进行</span><span lang="EN-US" xml:lang="EN-US">DYN_BLOCK_FULL_FLAG</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">与操作，表示该结点已经使用满。每增加一个新的</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">总要将前一个</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">设置为已满，因此只有最后一个</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">是可用的。即使如前文所例，</span><span lang="EN-US" xml:lang="EN-US">500</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">字节不够用时创建了一个新的</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，第二次有申请</span><span lang="EN-US" xml:lang="EN-US">10</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个字节时，显示显示该块的大小</span><span lang="EN-US" xml:lang="EN-US">&gt;512</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">了，因为</span><span lang="EN-US" xml:lang="EN-US">DYN_BLOCK_FULL_FLAG</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的值为：</span><span lang="EN-US" xml:lang="EN-US">0x1000000UL</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>block = dyn_array_get_last_block(arr);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>block-&gt;used = block-&gt;used | DYN_BLOCK_FULL_FLAG;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>heap = arr-&gt;heap;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">    </span>//</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">步骤</span><span lang="EN-US" xml:lang="EN-US">3</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：创建一个新结点，并插入到链表尾</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>block = mem_heap_alloc(heap, sizeof(dyn_block_t));</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>block-&gt;used = 0;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt; mso-outline-level: 1;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>UT_LIST_ADD_LAST(list, arr-&gt;base, block);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>return(block);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">}</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个结点扩展为</span><span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个结点后，见图</span><span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">（</span><span lang="EN-US" xml:lang="EN-US">prev</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">和</span><span lang="EN-US" xml:lang="EN-US">next</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">指向结构的首字节，便于绘图进行了简化，此处加以说明。</span><span lang="EN-US" xml:lang="EN-US">list</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的</span><span lang="EN-US" xml:lang="EN-US">prev</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">和</span><span lang="EN-US" xml:lang="EN-US">next</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">参考前一篇文章）：</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"> </p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;"><img src="http://hi.csdn.net/attachment/201008/1/0_12806676075MfI.gif" alt="" /></span></span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个结点扩展为</span><span lang="EN-US" xml:lang="EN-US">3</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个结点，见图</span><span lang="EN-US" xml:lang="EN-US">3</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"> </p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;"><img src="http://hi.csdn.net/attachment/201008/1/0_1280667616zBbe.gif" alt="" /></span></span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">到这里，我们就解决了前面的三个问题。问题</span><span lang="EN-US" xml:lang="EN-US">1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：</span><span lang="EN-US" xml:lang="EN-US">dyn_array_t</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">与</span><span lang="EN-US" xml:lang="EN-US">dyn_block_t</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">是同样的定义，而一个动态数组只有一个首结点，那么</span><span lang="EN-US" xml:lang="EN-US">UT_LIST_BASE_NODE_T(dyn_block_t) base</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">成员是不是每个结构体都是有效的？</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;"><span style="font-size: medium;">”</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Alex</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：“这个问题我明白，只有首结点的</span><span lang="EN-US" xml:lang="EN-US">base</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">是有效的。从图</span><span lang="EN-US" xml:lang="EN-US">1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">中可以看出，只有一个结点时，</span><span lang="EN-US" xml:lang="EN-US">base</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">是无效。图</span><span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">中，</span><span lang="EN-US" xml:lang="EN-US">arr</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的</span><span lang="EN-US" xml:lang="EN-US">base</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">有两个成员，首结点是第一个成员，新增加的结点在首结点的后面。图</span><span lang="EN-US" xml:lang="EN-US">3</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">中，</span><span lang="EN-US" xml:lang="EN-US">arr</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的</span><span lang="EN-US" xml:lang="EN-US">base</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">有三个成员，新增的成员在链表尾。”</span><span lang="EN-US" xml:lang="EN-US"> </span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Bingxi</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：“问题</span><span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：一开始分配的时候只分配了一个结构体，也就是</span><span lang="EN-US" xml:lang="EN-US">512</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">字节的大小，如果不够用，则扩展了一个，插入到链表里面，链表成员是</span><span lang="EN-US" xml:lang="EN-US">1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个还是</span><span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个？”</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt; mso-outline-level: 1;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Alex</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：“从</span><span lang="EN-US" xml:lang="EN-US">1</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个扩展到</span><span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个，链表的成员是</span><span lang="EN-US" xml:lang="EN-US">2</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">。”</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Bingxi</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：“问题</span><span lang="EN-US" xml:lang="EN-US">3</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：使用的时候，如何判断一个</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">已经使用满了，比如前面我们说到一个情况：</span><span lang="EN-US" xml:lang="EN-US">500</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个字节剩下了</span><span lang="EN-US" xml:lang="EN-US">12</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个不够</span><span lang="EN-US" xml:lang="EN-US">18</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个时候，产生了一个新的</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，假设这时候要使用其中的</span><span lang="EN-US" xml:lang="EN-US">10</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个字节，两个</span><span lang="EN-US" xml:lang="EN-US">block</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">都是符合，用哪个？如果用后一个，怎么标识前一个是满的。”</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Alex</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：“始终只有最后一个结点可能被使用，只有一个成员时，本身就是最后一个结点。新增结点时，会将前一个结点设置为已满。设置方法如下：</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">block-&gt;used = block-&gt;used | DYN_BLOCK_FULL_FLAG;</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span></span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">这样进行分配操作时候，</span><span lang="EN-US" xml:lang="EN-US">used + size &gt; DYN_ARRAY_DATA_SIZE</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">这个条件一定为真。表示首结点已经用满了，然后取最后一个结点。该条件只有一种情况为否，就是动态数组只有一个成员。</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;">if (used + size &gt; DYN_ARRAY_DATA_SIZE) {</span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>/* Get the last array block */</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-tab-count: 2;"><span style="font-size: medium;">              </span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>block = dyn_array_get_last_block(arr);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>used = block-&gt;used;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: medium;"> </span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>if (used + size &gt; DYN_ARRAY_DATA_SIZE) {</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 3;">                     </span>block = dyn_array_add_block(arr);</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 3;">                     </span>used = block-&gt;used;</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 2;">              </span>}</span></span></span></p>&#13;\n<p class="MsoNormal" style="background: #e6e6e6; margin: 0cm 0cm 0pt;"><span lang="EN-US" xml:lang="EN-US"><span style="font-size: small;"><span style="font-size: medium;"><span style="mso-tab-count: 1;">       </span>}</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;"><span style="font-size: medium;">”</span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Bingxi</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：“</span><span lang="EN-US" xml:lang="EN-US">good</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">，我现在问第</span><span lang="EN-US" xml:lang="EN-US">4</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个问题：我们需要插入三个元素，我们插入一个元素，就需要修改一次</span><span lang="EN-US" xml:lang="EN-US">used,</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">再插入，又得调用</span><span lang="EN-US" xml:lang="EN-US">push</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">函数进行操作。频繁的对</span><span lang="EN-US" xml:lang="EN-US">dyn</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">的数据结构进行操作。这样的效率是很低的。”</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Alex</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：“稍等，我看下代码。找到了，通过</span><span lang="EN-US" xml:lang="EN-US">dyn_array_open</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">、</span><span lang="EN-US" xml:lang="EN-US">dyn_array_close</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">函数可以解决这个问题。这两个函数建议大家看下。另外，我也问你第</span><span lang="EN-US" xml:lang="EN-US">5</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">个问题，是不是大于</span><span lang="EN-US" xml:lang="EN-US">512</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">字节的数据就不能插入？”</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Bingxi</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：“这个问题，请参考函数</span><span lang="EN-US" xml:lang="EN-US">dyn_push_string</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">。其它的函数也看一下，养成看函数的习惯，呵呵。今天就到这儿吧。”</span></span></span></p>&#13;\n<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-size: medium;"><span lang="EN-US" xml:lang="EN-US"><span style="mso-spacerun: yes;">  </span>Alex</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">：“</span><span lang="EN-US" xml:lang="EN-US">ok</span><span style="font-family: 宋体; mso-ascii-font-family: &quot;Times New Roman&quot;; mso-hansi-font-family: &quot;Times New Roman&quot;;">”</span></span></span></p>&#13;\n<p> </p> &#13;\n
