\n <div class="markdown_views"><h2 id="mysql学习笔记之管理和维护篇二">mysql学习笔记之管理和维护篇(二)</h2>\n\n<h3 id="mysql备份与恢复">MySQL备份与恢复　</h3>\n\n<p>好的备份方法和策略，能让数据库更加高效和安全。</p>\n\n<p>数据库的备份分类：</p>\n\n<pre><code>逻辑备份和物理备份\n</code></pre>\n\n<p>备份时需要考虑的因素：</p>\n\n<pre><code>1 确定备份的引擎是事务引擎还是非事务引擎，两种引擎的备份方式是不一样的\n2 确认是全量备份还是增量备份。恢复的时间的查表\n3 可以考虑做异地复制的方式备份，但是复制不能代替备份\n4 要定期做备份，备份周期需要考虑\n5 打开log-bin\n6 经常做备份恢复测试，确认备份是有效的，并可以恢复的。\n</code></pre>\n\n<p>逻辑备份</p>\n\n<pre><code>1 备份方式 mysqldump [options] dbname [tables]\n2 备份多个数据库mysqldump [options] --dtabases dbname1 dbname2\n3 备份所有数据库 mysqldump --all-database\n</code></pre>\n\n<p>恢复</p>\n\n<pre><code>mysql -uxxx -pxxx dbname &lt; xx.dump\n</code></pre>\n\n<p>基于时间点的恢复</p>\n\n<pre><code>1 mysqlbinglog --stop-date='2016-11-11 11:11:11' xxxx.dump | mysql -u xx -pxxx\n</code></pre>\n\n<p>跳过时间点的恢复</p>\n\n<pre><code>2 mysqlbinglog --start-date='2016-11-11 11:11:11' xxxx.dump | mysql -u xx -pxxx\n</code></pre>\n\n<p>基于位置点的恢复</p>\n\n<pre><code>mysqlbinglog --stop--position='123314' xxxx.dump | mysql -u xx -pxxx\n</code></pre>\n\n<p>物理备份和恢复</p>\n\n<pre><code>物理备份又分为冷备份和热备份，它相对于逻辑备份的特点是：备份和恢复的速度更快，原理都是基于cp的\n</code></pre>\n\n<p>冷备份</p>\n\n<pre><code>备份操作：\n 停掉mysql服务，在操作系统级别备份mysql的数据文件和日志文件到备份目录\n\n恢复操作：\n 停掉mysql服务，在操作系统级别恢复mysql的数据库文件，然后重启mysql服务，使用mysqlbinlog工具恢复备份以来的所有binglog\n</code></pre>\n\n<p>热备份</p>\n\n<pre><code>myisam 引擎\n 1 mysqlhotcopy工具\n 2 手工锁表（flush tables for read;）然后cp文件\n\ninnodb 引擎\n\n ibbackup等，采用第三方备份工具\n</code></pre>\n\n<p>表的导出</p>\n\n<pre><code>1 select ... into outfile\n2 mysqldump 导出数据为文本\n</code></pre>\n\n<p>表的导入</p>\n\n<pre><code>1 load data infile ...\n2 mysqlimport \n</code></pre>\n\n\n\n<h3 id="mysql权限与安全">MySQL权限与安全</h3>\n\n<p>mysql的权限管理的原理：</p>\n\n<pre><code>1 用户的身份认证\n2 对用户操作权限的管理\n</code></pre>\n\n<p>mysql的权限管理具体操作</p>\n\n<pre><code>使用grant创建权限\n\n使用show grants for xx@host查看权限\n\n使用grant更改权限\n\n使用revoke回收权限\n\n删除账号 drop user xxx\n</code></pre>\n\n<p>mysql安全问题</p>\n\n<pre><code>1 严格控制操作系统账号和权限\n 锁定mysql用户\n 任何用户都采用独立的账户登录\n mysql用户目录下，除了数据文件目录，其他文件和目录属主都改为root\n\n2 尽量避免以root权限运行mysql\n3 防止DNS欺骗\n4 删除匿名账户\n5 给root账户设置口令\n6 设置安全密码\n7 只授权必须的权限\n8 除了root任何用户不应该有user表权限\n9 不要把file，process，super权限授权给管理员之外的账户\n10 load data local可能带来安全问题，禁用它\n11 meger可能存在安全隐患\n12 drop table 不会收回权限\n13 使用ssl\n14 给所有用户加上ip限制\n15 revoke命令可能有漏洞\n16 选择合适的密码生成器\n17 禁用一些命令\n</code></pre>\n\n\n\n<h3 id="mysql复制">MySQL复制</h3>\n\n<p>通过binlog把日志复制到从服务器，从服务器继续执行，保持主从同步。</p>\n\n<p>mysql的主从支持链式结构</p>\n\n<p>复制的优点：</p>\n\n<pre><code>1 如果主出现问题，可以快速的切换到从\n2 从上可以读，降低主的访问压力\n3 从上可以执行备份，不会影响主服务器的服务\n</code></pre>\n\n<p>了解配置从服务器的配置</p>\n\n<pre><code>这个可以百度一下\n</code></pre>\n\n<p>主要复制启动选项</p>\n\n<pre><code>log-slave-updates 从库上的更新操作是否写二进制日孩子\nmaster-connect-retry 主从丢失连接时的重试时间\nread-only,从服务器只接受超级用户的更新操作\n指定复制的数据库或者表忽略一些库或者表\nslave-skip-errors 忽略一些错误\n</code></pre>\n\n<p>日常管理维护</p>\n\n<pre><code>查看从服务器状态\n show slave status;\n主从同步的维护\n 常用的办法是在负载低的时候阻塞主服务器，强制更新主从同步\n从服务器出现错误的处理\n 可以忽略主服务器的错误或者更新失败语句\n使用blog时可以使用 max_allowed_packet \n\n多主复制时的自增长变量可能产生冲突多台主对应一台从\n\n查看复制进度\n show processlist；\n</code></pre>\n\n<p>切换到从服务器大致步骤</p>\n\n<pre><code>1 停止从服务器 2 将从设置为主 3 将主设置成从\n</code></pre></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
