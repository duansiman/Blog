\n <div class="markdown_views"><h3 id="优化mysql-server">优化MySQL Server</h3>\n\n<p>通过调整mysql server的参数来优化mysql server的效率</p>\n\n<p>查看mysql信息和状态</p>\n\n<pre><code>查看mysql server参数show variables;\n查看运行状态 show status;\n</code></pre>\n\n<p>影响mysql性能的重要参数</p>\n\n<pre><code>适用于myisam\n key_buffer_size 设置索引块缓存的大小\n 查看当前的：show variables like 'key_buffer_size';\n table_cache 表示数据库打开表的缓存数量。\n 每一个连接来都会打开一个表缓存。\n show global status like 'open_tables';\n\n适用于innodb\n innodb_buffer_pool_size\n 定义了表数据和索引数据的最大内存缓冲区大小。\n\n innodb_flush_log_at_trx_commit\n 控制缓冲区中的数据写入到日志文件以及日志文件数据刷新到磁盘的操作时机。 0 每秒一次，并且刷新到磁盘\n 1 事务提交时，刷新到磁盘\n 2 提交事务时，日志缓冲写到日志文件，但是不会刷新到磁盘。对日志文件到磁盘的刷新每秒一次\n\n innodb_addition_mem_pool_size\n 用来存储数据库结构和其他内部数据结构的内存池的大小，默认是1M，不够会自动分配\n innodb_lock_wait_timeout\n 自动监控行锁导致的死锁并进行相应的处理，表锁不自动处理，默认50秒\n\n innodb_support_xa \n 是否支持分布式事务\n\n innodb_log_buffer_size\n 日志缓存的大小一般8-16M\n\n innodb_log_file_size\n 日志组中每个日志文件的大小，默认5M， 负载越高，大点好 \n</code></pre>\n\n\n\n<h3 id="磁盘io问题">磁盘I/O问题　</h3>\n\n<p>咱们介绍了优化sql，数据库对象优化，数据库参数优化，其实他们的目的就是优化和减少磁盘读写，因为磁盘速度实在是太慢了(相对cpu和内存)</p>\n\n<p>选择合适的磁盘阵列 raid0/raid 1/raid 10/raid4/raid5</p>\n\n<pre><code>读写都很频繁，可靠性很高 raid10\n读频繁，写相对较少，可靠性有一定要求 raid5\n读写都很频繁，可靠性不高 raid0\n</code></pre>\n\n<p>使用软连接链接</p>\n\n<pre><code>将不同的数据库表索引指向不同的物理磁盘，从而达到分布磁盘io的目的\n</code></pre>\n\n<p>禁止更新文件的atime</p>\n\n<p>用裸设备存放innodb的共享表空间</p>\n\n<pre><code>操作系统的磁盘io缓存对innodb无帮助，可能有反作用\n</code></pre>\n\n\n\n<h3 id="应用优化">应用优化　</h3>\n\n<p>使用数据库连接池，减少创建释放连接的消耗</p>\n\n<p>减少对mysql的访问</p>\n\n<pre><code>避免对统一数据做重复检索\n使用查询缓存\n show status 查询cache状态\n</code></pre>\n\n\n\n<pre class="prettyprint"><code class=" hljs asciidoc"><span class="hljs-header">mysql&gt; show variables like '%query_cache%';\n+------------------------------+---------+</span>\n<span class="hljs-header">| Variable_name | Value |\n+------------------------------+---------+</span>\n| have<span class="hljs-emphasis">_query_</span>cache | YES |\n| query<span class="hljs-emphasis">_cache_</span>limit | 1048576 |\n| query<span class="hljs-emphasis">_cache_</span>min<span class="hljs-emphasis">_res_</span>unit | 4096 |\n| query<span class="hljs-emphasis">_cache_</span>size | 1048576 |\n| query<span class="hljs-emphasis">_cache_</span>type | OFF |\n| query<span class="hljs-emphasis">_cache_</span>wlock<span class="hljs-emphasis">_invalidate | OFF |</span></code></pre>\n\n<pre><code>增加cache层\n</code></pre>\n\n<p>负载均衡</p>\n\n<pre><code>利用mysql的主从复制分流查询操作\n采用分布式数据库架构\n</code></pre>\n\n<p>其他优化措施</p>\n\n<pre><code> 空闲时间删除myisam表，并修复空洞\n 充分利用列有默认值\n 表尽量不适用自增长字段\n</code></pre></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
