\n\n<div><span style="font-family:Microsoft YaHei; font-size:18px">  DBA发来一个线上慢查询问题， SQL如下(为突出重点省略部分内容)：</span></div>&#13;\n<div><pre code_snippet_id="1633245" snippet_file_name="blog_20160403_1_9471260" name="code" class="sql">select distinct article0_.id, 等字段 from article_table article0_, hits_table articlehit1_ where article0_.id=articlehit1_.id order by hits;</pre><br />&#13;\n<br />&#13;\n</div>&#13;\n<div><span style="font-family:Microsoft YaHei; font-size:18px">EXPLAIN结果：耗时4.03S</span></div>&#13;\n<div><span style="font-family:Microsoft YaHei; font-size:18px"><img src="http://img.blog.csdn.net/20150804020312546" alt="" /><br />&#13;\n</span></div>&#13;\n<div><span style="font-family:Microsoft YaHei; font-size:18px">出乎意料， 竟然会有Using temporary， order by只用到了一张表， 正常情况下不会出现借助辅助表再进行排序的情况（这种情况是多个表都涉及到排序字段才会引起的）， 正常情况应该是只在排序有关系的表排序后然后就进行连接操作（例如本例的inner join）。<span style="color:rgb(51,51,51)"><strong> </strong>索引什么的其实都建好了，&#13;\n 看type字段就能看出来， 可参考<a target="_blank" href="http://blog.csdn.net/wenniuwuren/article/details/44851819" style="font-weight:bold"> MySQL调优 ---- LEFT JOIN</a></span></span></div>&#13;\n<div><strong><span style="color:rgb(51,51,51)"><span style="font-family:Microsoft YaHei; font-size:18px"><br />&#13;\n</span></span></strong></div>&#13;\n<div><strong><span style="color:rgb(51,51,51)"><span style="font-family:Microsoft YaHei; font-size:18px"><br />&#13;\n</span></span></strong></div>&#13;\n<div><span style="color:rgb(51,51,51)"><span style="font-family:Microsoft YaHei; font-size:18px">认真一看SQL语句， 竟然在主键id上加上了distinct， 这不是白白浪费了性能， 尝试修改语句为：</span></span></div>&#13;\n<div><pre code_snippet_id="1633245" snippet_file_name="blog_20160403_2_6853539" name="code" class="sql">select article0_.id, 等字段 from article_table article0_, hits_table articlehit1_ where article0_.id=articlehit1_.id order by hits;</pre><br />&#13;\n<br />&#13;\n</div>&#13;\n<div><span style="font-family:Microsoft YaHei; font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-family:Microsoft YaHei; font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-family:Microsoft YaHei; font-size:18px">EXPLAIN结果： 耗时0.04S</span></div>&#13;\n<div><span style="font-family:Microsoft YaHei; font-size:18px"><img src="http://img.blog.csdn.net/20150804020323390" alt="" /><br />&#13;\n</span></div>&#13;\n<div><span style="font-family:Microsoft YaHei; font-size:18px">竟然因为一个distinct修饰， 让MySQL认为两张表排序需要用到临时表， 真是一个奇葩的问题。 distinct非常耗时， 准备在下一篇博文详细介绍下。 </span></div>&#13;\n &#13;\n
