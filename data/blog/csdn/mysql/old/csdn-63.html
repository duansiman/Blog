\n\n<div style="">事务 (Transaction) 是操作数据库中很重要的一个功能, 它可以让你预定一条, 或者一系列 SQL 语句, 然后一起执行，并且在执行的过程中, 如果其中的某条执行失败, 可以回滚所有已更改的操作. 如果执行成功, 那么这一系列操作都会永久有效. 事务很好的解决了在操作数据库的时候不同步的问题. 同时, 通过事务去执行大数据量的时候, 执行效率可以提高很多很多.<span> </span><br style="background-color:inherit" />&#13;\n</div>&#13;\n<div style=""><br style="background-color:inherit" />&#13;\n</div>&#13;\n<div style="">在PDO中同样可以实现事物处理的功能</div>&#13;\n<div style="">1：开启事物：beginTransaction()方法</div>&#13;\n<div style=""><span style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left">beginTransaction()方法将关闭自动提交（autocommit）模式，直到事物被提交或者回滚以后才恢复</span><br style="background-color:inherit" />&#13;\n</div>&#13;\n<div style=""><span style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left">2：提交事物：commit()方法</span></div>&#13;\n<div style=""><span style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left">commit()方法完成事物的提交操作，成功则返回true，否则返回false。</span></div>&#13;\n<div style=""><span style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left">3：事物回滚：rollBack()方法</span></div>&#13;\n<div style=""><span style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left">rollBack()方法执行事物的回滚操作。</span></div>&#13;\n<div style=""><span style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left"><br style="background-color:inherit" />&#13;\n</span></div>&#13;\n<div style=""><span style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left">例如：</span></div>&#13;\n<p><br />&#13;\n</p>&#13;\n<p></p><pre name="code" class="php">$dbms='mysql';//数据库类型\n$dbName='admin';//使用的数据库\n$user='root';//数据库连接用户名\n$pwd='password';//数据库连接密码\n$host='localhost';//数据库主机名\n$dsn="$dbms:host=$host;port=3306;dbname=$dbName";\ntry {\n $pdo = new PDO($dsn, $user, $pwd);//初始化一个PDO对象，就是创建了数据库连接对象$pdo\n $pdo-&gt;beginTransaction();//开启事物\n $query = "insert into user (username,password) values('admin','123456')";//需要执行的sql语句\n $res = $pdo-&gt;prepare($query);\n if ($res-&gt;execute()) {\n echo "数据添加成功";\n }else{\n echo "数据添加失败";\n }\n $pdo-&gt;commit();//执行事物的提交操作\n}catch(PDOException $e){\n die("Error!: ".$e-&gt;getMessage().'&lt;br&gt;');\n $pdo-&gt;rollBack();//执行事物的回滚操作\n}</pre><br />&#13;\n&#13;\n<div style=""><span style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left">补充：</span></div>&#13;\n<div style=""><span style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left">数据库事务(Database Transaction) ，是指作为单个逻辑工作单元执行的一系列操作，要么完全地执行，要么完全地不执行。<br style="background-color:inherit" />&#13;\n　 　事务处理可以确保除非事务性单元内的所有操作都成功完成，否则不会永久更新面向数据的资源。通过将一组相关操作组合为一个要么全部成功要么全部失败的单 元，可以简化错误恢复并使应用程序更加可靠。一个逻辑工作单元要成为事务，必须满足所谓的ACID（原子性、一致性、隔离性和持久性）属性。<br style="background-color:inherit" />&#13;\n　　事务是数据库运行中的一个逻辑工作单位，由DBMS中的事务管理子系统负责事务的处理。<br style="background-color:inherit" />&#13;\n　　相关属性：<br style="background-color:inherit" />&#13;\n　　原子性（Atomic）（Atomicity)<br style="background-color:inherit" />&#13;\n　　事务必须是原子工作单元；对于其数据修改，要么全都执行，要么全都不执行。通常，与某个事务关联的操作具有共同的目标，并且是相互依赖的。如果系统只执行这些操作的一个子集，则可能会破坏事务的总体目标。原子性消除了系统处理操作子集的可能性。<br style="background-color:inherit" />&#13;\n　　一致性（Consistent）(Consistency)<br style="background-color:inherit" />&#13;\n　 　事务在完成时，必须使所有的数据都保持一致状态。在相关数据库中，所有规则都必须应用于事务的修改，以保持所有数据的完整性。事务结束时，所有的内部数 据结构（如 B 树索引或双向链表）都必须是正确的。某些维护一致性的责任由应用程序开发人员承担，他们必须确保应用程序已强制所有已知的完整性约束。例如，当开发用于转 帐的应用程序时，应避免在转帐过程中任意移动小数点。<br style="background-color:inherit" />&#13;\n　　隔离性（Insulation）(Isolation)<br style="background-color:inherit" />&#13;\n　　由并发事务所作的修 改必须与任何其它并发事务所作的修改隔离。事务查看数据时数据所处的状态，要么是另一并发事务修改它之前的状态，要么是另一事务修改它之后的状态，事务不 会查看中间状态的数据。这称为隔离性，因为它能够重新装载起始数据，并且重播一系列事务，以使数据结束时的状态与原始事务执行的状态相同。当事务可序列化 时将获得最高的隔离级别。在此级别上，从一组可并行执行的事务获得的结果与通过连续运行每个事务所获得的结果相同。由于高度隔离会限制可并行执行的事务 数，所以一些应用程序降低隔离级别以换取更大的吞吐量。<br style="background-color:inherit" />&#13;\n　　持久性（Duration）(Durability）<br style="background-color:inherit" />&#13;\n　　事务完成之后，它对于系统的影响是永久性的。该修改即使出现致命的系统故障也将一直保持。<span> <br />&#13;\n</span></span></div>&#13;\n<br />&#13;\n<p></p>&#13;\n &#13;\n
