\n <div class="markdown_views"><pre class="prettyprint"><code class=" hljs oxygene">-- 创建存储过程\nDROP <span class="hljs-function"><span class="hljs-keyword">PROCEDURE</span> <span class="hljs-title">IF</span> <span class="hljs-title">exists</span> <span class="hljs-title">init_budget_proc</span>;</span>\n<span class="hljs-keyword">CREATE</span> <span class="hljs-function"><span class="hljs-keyword">PROCEDURE</span> <span class="hljs-title">init_budget_proc</span><span class="hljs-params">()</span>\n<span class="hljs-title">BEGIN</span>\n <span class="hljs-title">DECLARE</span> <span class="hljs-title">p_ou</span> <span class="hljs-title">VARCHAR</span> <span class="hljs-params">(64)</span>;</span>\n -- 遍历数据结束标识\n\n DECLARE done varchar(<span class="hljs-number">2</span>);\n\n -- 创建游标\n\n DECLARE ou_cur CURSOR <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span> es.portalorg_ou <span class="hljs-keyword">as</span> ou <span class="hljs-keyword">FROM</span> shop_info es <span class="hljs-keyword">where</span> es.shoptype=<span class="hljs-number">0</span>;\n\n -- 将结束标识绑定到游标\n\n declare <span class="hljs-keyword">continue</span> handler <span class="hljs-keyword">for</span> <span class="hljs-keyword">not</span> found <span class="hljs-keyword">set</span> done = <span class="hljs-keyword">true</span>; \n\n <span class="hljs-keyword">set</span> done = <span class="hljs-keyword">false</span>;\n\n -- 打开游标\n\n OPEN ou_cur;\n\n -- 开始循环\n\n read_loop:<span class="hljs-keyword">LOOP</span>\n FETCH ou_cur <span class="hljs-keyword">into</span> p_ou;\n\n <span class="hljs-keyword">IF</span> done <span class="hljs-keyword">THEN</span>\n leave read_loop;\n\n <span class="hljs-keyword">END</span> <span class="hljs-keyword">IF</span>;\n\n insert <span class="hljs-keyword">into</span> eshop_info_data(code,name,portalorg_ou_mount) <span class="hljs-keyword">select</span> em.`code`,em.`name`,p_ou <span class="hljs-keyword">from</span> eshop_mall_data_info em ;\n\n <span class="hljs-keyword">end</span> <span class="hljs-keyword">LOOP</span>;\n\n -- 关闭游标\n\n close ou_cur;\n\n<span class="hljs-keyword">end</span>;</code></pre>\n\n<p>call init_budget_proc(); 运行成功</p></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
