\n <div class="markdown_views"><p><strong>一、索引基础</strong></p>\n\n\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">select</span> first_name <span class="hljs-keyword">from</span> actor <span class="hljs-keyword">where</span> id = <span class="hljs-number">5</span>;</span></code></pre>\n\n<p>如果在id上建有索引，则Mysql将使用该索引找到id=5的列，也就是说Mysql先在索引上按值进行查找，然后返回符合条件的所有数据。 <br />\n索引可以包含一个或者多个列的值。如果索引包含多个列，那么列的顺序也很重要，因为Mysql只能高效的使用索引的最左前缀列。 <br />\n索引分类： <br />\n普通索引 <br />\n唯一索引 <br />\n主键 <br />\n单列索引和多列索引 <br />\n选择索引列 <br />\n<strong>1、索引的类型</strong> <br />\n<strong>B-tree索引</strong> <br />\nInnoDB使用的是B-tree。存储引擎以不同的方式使用B-tree索引，性能也各有不同，各有优劣。B-tree通常意味着所有的值都按照顺序存储，所以很适合查找范围数据。例如，在一个基于文本域的索引树上，按照字母顺序传递连续的值进行查找是非常合适的。像找出所有以I到K开头的名字效率非常高。 <br />\n可以使用B-tree索引查询的类型：全键值、键值范围、键值前缀 <br />\n假设有数据表</p>\n\n\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> people(\n <span class="hljs-keyword">last</span> name <span class="hljs-keyword">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,\n <span class="hljs-keyword">first</span> name <span class="hljs-keyword">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,\n dob <span class="hljs-keyword">date</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,\n gender enum(<span class="hljs-string">'m'</span>,<span class="hljs-string">'f'</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,\n <span class="hljs-keyword">key</span>(last_name,first_name,dob)\n)</span></code></pre>\n\n<p>索引中包含了last_name,first_name,dob <br />\n适合B-tree索引 <br />\n全值匹配 <br />\n和索引中的所有列进行皮牌，例如前面提到的可用于查找姓名为Cuba Allen、出生于1960-01-01的人 <br />\n匹配最左前缀 <br />\n前面提到的索引可用于查找所有姓为Allen的人，即只使用索引的第一列 <br />\n匹配列前缀 <br />\n例如：查找所有以J开头的姓的人，只用了索引的第一列 <br />\n匹配范围值 <br />\n查找在Allen和Barrymore之间的人，只用了索引的第一列 <br />\nB-tree索引的使用限制： <br />\n1、如果不是按照索引的最左列开始查找，则无法使用索引，对于联合索引如果从左往右第一列不是索引则无法使用索引 <br />\n2、不能跳过索引中的列，也就是无法查找姓为Smith并且在某个特定日期出生的人，如果不指定名（first name）则Mysql只能使用索引的第一列 <br />\n3、如果查询中有某个列的范围查询，则其右边所有的列都无法使用索引。例如： <br />\nwhere last_name = ‘smith’ and first_name like ‘J%’ and dob = ‘2015-05-12’ ，这个查询只能使用索引的前两列，因为like是范围条件。 <br />\n<strong>2、哈希索引</strong> <br />\n基于哈希表的实现，只有精确匹配索引的列查询才有效。对于每一行数据存储引擎都会对所有的索引计算一下哈希码。 <br />\n在Mysql中只有Memory引擎显式的支持哈希索引，Memory同时支持B-tree <br />\n假如有以下表：</p>\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> testhash(\n fname <span class="hljs-keyword">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,\n lname <span class="hljs-keyword">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,\n <span class="hljs-keyword">key</span> <span class="hljs-keyword">using</span> hash(fname)\n)engine = memory</span></code></pre>\n\n<p>哈希索引的使用限制： <br />\n1、哈希索引只包含哈希值和行指针，而不存储字段值，所以不能使用索引中的值来避免读取行。 <br />\n2、哈希索引数据并不是按照索引值顺序存储，所以无法用于排序 <br />\n3、不支持部分索引列的匹配查找。例如在数据A、B列上创建哈希索引，如果查询只有数据A列，则无法使用索引。 <br />\n4、哈希索引只支持等值比较查询，包括=，in &lt;=&gt;，不包括任何范围查询，例如，where price &gt; 100 <br />\n<strong>二、索引的优点</strong> <br />\n1、索引大大减少了服务器需要扫描的数据量 <br />\n2、索引可以帮助服务器避免排序和临时表 <br />\n3、索引可以将随机I/O变为顺序I/O <br />\n非常小的表，通常全表扫描更高效 <br />\n中到大型的表，索引非常有效 <br />\n特大型的表，需要一种技术可以直接区分出需要的一组数据，分区技术 <br />\n<strong>三、高性能索引的策略</strong> <br />\n<strong>1、独立的列</strong> <br />\n独立的列是指索引不能使表达式的一部分，也不能是函数的参数 <br />\n例如，下面的查询无法使用索引</p>\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id + <span class="hljs-number">1</span> = <span class="hljs-number">5</span>;</span></code></pre>\n\n<p><strong>2、前缀索引和索引选择性</strong> <br />\n有时候需要索引很长的字符列，这会让索引变得大且慢。一个策略时前面提到过的模拟哈希索引。但有时不够 <br />\n通常可以索引开始的部分字符，这样可以大大节约索引空间，提高索引效率。但这样会降低索引的选择性，选择性是指不重复的索引值和数据表的记录总数的比值。索引的选择性越高查询效率越高。选择性高的索引可以让Mysql过滤掉更多的行。唯一索引的选择性是1，这是最高的索引，性能也是最好的。 <br />\n<strong>3、多列索引</strong> <br />\n在多个列上建立多个单列索引并不能提高Mysql的查询性能。索引合并策略有时候是一种优化的结果，但实际上更多时候说明了表上的索引建立的很糟糕。 <br />\n<strong>4、选择合适的索引列顺序</strong> <br />\n当不需要考虑和分组时。将选择性最高的列放在索引的最前列，这时候索引列的作用只是用于优化where条件的查找。以下面的查询为例： <br />\nselect csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-331.html csdn-332.html csdn-333.html csdn-334.html csdn-335.html csdn-336.html csdn-337.html csdn-338.html csdn-339.html csdn-33.html csdn-340.html csdn-341.html csdn-342.html csdn-343.html csdn-344.html csdn-345.html csdn-346.html csdn-347.html csdn-348.html csdn-349.html csdn-34.html csdn-350.html csdn-351.html csdn-352.html csdn-353.html csdn-354.html csdn-355.html csdn-356.html csdn-357.html csdn-358.html csdn-359.html csdn-35.html csdn-360.html csdn-361.html csdn-362.html csdn-363.html csdn-364.html csdn-365.html csdn-366.html csdn-367.html csdn-368.html csdn-369.html csdn-36.html csdn-370.html csdn-371.html csdn-372.html csdn-373.html csdn-374.html csdn-375.html csdn-376.html csdn-377.html csdn-378.html csdn-379.html csdn-37.html csdn-380.html csdn-381.html csdn-382.html csdn-383.html csdn-384.html csdn-385.html csdn-386.html csdn-387.html csdn-388.html csdn-389.html csdn-38.html csdn-390.html csdn-391.html csdn-392.html csdn-393.html csdn-394.html csdn-395.html csdn-396.html csdn-397.html csdn-398.html csdn-399.html csdn-39.html csdn-3.html csdn-400.html csdn-401.html csdn-402.html csdn-403.html csdn-404.html csdn-405.html csdn-406.html csdn-407.html csdn-408.html csdn-409.html csdn-40.html csdn-410.html csdn-411.html csdn-412.html csdn-413.html csdn-414.html csdn-415.html csdn-416.html csdn-417.html csdn-418.html csdn-419.html csdn-41.html csdn-420.html csdn-421.html csdn-422.html csdn-423.html csdn-424.html csdn-425.html csdn-426.html csdn-427.html csdn-428.html csdn-429.html csdn-42.html csdn-430.html csdn-431.html csdn-432.html csdn-433.html csdn-434.html csdn-435.html csdn-436.html csdn-437.html csdn-438.html csdn-439.html csdn-43.html csdn-440.html csdn-441.html csdn-442.html csdn-443.html csdn-444.html csdn-445.html csdn-446.html csdn-447.html csdn-448.html csdn-449.html csdn-44.html csdn-450.html csdn-451.html csdn-452.html csdn-453.html csdn-454.html csdn-455.html csdn-456.html csdn-457.html csdn-458.html csdn-459.html csdn-45.html csdn-460.html csdn-461.html csdn-462.html csdn-463.html csdn-464.html csdn-465.html csdn-466.html csdn-467.html csdn-468.html csdn-469.html csdn-46.html csdn-470.html csdn-471.html csdn-472.html csdn-473.html csdn-474.html csdn-475.html csdn-476.html csdn-477.html csdn-478.html csdn-479.html csdn-47.html csdn-480.html csdn-481.html csdn-482.html csdn-483.html csdn-484.html csdn-485.html csdn-486.html csdn-487.html csdn-488.html csdn-489.html csdn-48.html csdn-490.html csdn-491.html csdn-492.html csdn-493.html csdn-494.html csdn-495.html csdn-496.html csdn-497.html csdn-498.html csdn-499.html csdn-49.html csdn-4.html csdn-500.html csdn-501.html csdn-502.html csdn-503.html csdn-504.html csdn-505.html csdn-506.html csdn-507.html csdn-508.html csdn-509.html csdn-50.html csdn-510.html csdn-511.html csdn-512.html csdn-513.html csdn-514.html csdn-515.html csdn-516.html csdn-517.html csdn-518.html csdn-519.html csdn-51.html csdn-520.html csdn-521.html csdn-522.html csdn-523.html csdn-524.html csdn-525.html csdn-526.html csdn-527.html csdn-528.html csdn-529.html csdn-52.html csdn-530.html csdn-531.html csdn-532.html csdn-533.html csdn-534.html csdn-535.html csdn-536.html csdn-537.html csdn-538.html csdn-539.html csdn-53.html csdn-540.html csdn-541.html csdn-542.html csdn-543.html csdn-544.html csdn-545.html csdn-546.html csdn-547.html csdn-548.html csdn-549.html csdn-54.html csdn-550.html csdn-551.html csdn-552.html csdn-553.html csdn-554.html csdn-555.html csdn-556.html csdn-557.html csdn-558.html csdn-559.html csdn-55.html csdn-560.html csdn-561.html csdn-562.html csdn-563.html csdn-564.html csdn-565.html csdn-566.html csdn-567.html csdn-568.html csdn-569.html csdn-56.html csdn-570.html csdn-571.html csdn-572.html csdn-573.html csdn-574.html csdn-575.html csdn-576.html csdn-577.html csdn-578.html csdn-579.html csdn-57.html csdn-580.html csdn-581.html csdn-582.html csdn-583.html csdn-584.html csdn-585.html csdn-586.html csdn-587.html csdn-588.html csdn-589.html csdn-58.html csdn-590.html csdn-591.html csdn-592.html csdn-593.html csdn-594.html csdn-595.html csdn-596.html csdn-597.html csdn-598.html csdn-599.html csdn-59.html csdn-5.html csdn-600.html csdn-601.html csdn-602.html csdn-603.html csdn-604.html csdn-605.html csdn-606.html csdn-607.html csdn-608.html csdn-609.html csdn-60.html csdn-610.html csdn-611.html csdn-612.html csdn-613.html csdn-614.html csdn-615.html csdn-616.html csdn-617.html csdn-618.html csdn-619.html csdn-61.html csdn-620.html csdn-621.html csdn-622.html csdn-623.html csdn-624.html csdn-625.html csdn-626.html csdn-627.html csdn-628.html csdn-629.html csdn-62.html csdn-630.html csdn-631.html csdn-63.html csdn-64.html csdn-65.html csdn-66.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh from payment where staff_id = 2 and customer_id = 584; <br />\n是应该创建一个(staff_id,customer_id)索引还是该颠倒下顺序？ <br />\n答案是后者 <br />\n<strong>5、聚簇索引</strong> <br />\n不是单独的索引类型而是一种存储方式。聚簇表示数据行和相邻的键值紧凑的存储在一起。因为无法同时把数据行存放在两个不同的地方，所以一个表只能有一个聚簇索引。 <br />\n聚集的数据优点： <br />\n 1、可以将相关的数据保存在一起，例如实现电子邮箱时，可以根据用户Id聚集数据，这样只需要从磁盘上读取少量数据页就能获取用户全部邮件 <br />\n 2、数据访问更快，聚簇索引将索引和数据保存在同一个B-Tree中，查找更快 <br />\n 3、使用覆盖索引扫描的查询可以直接使用页节点中的主键值。 <br />\n<strong>6、覆盖索引</strong> <br />\n大家都会根据查询的where条件来创建合适的索引，不过这只是索引优化的一个方面。设计优秀的索引应该是考虑到整个查询，而不单单是where的条件查询部分。索引确实是一种高效的查询方式，但是Mysql也可以使用索引来直接获取列，这样就不需要读取数据行。如果索引的叶子节点包含了要查询的数据列，就没有必要再查询表了。如果一个索引包含（或者覆盖）所有需要查询的列，我们称之为覆盖索引。 <br />\nMysql只能使用B-Tree索引做覆盖索引。 <br />\n<strong>7、使用索引扫描来做排序</strong> <br />\nMysql有两种方式可以生成有序结果：通过排序操作；或者按索引顺序扫描。如果explain出来的type为index，说明Mysql使用了索引扫描来排序。 <br />\nMysql可以使用同一个索引既满足排序，又用于查找行。如果可能，设计索引时尽可能的同时满足这两种任务，这样是最好的。只有当索引列的顺序和order by子句的顺序完全一样，并且所有列排序方向都一样，Mysql才能够使用索引来对结果进行排序。如果查询需要关联多个表，则只有当order by子句引用的字段全部为第一个表时，才能使用索引做排序。order by子句和查找型查询的限制是一样的：需要满足索引的最左前缀要求，否则，Mysql都要执行排序操作，无法利用索引进行排序。 <br />\n<strong>8、压缩前缀索引</strong> <br />\nMyisam压缩索引快的方法是，先完全保存索引块中的第一个值，然后将其他值和第一个值进行比较得到相同前缀的字节数和不同后缀部分，把这部分存储起来即可。例如： <br />\n第一个值perform，第二个值performance，那么第二个值前缀压缩成7,ance <br />\n<strong>9、冗余和重复索引</strong> <br />\nMysql允许在相同列上创建多个索引，Mysql需要单独维护重复索引，这会影响性能。 <br />\n一个经验不足的用户可能是想创建一个主键，先加上唯一限制，然后再加上索引供查询。事实上，Mysql的唯一限制和主键限制都是通过索引实现的，上面写法实际上在相同列上创建了三个重复的索引。除非是在同一列创建不同类型的索引来满足不同的查询需求。 <br />\n冗余索引和重复索引有些不同，如果创建了索引(A,B)，再创建索引(A)，索引A就是冗余索引。 <br />\n<strong>10、索引和锁</strong> <br />\n如果你的查询不访问那些不需要的行，就会锁定更少的行，锁定行总是需要额外的开销，其次锁定超过需要的行会增加锁竞争并减少并发性。 <br />\n即使使用了索引，InnoDB也可能锁定一些不需要的数据，如果不能使用索引查找锁定行的话，Mysql可能全表扫描并锁定所有行。 <br />\nselect for update 比lock in share mode或非锁定查询慢很多。</p></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
