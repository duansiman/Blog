\n\n<h1><span style="font-size:32px">一、           发现慢查询</span></h1>&#13;\n<div><span style="font-size:14px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:14px">上一讲我们为慢查询的发生做了数据准备，这一讲就让我们来发现慢查询，同时把它记录到文件中</span><span style="font-size:14px">。</span></div>&#13;\n<div><span style="font-size:14px"><br />&#13;\n</span></div>&#13;\n<div>&#13;\n<p><strong><span style="font-size:24px">3.      记录慢查询</span></strong></p>&#13;\n<p><span style="font-size:14px"><br />&#13;\n</span></p>&#13;\n<p><span style="font-size:14px">此时我们已经有让慢查询发生的成本了。执行以下语句，你就知道什么叫慢！查！询！</span></p>&#13;\n<p></p>&#13;\n<pre code_snippet_id="636902" snippet_file_name="blog_20150407_1_9398934" name="code" class="plain">select empno from emp where ename='';</pre><br />&#13;\n<p></p>&#13;\n<span style="font-size:14px"><img src="http://img.blog.csdn.net/20150401162645712?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHp5MzgzMjQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br />&#13;\n</span>&#13;\n<p></p>&#13;\n<p></p>&#13;\n<p><span style="font-size:14px">一个很明显找不到结果的查询语句居然也执行了近3秒钟。</span></p>&#13;\n<p><span style="font-size:14px">这时候，作为DBA就应该把这个sql语句记录下来，是记在记事本还是写在笔记本呢？不用想太多了，不用你自己记，Mysql提供了慢查询日志功能，自动帮你记录慢查询的语句。</span></p>&#13;\n<p><span style="font-size:14px"><strong>1)    把慢查询的sql记录到日志中</strong></span></p>&#13;\n<p><span style="font-size:14px">首先你要打开慢查询日志文件记录器</span></p>&#13;\n<p><span style="font-size:14px">使用</span></p>&#13;\n<p></p>&#13;\n<pre code_snippet_id="636902" snippet_file_name="blog_20150407_2_9828191" name="code" class="plain">show variables like 'slow%';</pre>&#13;\n<p></p>&#13;\n<p><span style="font-size:14px">你会发现默认情况下慢查询日志记录器关闭的</span></p>&#13;\n<p><span style="font-size:14px">使用</span></p>&#13;\n<p></p>&#13;\n<pre code_snippet_id="636902" snippet_file_name="blog_20150406_3_7930212" name="code" class="plain">set global slow_query_log=ON;</pre>&#13;\n<p></p>&#13;\n<p></p>&#13;\n<p>打开之</p>&#13;\n<img src="http://img.blog.csdn.net/20150401164201480?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHp5MzgzMjQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br />&#13;\n<p><span style="font-size:14px"><br />&#13;\n</span></p>&#13;\n<p><span style="font-size:14px">此时你会发现mysql安装目录下的data文件夹中出现了以你本机名命名的日志文件</span></p>&#13;\n<span style="font-size:14px"><img src="http://img.blog.csdn.net/20150401162911647?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHp5MzgzMjQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br />&#13;\n</span>&#13;\n<p><span style="font-size:14px">此时再执行慢查询操作<br />&#13;\n</span></p>&#13;\n<p><span style="font-size:14px"><img src="http://img.blog.csdn.net/20150401163024877?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHp5MzgzMjQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br />&#13;\n</span></p>&#13;\n<p><span style="font-size:14px">打开日志文件发现出现记录<br />&#13;\n</span></p>&#13;\n<p><span style="font-size:14px"><img src="http://img.blog.csdn.net/20150401163139036?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHp5MzgzMjQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br />&#13;\n</span></p>&#13;\n<p></p>&#13;\n<p><span style="font-size:14px">以后只需要定期检查日志文件就可以找到慢查询语句了</span></p>&#13;\n<p><span style="font-size:14px"><br />&#13;\n</span></p>&#13;\n<p><span style="font-size:14px"><strong>注意：</strong></span></p>&#13;\n<p><span style="font-size:14px"><em>在找到慢查询语句后，要通过反复使用select语句确认慢查询，注意只能使用select语句，就算是原来语句为delete或者update等，也要用select代替，因为只有select不会弄脏数据库</em></span></p>&#13;\n<p><span style="font-size:14px"><em><br />&#13;\n</em></span></p>&#13;\n<p><span style="font-size:14px"><strong>2)    另一种发现慢查询语句的方法</strong></span></p>&#13;\n<p><span style="font-size:14px">要是你使用Hibernate进行J2ee开发，可以使用一下方式。</span></p>&#13;\n<span style="font-size:14px">在页面中进行操作，当发现某个操作的响应较慢时，查看Eclipse控制台的Hibernate输出sql语句，此语句即为慢查询语句。</span></div>&#13;\n<div><span style="font-size:14px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:14px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:14px">本章结束，下一章我们将讲解如何使用mysql的性能分析命令Explain。<br />&#13;\n</span></div>&#13;\n &#13;\n
