\n<h3>详细错误信息：</h3><p>严重: StandardWrapper.Throwable<br />org.springframework.transaction.CannotCreateTransactionException: Could not open JDBC Connection for transaction; nested exception is org.apache.commons.dbcp.SQLNestedException: Error preloading the connection pool<br /><span style="white-space:pre">\t</span>at org.springframework.jdbc.datasource.DataSourceTransactionManager.doBegin(DataSourceTransactionManager.java:241)<br /><span style="white-space:pre">\t</span>at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:372)<br /><span style="white-space:pre">\t</span>at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:417)<br /><span style="white-space:pre">\t</span>at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:255)<br /><span style="white-space:pre">\t</span>at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)<br /><span style="white-space:pre">\t</span>at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)<br /><span style="white-space:pre">\t</span>at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:633)<br /><span style="white-space:pre">\t</span>at com.qujiu.base.service.XgPlatformManager$$EnhancerBySpringCGLIB$$112e244c.getPlarMark(&lt;generated&gt;)<br /><span style="white-space:pre">\t</span>at com.qujiu.base.web.init.BaseDataDictionary.init(BaseDataDictionary.java:40)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.StandardWrapper.initServlet(StandardWrapper.java:1284)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1197)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:1087)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.StandardContext.loadOnStartup(StandardContext.java:5210)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5493)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1559)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1549)<br /><span style="white-space:pre">\t</span>at java.util.concurrent.FutureTask.run(FutureTask.java:262)<br /><span style="white-space:pre">\t</span>at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)<br /><span style="white-space:pre">\t</span>at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)<br /><span style="white-space:pre">\t</span>at java.lang.Thread.run(Thread.java:745)<br />Caused by: org.apache.commons.dbcp.SQLNestedException: Error preloading the connection pool<br /><span style="white-space:pre">\t</span>at org.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:868)<br /><span style="white-space:pre">\t</span>at org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:540)<br /><span style="white-space:pre">\t</span>at org.springframework.jdbc.datasource.DataSourceTransactionManager.doBegin(DataSourceTransactionManager.java:203)<br /><span style="white-space:pre">\t</span>... 20 more<br />Caused by: com.mysql.jdbc.exceptions.jdbc4.MySQLNonTransientConnectionException: Data source rejected establishment of connection,  message from server: "Too many connections"<br /><span style="white-space:pre">\t</span>at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)<br /><span style="white-space:pre">\t</span>at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)<br /><span style="white-space:pre">\t</span>at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)<br /><span style="white-space:pre">\t</span>at java.lang.reflect.Constructor.newInstance(Constructor.java:526)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.Util.handleNewInstance(Util.java:411)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.Util.getInstance(Util.java:386)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1014)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:988)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:974)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.MysqlIO.doHandshake(MysqlIO.java:1104)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.ConnectionImpl.coreConnect(ConnectionImpl.java:2412)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:2445)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:2230)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.ConnectionImpl.&lt;init&gt;(ConnectionImpl.java:813)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.JDBC4Connection.&lt;init&gt;(JDBC4Connection.java:47)<br /><span style="white-space:pre">\t</span>at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)<br /><span style="white-space:pre">\t</span>at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)<br /><span style="white-space:pre">\t</span>at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)<br /><span style="white-space:pre">\t</span>at java.lang.reflect.Constructor.newInstance(Constructor.java:526)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.Util.handleNewInstance(Util.java:411)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:399)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:334)<br /><span style="white-space:pre">\t</span>at org.apache.commons.dbcp.DriverConnectionFactory.createConnection(DriverConnectionFactory.java:37)<br /><span style="white-space:pre">\t</span>at org.apache.commons.dbcp.PoolableConnectionFactory.makeObject(PoolableConnectionFactory.java:290)<br /><span style="white-space:pre">\t</span>at org.apache.commons.pool.impl.GenericObjectPool.addObject(GenericObjectPool.java:996)<br /><span style="white-space:pre">\t</span>at org.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:865)<br /><span style="white-space:pre">\t</span>... 22 more<br /><br /><br />七月 30, 2014 12:04:20 下午 org.apache.catalina.core.StandardContext loadOnStartup<br />严重: Servlet /wowo-web threw load() exception<br />com.mysql.jdbc.exceptions.jdbc4.MySQLNonTransientConnectionException: Data source rejected establishment of connection,  message from server: "Too many connections"<br /><span style="white-space:pre">\t</span>at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)<br /><span style="white-space:pre">\t</span>at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)<br /><span style="white-space:pre">\t</span>at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)<br /><span style="white-space:pre">\t</span>at java.lang.reflect.Constructor.newInstance(Constructor.java:526)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.Util.handleNewInstance(Util.java:411)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.Util.getInstance(Util.java:386)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1014)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:988)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:974)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.MysqlIO.doHandshake(MysqlIO.java:1104)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.ConnectionImpl.coreConnect(ConnectionImpl.java:2412)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:2445)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:2230)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.ConnectionImpl.&lt;init&gt;(ConnectionImpl.java:813)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.JDBC4Connection.&lt;init&gt;(JDBC4Connection.java:47)<br /><span style="white-space:pre">\t</span>at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)<br /><span style="white-space:pre">\t</span>at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)<br /><span style="white-space:pre">\t</span>at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)<br /><span style="white-space:pre">\t</span>at java.lang.reflect.Constructor.newInstance(Constructor.java:526)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.Util.handleNewInstance(Util.java:411)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:399)<br /><span style="white-space:pre">\t</span>at com.mysql.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:334)<br /><span style="white-space:pre">\t</span>at org.apache.commons.dbcp.DriverConnectionFactory.createConnection(DriverConnectionFactory.java:37)<br /><span style="white-space:pre">\t</span>at org.apache.commons.dbcp.PoolableConnectionFactory.makeObject(PoolableConnectionFactory.java:290)<br /><span style="white-space:pre">\t</span>at org.apache.commons.pool.impl.GenericObjectPool.addObject(GenericObjectPool.java:996)<br /><span style="white-space:pre">\t</span>at org.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:865)<br /><span style="white-space:pre">\t</span>at org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:540)<br /><span style="white-space:pre">\t</span>at org.springframework.jdbc.datasource.DataSourceTransactionManager.doBegin(DataSourceTransactionManager.java:203)<br /><span style="white-space:pre">\t</span>at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:372)<br /><span style="white-space:pre">\t</span>at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:417)<br /><span style="white-space:pre">\t</span>at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:255)<br /><span style="white-space:pre">\t</span>at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)<br /><span style="white-space:pre">\t</span>at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)<br /><span style="white-space:pre">\t</span>at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:633)<br /><span style="white-space:pre">\t</span>at com.qujiu.base.service.XgPlatformManager$$EnhancerBySpringCGLIB$$112e244c.getPlarMark(&lt;generated&gt;)<br /><span style="white-space:pre">\t</span>at com.qujiu.base.web.init.BaseDataDictionary.init(BaseDataDictionary.java:40)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.StandardWrapper.initServlet(StandardWrapper.java:1284)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1197)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:1087)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.StandardContext.loadOnStartup(StandardContext.java:5210)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5493)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1559)<br /><span style="white-space:pre">\t</span>at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1549)<br /><span style="white-space:pre">\t</span>at java.util.concurrent.FutureTask.run(FutureTask.java:262)<br /><span style="white-space:pre">\t</span>at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)<br /><span style="white-space:pre">\t</span>at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)<br /><span style="white-space:pre">\t</span>at java.lang.Thread.run(Thread.java:745)<br /><br />七月 30, 2014 12:04:20 下午 org.apache.catalina.core.ApplicationContext log<br />信息: Initializing Spring FrameworkServlet 'springmvc'<br />七月 30, 2014 12:04:21 下午 org.apache.coyote.AbstractProtocol start<br />信息: Starting ProtocolHandler ["http-bio-8080"]<br />七月 30, 2014 12:04:21 下午 org.apache.coyote.AbstractProtocol start<br />信息: Starting ProtocolHandler ["ajp-bio-8009"]<br />七月 30, 2014 12:04:21 下午 org.apache.catalina.startup.Catalina start<br />信息: Server startup in 18779 ms<br /></p><h3>问题分析：</h3><p>查看MySQL的当前最大连接数，登录MySQL：mysql -uroot -p，回车；输入密码，回车；</p><p>输入命令：<span style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px;">select VARIABLE_VALUE from information_schema.GLOBAL_VARIABLES where VARIABLE_NAME='MAX_CONNECTIONS'; 回车</span></p><p><span style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px;">显示当前最大连接数为：151，之前通过文章“<a target="_blank" href="http://blog.csdn.net/testcs_dn/article/details/37880489" style="color: rgb(0, 0, 0); text-decoration: none; font-family: 'Microsoft YaHei'; font-size: 20px; line-height: 30px;">CentOS下mysql最大连接数设置 1040 too many connection</a>”中的方法设置为3600了，现在怎么又变成151了？原来这个方法只是临时的修改了最大连接数，重新启动MySQL服务后就还原了。</span></p><h3><span style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px;">解决问题：</span></h3><p><span style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px;">要彻底解决问题还是要修改my.cnf配置文件，这里使用VI来修改，输入命令：vi /usr/my.cnf 回车；打开文件后按“i”键进入编辑状态；</span></p><p><span style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px;">在“[mysqld]”下面添加“max_connections=3600”，按Esc键进入命令模式，输入“:wq”回车（保存并退出）。</span></p><p><span style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px;">执行：service mysql restart 重新启动MySQL服务；启动服务的时间可能有点长，耐心等待……</span></p><p></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px;"><strong><span style="color: rgb(255, 0, 0);">注意：很多文章中提到在“[mysqld]”下面添加“<span style="font-family: 'Courier New'; white-space: pre-wrap; margin: 0px; padding: 0px; line-height: 1.5 !important;">set</span><span style="font-family: 'Courier New'; line-height: 21.600000381469727px; white-space: pre-wrap; background-color: rgb(240, 240, 240);">-variable=max_connections=</span><span style="font-family: 'Courier New'; white-space: pre-wrap; margin: 0px; padding: 0px; line-height: 1.5 !important;">1000</span>”，根本不行，加了之后服务就启动不了了。</span></strong></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px;"><span style="color: rgb(255, 0, 0);"><strong>我这的环境是：CentOS 6.5  MySQL 5.6</strong></span></p><br /><p><br /></p> &#13;\n
