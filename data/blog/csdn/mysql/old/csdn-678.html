\n<h1>MyCAT</h1><p><br /></p><p>MyCat是基于阿里开源的Cobar产品而研发，Cobar的稳定性、可靠性、优秀的架构和性能以及众多成熟的使用案例使得MYCAT一开始就拥有一个很好的起点，站在巨人的肩膀上，我们能看到更远。业界优秀的开源项目和创新思路被广泛融入到MYCAT的基因中，使得MYCAT在很多方面都领先于目前其他一些同类的开源项目，甚至超越某些商业产品。</p>MYCAT背后有一支强大的技术团队，其参与者都是5年以上资深软件工程师、架构师、DBA等，优秀的技术团队保证了MYCAT的产品质量。<br />MYCAT并不依托于任何一个商业公司，因此不像某些开源项目，将一些重要的特性封闭在其商业产品中，使得开源项目成了一个摆设。<br />因此，MyCat你可以认为是从Amoeba-&gt;Cobar一路过来的最终版升级者。<br />由于MyCat和Corba都是Amoeba框架上发展而来的，如果一个具有Amoeba配置经验的开发者可以几乎不用看任何文档而可以直接使用MyCat来实现mySQL的读写分离更重要的是，基于myCat你可以实现数据的垂直和水平切割，它使得了mySQL据有了真正的“集群”的能力，并为去IOE做好了最终的准备。<br /><p>myCAT开源项目维护很频繁，目前最新版已经到了1.5 Release(23天前刚维护过)。因此它的维护性、稳定性是得到了保证的。同时myCat的文档极其丰富，参于开发的人员又很多，所以它可以应付很多在以往的Amoeba以及Corba上未能解决的问题，它是一个可以真正被应用在生产环境上的数据库中间件。在下面的章节我们将使用myCat来实现mySQL的读写分离和垂直水平折分的具体案例。</p><p><br /></p><h1>myCat介绍</h1><p><br /></p><p>什么是MyCAT?简单的说，MyCAT就是：</p><p></p><ul><li> 一个彻底开源的，面向企业应用开发的“大数据库集群” 支持事务、ACID、可以替代Mysql的加强版数据库</li><li>一个可以视为“Mysql”集群的企业级数据库，用来替代昂贵的Oracle集群 </li><li>一个融合内存缓存技术、Nosql技术、HDFS大数据的新型SQL Server </li><li>结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品 </li><li>一个新颖的数据库中间件产品</li></ul><div><strong><br /></strong></div><div><strong>目标</strong></div><div><strong><br /></strong>低成本的将现有的单机数据库和应用平滑迁移到“云”端，解决数据存储和业务规模迅速增长情况下的数据瓶颈问题。<br />关键特性<br />支持 SQL 92标准 支持Mysql集群，可以作为Proxy使用 支持JDBC连接ORACLE、DB2、SQL Server，将其模拟为MySQL Server使用 支持galera for mysql集群，percona-cluster或者mariadb cluster，提供高可用性数据分片集群，自动故障切换，高可用性 ，支持读写分离，支持Mysql双主多从，以及一主多从的模式 ，支持全局表，数据自动分片到多个节点，用于高效表关联查询 ，支持独有的基于E-R 关系的分片策略，实现了高效的表关联查询多平台支持，部署和实施简单。<br /><br /></div><div><strong>优势</strong></div><div><br />基于阿里开源的Cobar产品而研发，Cobar的稳定性、可靠性、优秀的架构和性能，以及众多成熟的使用案例使得MyCAT一开始就拥有一个很好的起点，站在巨人的肩膀上，我们能看到更远。广泛吸取业界优秀的开源项目和创新思路，将其融入到MyCAT的基因中，使得MyCAT在很多方面都领先于目前其他一些同类的开源项目，甚至超越某些商业产品。MyCAT背后有一只强大的技术团队，其参与者都是5年以上资深软件工程师、架构师、DBA等，优秀的技术团队保证了MyCAT的产品质量。 MyCAT并不依托于任何一个商业公司，因此不像某些开源项目，将一些重要的特性封闭在其商业产品中，使得开源项目成了一个摆设。<br /><br /><br /><strong>长期规划</strong></div><div><br />在支持Mysql的基础上，后端增加更多的开源数据库和商业数据库的支持，包括原生支持PosteSQL、FireBird等开源数据库，以及通过JDBC等方式间接支持其他非开源的数据库如Oracle、DB2、SQL Server等实现更为智能的自我调节特性，如自动统计分析SQL，自动创建和调整索引，根据数据表的读写频率，自动优化缓存和备份策略等实现更全面的监控管理功能与HDFS集成，提供SQL命令，将数据库装入HDFS中并能够快速分析集成优秀的开源报表工具，使之具备一定的数据分析的能力。<br /></div><div><br /></div><div><strong>MyCat架构<br /></strong></div><div><br /></div><div><br /></div><div><img src="http://img.blog.csdn.net/20161025111919766?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><h1><br />安装myCat</h1><div><br /></div><div>通过myCat的官方源码网站获得（https://github.com/MyCATApache/Mycat-download）<br />本教程中使用的是myCat 8月出的稳定版：Mycat-server-1.5.1-RELEASE-20160810140521。<br /></div><div><br /></div><div><img src="http://img.blog.csdn.net/20161025112005705?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><div><br /></div><div>下载后解压至一个目录如：<br /></div><div><br /></div><div><img src="http://img.blog.csdn.net/20161025112021689?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><div><br /></div><h2> 配置myCat</h2><div><br /></div><div>myCat的核心配置文件有如下几个：<br /></div><div><br /></div><div><img src="http://img.blog.csdn.net/20161025112441218?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><div><ul><li>wrapper.conf – 系统环境配置</li><li>server.xml – mycat主配置文件，用于配置mycat对外数据库表、用户名、访问权限等</li><li>schema.xml – 用于配置读写分离、水平垂直折分集群</li><li>rule.xml – 用于配置数据水平垂直折分规则</li><li>router.xml – 配合rule.xml文件使用，当数据折分不符合规则时的走向，类似switch中的default作用</li></ul></div><div><br /></div><h2>myCat配置读写分离</h2><div><br /></div><div>请看下面这组读写分离，我们就用myCat来配置出这个实例吧。<br /></div><div><br /></div><div><img src="http://img.blog.csdn.net/20161025112637073?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><h3>先在物理上构建主从配置</h3><div><br /></div><div>先按照“Mysql主从配置”把：<br /><ul><li>192.168.0.101 配成master</li><li>192.168.0.102 为 192.168.0.101的slave1</li><li>192.168.0.103 为 192.168.0.103的slave3</li></ul></div><div><br /></div><h3>配置myCat读写分离</h3><div><br /></div><div><strong>修改server.xml文件</strong><br />打开server.xml文件，你会发觉好大一陀，全部删了吧，改成下面这个配置：<br /></div><div><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_1_6686376" name="code" class="html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;\n&lt;!DOCTYPE mycat:server SYSTEM "server.dtd"&gt;\n&lt;mycat:server xmlns:mycat="http://org.opencloudb/"&gt;\n\t&lt;system&gt;\n\t&lt;property name="defaultSqlParser"&gt;druidparser&lt;/property&gt;\n \t&lt;/system&gt;\n\t\n\t&lt;user name="mk"&gt;\n\t\t&lt;property name="password"&gt;aaaaaa&lt;/property&gt;\n\t\t&lt;property name="schemas"&gt;mycat&lt;/property&gt;\n\t\t&lt;property name="readOnly"&gt;false&lt;/property&gt;\n\t&lt;/user&gt;\n&lt;/mycat:server&gt;\n</pre><br />上述配置定义了这么一件事：<br /><ul><li>定义了一个可供外部访问的myCat的虚拟数据库</li><li>它的端口为8806</li><li>schema名为mycat</li><li>客户端访问时的用户名为mk，密码为aaaaaa（六个a）</li></ul></div><div><br /></div><div><strong>修改schema.xml文件</strong><br /></div><div><br /></div><div>打开后也是很大的一陀，全删了吧，改成下面这一段：<br /></div><div><br /></div><div><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_2_7831428" name="code" class="html">&lt;?xml version="1.0"?&gt;\n&lt;!DOCTYPE mycat:schema SYSTEM "schema.dtd"&gt;\n&lt;mycat:schema xmlns:mycat="http://org.opencloudb/" &gt;\n\n&lt;schema name="mycat" checkSQLschema="false" sqlMaxLimit="100" dataNode="dn1"/&gt;\n\n\t&lt;dataNode name="dn1" dataHost="virtualHost" database="mk" /&gt;\n\n\t&lt;dataHost name="virtualHost" maxCon="50" minCon="5" balance="3"\n writeType="0" dbType="mysql" dbDriver="native" switchType="1" &gt;\n &lt;heartbeat&gt;select 1&lt;/heartbeat&gt;\n &lt;writeHost host="m1" url="192.168.0.101:3306" user="mk" password="aaaaaa"&gt;\n\t\t\t&lt;readHost host="s1" url="192.168.0.102:3306" user="mk" password="aaaaaa" /&gt;\n\t\t\t&lt;readHost host="s2" url="192.168.0.103:3306" user="mk" password="aaaaaa" /&gt;\n &lt;/writeHost&gt; \n\t&lt;/dataHost&gt;\n\n&lt;/mycat:schema&gt;\n</pre><br />这里有三处需要注意：<br /></div><div><br /></div><div><strong>balance="1"与writeType="0" ,switchType=”1”</strong><br />balance 属性负载均衡类型，目前的取值有 4 种：<br /><ol><li>balance="0", 不开启读写分离机制，所有读操作都发送到当前可用的writeHost 上。</li><li>balance="1"，全部的 readHost 与 stand by writeHost 参与 select 语句的负载均衡，简单的说，当双主双从模式(M1 -&gt;S1 ， M2-&gt;S2，并且 M1 与 M2 互为主备)，正常情况下， M2,S1,S2 都参与 select 语句的负载均衡。</li><li>balance="2"，所有读操作都随机的在 writeHost、 readhost 上分发。</li><li>balance="3"， 所有读请求随机的分发到 wiriterHost 对应的 readhost 执行,writerHost 不负担读压力，注意 balance=3 只在 1.4 及其以后版本有， 1.3 没有。</li></ol><div><strong>writeType 属性，负载均衡类型，目前的取值有 3 种</strong>：<br /><ol><li>writeType="0", 所有写操作发送到配置的第一个 writeHost，第一个挂了切到还生存的第二个writeHost，重新启动后已切换后的为准，切换记录在配置文件中:dnindex.properties .</li><li>writeType="1"，所有写操作都随机的发送到配置的 writeHost。</li><li>writeType="2"，没实现。</li></ol><div><strong>switchType 属性</strong><br /><ol><li>-1 表示不自动切换</li><li>- 1 默认值，自动切换</li><li>2 基于MySQL 主从同步的状态决定是否切换</li></ol><div><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_7_9182657" name="code" class="html">&lt;writeHost host="m1" url="192.168.0.101:3306" user="mk" password="aaaaaa"&gt;\n&lt;readHost host="s1" url="192.168.0.102:3306" user="mk" password="aaaaaa" /&gt;\n&lt;readHost host="s2" url="192.168.0.103:3306" user="mk" password="aaaaaa" /&gt;\n&lt;/writeHost&gt;\n</pre><br />这里是配置的我们的myCat后台连接的真实的 1主2从服务器以及它们的连接信息。<br /></div></div></div></div><div><br /></div><h3>测试读写分离</h3><div><br /></div><div>1. 我们把mycat启动起来<br /></div><div><br /></div><div><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_4_371920" name="code" class="plain">./mycat start</pre><br />看wrapper.log文件中的内容<br /></div><div><img src="http://img.blog.csdn.net/20161025113331581?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><div>看到mycat已经被启动了。‘<br /></div><div><br /></div><div>2. 于是我们打开一个mysql客户端使用如下方式连接进入mycat<br /></div><div><img src="http://img.blog.csdn.net/20161025113408427?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><div>3. 我们往mycat里插入4条数据</div><div><br /></div><div><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_5_1625656" name="code" class="sql">insert into user_info(user_name)values(@@hostname);\ninsert into user_info(user_name)values(@@hostname);\ninsert into user_info(user_name)values(@@hostname);\ninsert into user_info(user_name)values(@@hostname);\ncommit;\n</pre><br />单独连上ymklinux和ymklinux2以及ymklinux3分别作<br /></div><div><br /></div><div><img src="http://img.blog.csdn.net/20161025113455803?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><div><img src="http://img.blog.csdn.net/20161025113512350?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><div>我们可以看到，由于102,103为101的slaver所以当下面这种模式：<br /></div><div><br /></div><div><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_7_9182657" name="code" class="html">&lt;writeHost host="m1" url="192.168.0.101:3306" user="mk" password="aaaaaa"&gt;\n&lt;readHost host="s1" url="192.168.0.102:3306" user="mk" password="aaaaaa" /&gt;\n&lt;readHost host="s2" url="192.168.0.103:3306" user="mk" password="aaaaaa" /&gt;\n&lt;/writeHost&gt;\n</pre><br />writeHost为192.168.0.101（Master）被写入数据时，而又因为192.168.0.101与102, 103为Master-Slaver的关系因此102与103会自动同步192.168.0.101上被insert进入的数据。如下图演示那样。<br /></div><div><br /></div><div><img src="http://img.blog.csdn.net/20161025113731275?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><div><br /></div><h1>考虑多Master的场景</h1><div><br /></div><div>我们回到上棕这个场景来看，为什么説需要多Master？<br /></div><div><br /></div><div><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_7_9182657" name="code" class="html">&lt;writeHost host="m1" url="192.168.0.101:3306" user="mk" password="aaaaaa"&gt;\n&lt;readHost host="s1" url="192.168.0.102:3306" user="mk" password="aaaaaa" /&gt;\n&lt;readHost host="s2" url="192.168.0.103:3306" user="mk" password="aaaaaa" /&gt;\n&lt;/writeHost&gt;\n</pre><br />上述这个应用，有一个非致命的缺点：<br />即定义的writeHost一旦发生宕机那么其相应对的readHost全部为不可用，换而言之即整个myCat群宕机。<br /></div><div><br /></div><h2>熊掌与鱼兼得法</h2><div><br /></div><div>按照myCat的配置我们可以配置多个writeHost并把writeType这个值设为“0”。<br />来看writeType=”0”的含议：<br />writeType="0", 所有写操作发送到配置的第一个 writeHost，第一个挂了切到还生存的第二个writeHost，重新启动后已切换后的为准，切换记录在配置文件中:dnindex.properties .</div><div><br /><strong>第一种配置：</strong></div><div><br />于是我们来考虑下面这样的配置：<br /></div><div><br /></div><div><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_9_8866230" name="code" class="html">&lt;writeHost host="m1" url="192.168.0.101:3306" user="root" password="aaaaaa"&gt;\n&lt;/writeHost&gt;\n&lt;writeHost host="m2" url="192.168.0.104:3306" user="root" password="aaaaaa"/&gt;\n</pre><br />MyCat群会在Master1发生宕机时自动探寻Master2是否还存活，如果Master2存活那么把数据的读和写全部转向以Master2为代表的读写群。<br />但是，这也带来了一个问题。<br />如果此时Master1宕机了，Master2被顶了上来，那么数据全部跑入了Master2群内了。<br />当：<br />Master1再次恢复时。。。对于通过myCat客户端调用者来説这一切是秀明的，数据依然还是那些数据，可是此时，再来一次Master2宕机（刚才是Master1宕机），此时myCat会把Master1作为读写群。<br />于是，客户端再次通过myCat代理调用后，会发觉数据有差异了。<br /><br /></div><div><span style="font-size:24px;"><strong>为什么？</strong></span></div><div><br />因为Master2内的数据和Master1内的数据没有同步。<br /></div><div><br /></div><div><br /></div><div><strong>第二种配置：</strong></div><div><strong><br /></strong>于是：</div><div><br /><strong>第一步：</strong></div><div><br />我们保留第一种配置即<br /></div><div><br /></div><div><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_9_8866230" name="code" class="html">&lt;writeHost host="m1" url="192.168.0.101:3306" user="root" password="aaaaaa"&gt;\n&lt;/writeHost&gt;\n&lt;writeHost host="m2" url="192.168.0.104:3306" user="root" password="aaaaaa"/&gt;\n</pre><br /><strong>第二步：</strong></div><div><br /></div><div>我们把Master1和Master2在物理上做成MySQL的主-备结构，现在来看场景推演。<br />Master1发生宕机，Master2顶上同时同步了Master1宕机前的数据，对于myCat用户群来説数据everything is ok。<br />Master1恢复，Master2宕机客户端发觉通过myCat得到的数据（来自于Master1）有异常，为什么？<br />因为Master2是Master1的Slaver，因此它只会“正向同步Master1的数据”，而不能逆向，因此这种配置和第一种配置完全没有区别。<br />那么有人説我们把Master1作成Master2的Slaver呢？那无非上第二种情况的场景推演倒一倒而己，还是不能保证任何一点宕机并且在恢复后如何保证数据的强一致性。<br /></div><div><br /></div><div><strong>第三种配置：</strong></div><div><strong><br /></strong>于是，我们想到了一个办法，这个办法来源于Master和Slaver在作配置时my.cnf配置文件 中的一个参数，它就是“log-slave-update”。<br />对于这个参数的解释，mySQL官方是如下解释的：当你的Master同时又是其它Master’的slaver 时，你需要设置此参数。<br />单从上述描述来看这段语句念起来有些晦涩，我们还是实际来看一个架构图吧。<br /></div><div><br /></div><div><br /></div><div><img src="http://img.blog.csdn.net/20161025114407944?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><div>这种结构被称为“双主结构”或者又称为“互为主备”结构。<br /><br /></div><div><ul><li>Master1是Master2的Slaver；</li><li>Master2是Master1的Slaver；</li><li>同时，他们又是彼此下面如：Master1拖的S1, S2的Master</li><li><br /></li></ul></div><h1>基于互为主备结构的myCat群搭建方法</h1><div><br /></div><h2>第一步(一定要设log-slave-update)</h2><div><br /></div><div>把Master1作成Master2的Slaver，在Master1配置文件my.cnf中设置log-slave-update。<br />如果不设会发生下面这种情况<br />1）<span style="white-space:pre">\t</span>通过Master2 insert数据<br />2）<span style="white-space:pre">\t</span>在Master1上查看，数据被从Master2上同步过来了<br />3）<span style="white-space:pre">\t</span>通过Master1下挂载的它本身的几个Slaver连入并进行查看，结果发觉没有同步Master1的数据<br />4）<span style="white-space:pre">\t</span>通过Master1 insert数据<br />5）<span style="white-space:pre">\t</span>在Master2上查看，数据被从Master1上同步过来了<br />6）<span style="white-space:pre">\t</span>通过Master2下挂载的它本身的几个Slaver连入并进行查看，结果发觉没有同步Master2的数据<br /></div><div><br /></div><div><img src="http://img.blog.csdn.net/20161025114521066?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><div><img src="http://img.blog.csdn.net/20161025114541055?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><h2>第二步</h2><div><br /></div><div><br /></div><div>把Master2作成Master1的Slaver，在Master2配置文件my.cnf中设置log-slave-update。<br />对于Master1或者是Master2下再外挂的其本身的s1,s2上不需要再设log-slave-update这个开关了。<br />如果Master1或者是Master2本身下面还有挂Slaver，请记得此时在其本身的Slaver1上再同步一下它们与Master之间的bin-log。<br />因为Master一旦作成了另一个Master的Slaver，因此它的bin-log也改变了，你可以直接在其本身的Slaver上使用change master命令。<br /></div><div><br /></div><h2>第三步</h2><div><br /></div><div>在myCat的配件文件中作如下设置：<br /></div><div><br /></div><div><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_10_9804321" name="code" class="html">&lt;dataHost name="virtualHost" maxCon="50" minCon="5" balance="3"\n writeType="0" dbType="mysql" dbDriver="native" switchType="2" slaveThreshold="100"&gt;\n &lt;heartbeat&gt;show slave status&lt;/heartbeat&gt;\n &lt;writeHost host="m1" url="192.168.0.101:3306" user="root" password="aaaaaa"&gt;\n &lt;readHost host="s1" url="192.168.0.102:3306" user="root" password="aaaaaa"/&gt;\n &lt;readHost host="s2" url="192.168.0.103:3306" user="root" password="aaaaaa"/&gt;\n &lt;/writeHost&gt;\n &lt;writeHost host="m2" url="192.168.0.104:3306" user="root" password="aaaaaa"/&gt;\n&lt;/dataHost&gt;\n</pre><br />于是，我们就有了这样的结构了<br /></div><div><br /></div><div><img src="http://img.blog.csdn.net/20161025114739728?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></div><div><br /></div><h2>测试</h2><div><br />1） 我们连上myCat，对myCat群发送2条insert语句<br />2） 我们单独连上m1, s1, s2, m2查看，发觉各个mysql实例中的数据一致<br />3） 直接在m1上执行service mysqld stop<br />4） 再次连上myCat群，对myCat群再发送2条insert语句<br />5） 我们单独连上m2进行查看，现在m2上为4条数据<br />6） 我们分别连上s1和s2进行查看，发现s1和s2上还是2条数据<br />7） 我们把m1的mysql实例重新启动起来使用命令service mysqld start<br />8） 单独连上m1进行查看，发觉m1此时数据条数据为4条<br />9）我们分别连上s1和s2进行查看，发现s1和s2上已经从原来的2条数据变为了4条数据</div><div><br /></div><div>一个高可用的读写分离的集群就此搭建完毕，绝逼完美！<br /></div><h1><br />mySQL的垂直与水平折分</h1><div><br /></div><div>在本书系统的《mySQL集群(cluster)》中，我们详细介绍和对比了几种集群的方案，并且在该章节中我详细描述过使用mySQL的分片原则是可以取代集群方案的。并且它比起集群方案来説拥有着更多的优点：<br /><ul><li>廉价，软件免费并且可以使用廉价PC</li><li>可以大规模铺设不受License的束缚</li><li>稳定可监控</li><li>对于已有应用程序来説，它是透明的</li><li><br /></li></ul><h2>什么是分片</h2><div><br />一般的replication具有一个限制，即一旦数据库过于庞大，尤其是当写入过于频繁，很难由一台主机支撑的时候，我们还是会面临到扩展瓶颈。<br />所谓数据分片(sharding)即是通过某种特定的条件，将我们存放在同一个数据库中的数据分散存放到多个数据库（主机）上面，以达到分散单台设备负载的效果。。数据的切分同时还可以提高系统的总体可用性，因为单台设备Crash之后，只有总体数据的某部分不可用，而不是所有的数据。<br /></div></div><div><br /></div><div><h3>数据的切分（Sharding）模式</h3>一种是按照不同的表（或者Schema）来切分到不同的数据库（主机）之上，这种切可以称之为数据的垂直（纵向）切分；另外一种则是根据表中的数据的逻辑关系，将同一个表中的数据按照某种条件拆分到多台数据库（主机）上面，这种切分称之为数据的水平（横向）切分。<br /><br /></div><h4>垂直切分</h4><div><br />一个架构设计较好的应用系统，其总体功能肯定是由很多个功能模块所组成的，而每一个功能模块所需要的数据对应到数据库中就是一个或者多个表。而在架构设计中，各个功能模块相互之间的交互点越统一越少，系统的耦合度就越低，系统各个模块的维护性以及扩展性也就越好。这样的系统，实现数据的垂直切分也就越容易。<br />一般来说，如果是一个负载相对不是很大的系统，而且表关联又非常的频繁，那可能数据库让步，将几个相关模块合并在一起减少应用程序的工作的方案可以减少较多的工作量，这是一个可行的方案。一个垂直拆分的例子:</div><div><br />1.用户模块表：user,user_profile,user_group,user_photo_album<br />2.群组讨论表：groups,group_message,group_message_content,top_message<br />3.相册相关表：photo,photo_album,photo_album_relation,photo_comment<br />4.事件信息表：event</div><div>群组讨论模块和用户模块之间主要存在通过用户或者是群组关系来进行关联。一般关联的时候都会是通过用户的id或者nick_name以及group的id来进行关联，通过模块之间的接口实现不会带来太多麻烦；<br />相册模块仅仅与用户模块存在通过用户的关联。这两个模块之间的关联基本就有通过用户id关联的内容，简单清晰，接口明确；<br />事件模块与各个模块可能都有关联，但是都只关注其各个模块中对象的ID信息，同样可以做到很容易分拆。<br /></div><div><br /></div><div><strong>垂直切分的优点</strong><br /><ul><li>数据库的拆分简单明了，拆分规则明确；</li><li>应用程序模块清晰明确，整合容易；</li><li>数据维护方便易行，容易定位；</li></ul><strong>垂直切分的缺点</strong></div><div><br /><ul><li>部分表关联无法在数据库级别完成，需要在程序中完成；</li><li>对于访问极其频繁且数据量超大的表仍然存在性能瓶颈，不一定能满足要求；</li><li>事务处理相对更为复杂；</li><li>切分达到一定程度之后，扩展性会遇到限制；</li><li>过度切分可能会带来系统过渡复杂而难以维护。</li></ul></div><div><h4>水平切分</h4><div><br /></div>将某个访问极其频繁的表再按照某个字段的某种规则来分散到多个表之中，每个表中包含一部分数据。<br />对于上面的例子:所有数据都是和用户关联的，那么我们就可以根据用户来进行水平拆分，将不同用户的数据切分到不同的数据库中。<br />现在互联网非常火爆的Web2.0类型的网站，基本上大部分数据都能够通过会员用户信息关联上，可能很多核心表都非常适合通过会员ID来进行数据的水平切分。而像论坛社区讨论系统，就更容易切分了，非常容易按照论坛编号来进行数据的水平切分。切分之后基本上不会出现各个库之间的交互。<br /><br /></div><div><strong>水平切分的优点</strong></div><div><br />表关联基本能够在数据库端全部完成；<br />不会存在某些超大型数据量和高负载的表遇到瓶颈的问题；<br />应用程序端整体架构改动相对较少；<br />事务处理相对简单；<br />只要切分规则能够定义好，基本上较难遇到扩展性限制；</div><div><strong><br />水平切分的缺点</strong></div><div><br />切分规则相对更为复杂，很难抽象出一个能够满足整个数据库的切分规则；<br />后期数据的维护难度有所增加，人为手工定位数据更困难；<br />应用系统各模块耦合度较高，可能会对后面数据的迁移拆分造成一定的困难。<br /></div><div><br /></div><div><br /></div><h2>两种切分结合用</h2><p><br /></p><p>一般来说，我们数据库中的所有表很难通过某一个（或少数几个）字段全部关联起来，所以很难简单的仅仅通过数据的水平切分来解决所有问题。而垂直切分也只能解决部分问题，对于那些负载非常高的系统，即使仅仅只是单个表都无法通过单台数据库主机来承担其负载。我们必须结合“垂直”和“水平”两种切分方式同时使用<br />每一个应用系统的负载都是一步一步增长上来的，在开始遇到性能瓶颈的时候，大多数架构师和DBA都会选择先进行数据的垂直拆分，因为这样的成本最先，最符合这个时期所追求的最大投入产出比。然而，随着业务的不断扩张，系统负载的持续增长，在系统稳定一段时期之后，经过了垂直拆分之后的数据库集群可能又再一次不堪重负，遇到了性能瓶颈。<br />如果我们再一次像最开始那样继续细分模块，进行数据的垂直切分，那我们可能在不久的将来，又会遇到现在所面对的同样的问题。而且随着模块的不断的细化，应用系统的架构也会越来越复杂，整个系统很可能会出现失控的局面。<br />这时候我们就必须要通过数据的水平切分的优势，来解决这里所遇到的问题。而且，我们完全不必要在使用数据水平切分的时候，推倒之前进行数据垂直切分的成果，而是在其基础上利用水平切分的优势来避开垂直切分的弊端，解决系统复杂性不断扩大的问题。而水平拆分的弊端（规则难以统一）也已经被之前的垂直切分解决掉了，让水平拆分可以进行的得心应手。<br /></p><p><br /></p><h3>myCat实现数据分片</h3><p><br /></p><p><img src="http://img.blog.csdn.net/20161025115309155?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p><br /></p><p><img src="http://img.blog.csdn.net/20161025115323575?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p><br /></p><p>在数据切分处理中，特别是水平切分中，中间件最终要的两个处理过程就是数据的切分、数据的聚合。<br />选择合适的切分规则，至关重要，因为它决定了后续数据聚合的难易程度，甚至可以避免跨库的数据聚合<br />处理。<br /><br /><br /><strong>myCAT数据分片拆分原则：</strong><br /></p><ul><li>避免或减少跨库join。</li><li>选择最合适的拆分维度。</li></ul><strong>Mycat拆分表解决方案：</strong><br /><ul><li>MYCAT 全局表</li><li>ER关系</li><li>表拆分</li></ul>              --拆分维度<br />              --主键分片vs 非主键分片<br /><br /><p></p><p>myCAT对于后端多个mySQL的数据折分和折分后的聚合，对于myCAT前端调用来説是透明的。<br /></p><p><br /></p><h2>以实际例子来操作分片</h2><p>在分片前，我们需要事先了解一个重要的知识点，也算是一个需要引起重视的问题。<br />A和B互为主从，我们按照userID来实施分片，userID为1，3，5的插入到一台mysql实例，userID为2，4，6的插入到另一个mysql实例中去。然后在mycat前端select时mycat会自动进行聚合，即它会从2个mysql实例中选择数据并合并成1,2,3,4,5,6…这样的数据显示给调用的客户端。<br /><br /></p><p>1. 先往A上插入 一条数据（id:1 name: tom, gender: m），于是B上也马上会REPLI（同步）一条数据，因此你在A和B上做SELECT查询，都可以看到两边记录一样</p><p>2. 往B上插入 一条数据（id:2 name: tom, gender: m），于是A上也马上会REPLI一条数据，因此你在A和B上做SELECT查询，都可以看到两边记录一样</p><p>3. 使用MYCAT读写分离，A为写，B为读，一切OK</p><p>4. 使用MYCAT做水平拆分，拆分规则为（id % 2 case 0 then Server A; case 1 then Server B;），于是，规则开始起效。</p><p></p><ul><li>当插入id: 2的数据时，它会被insert到A上，接下去由于A和B互为主备，因此B马上会同步一条数据。</li><li>接下去再插入一条id:3的数据，由于id为3的数据根据我们预先配置后的规则会被插入到Server B上， 然后A马上也会被REPLI一条数据id为3，此时， 此时A和B两个MYSQL上就都有了同样的记录集，都为1,2,3，即：</li></ul><div><table border="1" width="200" cellspacing="1" cellpadding="1"><tbody><tr><td>Server A</td><td>Server B</td></tr><tr><td>1</td><td>1</td></tr><tr><td>2</td><td>2</td></tr><tr><td>3</td><td>3</td></tr></tbody></table>所以数据分片等于没用。再来看分片读，读的规则也走上述规则，于是当你通过mycat作为mysql proxy时你会发生这样的场景：</div><div><br />Mysql –u root –p aaaaaa –P8066 –h 192.168.0.1</div><div><br />Select csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-331.html csdn-332.html csdn-333.html csdn-334.html csdn-335.html csdn-336.html csdn-337.html csdn-338.html csdn-339.html csdn-33.html csdn-340.html csdn-341.html csdn-342.html csdn-343.html csdn-344.html csdn-345.html csdn-346.html csdn-347.html csdn-348.html csdn-349.html csdn-34.html csdn-350.html csdn-351.html csdn-352.html csdn-353.html csdn-354.html csdn-355.html csdn-356.html csdn-357.html csdn-358.html csdn-359.html csdn-35.html csdn-360.html csdn-361.html csdn-362.html csdn-363.html csdn-364.html csdn-365.html csdn-366.html csdn-367.html csdn-368.html csdn-369.html csdn-36.html csdn-370.html csdn-371.html csdn-372.html csdn-373.html csdn-374.html csdn-375.html csdn-376.html csdn-377.html csdn-378.html csdn-379.html csdn-37.html csdn-380.html csdn-381.html csdn-382.html csdn-383.html csdn-384.html csdn-385.html csdn-386.html csdn-387.html csdn-388.html csdn-389.html csdn-38.html csdn-390.html csdn-391.html csdn-392.html csdn-393.html csdn-394.html csdn-395.html csdn-396.html csdn-397.html csdn-398.html csdn-399.html csdn-39.html csdn-3.html csdn-400.html csdn-401.html csdn-402.html csdn-403.html csdn-404.html csdn-405.html csdn-406.html csdn-407.html csdn-408.html csdn-409.html csdn-40.html csdn-410.html csdn-411.html csdn-412.html csdn-413.html csdn-414.html csdn-415.html csdn-416.html csdn-417.html csdn-418.html csdn-419.html csdn-41.html csdn-420.html csdn-421.html csdn-422.html csdn-423.html csdn-424.html csdn-425.html csdn-426.html csdn-427.html csdn-428.html csdn-429.html csdn-42.html csdn-430.html csdn-431.html csdn-432.html csdn-433.html csdn-434.html csdn-435.html csdn-436.html csdn-437.html csdn-438.html csdn-439.html csdn-43.html csdn-440.html csdn-441.html csdn-442.html csdn-443.html csdn-444.html csdn-445.html csdn-446.html csdn-447.html csdn-448.html csdn-449.html csdn-44.html csdn-450.html csdn-451.html csdn-452.html csdn-453.html csdn-454.html csdn-455.html csdn-456.html csdn-457.html csdn-458.html csdn-459.html csdn-45.html csdn-460.html csdn-461.html csdn-462.html csdn-463.html csdn-464.html csdn-465.html csdn-466.html csdn-467.html csdn-468.html csdn-469.html csdn-46.html csdn-470.html csdn-471.html csdn-472.html csdn-473.html csdn-474.html csdn-475.html csdn-476.html csdn-477.html csdn-478.html csdn-479.html csdn-47.html csdn-480.html csdn-481.html csdn-482.html csdn-483.html csdn-484.html csdn-485.html csdn-486.html csdn-487.html csdn-488.html csdn-489.html csdn-48.html csdn-490.html csdn-491.html csdn-492.html csdn-493.html csdn-494.html csdn-495.html csdn-496.html csdn-497.html csdn-498.html csdn-499.html csdn-49.html csdn-4.html csdn-500.html csdn-501.html csdn-502.html csdn-503.html csdn-504.html csdn-505.html csdn-506.html csdn-507.html csdn-508.html csdn-509.html csdn-50.html csdn-510.html csdn-511.html csdn-512.html csdn-513.html csdn-514.html csdn-515.html csdn-516.html csdn-517.html csdn-518.html csdn-519.html csdn-51.html csdn-520.html csdn-521.html csdn-522.html csdn-523.html csdn-524.html csdn-525.html csdn-526.html csdn-527.html csdn-528.html csdn-529.html csdn-52.html csdn-530.html csdn-531.html csdn-532.html csdn-533.html csdn-534.html csdn-535.html csdn-536.html csdn-537.html csdn-538.html csdn-539.html csdn-53.html csdn-540.html csdn-541.html csdn-542.html csdn-543.html csdn-544.html csdn-545.html csdn-546.html csdn-547.html csdn-548.html csdn-549.html csdn-54.html csdn-550.html csdn-551.html csdn-552.html csdn-553.html csdn-554.html csdn-555.html csdn-556.html csdn-557.html csdn-558.html csdn-559.html csdn-55.html csdn-560.html csdn-561.html csdn-562.html csdn-563.html csdn-564.html csdn-565.html csdn-566.html csdn-567.html csdn-568.html csdn-569.html csdn-56.html csdn-570.html csdn-571.html csdn-572.html csdn-573.html csdn-574.html csdn-575.html csdn-576.html csdn-577.html csdn-578.html csdn-579.html csdn-57.html csdn-580.html csdn-581.html csdn-582.html csdn-583.html csdn-584.html csdn-585.html csdn-586.html csdn-587.html csdn-588.html csdn-589.html csdn-58.html csdn-590.html csdn-591.html csdn-592.html csdn-593.html csdn-594.html csdn-595.html csdn-596.html csdn-597.html csdn-598.html csdn-599.html csdn-59.html csdn-5.html csdn-600.html csdn-601.html csdn-602.html csdn-603.html csdn-604.html csdn-605.html csdn-606.html csdn-607.html csdn-608.html csdn-609.html csdn-60.html csdn-610.html csdn-611.html csdn-612.html csdn-613.html csdn-614.html csdn-615.html csdn-616.html csdn-617.html csdn-618.html csdn-619.html csdn-61.html csdn-620.html csdn-621.html csdn-622.html csdn-623.html csdn-624.html csdn-625.html csdn-626.html csdn-627.html csdn-628.html csdn-629.html csdn-62.html csdn-630.html csdn-631.html csdn-632.html csdn-633.html csdn-634.html csdn-635.html csdn-636.html csdn-637.html csdn-638.html csdn-639.html csdn-63.html csdn-640.html csdn-641.html csdn-642.html csdn-643.html csdn-644.html csdn-645.html csdn-646.html csdn-647.html csdn-648.html csdn-649.html csdn-64.html csdn-650.html csdn-651.html csdn-652.html csdn-653.html csdn-654.html csdn-655.html csdn-656.html csdn-657.html csdn-658.html csdn-659.html csdn-65.html csdn-660.html csdn-661.html csdn-662.html csdn-663.html csdn-664.html csdn-665.html csdn-666.html csdn-667.html csdn-668.html csdn-669.html csdn-66.html csdn-670.html csdn-671.html csdn-672.html csdn-673.html csdn-674.html csdn-675.html csdn-676.html csdn-677.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh from person<br />此时你得到的结果集为：<br /></div><div><br /></div><div>1<br />2<br />3<br />1<br />2<br />3<br />或者你的ReadServer始终为一台，那你会得到正确的1，2，3这样的结果集。但是，原先所需要的数据的sharding功能。。。其实没有做到。<br /></div><div><br /></div><h4>myCAT分片前置条件（极其重要）</h4><div><strong><br /></strong></div><div><strong>因此：</strong></div><div><strong><br /><span style="color:#ff6666;">如果要考虑后期的水平和垂直折分，被折分的数据库不可以在其本身已经做了主从结构，而是需要把这个主从结构交由mycat来做。</span></strong><br /></div><div><br /></div><div><h3> 实际分片演示</h3>我们只需要修改rule.xml这个文件即可实现myCat的数据分片定义了。<br />但是按照前面小节的重要提示，在做分片前，我们一定要让我们参于分片规则的mySQL实例保持独立运行状态，即多个mySQL实例间不要做任何的“主备”结构。<br /><br /></div><h4>实验前准备</h4><p>我们拿192.168.0.101与192.168.0.102两台机器来做分片实验<br /><br /></p><p>在192.168.0.101上禁用binlog，关闭master slaver的关联，同时断开与原有192.168.0.104的master slaver关联。<br /></p><p><strong><span style="color:#ff6666;">别忘了把“log-slave-update”也注释掉。</span></strong><br /></p><p><br /></p><p>重启后登录192.168.0.101，输入以下命令<br /></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_12_6456251" name="code" class="plain">stop slave;\nchange master to master_host=' ';\n</pre><br />在192.168.0.104上禁用binlog，关闭master slaver的关联，同时断开与原有192.168.0.101的master slaver关联。<br /><p></p><p><br /></p><p><img src="http://img.blog.csdn.net/20161025120331375?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p><strong><span style="color:#ff6666;"><br /></span></strong></p><p><strong><span style="color:#ff6666;">别忘了把“log-slave-update”也注释掉。</span></strong><br /></p><p><br /></p><p>重启后登录192.168.0.104，输入以下命令<br /></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_12_6456251" name="code" class="plain">stop slave;\nchange master to master_host=' ';\n</pre><br /><h4>配置数据分片</h4>我们有一张T_PERSON表，结构如下：<br /><p></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_13_7709987" name="code" class="sql">CREATE TABLE `t_person` (\n `person_id` int(11) NOT NULL,\n `person_name` varchar(20) DEFAULT NULL,\n PRIMARY KEY (`person_id`)\n) ENGINE=MyISAM DEFAULT CHARSET=latin1;\nshow slave status;\n</pre><br />数据分片按照PERSON_ID的奇偶来分。<br /><p></p><p>配置mycat的rule.xml文件<br /></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_14_5965101" name="code" class="plain">&lt;?xml version="1.0" encoding="UTF-8"?&gt;\n&lt;!DOCTYPE mycat:rule SYSTEM "rule.dtd"&gt;\n&lt;mycat:rule xmlns:mycat="http://org.opencloudb/"&gt;\n\t&lt;tableRule name="mod-long"&gt;\n\t\t&lt;rule&gt;\n\t\t\t&lt;columns&gt;person_id&lt;/columns&gt;\n\t\t\t&lt;algorithm&gt;mod-long&lt;/algorithm&gt;\n\t\t&lt;/rule&gt;\n\t&lt;/tableRule&gt;\n\t\t&lt;function name="mod-long" class="org.opencloudb.route.function.PartitionByMod"&gt;\n\t\t&lt;!-- how many data nodes --&gt;\n\t\t&lt;property name="count"&gt;2&lt;/property&gt;\n\t&lt;/function&gt;\n&lt;/mycat:rule&gt;\n</pre><br /><br /><p></p><p>通过配置可以看到我们按照person_id会把该表数据分在2个物理库内，分片数据包括通过mycat的mysql client端insert时自动分片以及select时自动聚合。<br /><br /></p><h4>应用分片</h4><p></p><p>rule.xml文件定义后还需要应用它里面的规则，才能够最终让数据分片在mycat中起效，为此，我们更改schema.xml文件，増加如下一段配置：<br /></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_15_806887" name="code" class="html">&lt;schema name="split" checkSQLschema="false" sqlMaxLimit="100"&gt;\n\t\t &lt;table name="t_person" dataNode="splitNode1,splitNode2" rule="mod-long"/&gt;\n&lt;/schema&gt;\n&lt;dataNode name="splitNode1" dataHost="host1" database="mk" /&gt;\n&lt;dataNode name="splitNode2" dataHost="host2" database="mk" /&gt;\n&lt;dataHost name="host1" maxCon="20" minCon="5" balance="0"\n writeType="0" dbType="mysql" dbDriver="native" switchType="1" &gt;\n &lt;heartbeat&gt;select 1&lt;/heartbeat&gt;\n &lt;writeHost host="m1" url="192.168.0.101:3306" user="mk" password="aaaaaa"/&gt;\n&lt;/dataHost&gt;\n&lt;dataHost name="host2" maxCon="20" minCon="5" balance="0"\n writeType="0" dbType="mysql" dbDriver="native" switchType="1" &gt;\n &lt;heartbeat&gt;select 1&lt;/heartbeat&gt;\n &lt;writeHost host="s1" url="192.168.0.104:3306" user="mk" password="aaaaaa"/&gt;\n&lt;/dataHost&gt;\n</pre><br />接着我们更改server.xml文件，増加如下一段配置：<br /><p></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_16_5648673" name="code" class="html">\t&lt;user name="split"&gt;\n\t\t&lt;property name="password"&gt;aaaaaa&lt;/property&gt;\n\t\t&lt;property name="schemas"&gt;split&lt;/property&gt;\n\t\t&lt;property name="readOnly"&gt;false&lt;/property&gt;\n\t&lt;/user&gt;\n</pre><br /><h4><br />测试分片</h4><p></p><p>我们使用split/aaaaaa用户连上mycat实例<br /></p><p><br /></p><p><img src="http://img.blog.csdn.net/20161025120644032?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p><br /></p><p>我们插入5条数据<br /></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_17_1046868" name="code" class="sql">insert into t_person(person_id,person_name)values('1','michael');\ninsert into t_person(person_id,person_name)values('2','tom');\ninsert into t_person(person_id,person_name)values('3','tonny');\ninsert into t_person(person_id,person_name)values('4','marry');\ninsert into t_person(person_id,person_name)values('5','jack');\ncommit;\n</pre><br />然后我们接着做一次查询<br /><p></p><p><br /></p><p><img src="http://img.blog.csdn.net/20161025120725501?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p><br /></p><p>连入192.168.0.101上进行查看，我们可以得到2条数据，person_id为偶数倍。<br /></p><p><br /></p><p><img src="http://img.blog.csdn.net/20161025120918942?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p>连入192.168.0.104上进行查看，我们可以得到3条数据，person_id为奇数倍。<br /></p><p><br /></p><p><img src="http://img.blog.csdn.net/20161025120938239?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p><br /></p><p><span style="font-size:18px;color:#ff0000;"><strong>分片成功！！！</strong></span><br /></p><p><br /></p><p>myCAT的分片功能相当的强大，完全可以应付亿万级的数据，如果再结合适当的读写分离机制是完全可以让你的网站飞起来的。<br />myCAT的分片规则还有很多，文后的附件中会给出一个myCAT分片规则大全。<br /></p><p><br /></p><h1>附件 myCAT分片规则大全</h1><p>常用的根据主键或非主键的分片规则配置：<br /></p><p><br /></p><h2>1. 枚举法</h2><p><br /></p><p>通过在配置文件中配置可能的枚举id，自己配置分片，使用规则：'<br /></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_18_3172656" name="code" class="html">&lt;tableRule name="sharding-by-intfile"&gt;\n &lt;rule&gt;\n &lt;columns&gt;user_id&lt;/columns&gt;\n &lt;algorithm&gt;hash-int&lt;/algorithm&gt;\n &lt;/rule&gt;\n &lt;/tableRule&gt;\n&lt;function name="hash-int" class="org.opencloudb.route.function.PartitionByFileMap"&gt;\n &lt;property name="mapFile"&gt;partition-hash-int.txt&lt;/property&gt;\n &lt;property name="type"&gt;0&lt;/property&gt;\n &lt;property name="defaultNode"&gt;0&lt;/property&gt;\n &lt;/function&gt;\n\npartition-hash-int.txt 配置：\n10000=0\n10010=1\nDEFAULT_NODE=1\n</pre><br />上面columns 标识将要分片的表字段，algorithm 分片函数，<br />其中分片函数配置中，mapFile标识配置文件名称，type默认值为0，0表示Integer，非零表示String，<br />所有的节点配置都是从0开始，及0代表节点1<br /><p></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_19_4982799" name="code" class="html">/**\n* defaultNode 默认节点:小于0表示不设置默认节点，大于等于0表示设置默认节点\n* \n默认节点的作用：枚举分片时，如果碰到不识别的枚举值，就让它路由到默认节点\n* 如果不配置默认节点（defaultNode值小于0表示不配置默认节点），碰到\n* 不识别的枚举值就会报错，\n* like this：can't find datanode for sharding column:column_name val:ffffffff \n*/\n</pre><br /><h2>2. 固定分片hash算法</h2><p></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_20_2889248" name="code" class="html">&lt;tableRule name="rule1"&gt;\n &lt;rule&gt;\n &lt;columns&gt;user_id&lt;/columns&gt;\n &lt;algorithm&gt;func1&lt;/algorithm&gt;\n &lt;/rule&gt;\n&lt;/tableRule&gt;\n\n &lt;function name="func1" class="org.opencloudb.route.function.PartitionByLong"&gt;\n &lt;property name="partitionCount"&gt;2,1&lt;/property&gt;\n &lt;property name="partitionLength"&gt;256,512&lt;/property&gt;\n &lt;/function&gt;\n</pre><br /><br /><p></p><p>配置说明：<br />上面columns 标识将要分片的表字段，algorithm 分片函数，<br />partitionCount 分片个数列表，partitionLength 分片范围列表<br />分区长度:默认为最大2^n=1024 ,即最大支持1024分区<br />约束 :<br />count,length两个数组的长度必须是一致的。<br />1024 = sum((count[i]*length[i])). count和length两个向量的点积恒等于1024<br />用法例子：<br />本例的分区策略：希望将数据水平分成3份，前两份各占25%，第三份占50%。（故本例非均匀分区）<br /></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_21_2191137" name="code" class="plain"> // |&lt;---------------------1024------------------------&gt;|\n // |&lt;----256---&gt;|&lt;----256---&gt;|&lt;----------512----------&gt;|\n // | partition0 | partition1 | partition2 |\n // | 共2份,故count[0]=2 | 共1份，故count[1]=1 |\n int[] count = new int[] { 2, 1 };\n int[] length = new int[] { 256, 512 };\n PartitionUtil pu = new PartitionUtil(count, length);\n\n // 下面代码演示分别以offerId字段或memberId字段根据上述分区策略拆分的分配结果\n int DEFAULT_STR_HEAD_LEN = 8; // cobar默认会配置为此值\n long offerId = 12345;\n String memberId = "qiushuo";\n\n // 若根据offerId分配，partNo1将等于0，即按照上述分区策略，offerId为12345时将会被分配到partition0中\n int partNo1 = pu.partition(offerId);\n\n // 若根据memberId分配，partNo2将等于2，即按照上述分区策略，memberId为qiushuo时将会被分到partition2中\n int partNo2 = pu.partition(memberId, 0, DEFAULT_STR_HEAD_LEN);\n</pre><br />如果需要平均分配设置：平均分为4分片，partitionCount*partitionLength=1024<br /><p></p><p><br /></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_22_97586" name="code" class="html">&lt;function name="func1" class="org.opencloudb.route.function.PartitionByLong"&gt;\n &lt;property name="partitionCount"&gt;4&lt;/property&gt;\n &lt;property name="partitionLength"&gt;256&lt;/property&gt;\n&lt;/function&gt;\n</pre><br /><h2>3. 范围约定</h2><p></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_23_1907729" name="code" class="html">&lt;tableRule name="auto-sharding-long"&gt;\n &lt;rule&gt;\n &lt;columns&gt;user_id&lt;/columns&gt;\n &lt;algorithm&gt;rang-long&lt;/algorithm&gt;\n &lt;/rule&gt;\n &lt;/tableRule&gt;\n&lt;function name="rang-long" class="org.opencloudb.route.function.AutoPartitionByLong"&gt;\n &lt;property name="mapFile"&gt;autopartition-long.txt&lt;/property&gt;\n &lt;/function&gt;\n# range start-end ,data node index\n# K=1000,M=10000.\n0-500M=0\n500M-1000M=1\n1000M-1500M=2\n或\n0-10000000=0\n10000001-20000000=1\n</pre><br />配置说明：<br />上面columns 标识将要分片的表字段，algorithm 分片函数，<br />rang-long 函数中mapFile代表配置文件路径<br />所有的节点配置都是从0开始，及0代表节点1，此配置非常简单，即预先制定可能的id范围到某个分片<br /><p></p><p><br /></p><h2>4. 求模法</h2><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_24_3717090" name="code" class="html">&lt;tableRule name="mod-long"&gt;\n &lt;rule&gt;\n &lt;columns&gt;user_id&lt;/columns&gt;\n &lt;algorithm&gt;mod-long&lt;/algorithm&gt;\n &lt;/rule&gt;\n &lt;/tableRule&gt;\n &lt;function name="mod-long" class="org.opencloudb.route.function.PartitionByMod"&gt;\n &lt;!-- how many data nodes --&gt;\n &lt;property name="count"&gt;3&lt;/property&gt;\n &lt;/function&gt; \n</pre><br />配置说明：<br />上面columns 标识将要分片的表字段，algorithm 分片函数，<br />此种配置非常明确即根据id进行十进制求模预算，相比方式1，此种在批量插入时需要切换数据源，id不连续<br /><p></p><p><br /></p><h2>5. 日期列分区法</h2><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_25_2495591" name="code" class="html">&lt;tableRule name="sharding-by-date"&gt;\n &lt;rule&gt;\n &lt;columns&gt;create_time&lt;/columns&gt;\n &lt;algorithm&gt;sharding-by-date&lt;/algorithm&gt;\n &lt;/rule&gt;\n &lt;/tableRule&gt; \n&lt;function name="sharding-by-date" class="org.opencloudb.route.function.PartitionByDate"&gt;\n &lt;property name="dateFormat"&gt;yyyy-MM-dd&lt;/property&gt;\n &lt;property name="sBeginDate"&gt;2014-01-01&lt;/property&gt;\n &lt;property name="sPartionDay"&gt;10&lt;/property&gt;\n&lt;/function&gt;\n</pre>配置说明：<br />上面columns 标识将要分片的表字段，algorithm 分片函数，<br />配置中配置了开始日期，分区天数，即默认从开始日期算起，分隔10天一个分区<br /><br /><br /><br /><br />Assert.assertEquals(true, 0 == partition.calculate("2014-01-01"));<br />Assert.assertEquals(true, 0 == partition.calculate("2014-01-10"));<br />Assert.assertEquals(true, 1 == partition.calculate("2014-01-11"));<br />Assert.assertEquals(true, 12 == partition.calculate("2014-05-01"));<p></p><p><br /></p><h2>6. 通配取模</h2><p><br /></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_26_8973579" name="code" class="html">&lt;tableRule name="sharding-by-pattern"&gt;\n &lt;rule&gt;\n &lt;columns&gt;user_id&lt;/columns&gt;\n &lt;algorithm&gt;sharding-by-pattern&lt;/algorithm&gt;\n &lt;/rule&gt;\n &lt;/tableRule&gt;\n&lt;function name="sharding-by-pattern" class="org.opencloudb.route.function.PartitionByPattern"&gt;\n &lt;property name="patternValue"&gt;256&lt;/property&gt;\n &lt;property name="defaultNode"&gt;2&lt;/property&gt;\n &lt;property name="mapFile"&gt;partition-pattern.txt&lt;/property&gt;\n\n&lt;/function&gt;\n</pre><br />partition-pattern.txt <br /># id partition range start-end ,data node index<br />###### first host configuration<br />1-32=0<br />33-64=1<br />65-96=2<br />97-128=3<br />######## second host configuration<br />129-160=4<br />161-192=5<br />193-224=6<br />225-256=7<br />0-0=7<br />配置说明：<br />上面columns 标识将要分片的表字段，algorithm 分片函数，patternValue 即求模基数，defaoultNode 默认节点，如果配置了默认，则不会按照求模运算<br />mapFile 配置文件路径<br />配置文件中，1-32 即代表id%256后分布的范围，如果在1-32则在分区1，其他类推，如果id非数据，则会分配在defaoultNode 默认节点<br /><p></p><p><br /></p><p>String idVal = "0";<br />Assert.assertEquals(true, 7 == autoPartition.calculate(idVal));<br />idVal = "45a";<br />Assert.assertEquals(true, 2 == autoPartition.calculate(idVal));<br /></p><p><br /></p><h2>7.  ASCII码求模通配</h2><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_27_227316" name="code" class="html">&lt;tableRule name="sharding-by-prefixpattern"&gt;\n &lt;rule&gt;\n &lt;columns&gt;user_id&lt;/columns&gt;\n &lt;algorithm&gt;sharding-by-prefixpattern&lt;/algorithm&gt;\n &lt;/rule&gt;\n &lt;/tableRule&gt;\n&lt;function name="sharding-by-pattern" class="org.opencloudb.route.function.PartitionByPattern"&gt;\n &lt;property name="patternValue"&gt;256&lt;/property&gt;\n &lt;property name="prefixLength"&gt;5&lt;/property&gt;\n &lt;property name="mapFile"&gt;partition-pattern.txt&lt;/property&gt;\n\n &lt;/function&gt;\n\npartition-pattern.txt\n\n# range start-end ,data node index\n# ASCII\n# 48-57=0-9\n# 64、65-90=@、A-Z\n# 97-122=a-z\n###### first host configuration\n1-4=0\n5-8=1\n9-12=2\n13-16=3\n###### second host configuration\n17-20=4\n21-24=5\n25-28=6\n29-32=7\n0-0=7\n配置说明：\n上面columns 标识将要分片的表字段，algorithm 分片函数，patternValue 即求模基数，prefixLength ASCII 截取的位数\nmapFile 配置文件路径\n配置文件中，1-32 即代表id%256后分布的范围，如果在1-32则在分区1，其他类推 \n\n此种方式类似方式6只不过采取的是将列种获取前prefixLength位列所有ASCII码的和进行求模sum%patternValue ,获取的值，在通配范围内的\n即 分片数，\n/**\n* ASCII编码：\n* 48-57=0-9阿拉伯数字\n* 64、65-90=@、A-Z\n* 97-122=a-z\n*\n*/\n如 \n\nString idVal="gf89f9a";\nAssert.assertEquals(true, 0==autoPartition.calculate(idVal));\n\nidVal="8df99a";\nAssert.assertEquals(true, 4==autoPartition.calculate(idVal));\n\nidVal="8dhdf99a";\nAssert.assertEquals(true, 3==autoPartition.calculate(idVal));\n</pre><br /><h2>8. 编程指定</h2><p></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_28_609000" name="code" class="html">&lt;tableRule name="sharding-by-substring"&gt;\n &lt;rule&gt;\n &lt;columns&gt;user_id&lt;/columns&gt;\n &lt;algorithm&gt;sharding-by-substring&lt;/algorithm&gt;\n &lt;/rule&gt;\n &lt;/tableRule&gt;\n&lt;function name="sharding-by-substring" class="org.opencloudb.route.function.PartitionDirectBySubString"&gt;\n &lt;property name="startIndex"&gt;0&lt;/property&gt; &lt;!-- zero-based --&gt;\n &lt;property name="size"&gt;2&lt;/property&gt;\n &lt;property name="partitionCount"&gt;8&lt;/property&gt;\n &lt;property name="defaultPartition"&gt;0&lt;/property&gt;\n &lt;/function&gt;\n配置说明：\n上面columns 标识将要分片的表字段，algorithm 分片函数 \n此方法为直接根据字符子串（必须是数字）计算分区号（由应用传递参数，显式指定分区号）。\n例如id=05-100000002\n在此配置中代表根据id中从startIndex=0，开始，截取siz=2位数字即05，05就是获取的分区，如果没传默认分配到defaultPartition\n</pre><br /><h2>9. 字符串拆分hash解析</h2><p></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_29_9910888" name="code" class="html">&lt;tableRule name="sharding-by-stringhash"&gt;\n &lt;rule&gt;\n &lt;columns&gt;user_id&lt;/columns&gt;\n &lt;algorithm&gt;sharding-by-stringhash&lt;/algorithm&gt;\n &lt;/rule&gt;\n &lt;/tableRule&gt;\n&lt;function name="sharding-by-substring" class="org.opencloudb.route.function.PartitionDirectBySubString"&gt;\n &lt;property name=length&gt;512&lt;/property&gt; &lt;!-- zero-based --&gt;\n &lt;property name="count"&gt;2&lt;/property&gt;\n &lt;property name="hashSlice"&gt;0:2&lt;/property&gt;\n &lt;/function&gt;\n配置说明：\n上面columns 标识将要分片的表字段，algorithm 分片函数 \n函数中length代表字符串hash求模基数，count分区数，hashSlice hash预算位\n\n即根据子字符串 hash运算\n\n\t\n\nhashSlice ： 0 means str.length(), -1 means str.length()-1\n\n/**\n csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-331.html csdn-332.html csdn-333.html csdn-334.html csdn-335.html csdn-336.html csdn-337.html csdn-338.html csdn-339.html csdn-33.html csdn-340.html csdn-341.html csdn-342.html csdn-343.html csdn-344.html csdn-345.html csdn-346.html csdn-347.html csdn-348.html csdn-349.html csdn-34.html csdn-350.html csdn-351.html csdn-352.html csdn-353.html csdn-354.html csdn-355.html csdn-356.html csdn-357.html csdn-358.html csdn-359.html csdn-35.html csdn-360.html csdn-361.html csdn-362.html csdn-363.html csdn-364.html csdn-365.html csdn-366.html csdn-367.html csdn-368.html csdn-369.html csdn-36.html csdn-370.html csdn-371.html csdn-372.html csdn-373.html csdn-374.html csdn-375.html csdn-376.html csdn-377.html csdn-378.html csdn-379.html csdn-37.html csdn-380.html csdn-381.html csdn-382.html csdn-383.html csdn-384.html csdn-385.html csdn-386.html csdn-387.html csdn-388.html csdn-389.html csdn-38.html csdn-390.html csdn-391.html csdn-392.html csdn-393.html csdn-394.html csdn-395.html csdn-396.html csdn-397.html csdn-398.html csdn-399.html csdn-39.html csdn-3.html csdn-400.html csdn-401.html csdn-402.html csdn-403.html csdn-404.html csdn-405.html csdn-406.html csdn-407.html csdn-408.html csdn-409.html csdn-40.html csdn-410.html csdn-411.html csdn-412.html csdn-413.html csdn-414.html csdn-415.html csdn-416.html csdn-417.html csdn-418.html csdn-419.html csdn-41.html csdn-420.html csdn-421.html csdn-422.html csdn-423.html csdn-424.html csdn-425.html csdn-426.html csdn-427.html csdn-428.html csdn-429.html csdn-42.html csdn-430.html csdn-431.html csdn-432.html csdn-433.html csdn-434.html csdn-435.html csdn-436.html csdn-437.html csdn-438.html csdn-439.html csdn-43.html csdn-440.html csdn-441.html csdn-442.html csdn-443.html csdn-444.html csdn-445.html csdn-446.html csdn-447.html csdn-448.html csdn-449.html csdn-44.html csdn-450.html csdn-451.html csdn-452.html csdn-453.html csdn-454.html csdn-455.html csdn-456.html csdn-457.html csdn-458.html csdn-459.html csdn-45.html csdn-460.html csdn-461.html csdn-462.html csdn-463.html csdn-464.html csdn-465.html csdn-466.html csdn-467.html csdn-468.html csdn-469.html csdn-46.html csdn-470.html csdn-471.html csdn-472.html csdn-473.html csdn-474.html csdn-475.html csdn-476.html csdn-477.html csdn-478.html csdn-479.html csdn-47.html csdn-480.html csdn-481.html csdn-482.html csdn-483.html csdn-484.html csdn-485.html csdn-486.html csdn-487.html csdn-488.html csdn-489.html csdn-48.html csdn-490.html csdn-491.html csdn-492.html csdn-493.html csdn-494.html csdn-495.html csdn-496.html csdn-497.html csdn-498.html csdn-499.html csdn-49.html csdn-4.html csdn-500.html csdn-501.html csdn-502.html csdn-503.html csdn-504.html csdn-505.html csdn-506.html csdn-507.html csdn-508.html csdn-509.html csdn-50.html csdn-510.html csdn-511.html csdn-512.html csdn-513.html csdn-514.html csdn-515.html csdn-516.html csdn-517.html csdn-518.html csdn-519.html csdn-51.html csdn-520.html csdn-521.html csdn-522.html csdn-523.html csdn-524.html csdn-525.html csdn-526.html csdn-527.html csdn-528.html csdn-529.html csdn-52.html csdn-530.html csdn-531.html csdn-532.html csdn-533.html csdn-534.html csdn-535.html csdn-536.html csdn-537.html csdn-538.html csdn-539.html csdn-53.html csdn-540.html csdn-541.html csdn-542.html csdn-543.html csdn-544.html csdn-545.html csdn-546.html csdn-547.html csdn-548.html csdn-549.html csdn-54.html csdn-550.html csdn-551.html csdn-552.html csdn-553.html csdn-554.html csdn-555.html csdn-556.html csdn-557.html csdn-558.html csdn-559.html csdn-55.html csdn-560.html csdn-561.html csdn-562.html csdn-563.html csdn-564.html csdn-565.html csdn-566.html csdn-567.html csdn-568.html csdn-569.html csdn-56.html csdn-570.html csdn-571.html csdn-572.html csdn-573.html csdn-574.html csdn-575.html csdn-576.html csdn-577.html csdn-578.html csdn-579.html csdn-57.html csdn-580.html csdn-581.html csdn-582.html csdn-583.html csdn-584.html csdn-585.html csdn-586.html csdn-587.html csdn-588.html csdn-589.html csdn-58.html csdn-590.html csdn-591.html csdn-592.html csdn-593.html csdn-594.html csdn-595.html csdn-596.html csdn-597.html csdn-598.html csdn-599.html csdn-59.html csdn-5.html csdn-600.html csdn-601.html csdn-602.html csdn-603.html csdn-604.html csdn-605.html csdn-606.html csdn-607.html csdn-608.html csdn-609.html csdn-60.html csdn-610.html csdn-611.html csdn-612.html csdn-613.html csdn-614.html csdn-615.html csdn-616.html csdn-617.html csdn-618.html csdn-619.html csdn-61.html csdn-620.html csdn-621.html csdn-622.html csdn-623.html csdn-624.html csdn-625.html csdn-626.html csdn-627.html csdn-628.html csdn-629.html csdn-62.html csdn-630.html csdn-631.html csdn-632.html csdn-633.html csdn-634.html csdn-635.html csdn-636.html csdn-637.html csdn-638.html csdn-639.html csdn-63.html csdn-640.html csdn-641.html csdn-642.html csdn-643.html csdn-644.html csdn-645.html csdn-646.html csdn-647.html csdn-648.html csdn-649.html csdn-64.html csdn-650.html csdn-651.html csdn-652.html csdn-653.html csdn-654.html csdn-655.html csdn-656.html csdn-657.html csdn-658.html csdn-659.html csdn-65.html csdn-660.html csdn-661.html csdn-662.html csdn-663.html csdn-664.html csdn-665.html csdn-666.html csdn-667.html csdn-668.html csdn-669.html csdn-66.html csdn-670.html csdn-671.html csdn-672.html csdn-673.html csdn-674.html csdn-675.html csdn-676.html csdn-677.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh "2" -&gt; (0,2)&lt;br/&gt;\n csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-331.html csdn-332.html csdn-333.html csdn-334.html csdn-335.html csdn-336.html csdn-337.html csdn-338.html csdn-339.html csdn-33.html csdn-340.html csdn-341.html csdn-342.html csdn-343.html csdn-344.html csdn-345.html csdn-346.html csdn-347.html csdn-348.html csdn-349.html csdn-34.html csdn-350.html csdn-351.html csdn-352.html csdn-353.html csdn-354.html csdn-355.html csdn-356.html csdn-357.html csdn-358.html csdn-359.html csdn-35.html csdn-360.html csdn-361.html csdn-362.html csdn-363.html csdn-364.html csdn-365.html csdn-366.html csdn-367.html csdn-368.html csdn-369.html csdn-36.html csdn-370.html csdn-371.html csdn-372.html csdn-373.html csdn-374.html csdn-375.html csdn-376.html csdn-377.html csdn-378.html csdn-379.html csdn-37.html csdn-380.html csdn-381.html csdn-382.html csdn-383.html csdn-384.html csdn-385.html csdn-386.html csdn-387.html csdn-388.html csdn-389.html csdn-38.html csdn-390.html csdn-391.html csdn-392.html csdn-393.html csdn-394.html csdn-395.html csdn-396.html csdn-397.html csdn-398.html csdn-399.html csdn-39.html csdn-3.html csdn-400.html csdn-401.html csdn-402.html csdn-403.html csdn-404.html csdn-405.html csdn-406.html csdn-407.html csdn-408.html csdn-409.html csdn-40.html csdn-410.html csdn-411.html csdn-412.html csdn-413.html csdn-414.html csdn-415.html csdn-416.html csdn-417.html csdn-418.html csdn-419.html csdn-41.html csdn-420.html csdn-421.html csdn-422.html csdn-423.html csdn-424.html csdn-425.html csdn-426.html csdn-427.html csdn-428.html csdn-429.html csdn-42.html csdn-430.html csdn-431.html csdn-432.html csdn-433.html csdn-434.html csdn-435.html csdn-436.html csdn-437.html csdn-438.html csdn-439.html csdn-43.html csdn-440.html csdn-441.html csdn-442.html csdn-443.html csdn-444.html csdn-445.html csdn-446.html csdn-447.html csdn-448.html csdn-449.html csdn-44.html csdn-450.html csdn-451.html csdn-452.html csdn-453.html csdn-454.html csdn-455.html csdn-456.html csdn-457.html csdn-458.html csdn-459.html csdn-45.html csdn-460.html csdn-461.html csdn-462.html csdn-463.html csdn-464.html csdn-465.html csdn-466.html csdn-467.html csdn-468.html csdn-469.html csdn-46.html csdn-470.html csdn-471.html csdn-472.html csdn-473.html csdn-474.html csdn-475.html csdn-476.html csdn-477.html csdn-478.html csdn-479.html csdn-47.html csdn-480.html csdn-481.html csdn-482.html csdn-483.html csdn-484.html csdn-485.html csdn-486.html csdn-487.html csdn-488.html csdn-489.html csdn-48.html csdn-490.html csdn-491.html csdn-492.html csdn-493.html csdn-494.html csdn-495.html csdn-496.html csdn-497.html csdn-498.html csdn-499.html csdn-49.html csdn-4.html csdn-500.html csdn-501.html csdn-502.html csdn-503.html csdn-504.html csdn-505.html csdn-506.html csdn-507.html csdn-508.html csdn-509.html csdn-50.html csdn-510.html csdn-511.html csdn-512.html csdn-513.html csdn-514.html csdn-515.html csdn-516.html csdn-517.html csdn-518.html csdn-519.html csdn-51.html csdn-520.html csdn-521.html csdn-522.html csdn-523.html csdn-524.html csdn-525.html csdn-526.html csdn-527.html csdn-528.html csdn-529.html csdn-52.html csdn-530.html csdn-531.html csdn-532.html csdn-533.html csdn-534.html csdn-535.html csdn-536.html csdn-537.html csdn-538.html csdn-539.html csdn-53.html csdn-540.html csdn-541.html csdn-542.html csdn-543.html csdn-544.html csdn-545.html csdn-546.html csdn-547.html csdn-548.html csdn-549.html csdn-54.html csdn-550.html csdn-551.html csdn-552.html csdn-553.html csdn-554.html csdn-555.html csdn-556.html csdn-557.html csdn-558.html csdn-559.html csdn-55.html csdn-560.html csdn-561.html csdn-562.html csdn-563.html csdn-564.html csdn-565.html csdn-566.html csdn-567.html csdn-568.html csdn-569.html csdn-56.html csdn-570.html csdn-571.html csdn-572.html csdn-573.html csdn-574.html csdn-575.html csdn-576.html csdn-577.html csdn-578.html csdn-579.html csdn-57.html csdn-580.html csdn-581.html csdn-582.html csdn-583.html csdn-584.html csdn-585.html csdn-586.html csdn-587.html csdn-588.html csdn-589.html csdn-58.html csdn-590.html csdn-591.html csdn-592.html csdn-593.html csdn-594.html csdn-595.html csdn-596.html csdn-597.html csdn-598.html csdn-599.html csdn-59.html csdn-5.html csdn-600.html csdn-601.html csdn-602.html csdn-603.html csdn-604.html csdn-605.html csdn-606.html csdn-607.html csdn-608.html csdn-609.html csdn-60.html csdn-610.html csdn-611.html csdn-612.html csdn-613.html csdn-614.html csdn-615.html csdn-616.html csdn-617.html csdn-618.html csdn-619.html csdn-61.html csdn-620.html csdn-621.html csdn-622.html csdn-623.html csdn-624.html csdn-625.html csdn-626.html csdn-627.html csdn-628.html csdn-629.html csdn-62.html csdn-630.html csdn-631.html csdn-632.html csdn-633.html csdn-634.html csdn-635.html csdn-636.html csdn-637.html csdn-638.html csdn-639.html csdn-63.html csdn-640.html csdn-641.html csdn-642.html csdn-643.html csdn-644.html csdn-645.html csdn-646.html csdn-647.html csdn-648.html csdn-649.html csdn-64.html csdn-650.html csdn-651.html csdn-652.html csdn-653.html csdn-654.html csdn-655.html csdn-656.html csdn-657.html csdn-658.html csdn-659.html csdn-65.html csdn-660.html csdn-661.html csdn-662.html csdn-663.html csdn-664.html csdn-665.html csdn-666.html csdn-667.html csdn-668.html csdn-669.html csdn-66.html csdn-670.html csdn-671.html csdn-672.html csdn-673.html csdn-674.html csdn-675.html csdn-676.html csdn-677.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh "1:2" -&gt; (1,2)&lt;br/&gt;\n csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-331.html csdn-332.html csdn-333.html csdn-334.html csdn-335.html csdn-336.html csdn-337.html csdn-338.html csdn-339.html csdn-33.html csdn-340.html csdn-341.html csdn-342.html csdn-343.html csdn-344.html csdn-345.html csdn-346.html csdn-347.html csdn-348.html csdn-349.html csdn-34.html csdn-350.html csdn-351.html csdn-352.html csdn-353.html csdn-354.html csdn-355.html csdn-356.html csdn-357.html csdn-358.html csdn-359.html csdn-35.html csdn-360.html csdn-361.html csdn-362.html csdn-363.html csdn-364.html csdn-365.html csdn-366.html csdn-367.html csdn-368.html csdn-369.html csdn-36.html csdn-370.html csdn-371.html csdn-372.html csdn-373.html csdn-374.html csdn-375.html csdn-376.html csdn-377.html csdn-378.html csdn-379.html csdn-37.html csdn-380.html csdn-381.html csdn-382.html csdn-383.html csdn-384.html csdn-385.html csdn-386.html csdn-387.html csdn-388.html csdn-389.html csdn-38.html csdn-390.html csdn-391.html csdn-392.html csdn-393.html csdn-394.html csdn-395.html csdn-396.html csdn-397.html csdn-398.html csdn-399.html csdn-39.html csdn-3.html csdn-400.html csdn-401.html csdn-402.html csdn-403.html csdn-404.html csdn-405.html csdn-406.html csdn-407.html csdn-408.html csdn-409.html csdn-40.html csdn-410.html csdn-411.html csdn-412.html csdn-413.html csdn-414.html csdn-415.html csdn-416.html csdn-417.html csdn-418.html csdn-419.html csdn-41.html csdn-420.html csdn-421.html csdn-422.html csdn-423.html csdn-424.html csdn-425.html csdn-426.html csdn-427.html csdn-428.html csdn-429.html csdn-42.html csdn-430.html csdn-431.html csdn-432.html csdn-433.html csdn-434.html csdn-435.html csdn-436.html csdn-437.html csdn-438.html csdn-439.html csdn-43.html csdn-440.html csdn-441.html csdn-442.html csdn-443.html csdn-444.html csdn-445.html csdn-446.html csdn-447.html csdn-448.html csdn-449.html csdn-44.html csdn-450.html csdn-451.html csdn-452.html csdn-453.html csdn-454.html csdn-455.html csdn-456.html csdn-457.html csdn-458.html csdn-459.html csdn-45.html csdn-460.html csdn-461.html csdn-462.html csdn-463.html csdn-464.html csdn-465.html csdn-466.html csdn-467.html csdn-468.html csdn-469.html csdn-46.html csdn-470.html csdn-471.html csdn-472.html csdn-473.html csdn-474.html csdn-475.html csdn-476.html csdn-477.html csdn-478.html csdn-479.html csdn-47.html csdn-480.html csdn-481.html csdn-482.html csdn-483.html csdn-484.html csdn-485.html csdn-486.html csdn-487.html csdn-488.html csdn-489.html csdn-48.html csdn-490.html csdn-491.html csdn-492.html csdn-493.html csdn-494.html csdn-495.html csdn-496.html csdn-497.html csdn-498.html csdn-499.html csdn-49.html csdn-4.html csdn-500.html csdn-501.html csdn-502.html csdn-503.html csdn-504.html csdn-505.html csdn-506.html csdn-507.html csdn-508.html csdn-509.html csdn-50.html csdn-510.html csdn-511.html csdn-512.html csdn-513.html csdn-514.html csdn-515.html csdn-516.html csdn-517.html csdn-518.html csdn-519.html csdn-51.html csdn-520.html csdn-521.html csdn-522.html csdn-523.html csdn-524.html csdn-525.html csdn-526.html csdn-527.html csdn-528.html csdn-529.html csdn-52.html csdn-530.html csdn-531.html csdn-532.html csdn-533.html csdn-534.html csdn-535.html csdn-536.html csdn-537.html csdn-538.html csdn-539.html csdn-53.html csdn-540.html csdn-541.html csdn-542.html csdn-543.html csdn-544.html csdn-545.html csdn-546.html csdn-547.html csdn-548.html csdn-549.html csdn-54.html csdn-550.html csdn-551.html csdn-552.html csdn-553.html csdn-554.html csdn-555.html csdn-556.html csdn-557.html csdn-558.html csdn-559.html csdn-55.html csdn-560.html csdn-561.html csdn-562.html csdn-563.html csdn-564.html csdn-565.html csdn-566.html csdn-567.html csdn-568.html csdn-569.html csdn-56.html csdn-570.html csdn-571.html csdn-572.html csdn-573.html csdn-574.html csdn-575.html csdn-576.html csdn-577.html csdn-578.html csdn-579.html csdn-57.html csdn-580.html csdn-581.html csdn-582.html csdn-583.html csdn-584.html csdn-585.html csdn-586.html csdn-587.html csdn-588.html csdn-589.html csdn-58.html csdn-590.html csdn-591.html csdn-592.html csdn-593.html csdn-594.html csdn-595.html csdn-596.html csdn-597.html csdn-598.html csdn-599.html csdn-59.html csdn-5.html csdn-600.html csdn-601.html csdn-602.html csdn-603.html csdn-604.html csdn-605.html csdn-606.html csdn-607.html csdn-608.html csdn-609.html csdn-60.html csdn-610.html csdn-611.html csdn-612.html csdn-613.html csdn-614.html csdn-615.html csdn-616.html csdn-617.html csdn-618.html csdn-619.html csdn-61.html csdn-620.html csdn-621.html csdn-622.html csdn-623.html csdn-624.html csdn-625.html csdn-626.html csdn-627.html csdn-628.html csdn-629.html csdn-62.html csdn-630.html csdn-631.html csdn-632.html csdn-633.html csdn-634.html csdn-635.html csdn-636.html csdn-637.html csdn-638.html csdn-639.html csdn-63.html csdn-640.html csdn-641.html csdn-642.html csdn-643.html csdn-644.html csdn-645.html csdn-646.html csdn-647.html csdn-648.html csdn-649.html csdn-64.html csdn-650.html csdn-651.html csdn-652.html csdn-653.html csdn-654.html csdn-655.html csdn-656.html csdn-657.html csdn-658.html csdn-659.html csdn-65.html csdn-660.html csdn-661.html csdn-662.html csdn-663.html csdn-664.html csdn-665.html csdn-666.html csdn-667.html csdn-668.html csdn-669.html csdn-66.html csdn-670.html csdn-671.html csdn-672.html csdn-673.html csdn-674.html csdn-675.html csdn-676.html csdn-677.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh "1:" -&gt; (1,0)&lt;br/&gt;\n csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-331.html csdn-332.html csdn-333.html csdn-334.html csdn-335.html csdn-336.html csdn-337.html csdn-338.html csdn-339.html csdn-33.html csdn-340.html csdn-341.html csdn-342.html csdn-343.html csdn-344.html csdn-345.html csdn-346.html csdn-347.html csdn-348.html csdn-349.html csdn-34.html csdn-350.html csdn-351.html csdn-352.html csdn-353.html csdn-354.html csdn-355.html csdn-356.html csdn-357.html csdn-358.html csdn-359.html csdn-35.html csdn-360.html csdn-361.html csdn-362.html csdn-363.html csdn-364.html csdn-365.html csdn-366.html csdn-367.html csdn-368.html csdn-369.html csdn-36.html csdn-370.html csdn-371.html csdn-372.html csdn-373.html csdn-374.html csdn-375.html csdn-376.html csdn-377.html csdn-378.html csdn-379.html csdn-37.html csdn-380.html csdn-381.html csdn-382.html csdn-383.html csdn-384.html csdn-385.html csdn-386.html csdn-387.html csdn-388.html csdn-389.html csdn-38.html csdn-390.html csdn-391.html csdn-392.html csdn-393.html csdn-394.html csdn-395.html csdn-396.html csdn-397.html csdn-398.html csdn-399.html csdn-39.html csdn-3.html csdn-400.html csdn-401.html csdn-402.html csdn-403.html csdn-404.html csdn-405.html csdn-406.html csdn-407.html csdn-408.html csdn-409.html csdn-40.html csdn-410.html csdn-411.html csdn-412.html csdn-413.html csdn-414.html csdn-415.html csdn-416.html csdn-417.html csdn-418.html csdn-419.html csdn-41.html csdn-420.html csdn-421.html csdn-422.html csdn-423.html csdn-424.html csdn-425.html csdn-426.html csdn-427.html csdn-428.html csdn-429.html csdn-42.html csdn-430.html csdn-431.html csdn-432.html csdn-433.html csdn-434.html csdn-435.html csdn-436.html csdn-437.html csdn-438.html csdn-439.html csdn-43.html csdn-440.html csdn-441.html csdn-442.html csdn-443.html csdn-444.html csdn-445.html csdn-446.html csdn-447.html csdn-448.html csdn-449.html csdn-44.html csdn-450.html csdn-451.html csdn-452.html csdn-453.html csdn-454.html csdn-455.html csdn-456.html csdn-457.html csdn-458.html csdn-459.html csdn-45.html csdn-460.html csdn-461.html csdn-462.html csdn-463.html csdn-464.html csdn-465.html csdn-466.html csdn-467.html csdn-468.html csdn-469.html csdn-46.html csdn-470.html csdn-471.html csdn-472.html csdn-473.html csdn-474.html csdn-475.html csdn-476.html csdn-477.html csdn-478.html csdn-479.html csdn-47.html csdn-480.html csdn-481.html csdn-482.html csdn-483.html csdn-484.html csdn-485.html csdn-486.html csdn-487.html csdn-488.html csdn-489.html csdn-48.html csdn-490.html csdn-491.html csdn-492.html csdn-493.html csdn-494.html csdn-495.html csdn-496.html csdn-497.html csdn-498.html csdn-499.html csdn-49.html csdn-4.html csdn-500.html csdn-501.html csdn-502.html csdn-503.html csdn-504.html csdn-505.html csdn-506.html csdn-507.html csdn-508.html csdn-509.html csdn-50.html csdn-510.html csdn-511.html csdn-512.html csdn-513.html csdn-514.html csdn-515.html csdn-516.html csdn-517.html csdn-518.html csdn-519.html csdn-51.html csdn-520.html csdn-521.html csdn-522.html csdn-523.html csdn-524.html csdn-525.html csdn-526.html csdn-527.html csdn-528.html csdn-529.html csdn-52.html csdn-530.html csdn-531.html csdn-532.html csdn-533.html csdn-534.html csdn-535.html csdn-536.html csdn-537.html csdn-538.html csdn-539.html csdn-53.html csdn-540.html csdn-541.html csdn-542.html csdn-543.html csdn-544.html csdn-545.html csdn-546.html csdn-547.html csdn-548.html csdn-549.html csdn-54.html csdn-550.html csdn-551.html csdn-552.html csdn-553.html csdn-554.html csdn-555.html csdn-556.html csdn-557.html csdn-558.html csdn-559.html csdn-55.html csdn-560.html csdn-561.html csdn-562.html csdn-563.html csdn-564.html csdn-565.html csdn-566.html csdn-567.html csdn-568.html csdn-569.html csdn-56.html csdn-570.html csdn-571.html csdn-572.html csdn-573.html csdn-574.html csdn-575.html csdn-576.html csdn-577.html csdn-578.html csdn-579.html csdn-57.html csdn-580.html csdn-581.html csdn-582.html csdn-583.html csdn-584.html csdn-585.html csdn-586.html csdn-587.html csdn-588.html csdn-589.html csdn-58.html csdn-590.html csdn-591.html csdn-592.html csdn-593.html csdn-594.html csdn-595.html csdn-596.html csdn-597.html csdn-598.html csdn-599.html csdn-59.html csdn-5.html csdn-600.html csdn-601.html csdn-602.html csdn-603.html csdn-604.html csdn-605.html csdn-606.html csdn-607.html csdn-608.html csdn-609.html csdn-60.html csdn-610.html csdn-611.html csdn-612.html csdn-613.html csdn-614.html csdn-615.html csdn-616.html csdn-617.html csdn-618.html csdn-619.html csdn-61.html csdn-620.html csdn-621.html csdn-622.html csdn-623.html csdn-624.html csdn-625.html csdn-626.html csdn-627.html csdn-628.html csdn-629.html csdn-62.html csdn-630.html csdn-631.html csdn-632.html csdn-633.html csdn-634.html csdn-635.html csdn-636.html csdn-637.html csdn-638.html csdn-639.html csdn-63.html csdn-640.html csdn-641.html csdn-642.html csdn-643.html csdn-644.html csdn-645.html csdn-646.html csdn-647.html csdn-648.html csdn-649.html csdn-64.html csdn-650.html csdn-651.html csdn-652.html csdn-653.html csdn-654.html csdn-655.html csdn-656.html csdn-657.html csdn-658.html csdn-659.html csdn-65.html csdn-660.html csdn-661.html csdn-662.html csdn-663.html csdn-664.html csdn-665.html csdn-666.html csdn-667.html csdn-668.html csdn-669.html csdn-66.html csdn-670.html csdn-671.html csdn-672.html csdn-673.html csdn-674.html csdn-675.html csdn-676.html csdn-677.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh "-1:" -&gt; (-1,0)&lt;br/&gt;\n csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-331.html csdn-332.html csdn-333.html csdn-334.html csdn-335.html csdn-336.html csdn-337.html csdn-338.html csdn-339.html csdn-33.html csdn-340.html csdn-341.html csdn-342.html csdn-343.html csdn-344.html csdn-345.html csdn-346.html csdn-347.html csdn-348.html csdn-349.html csdn-34.html csdn-350.html csdn-351.html csdn-352.html csdn-353.html csdn-354.html csdn-355.html csdn-356.html csdn-357.html csdn-358.html csdn-359.html csdn-35.html csdn-360.html csdn-361.html csdn-362.html csdn-363.html csdn-364.html csdn-365.html csdn-366.html csdn-367.html csdn-368.html csdn-369.html csdn-36.html csdn-370.html csdn-371.html csdn-372.html csdn-373.html csdn-374.html csdn-375.html csdn-376.html csdn-377.html csdn-378.html csdn-379.html csdn-37.html csdn-380.html csdn-381.html csdn-382.html csdn-383.html csdn-384.html csdn-385.html csdn-386.html csdn-387.html csdn-388.html csdn-389.html csdn-38.html csdn-390.html csdn-391.html csdn-392.html csdn-393.html csdn-394.html csdn-395.html csdn-396.html csdn-397.html csdn-398.html csdn-399.html csdn-39.html csdn-3.html csdn-400.html csdn-401.html csdn-402.html csdn-403.html csdn-404.html csdn-405.html csdn-406.html csdn-407.html csdn-408.html csdn-409.html csdn-40.html csdn-410.html csdn-411.html csdn-412.html csdn-413.html csdn-414.html csdn-415.html csdn-416.html csdn-417.html csdn-418.html csdn-419.html csdn-41.html csdn-420.html csdn-421.html csdn-422.html csdn-423.html csdn-424.html csdn-425.html csdn-426.html csdn-427.html csdn-428.html csdn-429.html csdn-42.html csdn-430.html csdn-431.html csdn-432.html csdn-433.html csdn-434.html csdn-435.html csdn-436.html csdn-437.html csdn-438.html csdn-439.html csdn-43.html csdn-440.html csdn-441.html csdn-442.html csdn-443.html csdn-444.html csdn-445.html csdn-446.html csdn-447.html csdn-448.html csdn-449.html csdn-44.html csdn-450.html csdn-451.html csdn-452.html csdn-453.html csdn-454.html csdn-455.html csdn-456.html csdn-457.html csdn-458.html csdn-459.html csdn-45.html csdn-460.html csdn-461.html csdn-462.html csdn-463.html csdn-464.html csdn-465.html csdn-466.html csdn-467.html csdn-468.html csdn-469.html csdn-46.html csdn-470.html csdn-471.html csdn-472.html csdn-473.html csdn-474.html csdn-475.html csdn-476.html csdn-477.html csdn-478.html csdn-479.html csdn-47.html csdn-480.html csdn-481.html csdn-482.html csdn-483.html csdn-484.html csdn-485.html csdn-486.html csdn-487.html csdn-488.html csdn-489.html csdn-48.html csdn-490.html csdn-491.html csdn-492.html csdn-493.html csdn-494.html csdn-495.html csdn-496.html csdn-497.html csdn-498.html csdn-499.html csdn-49.html csdn-4.html csdn-500.html csdn-501.html csdn-502.html csdn-503.html csdn-504.html csdn-505.html csdn-506.html csdn-507.html csdn-508.html csdn-509.html csdn-50.html csdn-510.html csdn-511.html csdn-512.html csdn-513.html csdn-514.html csdn-515.html csdn-516.html csdn-517.html csdn-518.html csdn-519.html csdn-51.html csdn-520.html csdn-521.html csdn-522.html csdn-523.html csdn-524.html csdn-525.html csdn-526.html csdn-527.html csdn-528.html csdn-529.html csdn-52.html csdn-530.html csdn-531.html csdn-532.html csdn-533.html csdn-534.html csdn-535.html csdn-536.html csdn-537.html csdn-538.html csdn-539.html csdn-53.html csdn-540.html csdn-541.html csdn-542.html csdn-543.html csdn-544.html csdn-545.html csdn-546.html csdn-547.html csdn-548.html csdn-549.html csdn-54.html csdn-550.html csdn-551.html csdn-552.html csdn-553.html csdn-554.html csdn-555.html csdn-556.html csdn-557.html csdn-558.html csdn-559.html csdn-55.html csdn-560.html csdn-561.html csdn-562.html csdn-563.html csdn-564.html csdn-565.html csdn-566.html csdn-567.html csdn-568.html csdn-569.html csdn-56.html csdn-570.html csdn-571.html csdn-572.html csdn-573.html csdn-574.html csdn-575.html csdn-576.html csdn-577.html csdn-578.html csdn-579.html csdn-57.html csdn-580.html csdn-581.html csdn-582.html csdn-583.html csdn-584.html csdn-585.html csdn-586.html csdn-587.html csdn-588.html csdn-589.html csdn-58.html csdn-590.html csdn-591.html csdn-592.html csdn-593.html csdn-594.html csdn-595.html csdn-596.html csdn-597.html csdn-598.html csdn-599.html csdn-59.html csdn-5.html csdn-600.html csdn-601.html csdn-602.html csdn-603.html csdn-604.html csdn-605.html csdn-606.html csdn-607.html csdn-608.html csdn-609.html csdn-60.html csdn-610.html csdn-611.html csdn-612.html csdn-613.html csdn-614.html csdn-615.html csdn-616.html csdn-617.html csdn-618.html csdn-619.html csdn-61.html csdn-620.html csdn-621.html csdn-622.html csdn-623.html csdn-624.html csdn-625.html csdn-626.html csdn-627.html csdn-628.html csdn-629.html csdn-62.html csdn-630.html csdn-631.html csdn-632.html csdn-633.html csdn-634.html csdn-635.html csdn-636.html csdn-637.html csdn-638.html csdn-639.html csdn-63.html csdn-640.html csdn-641.html csdn-642.html csdn-643.html csdn-644.html csdn-645.html csdn-646.html csdn-647.html csdn-648.html csdn-649.html csdn-64.html csdn-650.html csdn-651.html csdn-652.html csdn-653.html csdn-654.html csdn-655.html csdn-656.html csdn-657.html csdn-658.html csdn-659.html csdn-65.html csdn-660.html csdn-661.html csdn-662.html csdn-663.html csdn-664.html csdn-665.html csdn-666.html csdn-667.html csdn-668.html csdn-669.html csdn-66.html csdn-670.html csdn-671.html csdn-672.html csdn-673.html csdn-674.html csdn-675.html csdn-676.html csdn-677.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh ":-1" -&gt; (0,-1)&lt;br/&gt;\n csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-331.html csdn-332.html csdn-333.html csdn-334.html csdn-335.html csdn-336.html csdn-337.html csdn-338.html csdn-339.html csdn-33.html csdn-340.html csdn-341.html csdn-342.html csdn-343.html csdn-344.html csdn-345.html csdn-346.html csdn-347.html csdn-348.html csdn-349.html csdn-34.html csdn-350.html csdn-351.html csdn-352.html csdn-353.html csdn-354.html csdn-355.html csdn-356.html csdn-357.html csdn-358.html csdn-359.html csdn-35.html csdn-360.html csdn-361.html csdn-362.html csdn-363.html csdn-364.html csdn-365.html csdn-366.html csdn-367.html csdn-368.html csdn-369.html csdn-36.html csdn-370.html csdn-371.html csdn-372.html csdn-373.html csdn-374.html csdn-375.html csdn-376.html csdn-377.html csdn-378.html csdn-379.html csdn-37.html csdn-380.html csdn-381.html csdn-382.html csdn-383.html csdn-384.html csdn-385.html csdn-386.html csdn-387.html csdn-388.html csdn-389.html csdn-38.html csdn-390.html csdn-391.html csdn-392.html csdn-393.html csdn-394.html csdn-395.html csdn-396.html csdn-397.html csdn-398.html csdn-399.html csdn-39.html csdn-3.html csdn-400.html csdn-401.html csdn-402.html csdn-403.html csdn-404.html csdn-405.html csdn-406.html csdn-407.html csdn-408.html csdn-409.html csdn-40.html csdn-410.html csdn-411.html csdn-412.html csdn-413.html csdn-414.html csdn-415.html csdn-416.html csdn-417.html csdn-418.html csdn-419.html csdn-41.html csdn-420.html csdn-421.html csdn-422.html csdn-423.html csdn-424.html csdn-425.html csdn-426.html csdn-427.html csdn-428.html csdn-429.html csdn-42.html csdn-430.html csdn-431.html csdn-432.html csdn-433.html csdn-434.html csdn-435.html csdn-436.html csdn-437.html csdn-438.html csdn-439.html csdn-43.html csdn-440.html csdn-441.html csdn-442.html csdn-443.html csdn-444.html csdn-445.html csdn-446.html csdn-447.html csdn-448.html csdn-449.html csdn-44.html csdn-450.html csdn-451.html csdn-452.html csdn-453.html csdn-454.html csdn-455.html csdn-456.html csdn-457.html csdn-458.html csdn-459.html csdn-45.html csdn-460.html csdn-461.html csdn-462.html csdn-463.html csdn-464.html csdn-465.html csdn-466.html csdn-467.html csdn-468.html csdn-469.html csdn-46.html csdn-470.html csdn-471.html csdn-472.html csdn-473.html csdn-474.html csdn-475.html csdn-476.html csdn-477.html csdn-478.html csdn-479.html csdn-47.html csdn-480.html csdn-481.html csdn-482.html csdn-483.html csdn-484.html csdn-485.html csdn-486.html csdn-487.html csdn-488.html csdn-489.html csdn-48.html csdn-490.html csdn-491.html csdn-492.html csdn-493.html csdn-494.html csdn-495.html csdn-496.html csdn-497.html csdn-498.html csdn-499.html csdn-49.html csdn-4.html csdn-500.html csdn-501.html csdn-502.html csdn-503.html csdn-504.html csdn-505.html csdn-506.html csdn-507.html csdn-508.html csdn-509.html csdn-50.html csdn-510.html csdn-511.html csdn-512.html csdn-513.html csdn-514.html csdn-515.html csdn-516.html csdn-517.html csdn-518.html csdn-519.html csdn-51.html csdn-520.html csdn-521.html csdn-522.html csdn-523.html csdn-524.html csdn-525.html csdn-526.html csdn-527.html csdn-528.html csdn-529.html csdn-52.html csdn-530.html csdn-531.html csdn-532.html csdn-533.html csdn-534.html csdn-535.html csdn-536.html csdn-537.html csdn-538.html csdn-539.html csdn-53.html csdn-540.html csdn-541.html csdn-542.html csdn-543.html csdn-544.html csdn-545.html csdn-546.html csdn-547.html csdn-548.html csdn-549.html csdn-54.html csdn-550.html csdn-551.html csdn-552.html csdn-553.html csdn-554.html csdn-555.html csdn-556.html csdn-557.html csdn-558.html csdn-559.html csdn-55.html csdn-560.html csdn-561.html csdn-562.html csdn-563.html csdn-564.html csdn-565.html csdn-566.html csdn-567.html csdn-568.html csdn-569.html csdn-56.html csdn-570.html csdn-571.html csdn-572.html csdn-573.html csdn-574.html csdn-575.html csdn-576.html csdn-577.html csdn-578.html csdn-579.html csdn-57.html csdn-580.html csdn-581.html csdn-582.html csdn-583.html csdn-584.html csdn-585.html csdn-586.html csdn-587.html csdn-588.html csdn-589.html csdn-58.html csdn-590.html csdn-591.html csdn-592.html csdn-593.html csdn-594.html csdn-595.html csdn-596.html csdn-597.html csdn-598.html csdn-599.html csdn-59.html csdn-5.html csdn-600.html csdn-601.html csdn-602.html csdn-603.html csdn-604.html csdn-605.html csdn-606.html csdn-607.html csdn-608.html csdn-609.html csdn-60.html csdn-610.html csdn-611.html csdn-612.html csdn-613.html csdn-614.html csdn-615.html csdn-616.html csdn-617.html csdn-618.html csdn-619.html csdn-61.html csdn-620.html csdn-621.html csdn-622.html csdn-623.html csdn-624.html csdn-625.html csdn-626.html csdn-627.html csdn-628.html csdn-629.html csdn-62.html csdn-630.html csdn-631.html csdn-632.html csdn-633.html csdn-634.html csdn-635.html csdn-636.html csdn-637.html csdn-638.html csdn-639.html csdn-63.html csdn-640.html csdn-641.html csdn-642.html csdn-643.html csdn-644.html csdn-645.html csdn-646.html csdn-647.html csdn-648.html csdn-649.html csdn-64.html csdn-650.html csdn-651.html csdn-652.html csdn-653.html csdn-654.html csdn-655.html csdn-656.html csdn-657.html csdn-658.html csdn-659.html csdn-65.html csdn-660.html csdn-661.html csdn-662.html csdn-663.html csdn-664.html csdn-665.html csdn-666.html csdn-667.html csdn-668.html csdn-669.html csdn-66.html csdn-670.html csdn-671.html csdn-672.html csdn-673.html csdn-674.html csdn-675.html csdn-676.html csdn-677.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh ":" -&gt; (0,0)&lt;br/&gt;\n */\n</pre><br />例子：<br /><p></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_30_2800827" name="code" class="java">String idVal=null;\n rule.setPartitionLength("512");\n rule.setPartitionCount("2");\n rule.init();\n rule.setHashSlice("0:2");\n//\t\tidVal = "0";\n//\t\tAssert.assertEquals(true, 0 == rule.calculate(idVal));\n//\t\tidVal = "45a";\n//\t\tAssert.assertEquals(true, 1 == rule.calculate(idVal));\n\n \n \n //last 4\n rule = new PartitionByString();\n rule.setPartitionLength("512");\n rule.setPartitionCount("2");\n rule.init();\n //last 4 characters\n rule.setHashSlice("-4:0");\n idVal = "aaaabbb0000";\n Assert.assertEquals(true, 0 == rule.calculate(idVal));\n idVal = "aaaabbb2359";\n Assert.assertEquals(true, 0 == rule.calculate(idVal));\n</pre><br /><h2>10. 一致性hash</h2><p></p><p><br /></p><p></p><pre code_snippet_id="1947775" snippet_file_name="blog_20161025_31_5690766" name="code" class="html">&lt;tableRule name="sharding-by-murmur"&gt;\n &lt;rule&gt;\n &lt;columns&gt;user_id&lt;/columns&gt;\n &lt;algorithm&gt;murmur&lt;/algorithm&gt;\n &lt;/rule&gt;\n &lt;/tableRule&gt;\n&lt;function name="murmur" class="org.opencloudb.route.function.PartitionByMurmurHash"&gt;\n &lt;property name="seed"&gt;0&lt;/property&gt;&lt;!-- 默认是0--&gt;\n &lt;property name="count"&gt;2&lt;/property&gt;&lt;!-- 要分片的数据库节点数量，必须指定，否则没法分片--&gt;\n &lt;property name="virtualBucketTimes"&gt;160&lt;/property&gt;&lt;!-- 一个实际的数据库节点被映射为这么多虚拟节点，默认是160倍，也就是虚拟节点数是物理节点数的160倍--&gt;\n &lt;!--\n &lt;property name="weightMapFile"&gt;weightMapFile&lt;/property&gt;\n 节点的权重，没有指定权重的节点默认是1。以properties文件的格式填写，以从0开始到count-1的整数值也就是节点索引为key，以节点权重值为值。所有权重值必须是正整数，否则以1代替 --&gt;\n &lt;!--\n &lt;property name="bucketMapPath"&gt;/etc/mycat/bucketMapPath&lt;/property&gt;\n 用于测试时观察各物理节点与虚拟节点的分布情况，如果指定了这个属性，会把虚拟节点的murmur hash值与物理节点的映射按行输出到这个文件，没有默认值，如果不指定，就不会输出任何东西 --&gt;\n &lt;/function&gt;\n</pre><br /><br /><p></p><p><strong><span style="color:#ff6666;">一致性hash预算有效解决了分布式数据的扩容问题，前1-9中id规则都多少存在数据扩容难题，而10规则解决了数据扩容难点<br />关于一致性hash详细：<br /></span></strong></p><p><br /></p><p>一致性哈希算法在1997年由麻省理工学院提出的一种分布式哈希（DHT）实现算法，设计目标是为了解决因特网中的热点(Hot spot)问题，初衷和CARP十分类似。一致性哈希修正了CARP使用的简 单哈希算法带来的问题，使得分布式哈希（DHT）可以在P2P环境中真正得到应用。 <br />一致性hash算法提出了在动态变化的Cache环境中，判定哈希算法好坏的四个定义：<br />1、平衡性(Balance)：平衡性是指哈希的结果能够尽可能分布到所有的缓冲中去，这样可以使得所有的缓冲空间都得到利用。很多哈希算法都能够满足这一条件。<br />2、单调性(Monotonicity)：单调性是指如果已经有一些内容通过哈希分派到了相应的缓冲中，又有新的缓冲加入到系统中。哈希的结果应能够保证原有已分配的内容可以被映射到原有的或者新的缓冲中去，而不会被映射到旧的缓冲集合中的其他缓冲区。 <br />3、分散性(Spread)：在分布式环境中，终端有可能看不到所有的缓冲，而是只能看到其中的一部分。当终端希望通过哈希过程将内容映射到缓冲上时，由于不同终端所见的缓冲范围有可能不同，从而导致哈希的结果不一致，最终的结果是相同的内容被不同的终端映射到不同的缓冲区中。这种情况显然是应该避免的，因为它导致相同内容被存储到不同缓冲中去，降低了系统存储的效率。分散性的定义就是上述情况发生的严重程度。好的哈希算法应能够尽量避免不一致的情况发生，也就是尽量降低分散性。 <br />4、负载(Load)：负载问题实际上是从另一个角度看待分散性问题。既然不同的终端可能将相同的内容映射到不同的缓冲区中，那么对于一个特定的缓冲区而言，也可能被不同的用户映射为不同 的内容。与分散性一样，这种情况也是应当避免的，因此好的哈希算法应能够尽量降低缓冲的负荷。<br />在分布式集群中，对机器的添加删除，或者机器故障后自动脱离集群这些操作是分布式集群管理最基本的功能。如果采用常用的hash(object)%N算法，那么在有机器添加或者删除后，很多原有的数据就无法找到了，这样严重的违反了单调性原则。接下来主要讲解一下一致性哈希算法是如何设计的：<br />环形Hash空间<br />按照常用的hash算法来将对应的key哈希到一个具有2^32次方个桶的空间中，即0~(2^32)-1的数字空间中。现在我们可以将这些数字头尾相连，想象成一个闭合的环形。如下图<br /></p><p><br /></p><p><img src="http://img.blog.csdn.net/20161025124038639?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p><br /></p><p>把数据通过一定的hash算法处理后映射到环上<br />现在我们将object1、object2、object3、object4四个对象通过特定的Hash函数计算出对<br />应的key值，然后散列到Hash环上。如下图：<br />    Hash(object1) = key1；<br />    Hash(object2) = key2；<br />    Hash(object3) = key3；<br />    Hash(object4) = key4；<br /></p><p><img src="http://img.blog.csdn.net/20161025124107062?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p><br /></p><p>将机器通过hash算法映射到环上<br />在采用一致性哈希算法的分布式集群中将新的机器加入，其原理是通过使用与对象存储一样的Hash算法将机器也映射到环中（一般情况下对机器的hash计算是采用机器的IP或者机器唯一的别名作为输入值），然后以顺时针的方向计算，将所有对象存储到离自己最近的机器中。<br />假设现在有NODE1，NODE2，NODE3三台机器，通过Hash算法得到对应的KEY值，映射到环中，其示意图如下：<br />Hash(NODE1) = KEY1;<br />Hash(NODE2) = KEY2;<br />Hash(NODE3) = KEY3;<br /></p><p><img src="http://img.blog.csdn.net/20161025124128015?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p><br /></p><p>通过上图可以看出对象与机器处于同一哈希空间中，这样按顺时针转动object1存储到了NODE1中，object3存储到了NODE2中，object2、object4存储到了NODE3中。在这样的部署环境中，hash环是不会变更的，因此，通过算出对象的hash值就能快速的定位到对应的机器中，这样就能找到对象真正的存储位置了。<br /><br /><br /></p><p>机器的删除与添加<br />普通hash求余算法最为不妥的地方就是在有机器的添加或者删除之后会照成大量的对象存储位置失效，这样就大大的不满足单调性了。下面来分析一下一致性哈希算法是如何处理的。<br />1. 节点（机器）的删除<br />以上面的分布为例，如果NODE2出现故障被删除了，那么按照顺时针迁移的方法，object3将会被迁移到NODE3中，这样仅仅是object3的映射位置发生了变化，其它的对象没有任何的改动。如下图：<br />                                                   2. 节点（机器）的添加 <br />如果往集群中添加一个新的节点NODE4，通过对应的哈希算法得到KEY4，并映射到环中，如下图：<br /></p><p><br /></p><p><img src="http://img.blog.csdn.net/20161025124156689?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p><br /></p><p>通过按顺时针迁移的规则，那么object2被迁移到了NODE4中，其它对象还保持这原有的存储位置。通过对节点的添加和删除的分析，一致性哈希算法在保持了单调性的同时，还是数据的迁移达到了最小，这样的算法对分布式集群来说是非常合适的，避免了大量数据迁移，减小了服务器的的压力。<br /><br /><br />平衡性<br />根据上面的图解分析，一致性哈希算法满足了单调性和负载均衡的特性以及一般hash算法的分散性，但这还并不能当做其被广泛应用的原由，因为还缺少了平衡性。下面将分析一致性哈希算法是如何满足平衡性的。hash算法是不保证平衡的，如上面只部署了NODE1和NODE3的情况（NODE2被删除的图），object1存储到了NODE1中，而object2、object3、object4都存储到了NODE3中，这样就照成了非常不平衡的状态。在一致性哈希算法中，为了尽可能的满足平衡性，其引入了虚拟节点。<br />    ——“虚拟节点”（ virtual node ）是实际节点（机器）在 hash 空间的复制品（ replica ），一实际个节点（机器）对应了若干个“虚拟节点”，这个对应个数也成为“复制个数”，“虚拟节点”在 hash 空间中以hash值排列。<br />以上面只部署了NODE1和NODE3的情况（NODE2被删除的图）为例，之前的对象在机器上的分布很不均衡，现在我们以2个副本（复制个数）为例，这样整个hash环中就存在了4个虚拟节点，最后对象映射的关系图如下：</p><p><br /></p><p><img src="http://img.blog.csdn.net/20161025124223079?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p><br /></p><p>根据上图可知对象的映射关系：object1-&gt;NODE1-1，object2-&gt;NODE1-2，object3-&gt;NODE3-2，object4-&gt;NODE3-1。通过虚拟节点的引入，对象的分布就比较均衡了。那么在实际操作中，正真的对象查询是如何工作的呢？对象从hash到虚拟节点到实际节点的转换如下图：<br /></p><p><br /></p><p><img src="http://img.blog.csdn.net/20161025124243127?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /><br /></p><p><br /></p><p> “虚拟节点”的hash计算可以采用对应节点的IP地址加数字后缀的方式。例如假设NODE1的IP地址为192.168.1.100。引入“虚拟节点”前，计算 cache A 的 hash 值：<br />Hash(“192.168.1.100”);<br />引入“虚拟节点”后，计算“虚拟节”点NODE1-1和NODE1-2的hash值：<br />Hash(“192.168.1.100#1”); // NODE1-1<br />Hash(“192.168.1.100#2”); // NODE1-2<br /><strong><span style="color:#ff6666;">以上所有规则每种都有特定使用场景，可以选择性使用!</span></strong><br /></p><p><br /></p><p><br /></p> &#13;\n
