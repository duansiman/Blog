\n <div class="markdown_views"><p>索引不仅能提高查询速度，还可以添加排序速度，如果order by 后面的语句用到了索引，那么将会提高排序的速度。</p>\n\n<p><strong>测试</strong></p>\n\n<p>1、创建测试表：t15表</p>\n\n\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`t15`</span> (\n <span class="hljs-string">`id`</span> <span class="hljs-keyword">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,\n <span class="hljs-string">`cat_id`</span> <span class="hljs-keyword">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span>,\n <span class="hljs-string">`price`</span> <span class="hljs-keyword">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0.00'</span>,\n <span class="hljs-string">`name`</span> <span class="hljs-keyword">char</span>(<span class="hljs-number">5</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">''</span>,\n <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>),\n) ENGINE=InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8</span></code></pre>\n\n<p>2、插入1W行数据</p>\n\n\n\n<pre class="prettyprint"><code class=" hljs perl">&lt;?php \n<span class="hljs-variable">$db</span> = <span class="hljs-string">'test'</span>;\n<span class="hljs-variable">$conn</span> = mysql_connect(<span class="hljs-string">'localhost'</span>,<span class="hljs-string">'root'</span>,<span class="hljs-string">'1234'</span>);\nmysql_query(<span class="hljs-string">'use '</span> . <span class="hljs-variable">$db</span> , <span class="hljs-variable">$conn</span>);\nmysql_query(<span class="hljs-string">'set names utf8'</span> , <span class="hljs-variable">$conn</span>);\n\n<span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">1</span>;<span class="hljs-variable">$i</span>&lt;=<span class="hljs-number">10000</span>;<span class="hljs-variable">$i</span>++) {\n <span class="hljs-variable">$cat_id</span> = <span class="hljs-keyword">rand</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>);\n <span class="hljs-variable">$price</span> = <span class="hljs-keyword">rand</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50000</span>);\n <span class="hljs-variable">$name</span> = <span class="hljs-keyword">substr</span>(str_shuffle(<span class="hljs-string">'abcdefghjkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ234565789'</span>),<span class="hljs-number">0</span>,<span class="hljs-number">5</span>);\n <span class="hljs-variable">$sql</span> = <span class="hljs-keyword">sprintf</span>(<span class="hljs-string">"insert into t15 values (<span class="hljs-variable">%d</span>,<span class="hljs-variable">%d</span>,<span class="hljs-variable">%f</span>,'<span class="hljs-variable">%s</span>')"</span>,<span class="hljs-variable">$i</span>,<span class="hljs-variable">$cat_id</span>,<span class="hljs-variable">$price</span>,<span class="hljs-variable">$name</span>);\n mysql_query(<span class="hljs-variable">$sql</span> , <span class="hljs-variable">$conn</span>);\n}</code></pre>\n\n<p>3、商场网站，一般都会按照某个分类进行价格上的排序，我们来模拟一下，执行同一条sql语句。</p>\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">select</span> name,cat_id,price <span class="hljs-keyword">from</span> t15 <span class="hljs-keyword">where</span> cat_id=<span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> price;</span></code></pre>\n\n<p>（1）首先不添加索引</p>\n\n<p>从查询分析可以看到Extra中使用到了Using filesort，表示需要进行文件排序。 <br />\n<img src="http://img.blog.csdn.net/20170316192932835?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmFvY2hhbzk1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p>（2）给(cat_id,price)列添加索引</p>\n\n<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> t15 <span class="hljs-keyword">add</span> index cp(cat_id,price);</span></code></pre>\n\n<p>这里的查询分析中Extra没用了Using filesort，表示添加上索引再进行查询的sql没有使用到外部排序，而是使用到了索引的排序，因为索引本身就是会排序的，所以不需要额外的order by一次。</p>\n\n<p><img src="http://img.blog.csdn.net/20170316193219475?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmFvY2hhbzk1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p>4、观测查询时间</p>\n\n<p><img src="http://img.blog.csdn.net/20170316193839332?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmFvY2hhbzk1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p>Query_ID为1的是没有添加索引执行的语句，Query_ID为3的是添加索引后执行的语句，一个执行时间为0.013秒，一个执行时间为0.005秒，肯定是加上索引的快，我们来看看具体快在哪里</p>\n\n<p>Query_ID为1的sql语句执行详细耗时图： <br />\n<img src="http://img.blog.csdn.net/20170316194049381?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmFvY2hhbzk1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p>Query_ID为3的sql语句执行详细耗时图：</p>\n\n<p><img src="http://img.blog.csdn.net/20170316194148854?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmFvY2hhbzk1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" /></p>\n\n<p>很明显，Query_ID1中的Sorting result耗时0.012秒，而Query_ID2中的Sorting result只耗时0.000004秒，而这个Sorting result就是排序耗时。</p>\n\n<p>结论：索引对排序的速度是有一定的影响的，所以，在实际的开发中，要结合实际情况制定索引，并尽可能将排序字段添加至索引中。</p></div>&#13;\n <script type="text/javascript">&#13;\n $(function () {&#13;\n $('pre.prettyprint code').each(function () {&#13;\n var lines = $(this).text().split('\\n').length;&#13;\n var $numbering = $('&lt;ul/&gt;').addClass('pre-numbering').hide();&#13;\n $(this).addClass('has-numbering').parent().append($numbering);&#13;\n for (i = 1; i &lt;= lines; i++) {&#13;\n $numbering.append($('&lt;li/&gt;').text(i));&#13;\n };&#13;\n $numbering.fadeIn(1700);&#13;\n });&#13;\n });&#13;\n </script>&#13;\n &#13;\n
