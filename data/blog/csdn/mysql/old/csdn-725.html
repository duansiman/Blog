\n\n<p> <span style="font-size:18px">       开发项目过程中总是提到优化的概念，本篇文章是对Mysql数据优化实践的一次探索旅程，简要介绍了分区原因，方法，分区表管理方法和一次简单的实践。</span></p>&#13;\n<p><span style="font-size:18px"><br />&#13;\n</span></p>&#13;\n<h2><span style="font-size:18px">【为什么分区】</span></h2>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">       在大数据操作时，将数据表分而治之，将一张数据量很大的表分为一个更小的操作单元，每一个操作单元都会有一个单独的名称。同时，对于程序开发人员来说，分区和没有分区是一样的，通俗来说，mysql分区对于程序应用是透明的，只是数据库对数据的一次重新整理操作。</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">      分区作用：</span></div>&#13;\n<div><span style="font-size:18px">     </span></div>&#13;\n<div><span style="font-size:18px">      （1）提升性能。</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">       分区的最终目的是提升性能，分区完成后，mysql针对每个分区生成特定数据文件和索引文件，检索时通过检索特定的部分数据，因此更好的执行和维护数据库。这是因为分区后表被指派到不同的物理驱动器上，同时访问多个分区时减少分区物理I/O争用。</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">     （2）易于管理。</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">      分区后，管理数据可以直接管理对应的分区。操作简单，当数据达到百万级别时，直接操作分区远比操作数据表来的更加直接。</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">      （3）容错</span></div>&#13;\n<div><span style="font-size:18px">         </span></div>&#13;\n<div><span style="font-size:18px">      分区完成后，一个分区被破坏后，不会影响其他数据。</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<h2><span style="font-size:18px">【分区方法】</span></h2>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">         mysql 的分区方法有：RANGE分区、LIST分区、HASH分区、KEY分区。</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">        RANGE分区：根据某个字段的值来进行分区管理，是在直接创建表时进行的分区。eg：</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"></span><pre code_snippet_id="1765661" snippet_file_name="blog_20160716_1_9050796" name="code" class="sql">create table emp\n(empno varchar(20) not null ,\nempname varchar(20),\ndeptno int,\nbirthdate date,\nsalary int\n)\npartition by range(salary)\n(\npartition p1 values less than (1000),\npartition p2 values less than (2000),\npartition p3 values less than maxvalue\n);</pre><br />&#13;\n<br />&#13;\n</div>&#13;\n<div><span style="font-size:18px">      LIST分区：类似于RANG分区，不同的是，list分区是一个个散列值，RANG分区是根据某个字段范围进行分区。eg：</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"></span><pre code_snippet_id="1765661" snippet_file_name="blog_20160716_2_8745560" name="code" class="sql">create table emp\n(empno varchar(20) not null ,\nempname varchar(20),\ndeptno int,\nbirthdate date not null,\nsalary int\n)\npartition by list(deptno)\n(\npartition p1 values in (10,15),\npartition p2 values in (20,25),\npartition p3 values in (30,35)\n);</pre><br />&#13;\n<br />&#13;\n</div>&#13;\n<div><span style="font-size:18px">      HASH分区：确保数据在预先指定书目的分区中平均分布，分区时指定分区根据的列值和分区数量。eg：</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"></span><pre code_snippet_id="1765661" snippet_file_name="blog_20160716_3_9967059" name="code" class="sql">create table emp\n(empno varchar(20) not null ,\nempname varchar(20),\ndeptno int,\nbirthdate date not null,\nsalary int\n)\npartition by hash(year(birthdate))\npartitions 4;</pre><br />&#13;\n<br />&#13;\n</div>&#13;\n<div><span style="font-size:18px">       KEY分区：类似于HASH分区，区别于KEY分区只支持计算一列或多列，MySQL服务器提供其自身哈希函数，必须有一列或者多列包涵整数值。eg:</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"></span><pre code_snippet_id="1765661" snippet_file_name="blog_20160716_4_1188559" name="code" class="sql">create table emp\n(empno varchar(20) not null ,\nempname varchar(20),\ndeptno int,\nbirthdate date not null,\nsalary int\n)\npartition by key(birthdate)\npartitions 4;</pre>&#13;\n<h2><span style="font-size:18px"><br />&#13;\n</span></h2>&#13;\n<h2><span style="font-size:18px">【分区的管理操作方法】</span></h2>&#13;\n</div>&#13;\n<div><span style="font-size:18px">      </span>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px">删除分区:</span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:blue">alter</span> <span style="color:blue">table</span> emp <span style="color:blue">drop</span> partition p1<span style="color:gray">;</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">不可以删除hash或者key分区。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">一次性删除多个分区，<span style="color:blue">alter</span> <span style="color:blue">table</span> emp <span style="color:blue">drop</span> partition p1,p2<span style="color:gray">;</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="color:gray"><span style="font-size:18px"> </span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px">增加分区:</span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:blue">alter</span> <span style="color:blue">table</span> emp <span style="color:blue">add</span> partition (partition p3 <span style="color:blue">values</span> less than (<strong><span style="color:maroon">4000</span></strong>))<span style="color:gray">;</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:blue">alter</span> <span style="color:blue">table</span> empl <span style="color:blue">add</span> partition (partition p3 <span style="color:blue">values</span> <span style="color:gray">in</span> (<strong><span style="color:maroon">40</span></strong>))<span style="color:gray">;</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="color:gray"><span style="font-size:18px"> </span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px">分解分区:</span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">Reorganizepartition关键字可以对表的部分分区或全部分区进行修改，并且不会丢失数据。分解前后分区的整体范围应该一致。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:blue">alter</span> <span style="color:blue">table</span> te</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">reorganize partition p1 <span style="color:blue">into</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">(</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">partition p1 <span style="color:blue">values</span> less than (<strong><span style="color:maroon">100</span></strong>),</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">partition p3 <span style="color:blue">values</span> less than (<strong><span style="color:maroon">1000</span></strong>)</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">)<span style="color:gray">; ----</span><span style="color:gray">不会丢失数据</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="color:gray"><span style="font-size:18px"> </span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px">合并分区:</span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">Merge分区：把2个分区合并为一个。<br />&#13;\n<span style="color:blue">alter</span> <span style="color:blue">table</span> te</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">reorganize partition p1,p3 <span style="color:blue">into</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">(partition p1 <span style="color:blue">values</span> less than (<strong><span style="color:maroon">1000</span></strong>))<span style="color:gray">;</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:gray">----</span><span style="color:gray">不会丢失数据</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"> </span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px">重新定义hash分区表:</span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:blue">Alter</span> <span style="color:blue">table</span> emp partition <span style="color:blue">by</span> hash(salary)partitions <strong><span style="color:maroon">7</span></strong><span style="color:gray">;</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:gray">----</span><span style="color:gray">不会丢失数据</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px">重新定义range分区表:</span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:blue">Alter</span> <span style="color:blue">table</span> emp partition<span style="color:blue">by</span>range(salary)</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">(</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">partition p1 <span style="color:blue">values</span> less than (<strong><span style="color:maroon">2000</span></strong>),</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">partition p2 <span style="color:blue">values</span> less than (<strong><span style="color:maroon">4000</span></strong>)</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">)<span style="color:gray">; ----</span><span style="color:gray">不会丢失数据</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"> </span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px">删除表的所有分区:</span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"> </span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:blue">Alter</span> <span style="color:blue">table</span> emp removepartitioning<span style="color:gray">;--</span><span style="color:gray">不会丢失数据</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"> </span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px">重建分区：</span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">这和先删除保存在分区中的所有记录，然后重新插入它们，具有同样的效果。它可用于整理分区碎片。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:blue">ALTER</span> <span style="color:blue">TABLE</span> emp rebuild partitionp1,p2<span style="color:gray">;</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="color:gray"><span style="font-size:18px"> </span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px">优化分区：</span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">如果从分区中删除了大量的行，或者对一个带有可变长度的行（也就是说，有VARCHAR，BLOB，或TEXT类型的列）作了许多修改，可以使用“ALTER TABLE ... OPTIMIZE PARTITION”来收回没有使用的空间，并整理分区数据文件的碎片。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:blue">ALTER</span> <span style="color:blue">TABLE</span> emp <span style="color:blue">optimize</span> partition p1,p2<span style="color:gray">;</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="color:gray"><span style="font-size:18px"> </span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px">分析分区：</span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">读取并保存分区的键分布。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:blue">ALTER</span> <span style="color:blue">TABLE</span> emp <span style="color:blue">analyze</span> partition p1,p2<span style="color:gray">;</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px"> </span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px">修补分区：</span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">修补被破坏的分区。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:blue">ALTER</span> <span style="color:blue">TABLE</span> emp repairpartition p1,p2<span style="color:gray">;</span></span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"> </span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<strong><span style="font-size:18px">检查分区：</span></strong></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">可以使用几乎与对非分区表使用CHECK TABLE 相同的方式检查分区。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"><span style="color:blue">ALTER</span> <span style="color:blue">TABLE</span> emp <span style="color:blue">CHECK</span> partition p1,p2;</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">这个命令可以告诉你表emp的分区p1,p2中的数据或索引是否已经被破坏。如果发生了这种情况，使用“ALTER TABLE ... REPAIR PARTITION”来修补该分区。</span></p>&#13;\n</div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<h2><span style="font-size:18px">【分区实践】</span></h2>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">      1. 创建分区表和不分区表：</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">        </span><pre code_snippet_id="1765661" snippet_file_name="blog_20160716_5_6870160" name="code" class="sql">-- 创建分区表\nCREATE TABLE part_tab\n(c1 int NULL, c2 VARCHAR(30), c3 date not null)\nPARTITION BY RANGE(year(c3))\n(PARTITION p0 VALUES LESS THAN (1995),\nPARTITION p1 VALUES LESS THAN (1996) ,\nPARTITION p2 VALUES LESS THAN (1997) ,\nPARTITION p3 VALUES LESS THAN (1998) ,\n PARTITION p4 VALUES LESS THAN (1999) ,\nPARTITION p5 VALUES LESS THAN (2000) ,\nPARTITION p6 VALUES LESS THAN (2001) ,\nPARTITION p7 VALUES LESS THAN (2002) ,\nPARTITION p8 VALUES LESS THAN (2003) ,\nPARTITION p9 VALUES LESS THAN (2004) ,\nPARTITION p10 VALUES LESS THAN (2010),\nPARTITION p11 VALUES LESS THAN (MAXVALUE) );</pre></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span><pre code_snippet_id="1765661" snippet_file_name="blog_20160716_6_1331045" name="code" class="sql">-- 创建没有分区表\nCREATE TABLE nopart_tab\n(c1 int NULL, c2 VARCHAR(30), c3 date not null)</pre><br />&#13;\n</div>&#13;\n<div><br />&#13;\n</div>&#13;\n<div><span style="font-size:18px">      2. 创建大数据操作环境。为了测试结果的准确度提高，需要表中存在大数据，通过以下事务可在数据表中创建800万条数据：</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"></span><pre code_snippet_id="1765661" snippet_file_name="blog_20160716_7_3424596" name="code" class="sql">-- 创建生成数据事物\nCREATE PROCEDURE load_part_tab()\n begin\n declare v int default 0;\n while v &lt; 8000000\n do\n insert into part_tab\n values (v,'testingpartitions',adddate('1995-01-01',(rand(v)*36520)mod 3652));\n set v = v + 1;\n end while;\nend;</pre>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n         <span style="font-size:18px">执行事务:call load_part_tab(); ，因为执行此事务执行的时间很长，我只在表中插入了283304条数据。</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">      创建完成一张表后，可以将该表的数据复制到未分区表，这样执行速度会很快：</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"></span><pre code_snippet_id="1765661" snippet_file_name="blog_20160716_8_7677738" name="code" class="sql">insert into test.nopart_tab select csdn-100.html csdn-101.html csdn-102.html csdn-103.html csdn-104.html csdn-105.html csdn-106.html csdn-107.html csdn-108.html csdn-109.html csdn-10.html csdn-110.html csdn-111.html csdn-112.html csdn-113.html csdn-114.html csdn-115.html csdn-116.html csdn-117.html csdn-118.html csdn-119.html csdn-11.html csdn-120.html csdn-121.html csdn-122.html csdn-123.html csdn-124.html csdn-125.html csdn-126.html csdn-127.html csdn-128.html csdn-129.html csdn-12.html csdn-130.html csdn-131.html csdn-132.html csdn-133.html csdn-134.html csdn-135.html csdn-136.html csdn-137.html csdn-138.html csdn-139.html csdn-13.html csdn-140.html csdn-141.html csdn-142.html csdn-143.html csdn-144.html csdn-145.html csdn-146.html csdn-147.html csdn-148.html csdn-149.html csdn-14.html csdn-150.html csdn-151.html csdn-152.html csdn-153.html csdn-154.html csdn-155.html csdn-156.html csdn-157.html csdn-158.html csdn-159.html csdn-15.html csdn-160.html csdn-161.html csdn-162.html csdn-163.html csdn-164.html csdn-165.html csdn-166.html csdn-167.html csdn-168.html csdn-169.html csdn-16.html csdn-170.html csdn-171.html csdn-172.html csdn-173.html csdn-174.html csdn-175.html csdn-176.html csdn-177.html csdn-178.html csdn-179.html csdn-17.html csdn-180.html csdn-181.html csdn-182.html csdn-183.html csdn-184.html csdn-185.html csdn-186.html csdn-187.html csdn-188.html csdn-189.html csdn-18.html csdn-190.html csdn-191.html csdn-192.html csdn-193.html csdn-194.html csdn-195.html csdn-196.html csdn-197.html csdn-198.html csdn-199.html csdn-19.html csdn-1.html csdn-200.html csdn-201.html csdn-202.html csdn-203.html csdn-204.html csdn-205.html csdn-206.html csdn-207.html csdn-208.html csdn-209.html csdn-20.html csdn-210.html csdn-211.html csdn-212.html csdn-213.html csdn-214.html csdn-215.html csdn-216.html csdn-217.html csdn-218.html csdn-219.html csdn-21.html csdn-220.html csdn-221.html csdn-222.html csdn-223.html csdn-224.html csdn-225.html csdn-226.html csdn-227.html csdn-228.html csdn-229.html csdn-22.html csdn-230.html csdn-231.html csdn-232.html csdn-233.html csdn-234.html csdn-235.html csdn-236.html csdn-237.html csdn-238.html csdn-239.html csdn-23.html csdn-240.html csdn-241.html csdn-242.html csdn-243.html csdn-244.html csdn-245.html csdn-246.html csdn-247.html csdn-248.html csdn-249.html csdn-24.html csdn-250.html csdn-251.html csdn-252.html csdn-253.html csdn-254.html csdn-255.html csdn-256.html csdn-257.html csdn-258.html csdn-259.html csdn-25.html csdn-260.html csdn-261.html csdn-262.html csdn-263.html csdn-264.html csdn-265.html csdn-266.html csdn-267.html csdn-268.html csdn-269.html csdn-26.html csdn-270.html csdn-271.html csdn-272.html csdn-273.html csdn-274.html csdn-275.html csdn-276.html csdn-277.html csdn-278.html csdn-279.html csdn-27.html csdn-280.html csdn-281.html csdn-282.html csdn-283.html csdn-284.html csdn-285.html csdn-286.html csdn-287.html csdn-288.html csdn-289.html csdn-28.html csdn-290.html csdn-291.html csdn-292.html csdn-293.html csdn-294.html csdn-295.html csdn-296.html csdn-297.html csdn-298.html csdn-299.html csdn-29.html csdn-2.html csdn-300.html csdn-301.html csdn-302.html csdn-303.html csdn-304.html csdn-305.html csdn-306.html csdn-307.html csdn-308.html csdn-309.html csdn-30.html csdn-310.html csdn-311.html csdn-312.html csdn-313.html csdn-314.html csdn-315.html csdn-316.html csdn-317.html csdn-318.html csdn-319.html csdn-31.html csdn-320.html csdn-321.html csdn-322.html csdn-323.html csdn-324.html csdn-325.html csdn-326.html csdn-327.html csdn-328.html csdn-329.html csdn-32.html csdn-330.html csdn-331.html csdn-332.html csdn-333.html csdn-334.html csdn-335.html csdn-336.html csdn-337.html csdn-338.html csdn-339.html csdn-33.html csdn-340.html csdn-341.html csdn-342.html csdn-343.html csdn-344.html csdn-345.html csdn-346.html csdn-347.html csdn-348.html csdn-349.html csdn-34.html csdn-350.html csdn-351.html csdn-352.html csdn-353.html csdn-354.html csdn-355.html csdn-356.html csdn-357.html csdn-358.html csdn-359.html csdn-35.html csdn-360.html csdn-361.html csdn-362.html csdn-363.html csdn-364.html csdn-365.html csdn-366.html csdn-367.html csdn-368.html csdn-369.html csdn-36.html csdn-370.html csdn-371.html csdn-372.html csdn-373.html csdn-374.html csdn-375.html csdn-376.html csdn-377.html csdn-378.html csdn-379.html csdn-37.html csdn-380.html csdn-381.html csdn-382.html csdn-383.html csdn-384.html csdn-385.html csdn-386.html csdn-387.html csdn-388.html csdn-389.html csdn-38.html csdn-390.html csdn-391.html csdn-392.html csdn-393.html csdn-394.html csdn-395.html csdn-396.html csdn-397.html csdn-398.html csdn-399.html csdn-39.html csdn-3.html csdn-400.html csdn-401.html csdn-402.html csdn-403.html csdn-404.html csdn-405.html csdn-406.html csdn-407.html csdn-408.html csdn-409.html csdn-40.html csdn-410.html csdn-411.html csdn-412.html csdn-413.html csdn-414.html csdn-415.html csdn-416.html csdn-417.html csdn-418.html csdn-419.html csdn-41.html csdn-420.html csdn-421.html csdn-422.html csdn-423.html csdn-424.html csdn-425.html csdn-426.html csdn-427.html csdn-428.html csdn-429.html csdn-42.html csdn-430.html csdn-431.html csdn-432.html csdn-433.html csdn-434.html csdn-435.html csdn-436.html csdn-437.html csdn-438.html csdn-439.html csdn-43.html csdn-440.html csdn-441.html csdn-442.html csdn-443.html csdn-444.html csdn-445.html csdn-446.html csdn-447.html csdn-448.html csdn-449.html csdn-44.html csdn-450.html csdn-451.html csdn-452.html csdn-453.html csdn-454.html csdn-455.html csdn-456.html csdn-457.html csdn-458.html csdn-459.html csdn-45.html csdn-460.html csdn-461.html csdn-462.html csdn-463.html csdn-464.html csdn-465.html csdn-466.html csdn-467.html csdn-468.html csdn-469.html csdn-46.html csdn-470.html csdn-471.html csdn-472.html csdn-473.html csdn-474.html csdn-475.html csdn-476.html csdn-477.html csdn-478.html csdn-479.html csdn-47.html csdn-480.html csdn-481.html csdn-482.html csdn-483.html csdn-484.html csdn-485.html csdn-486.html csdn-487.html csdn-488.html csdn-489.html csdn-48.html csdn-490.html csdn-491.html csdn-492.html csdn-493.html csdn-494.html csdn-495.html csdn-496.html csdn-497.html csdn-498.html csdn-499.html csdn-49.html csdn-4.html csdn-500.html csdn-501.html csdn-502.html csdn-503.html csdn-504.html csdn-505.html csdn-506.html csdn-507.html csdn-508.html csdn-509.html csdn-50.html csdn-510.html csdn-511.html csdn-512.html csdn-513.html csdn-514.html csdn-515.html csdn-516.html csdn-517.html csdn-518.html csdn-519.html csdn-51.html csdn-520.html csdn-521.html csdn-522.html csdn-523.html csdn-524.html csdn-525.html csdn-526.html csdn-527.html csdn-528.html csdn-529.html csdn-52.html csdn-530.html csdn-531.html csdn-532.html csdn-533.html csdn-534.html csdn-535.html csdn-536.html csdn-537.html csdn-538.html csdn-539.html csdn-53.html csdn-540.html csdn-541.html csdn-542.html csdn-543.html csdn-544.html csdn-545.html csdn-546.html csdn-547.html csdn-548.html csdn-549.html csdn-54.html csdn-550.html csdn-551.html csdn-552.html csdn-553.html csdn-554.html csdn-555.html csdn-556.html csdn-557.html csdn-558.html csdn-559.html csdn-55.html csdn-560.html csdn-561.html csdn-562.html csdn-563.html csdn-564.html csdn-565.html csdn-566.html csdn-567.html csdn-568.html csdn-569.html csdn-56.html csdn-570.html csdn-571.html csdn-572.html csdn-573.html csdn-574.html csdn-575.html csdn-576.html csdn-577.html csdn-578.html csdn-579.html csdn-57.html csdn-580.html csdn-581.html csdn-582.html csdn-583.html csdn-584.html csdn-585.html csdn-586.html csdn-587.html csdn-588.html csdn-589.html csdn-58.html csdn-590.html csdn-591.html csdn-592.html csdn-593.html csdn-594.html csdn-595.html csdn-596.html csdn-597.html csdn-598.html csdn-599.html csdn-59.html csdn-5.html csdn-600.html csdn-601.html csdn-602.html csdn-603.html csdn-604.html csdn-605.html csdn-606.html csdn-607.html csdn-608.html csdn-609.html csdn-60.html csdn-610.html csdn-611.html csdn-612.html csdn-613.html csdn-614.html csdn-615.html csdn-616.html csdn-617.html csdn-618.html csdn-619.html csdn-61.html csdn-620.html csdn-621.html csdn-622.html csdn-623.html csdn-624.html csdn-625.html csdn-626.html csdn-627.html csdn-628.html csdn-629.html csdn-62.html csdn-630.html csdn-631.html csdn-632.html csdn-633.html csdn-634.html csdn-635.html csdn-636.html csdn-637.html csdn-638.html csdn-639.html csdn-63.html csdn-640.html csdn-641.html csdn-642.html csdn-643.html csdn-644.html csdn-645.html csdn-646.html csdn-647.html csdn-648.html csdn-649.html csdn-64.html csdn-650.html csdn-651.html csdn-652.html csdn-653.html csdn-654.html csdn-655.html csdn-656.html csdn-657.html csdn-658.html csdn-659.html csdn-65.html csdn-660.html csdn-661.html csdn-662.html csdn-663.html csdn-664.html csdn-665.html csdn-666.html csdn-667.html csdn-668.html csdn-669.html csdn-66.html csdn-670.html csdn-671.html csdn-672.html csdn-673.html csdn-674.html csdn-675.html csdn-676.html csdn-677.html csdn-678.html csdn-679.html csdn-67.html csdn-680.html csdn-681.html csdn-682.html csdn-683.html csdn-684.html csdn-685.html csdn-686.html csdn-687.html csdn-688.html csdn-689.html csdn-68.html csdn-690.html csdn-691.html csdn-692.html csdn-693.html csdn-694.html csdn-695.html csdn-696.html csdn-697.html csdn-698.html csdn-699.html csdn-69.html csdn-6.html csdn-700.html csdn-701.html csdn-702.html csdn-703.html csdn-704.html csdn-705.html csdn-706.html csdn-707.html csdn-708.html csdn-709.html csdn-70.html csdn-710.html csdn-711.html csdn-712.html csdn-713.html csdn-714.html csdn-715.html csdn-716.html csdn-717.html csdn-718.html csdn-719.html csdn-71.html csdn-720.html csdn-721.html csdn-722.html csdn-723.html csdn-724.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-84.html csdn-85.html csdn-86.html csdn-87.html csdn-88.html csdn-89.html csdn-8.html csdn-90.html csdn-91.html csdn-92.html csdn-93.html csdn-94.html csdn-95.html csdn-96.html csdn-97.html csdn-98.html csdn-99.html csdn-9.html mysql.sh from test.part_tab</pre>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">     3. 查看分区表分区结构：</span></div>&#13;\n<div><br />&#13;\n</div>&#13;\n<div><span style="font-size:18px"></span><pre code_snippet_id="1765661" snippet_file_name="blog_20160716_9_9455644" name="code" class="sql">-- 查询分区情况\nselect \n partition_name part, \n partition_expression expr, \n partition_description descr, \n table_rows \nfrom information_schema.partitions where \n table_schema = schema() \n and table_name='part_tab';</pre><br />&#13;\n</div>&#13;\n<div><span style="font-size:18px">       执行结果：</span></div>&#13;\n<div><br />&#13;\n</div>&#13;\n<div><span style="font-size:18px">                                               <img src="http://img.blog.csdn.net/20160716114940355" alt="" /></span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<span style="font-size:18px">     3. 测试速度：</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"><span style="white-space:pre"></span>执行分区表查询语句：</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span><pre code_snippet_id="1765661" snippet_file_name="blog_20160716_10_2595972" name="code" class="sql">select count(*) from part_tab where c3 &gt; date '1995-01-01'and c3 &lt; date '1995-12-31';</pre><br />&#13;\n <span style="font-size:18px">      执行时间：</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"><img src="http://img.blog.csdn.net/20160716114034580" alt="" /><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n       执行未分区表查询语句：</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span><pre code_snippet_id="1765661" snippet_file_name="blog_20160716_11_5977061" name="code" class="sql">select count(*) from nopart_tab where c3 &gt; date '1995-01-01'and c3 &lt; date '1995-12-31';</pre><br />&#13;\n</div>&#13;\n<div><span style="font-size:18px">       执行时间：</span></div>&#13;\n<div><span style="font-size:18px">     <img src="http://img.blog.csdn.net/20160716114111804" alt="" /></span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px">       从时间对比可以看出，同样的查询语句，分区表执行速度在20ms左右，未分区表在175ms左右，执行速度相差8倍左右，因此得出结论：分区表的执行速度要比未分区表执行速度快。</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<h2><span style="font-size:18px">【分区局限性】</span></h2>&#13;\n<div><span style="font-size:18px">       </span></div>&#13;\n<div><span style="font-size:18px"></span>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n    <span style="font-size:18px"> 1. MySQL分区处理NULL值的方式</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">         如果分区键所在列没有notnull约束。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">         如果是range分区表，那么null行将被保存在范围最小的分区。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">         如果是list分区表，那么null行将被保存到list为0的分区。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">         在按HASH和KEY分区的情况下，任何产生NULL值的表达式mysql都视同它的返回值为0。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">         为了避免这种情况的产生，建议分区键设置成NOT NULL。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"> </span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">     2. 分区键必须是INT类型，或者通过表达式返回INT类型，可以为NULL。唯一的例外是当分</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">         区类型为KEY分区的时候，可以使用其他类型的列作为分区键（ BLOB or TEXT 列除外）。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px"> </span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">     3. 对分区表的分区键创建索引，那么这个索引也将被分区,分区键没有全局索引一说。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">     4. 只有RANG和LIST分区能进行子分区，HASH和KEY分区不能进行子分区。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.2px">&#13;\n<span style="font-size:18px">     5. 临时表不能被分区。</span></p>&#13;\n<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.2px">&#13;\n </p>&#13;\n</div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n<div><span style="font-size:18px"><br />&#13;\n</span></div>&#13;\n &#13;\n
