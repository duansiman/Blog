\n\n<p><strong><span style="font-size:18px">数据备份：</span></strong></p>&#13;\n<p><strong><span style="font-size:18px">使用mysqldump命令备份</span></strong></p>&#13;\n<p><strong><span style="font-size:18px">mysqldump命令可以讲数据库中的数据备份成一个文本文件。表结果和表中的数据将存储在生成的文本中。mysqldump的工作原理很简单。他先查出需要备份的表结构，在在文本中文件中生存一个create语句，然后，将表中的所有记录转换成一条insert语句，这些create语句和insert语句都是还原时使用，还原数据时就可以使用其中的create语句来创建表，使用其中的insert语句来还原数据。</span></strong></p>&#13;\n<p><strong><span style="font-size:18px"></span></strong> </p>&#13;\n<p><strong><span style="font-size:18px">mysqldump -h主机名  -P端口 -u用户名 -p密码 (–database) 数据库名 &gt; 文件名.sql</span></strong></p>&#13;\n<p><strong><span style="font-size:18px"></span></strong> </p>&#13;\n<p><strong><span style="font-size:18px">备份MySQL数据库的命令</span></strong></p>&#13;\n<p><span style="font-size:18px">mysqldump -hhostname -uusername -ppassword databasename &gt; backupfile.sql</span></p>&#13;\n<p><br />&#13;\n<br />&#13;\n<span style="font-size:18px"><strong>备份MySQL数据库为带删除表的格式，能够让该备份覆盖已有数据库而不需要手动删除原有数据库。</strong><br />&#13;\nmysqldump -–add-drop-table -uusername -ppassword databasename &gt; backupfile.sql</span></p>&#13;\n<p><br />&#13;\n<br />&#13;\n<span style="font-size:18px"><strong>直接将MySQL数据库压缩备份</strong><br />&#13;\nmysqldump -hhostname -uusername -ppassword databasename | gzip &gt; backupfile.sql.gz</span></p>&#13;\n<p><br />&#13;\n<br />&#13;\n<span style="font-size:18px"><strong>备份MySQL数据库某个(些)表</strong><br />&#13;\nmysqldump -hhostname -uusername -ppassword databasename specific_table1 specific_table2 &gt; backupfile.sql</span></p>&#13;\n<p><br />&#13;\n<br />&#13;\n<span style="font-size:18px"><strong>同时备份多个MySQL数据库</strong><br />&#13;\nmysqldump -hhostname -uusername -ppassword –databases databasename1 databasename2 databasename3 &gt; multibackupfile.sql<br />&#13;\n</span></p>&#13;\n<p><br />&#13;\n<span style="font-size:18px"><strong>仅仅备份数据库结构</strong><br />&#13;\nmysqldump –no-data –databases databasename1 databasename2 databasename3 &gt; structurebackupfile.sql</span></p>&#13;\n<p><br />&#13;\n<br />&#13;\n<span style="font-size:18px"><strong>备份服务器上所有数据库</strong><br />&#13;\nmysqldump –all-databases &gt; allbackupfile.sql</span></p>&#13;\n<p><br />&#13;\n<br />&#13;\n<span style="font-size:18px"><strong>还原MySQL数据库的命令</strong><br />&#13;\nmysql -hhostname -uusername -ppassword databasename &lt; backupfile.sql</span></p>&#13;\n<p><br />&#13;\n<br />&#13;\n<span style="font-size:18px"><strong>还原压缩的MySQL数据库</strong><br />&#13;\ngunzip &lt; backupfile.sql.gz | mysql -uusername -ppassword databasename</span></p>&#13;\n<p><br />&#13;\n<br />&#13;\n<span style="font-size:18px"><strong>将数据库转移到新服务器</strong><br />&#13;\n</span></p>&#13;\n<p><span style="font-size:18px">mysqldump -uusername -ppassword databasename | mysql –host=*.*.*.* -C databasename</span></p>&#13;\n<p><span style="font-size:18px">===============================================================<br />&#13;\n</span></p>&#13;\n<p><strong><span style="font-size:18px">JAVA代码调用命令的方法</span></strong></p>&#13;\n<p><strong><span style="font-size:18px"></span></strong> </p>&#13;\n<pre class="sql" name="code">&lt;span style="font-size:18px;"&gt;Process p = Runtime.getRuntime().exec("cmd /c mysqldump -h127.0.0.1 -P3306 -uroot -p123456 customer &gt; d:/opt/customer/dbback/backupfile-1351022418812.sql");\n\t\t\t// 等待编译结束\n\t\t\tp.waitFor();\n\t\t\t// 检查返回码，看编译是否出错。\n\t\t\tint ret = p.exitValue();\n\t\t\tSystem.out.println(ret);&lt;/span&gt;</pre>&#13;\n<p><span style="font-size:18px"><br />&#13;\n</span> </p>&#13;\n<p><strong><span style="font-size:18px; color:#00238d"></span></strong> </p>&#13;\n<p><span style="font-size:18px">MySQL命令行导入数据库：</span></p>&#13;\n<p><span style="font-size:18px">1，将要导入的.<span class="hl1"><span id="1_4">sql</span></span>文件移至bin文件下，这样的路径比较方便<br />&#13;\n2，同上面导出的第1步<br />&#13;\n3，进入MySQL：mysql -u 用户名 -p<br />&#13;\n如我输入的命令行:mysql -u root -p?? (输入同样后会让你输入MySQL的密码)<br />&#13;\n4，在MySQL-Front中新建你要建的数据库，这时是空数据库，如新建一个名为news的目标数据库<br />&#13;\n5，输入：mysql&gt;use 目标数据库名<br />&#13;\n如我输入的命令行:mysql&gt;use news;<br />&#13;\n6，导入文件：mysql&gt;source 导入的文件名;<br />&#13;\n如我输入的命令行：mysql&gt;source news.<span class="hl1"><span id="1_5">sql</span></span>;</span></p>&#13;\n<p><span style="font-size:18px">MySQL备份和还原,都是利用mysqldump、mysql和source命令来完成的。</span></p>&#13;\n<p><span style="font-size:18px"></span> </p>&#13;\n<p><br />&#13;\n<span style="font-size:18px">1.Win32下MySQL的备份与还原</span></p>&#13;\n<p><br />&#13;\n<span style="font-size:18px">1.1 备份<br />&#13;\n开始菜单 | 运行 | cmd |利用“cd \\Program Files\\MySQL\\MySQL Server 5.0\\bin”命令进入bin文件夹 | 利用“mysqldump? -u 用户名 -p databasename &gt;exportfilename”导出数据库到文件，如mysqldump -u root -p voice&gt;voice.<span class="hl1"><span id="1_6">sql</span></span>，然后输入密码即可开始导出。<br />&#13;\n</span></p>&#13;\n<p><br />&#13;\n<span style="font-size:18px">1.2 还原<br />&#13;\n进入MySQL Command Line Client，输入密码，进入到“mysql&gt;”，输入命令"show databases；"，回车，看看有些什么数据库；建立你要还原的数据库，输入"create database voice；"，回车；切换到刚建立的数据库，输入"use voice；"，回车；导入数据，输入"source voice.<span class="hl1"><span id="1_7">sql</span></span>；"，回车，开始导入，再次出现"mysql&gt;"并且没有提示错误即还原成功。<br />&#13;\n</span></p>&#13;\n<p><br />&#13;\n<span style="font-size:18px">2.Linux下MySQL的备份与还原</span></p>&#13;\n<p><br />&#13;\n<span style="font-size:18px">2.1 备份<br />&#13;\n[root@localhost ~]# cd /var/lib/mysql (进入到MySQL库目录，根据自己的MySQL的安装情况调整目录)<br />&#13;\n[root@localhost mysql]# mysqldump -u root -p voice&gt;voice.<span class="hl1"><span id="1_8">sql</span></span>，输入密码即可。</span></p>&#13;\n<p><br />&#13;\n<span style="font-size:18px">2.2 还原<br />&#13;\n法一：<br />&#13;\n[root@localhost ~]# mysql -u root -p 回车，输入密码，进入MySQL的控制台"mysql&gt;"，同1.2还原。<br />&#13;\n法二：<br />&#13;\n[root@localhost ~]# cd /var/lib/mysql (进入到MySQL库目录，根据自己的MySQL的安装情况调整目录)<br />&#13;\n[root@localhost mysql]# mysql -u root -p voice&lt;voice.<span class="hl1"><span id="1_9">sql</span></span>，输入密码即可。</span></p>&#13;\n<p><span style="font-size:18px"></span> </p>&#13;\n<p><span style="font-size:18px"></span> </p>&#13;\n<p><span style="font-size:18px"></span> </p>&#13;\n<p><span style="font-size:18px"></span> </p>&#13;\n<p><span style="font-size:18px">以下是版本2:如果上面不明白的话，可以看下面的讲解</span></p>&#13;\n<p><span style="font-size:18px"></span> </p>&#13;\n<p><span style="font-size:18px"></span> </p>&#13;\n<h3><span style="font-size:18px">1、mysqldump</span></h3>&#13;\n<h4><span style="font-size:18px">1.1 备份</span></h4>&#13;\n<p><span style="font-size:18px"><code><span style="font-family:NSimsun">mysqldump</span></code> 是采用SQL级别的备份机制，它将数据表导成 SQL 脚本文件，在不同的 MySQL 版本之间升级时相对比较合适，这也是最常用的备份方法。<br />&#13;\n现在来讲一下 <code><span style="font-family:NSimsun">mysqldump</span></code> 的一些主要参数：</span></p>&#13;\n<ul type="1">&#13;\n<li><span style="font-size:18px">--compatible=name </span>&#13;\n<p><span style="font-size:18px">它告诉 mysqldump，导出的数据将和哪种数据库或哪个旧版本的 MySQL 服务器相兼容。值可以为&#13;\n<code><span style="font-family:NSimsun">ansi、mysql323、mysql40、postgresql、oracle、mssql、db2、maxdb、no_key_options、no_tables_options、no_field_options</span></code> 等，要使用几个值，用逗号将它们隔开。当然了，它并不保证能完全兼容，而是尽量兼容。&#13;\n</span></p>&#13;\n</li><li><span style="font-size:18px">--complete-insert，-c </span>&#13;\n<p><span style="font-size:18px">导出的数据采用包含字段名的完整 <code><span style="font-family:NSimsun">INSERT</span></code> 方式，也就是把所有的值都写在一行。这么做能提高插入效率，但是可能会受到&#13;\n<code><span style="font-family:NSimsun">max_allowed_packet</span></code> 参数的影响而导致插入失败。因此，需要谨慎使用该参数，至少我不推荐。&#13;\n</span></p>&#13;\n</li><li><span style="font-size:18px">--default-character-set=charset </span>&#13;\n<p><span style="font-size:18px">指定导出数据时采用何种字符集，如果数据表不是采用默认的 <code><span style="font-family:NSimsun">latin1</span></code> 字符集的话，那么导出时必须指定该选项，否则再次导入数据后将产生乱码问题。</span></p>&#13;\n</li><li><span style="font-size:18px">--disable-keys </span>&#13;\n<p><span style="font-size:18px">告诉 <code><span style="font-family:NSimsun">mysqldump</span></code> 在&#13;\n<code><span style="font-family:NSimsun">INSERT</span></code> 语句的开头和结尾增加 <code><span style="font-family:NSimsun">/*!40000 ALTER TABLE table DISABLE KEYS */;</span></code> 和&#13;\n<code><span style="font-family:NSimsun">/*!40000 ALTER TABLE table ENABLE KEYS */;</span></code> 语句，这能大大提高插入语句的速度，因为它是在插入完所有数据后才重建索引的。该选项只适合&#13;\n<code><span style="font-family:NSimsun">MyISAM</span></code> 表。</span></p>&#13;\n</li><li><span style="font-size:18px">--extended-insert = true|false </span>&#13;\n<p><span style="font-size:18px">默认情况下，<code><span style="font-family:NSimsun">mysqldump</span></code> 开启&#13;\n<code><span style="font-family:NSimsun">--complete-insert</span></code> 模式，因此不想用它的的话，就使用本选项，设定它的值为&#13;\n<code><span style="font-family:NSimsun">false</span></code> 即可。 </span></p>&#13;\n</li><li><span style="font-size:18px">--hex-blob </span>&#13;\n<p><span style="font-size:18px">使用十六进制格式导出二进制字符串字段。如果有二进制数据就必须使用本选项。影响到的字段类型有 <code>&#13;\n<span style="font-family:NSimsun">BINARY、VARBINARY、BLOB</span></code>。</span></p>&#13;\n</li><li><span style="font-size:18px">--lock-all-tables，-x </span>&#13;\n<p><span style="font-size:18px">在开始导出之前，提交请求锁定所有数据库中的所有表，以保证数据的一致性。这是一个全局读锁，并且自动关闭&#13;\n<code><span style="font-family:NSimsun">--single-transaction</span></code> 和 <code>&#13;\n<span style="font-family:NSimsun">--lock-tables</span></code> 选项。</span></p>&#13;\n</li><li><span style="font-size:18px">--lock-tables </span>&#13;\n<p><span style="font-size:18px">它和 <code><span style="font-family:NSimsun">--lock-all-tables</span></code> 类似，不过是锁定当前导出的数据表，而不是一下子锁定全部库下的表。本选项只适用于&#13;\n<code><span style="font-family:NSimsun">MyISAM</span></code> 表，如果是 <code><span style="font-family:NSimsun">Innodb</span></code> 表可以用&#13;\n<code><span style="font-family:NSimsun">--single-transaction</span></code> 选项。</span></p>&#13;\n</li><li><span style="font-size:18px">--no-create-info，-t </span>&#13;\n<p><span style="font-size:18px">只导出数据，而不添加 <code><span style="font-family:NSimsun">CREATE TABLE</span></code> 语句。</span></p>&#13;\n</li><li><span style="font-size:18px">--no-data，-d </span>&#13;\n<p><span style="font-size:18px">不导出任何数据，只导出数据库表结构。</span></p>&#13;\n</li><li><span style="font-size:18px">--opt </span>&#13;\n<p><span style="font-size:18px">这只是一个快捷选项，等同于同时添加 <code><span style="font-family:NSimsun">--add-drop-tables --add-locking --create-option --disable-keys --extended-insert --lock-tables --quick --set-charset</span></code> 选项。本选项能让&#13;\n<code><span style="font-family:NSimsun">mysqldump</span></code> 很快的导出数据，并且导出的数据能很快导回。该选项默认开启，但可以用&#13;\n<code><span style="font-family:NSimsun">--skip-opt</span></code> 禁用。注意，如果运行 <code>&#13;\n<span style="font-family:NSimsun">mysqldump</span></code> 没有指定 <code><span style="font-family:NSimsun">--quick</span></code> 或&#13;\n<code><span style="font-family:NSimsun">--opt</span></code> 选项，则会将整个结果集放在内存中。如果导出大数据库的话可能会出现问题。</span></p>&#13;\n</li><li><span style="font-size:18px">--quick，-q </span>&#13;\n<p><span style="font-size:18px">该选项在导出大表时很有用，它强制 <code><span style="font-family:NSimsun">mysqldump</span></code> 从服务器查询取得记录直接输出而不是取得所有记录后将它们缓存到内存中。</span></p>&#13;\n</li><li><span style="font-size:18px">--routines，-R </span>&#13;\n<p><span style="font-size:18px">导出存储过程以及自定义函数。</span></p>&#13;\n</li><li><span style="font-size:18px">--single-transaction </span>&#13;\n<p><span style="font-size:18px">该选项在导出数据之前提交一个 <code><span style="font-family:NSimsun">BEGIN</span></code> SQL语句，<code><span style="font-family:NSimsun">BEGIN</span></code> 不会阻塞任何应用程序且能保证导出时数据库的一致性状态。它只适用于事务表，例如&#13;\n<code><span style="font-family:NSimsun">InnoDB</span></code> 和 <code><span style="font-family:NSimsun">BDB</span></code>。<br />&#13;\n本选项和 <code><span style="font-family:NSimsun">--lock-tables</span></code> 选项是互斥的，因为&#13;\n<code><span style="font-family:NSimsun">LOCK TABLES</span></code> 会使任何挂起的事务隐含提交。<br />&#13;\n要想导出大表的话，应结合使用 <code><span style="font-family:NSimsun">--quick</span></code> 选项。 </span>&#13;\n</p>&#13;\n</li><li><span style="font-size:18px">--triggers </span>&#13;\n<p><span style="font-size:18px">同时导出触发器。该选项默认启用，用 <code><span style="font-family:NSimsun">--skip-triggers</span></code> 禁用它。</span></p>&#13;\n</li></ul>&#13;\n<p><span style="font-size:18px">其他参数详情请参考手册，我通常使用以下 SQL 来备份 <code><span style="font-family:NSimsun">MyISAM</span></code> 表：</span></p>&#13;\n<pre><span style="font-size:18px">/usr/local/mysql/bin/mysqldump -uyejr -pyejr \\\n--default-character-set=utf8 --opt --extended-insert=false \\\n--triggers -R --hex-blob -x db_name &gt; db_name.sql\n</span></pre>&#13;\n<p><span style="font-size:18px">使用以下 SQL 来备份 <code><span style="font-family:NSimsun">Innodb</span></code> 表：</span></p>&#13;\n<pre><span style="font-size:18px">/usr/local/mysql/bin/mysqldump -uyejr -pyejr \\\n--default-character-set=utf8 --opt --extended-insert=false \\\n--triggers -R --hex-blob --single-transaction db_name &gt; db_name.sql\n</span></pre>&#13;\n<p><span style="font-size:18px">另外，如果想要实现在线备份，还可以使用 <code><span style="font-family:NSimsun">--master-data</span></code> 参数来实现，如下：</span></p>&#13;\n<pre><span style="font-size:18px">/usr/local/mysql/bin/mysqldump -uyejr -pyejr \\\n--default-character-set=utf8 --opt --master-data=1 \\\n--single-transaction --flush-logs db_name &gt; db_name.sql\n</span></pre>&#13;\n<p><span style="font-size:18px">它只是在一开始的瞬间请求锁表，然后就刷新binlog了，而后在导出的文件中加入<code><span style="font-family:NSimsun">CHANGE MASTER</span></code> 语句来指定当前备份的binlog位置，如果要把这个文件恢复到slave里去，就可以采用这种方法来做。&#13;\n</span></p>&#13;\n<h4><span style="font-size:18px">1.2 还原</span></h4>&#13;\n<p><span style="font-size:18px">用 <code><span style="font-family:NSimsun">mysqldump</span></code> 备份出来的文件是一个可以直接倒入的 SQL 脚本，有两种方法可以将数据导入。</span></p>&#13;\n<ul type="1">&#13;\n<li><span style="font-size:18px">直接用 <code><span style="font-family:NSimsun">mysql</span></code> 客户端&#13;\n</span>&#13;\n<p><span style="font-size:18px">例如：</span></p>&#13;\n<pre><span style="font-size:18px">/usr/local/mysql/bin/mysql -uyejr -pyejr db_name &lt; db_name.sql\n</span></pre>&#13;\n<p><span style="font-size:18px"> </span></p>&#13;\n</li><li><span style="font-size:18px">用 SOURCE 语法 </span>&#13;\n<p><span style="font-size:18px">其实这不是标准的 SQL 语法，而是 <code><span style="font-family:NSimsun">mysql</span></code> 客户端提供的功能，例如：</span></p>&#13;\n<pre><span style="font-size:18px">SOURCE /tmp/db_name.sql;\n</span></pre>&#13;\n<p><span style="font-size:18px">这里需要指定文件的绝对路径，并且必须是 <code><span style="font-family:NSimsun">mysqld</span></code> 运行用户(例如 nobody)有权限读取的文件。</span></p>&#13;\n</li></ul>&#13;\n<h3><span style="font-size:18px">2、 mysqlhotcopy</span></h3>&#13;\n<h4><span style="font-size:18px">2.1 备份</span></h4>&#13;\n<p><span style="font-size:18px"><code><span style="font-family:NSimsun">mysqlhotcopy</span></code> 是一个 PERL 程序，最初由Tim Bunce编写。它使用&#13;\n<code><span style="font-family:NSimsun">LOCK TABLES、FLUSH TABLES</span></code> 和 <code>&#13;\n<span style="font-family:NSimsun">cp</span></code> 或 <code><span style="font-family:NSimsun">scp</span></code> 来快速备份数据库。它是备份数据库或单个表的最快的途径，但它只能运行在数据库文件（包括数据表定义文件、数据文件、索引文件）所在的机器上。<code><span style="font-family:NSimsun">mysqlhotcopy</span></code> 只能用于备份&#13;\n<code><span style="font-family:NSimsun">MyISAM</span></code>，并且只能运行在 <code><span style="font-family:NSimsun">类Unix</span></code> 和&#13;\n<code><span style="font-family:NSimsun">NetWare</span></code> 系统上。</span></p>&#13;\n<p><span style="font-size:18px"><code><span style="font-family:NSimsun">mysqlhotcopy</span></code> 支持一次性拷贝多个数据库，同时还支持正则表达。以下是几个例子：</span></p>&#13;\n<pre><span style="font-size:18px">root#/usr/local/mysql/bin/mysqlhotcopy -h=localhost -u=yejr -p=yejr \\\ndb_name /tmp (把数据库目录 <tt>db_name</tt> 拷贝到 <tt>/tmp</tt> 下)\nroot#/usr/local/mysql/bin/mysqlhotcopy -h=localhost -u=yejr -p=yejr \\\ndb_name_1 ... db_name_n /tmp\nroot#/usr/local/mysql/bin/mysqlhotcopy -h=localhost -u=yejr -p=yejr \\\ndb_name./regex/ /tmp\n</span></pre>&#13;\n<p><span style="font-size:18px">更详细的使用方法请查看手册，或者调用下面的命令来查看 <code><span style="font-family:NSimsun">mysqlhotcopy</span></code> 的帮助：</span></p>&#13;\n<pre><span style="font-size:18px">perldoc /usr/local/mysql/bin/mysqlhotcopy\n</span></pre>&#13;\n<p><span style="font-size:18px">注意，想要使用 <code><span style="font-family:NSimsun">mysqlhotcopy</span></code>，必须要有&#13;\n<code><span style="font-family:NSimsun">SELECT、RELOAD(要执行 FLUSH TABLES)</span></code> 权限，并且还必须要能够有读取&#13;\n<tt><span style="font-family:NSimsun">datadir/db_name</span></tt> 目录的权限。 </span></p>&#13;\n<h4><span style="font-size:18px">2.2 还原</span></h4>&#13;\n<p><span style="font-size:18px"><code><span style="font-family:NSimsun">mysqlhotcopy</span></code> 备份出来的是整个数据库目录，使用时可以直接拷贝到&#13;\n<code><span style="font-family:NSimsun">mysqld</span></code> 指定的 <tt><span style="font-family:NSimsun">datadir</span></tt> (在这里是&#13;\n<tt><span style="font-family:NSimsun">/usr/local/mysql/data/</span></tt>)目录下即可，同时要注意权限的问题，如下例：</span></p>&#13;\n<pre><span style="font-size:18px">root#cp -rf db_name /usr/local/mysql/data/\nroot#chown -R nobody:nobody /usr/local/mysql/data/ (将 db_name 目录的属主改成 <code>mysqld</code> 运行用户)\n</span></pre>&#13;\n<p><span style="font-size:18px"> </span></p>&#13;\n<h3><span style="font-size:18px">3、 SQL 语法备份</span></h3>&#13;\n<h4><span style="font-size:18px">3.1 备份</span></h4>&#13;\n<p><span style="font-size:18px"><code><span style="font-family:NSimsun">BACKUP TABLE</span></code> 语法其实和&#13;\n<code><span style="font-family:NSimsun">mysqlhotcopy</span></code> 的工作原理差不多，都是锁表，然后拷贝数据文件。它能实现在线备份，但是效果不理想，因此不推荐使用。它只拷贝表结构文件和数据文件，不同时拷贝索引文件，因此恢复时比较慢。<br />&#13;\n例子：</span></p>&#13;\n<pre><span style="font-size:18px">BACK TABLE tbl_name TO '/tmp/db_name/';\n</span></pre>&#13;\n<p><span style="font-size:18px">注意，必须要有 <code><span style="font-family:NSimsun">FILE</span></code> 权限才能执行本SQL，并且目录&#13;\n<tt><span style="font-family:NSimsun">/tmp/db_name/</span></tt> 必须能被 <code><span style="font-family:NSimsun">mysqld</span></code> 用户可写，导出的文件不能覆盖已经存在的文件，以避免安全问题。&#13;\n</span></p>&#13;\n<p><span style="font-size:18px"><code><span style="font-family:NSimsun">SELECT INTO OUTFILE</span></code> 则是把数据导出来成为普通的文本文件，可以自定义字段间隔的方式，方便处理这些数据。<br />&#13;\n例子：</span></p>&#13;\n<pre><span style="font-size:18px">SELECT csdn-10.html csdn-11.html csdn-12.html csdn-13.html csdn-14.html csdn-15.html csdn-16.html csdn-17.html csdn-18.html csdn-19.html csdn-1.html csdn-20.html csdn-21.html csdn-22.html csdn-23.html csdn-24.html csdn-25.html csdn-26.html csdn-27.html csdn-28.html csdn-29.html csdn-2.html csdn-30.html csdn-31.html csdn-32.html csdn-33.html csdn-34.html csdn-35.html csdn-36.html csdn-37.html csdn-38.html csdn-39.html csdn-3.html csdn-40.html csdn-41.html csdn-42.html csdn-43.html csdn-44.html csdn-45.html csdn-46.html csdn-47.html csdn-48.html csdn-49.html csdn-4.html csdn-50.html csdn-51.html csdn-52.html csdn-53.html csdn-54.html csdn-55.html csdn-56.html csdn-57.html csdn-58.html csdn-59.html csdn-5.html csdn-60.html csdn-61.html csdn-62.html csdn-63.html csdn-64.html csdn-65.html csdn-66.html csdn-67.html csdn-68.html csdn-69.html csdn-6.html csdn-70.html csdn-71.html csdn-72.html csdn-73.html csdn-74.html csdn-75.html csdn-76.html csdn-77.html csdn-78.html csdn-79.html csdn-7.html csdn-80.html csdn-81.html csdn-82.html csdn-83.html csdn-8.html csdn-9.html mysql.sh INTO OUTFILE '/tmp/db_name/tbl_name.txt' FROM tbl_name;\n</span></pre>&#13;\n<p><span style="font-size:18px">注意，必须要有 <code><span style="font-family:NSimsun">FILE</span></code> 权限才能执行本SQL，并且文件&#13;\n<tt><span style="font-family:NSimsun">/tmp/db_name/tbl_name.txt</span></tt> 必须能被 <code>&#13;\n<span style="font-family:NSimsun">mysqld</span></code> 用户可写，导出的文件不能覆盖已经存在的文件，以避免安全问题。&#13;\n</span></p>&#13;\n<h4><span style="font-size:18px">3.2 恢复</span></h4>&#13;\n<p><span style="font-size:18px">用 <code><span style="font-family:NSimsun">BACKUP TABLE</span></code> 方法备份出来的文件，可以运行&#13;\n<code><span style="font-family:NSimsun">RESTORE TABLE</span></code> 语句来恢复数据表。<br />&#13;\n例子：</span></p>&#13;\n<pre><span style="font-size:18px">RESTORE TABLE FROM '/tmp/db_name/';\n</span></pre>&#13;\n<p><span style="font-size:18px">权限要求类似上面所述。</span></p>&#13;\n<p><span style="font-size:18px">用 <code><span style="font-family:NSimsun">SELECT INTO OUTFILE</span></code> 方法备份出来的文件，可以运行&#13;\n<code><span style="font-family:NSimsun">LOAD DATA INFILE</span></code> 语句来恢复数据表。<br />&#13;\n例子：</span></p>&#13;\n<pre><span style="font-size:18px">LOAD DATA INFILE '/tmp/db_name/tbl_name.txt' INTO TABLE tbl_name;\n</span></pre>&#13;\n<p><span style="font-size:18px">权限要求类似上面所述。倒入数据之前，数据表要已经存在才行。如果担心数据会发生重复，可以增加 <code>&#13;\n<span style="font-family:NSimsun">REPLACE</span></code> 关键字来替换已有记录或者用 <code><span style="font-family:NSimsun">IGNORE</span></code> 关键字来忽略他们。</span></p>&#13;\n<h3><span style="font-size:18px">4、 启用二进制日志(binlog)</span></h3>&#13;\n<p><span style="font-size:18px">采用 <code><span style="font-family:NSimsun">binlog</span></code> 的方法相对来说更灵活，省心省力，而且还可以支持增量备份。</span></p>&#13;\n<p><span style="font-size:18px">启用 <code><span style="font-family:NSimsun">binlog</span></code> 时必须要重启&#13;\n<code><span style="font-family:NSimsun">mysqld</span></code>。首先，关闭 <code><span style="font-family:NSimsun">mysqld</span></code>，打开&#13;\n<code><span style="font-family:NSimsun">my.cnf</span></code>，加入以下几行：</span></p>&#13;\n<pre><span style="font-size:18px">server-id = 1\nlog-bin = binlog\nlog-bin-index = binlog.index\n</span></pre>&#13;\n<p><span style="font-size:18px">然后启动 <code><span style="font-family:NSimsun">mysqld</span></code> 就可以了。运行过程中会产生&#13;\n<code><span style="font-family:NSimsun">binlog.000001</span></code> 以及 <code><span style="font-family:NSimsun">binlog.index</span></code>，前面的文件是&#13;\n<code><span style="font-family:NSimsun">mysqld</span></code> 记录所有对数据的更新操作，后面的文件则是所有&#13;\n<code><span style="font-family:NSimsun">binlog</span></code> 的索引，都不能轻易删除。关于 <code>&#13;\n<span style="font-family:NSimsun">binlog</span></code> 的信息请查看手册。</span></p>&#13;\n<p><span style="font-size:18px">需要备份时，可以先执行一下 SQL 语句，让 <code><span style="font-family:NSimsun">mysqld</span></code> 终止对当前&#13;\n<code><span style="font-family:NSimsun">binlog</span></code> 的写入，就可以把文件直接备份，这样的话就能达到增量备份的目的了：</span></p>&#13;\n<pre><span style="font-size:18px">FLUSH LOGS;</span></pre>&#13;\n<p><span style="font-size:18px">如果是备份复制系统中的从服务器，还应该备份 <tt><span style="font-family:NSimsun">master.info</span></tt> 和&#13;\n<tt><span style="font-family:NSimsun">relay-log.info</span></tt> 文件。 </span></p>&#13;\n<p><span style="font-size:18px">备份出来的 <code><span style="font-family:NSimsun">binlog</span></code> 文件可以用 MySQL 提供的工具&#13;\n<code><span style="font-family:NSimsun">mysqlbinlog</span></code> 来查看，如：</span></p>&#13;\n<pre><span style="font-size:18px">/usr/local/mysql/bin/mysqlbinlog /tmp/binlog.000001\n</span></pre>&#13;\n<p><span style="font-size:18px">该工具允许你显示指定的数据库下的所有 SQL 语句，并且还可以限定时间范围，相当的方便，详细的请查看手册。</span></p>&#13;\n<p><span style="font-size:18px">恢复时，可以采用类似以下语句来做到：</span></p>&#13;\n<pre><span style="font-size:18px">/usr/local/mysql/bin/mysqlbinlog /tmp/binlog.000001 | mysql -uyejr -pyejr db_name\n</span></pre>&#13;\n<p><span style="font-size:18px">把 <code><span style="font-family:NSimsun">mysqlbinlog</span></code> 输出的 SQL 语句直接作为输入来执行它。</span></p>&#13;\n<p><span style="font-size:18px">如果你有空闲的机器，不妨采用这种方式来备份。由于作为 <code><span style="font-family:NSimsun">slave</span></code> 的机器性能要求相对不是那么高，因此成本低，用低成本就能实现增量备份而且还能分担一部分数据查询压力，何乐而不为呢？</span></p>&#13;\n<h3><span style="font-size:18px">5、 直接备份数据文件</span></h3>&#13;\n<p><span style="font-size:18px">相较前几种方法，备份数据文件最为直接、快速、方便，缺点是基本上不能实现增量备份。为了保证数据的一致性，需要在靠背文件前，执行以下 SQL 语句：</span></p>&#13;\n<pre><span style="font-size:18px">FLUSH TABLES WITH READ LOCK;</span></pre>&#13;\n<p><span style="font-size:18px">也就是把内存中的数据都刷新到磁盘中，同时锁定数据表，以保证拷贝过程中不会有新的数据写入。这种方法备份出来的数据恢复也很简单，直接拷贝回原来的数据库目录下即可。</span></p>&#13;\n<p><span style="font-size:18px">注意，对于 <code><span style="font-family:NSimsun">Innodb</span></code> 类型表来说，还需要备份其日志文件，即&#13;\n<code><span style="font-family:NSimsun">ib_logfile*</span></code> 文件。因为当 <code><span style="font-family:NSimsun">Innodb</span></code> 表损坏时，就可以依靠这些日志文件来恢复。</span></p>&#13;\n<h3><span style="font-size:18px">6、 备份策略</span></h3>&#13;\n<p><span style="font-size:18px">对于中等级别业务量的系统来说，备份策略可以这么定：第一次全量备份，每天一次增量备份，每周再做一次全量备份，如此一直重复。而对于重要的且繁忙的系统来说，则可能需要每天一次全量备份，每小时一次增量备份，甚至更频繁。为了不影响线上业务，实现在线备份，并且能增量备份，最好的办法就是采用主从复制机制(<code><span style="font-family:NSimsun">replication</span></code>)，在&#13;\n<code><span style="font-family:NSimsun">slave</span></code> 机器上做备份。</span></p>&#13;\n<h3><span style="font-size:18px">7、 数据维护和灾难恢复</span></h3>&#13;\n<p><span style="font-size:18px">作为一名DBA(我目前还不是，呵呵)，最重要的工作内容之一是保证数据表能安全、稳定、高速使用。因此，需要定期维护你的数据表。以下 SQL 语句就很有用：</span></p>&#13;\n<pre><span style="font-size:18px">CHECK TABLE 或 REPAIR TABLE，检查或维护 MyISAM 表\nOPTIMIZE TABLE，优化 MyISAM 表\nANALYZE TABLE，分析 MyISAM 表\n</span></pre>&#13;\n<p><span style="font-size:18px">当然了，上面这些命令起始都可以通过工具 <code><span style="font-family:NSimsun">myisamchk</span></code> 来完成，在这里不作详述。</span></p>&#13;\n<p><span style="font-size:18px"><code><span style="font-family:NSimsun">Innodb</span></code> 表则可以通过执行以下语句来整理碎片，提高索引速度：</span></p>&#13;\n<pre><span style="font-size:18px">ALTER TABLE tbl_name ENGINE = Innodb;\n</span></pre>&#13;\n<p><span style="font-size:18px">这其实是一个 <code><span style="font-family:NSimsun">NULL</span></code> 操作，表面上看什么也不做，实际上重新整理碎片了。</span></p>&#13;\n<p><span style="font-size:18px">通常使用的 <code><span style="font-family:NSimsun">MyISAM</span></code> 表可以用上面提到的恢复方法来完成。如果是索引坏了，可以用&#13;\n<code><span style="font-family:NSimsun">myisamchk</span></code> 工具来重建索引。而对于 <code>&#13;\n<span style="font-family:NSimsun">Innodb</span></code> 表来说，就没这么直接了，因为它把所有的表都保存在一个表空间了。不过&#13;\n<code><span style="font-family:NSimsun">Innodb</span></code> 有一个检查机制叫 <code><span style="font-family:NSimsun">模糊检查点</span></code>，只要保存了日志文件，就能根据日志文件来修复错误。可以在&#13;\n<tt><span style="font-family:NSimsun">my.cnf</span></tt> 文件中，增加以下参数，让 <code><span style="font-family:NSimsun">mysqld</span></code> 在启动时自动检查日志文件：</span></p>&#13;\n<pre><span style="font-size:18px">innodb_force_recovery = 4\n</span></pre>&#13;\n<p><span style="font-size:18px">关于该参数的信息请查看手册。</span></p>&#13;\n<h3><span style="font-size:18px">8、 总结</span></h3>&#13;\n<p><span style="font-size:18px">做好数据备份，定只好合适的备份策略，这是一个DBA所做事情的一小部分，万事开头难，就从现在开始吧！</span></p>&#13;\n<p><span style="font-size:18px"></span> </p>&#13;\n &#13;\n
